<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/97dc5fe527f5d592.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-40edba06f6f71edb.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-2b15443312687f8a.js" async=""></script><script src="/_next/static/chunks/596-adeabdb313a347d9.js" async=""></script><script src="/_next/static/chunks/main-app-326dcaa46b1410fc.js" async=""></script><title>Weekend project - graphing tumblr reblogs using cytoscape.js</title><meta name="description" content="A blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="128x128"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Weekend project - graphing tumblr reblogs using cytoscape.js</h1><h4>2015-08-30</h4></div><div><p>In the past, I made an app that used RStudio's Shiny platform to plot network
graphs with RGraphviz. This worked, and gave some nice results, but when I found
out about cytoscape.js, I really wanted to try that out.</p>
<p>The app is designed to plot tumblr reblogs, so it has a tree structure, but
simply plotting things as a tree is not very space efficient (as in, the
visualization takes up too much space). Therefore, using different types of
layouts can really help.</p>
<p>In my first app with graphviz <a href="https://colindiesh.shinyapps.io/tumblrgraph">https://colindiesh.shinyapps.io/tumblrgraph</a>, there
are several built-in graph layouts including "neato" "twopi", "circo", and "dot"</p>
<p>I made all of these available for users to try in the Shiny app. The names of
the layouts don't lend much to their behavior, but they are built-in functions
in Graphviz. There are both "tree" and "force-directed" style graph views. As I
mentioned, the "tree" style view make a lot of sense for the tumblr reblogs, but
the force directed graphs are also a lot more compact, so offering both styles
is useful.</p>
<p><img src="../../media/128000908903_0.png" alt=""></p>
<p>Figure 1. My default example graph from graphviz using the twopi layout.</p>
<p>I wanted to replicate all the features that I had in the Graphviz app in
Cytoscape.js. Here is the breakdown of the basic components that needed
replicating:</p>
<ol>
<li>
<p>Build the "graph" representation of reblogs in memory</p>
</li>
<li>
<p>Add user forms and configurability</p>
</li>
<li>
<p>Add color for distance from root using a breadth first search</p>
</li>
<li>
<p>Draw the graph</p>
</li>
</ol>
<p>As I went along, I was happy to learn that the concepts mapped very easily to
javascript and cytoscape.js. The implementations are a little different, but it
worked out very nicely.</p>
<p><img src="../../media/128000908903_1.png" alt=""></p>
<p>Figure 2. Same data plotted in Cytoscape.js with the springy layout.</p>
<p>In the new app, we enabled several different layouts similar to the Graphviz app
too. In cytoscape.js, the layouts that are offered include "arbor", "springy",
"cola", "cose", and "dagre". I like "cola" because it really looks like bubbles
moving around in a soda. Others are worth experimenting with too.</p>
<p><img src="../../media/128000908903_2.png" alt=""></p>
<p>Figure 3. A Cytoscape.js springy layout for a larger tumblr reblog graph</p>
<p>The new cytoscape.js app also has a nice animation feature. The old graphviz app
offered animation too (using Yihui's animation library for R) but the new
version can automatically encode HTML5 video on the client side from individual
picture frames in the browser using
<a href="https://github.com/antimatter15/whammy">"Whammy"</a>! This quite impressive!</p>
<p>So to animate the graph, what is done is</p>
<ol>
<li>
<p>Add nodes/edges and layout the graph (the simulation time is configurable,
because allowing the user to interact with the graph while the simulation is
running is useful)</p>
</li>
<li>
<p>Once layout is complete, the user can save the graph as an animation, which
first hides all nodes by adding visibility: hidden to the CSS.</p>
</li>
<li>
<p>Then the nodes are re-shown one-by-one, preserving the layout, and a frame is
saved by the renderer at each step (takes a snapshot of the canvas).</p>
</li>
</ol>
<p>This strategy for the animation is actually better than the original graphviz
version that I had because the layout is only done once, which is time saving
and it is also more consistent (the layout changes a lot if you re run it on
different sets of nodes).</p>
<p>Check out the app here <a href="http://cmdcolin.github.io/tumblrgraph2/">http://cmdcolin.github.io/tumblrgraph2/</a></p>
<p>Future goals:</p>
<ul>
<li>Test out super large graphs (I have tested up to about 500 reblogs but after
this, around 1000 reblogs, it slows down a lot and produces bad layouts. Needs
fixing)</li>
<li>Test out ability to place importance on certain nodes by increasing node size
based on it's degree</li>
</ul>
<p>Check out an example of the HTML5 video here</p></div><div style="margin-top:200px"></div></article><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/about">About</a></footer><script src="/_next/static/chunks/webpack-40edba06f6f71edb.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/97dc5fe527f5d592.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n5:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-3ae734227e2e8975.js\",\"185:static/chunks/app/layout-3759995e3b279a75.js\"],\"na"])</script><script>self.__next_f.push([1,"me\":\"\",\"async\":false}\n7:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/97dc5fe527f5d592.css\",\"precedence\":\"next\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"n6J26GJ4sS4ap58dzCFp9\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2015-08-30\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2015-08-30\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2015-08-30\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"style\":{\"marginBottom\":100},\"children\":[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"id\",\"2015-08-30\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L9\",\"$La\",null],\"segment\":\"__PAGE__?{\\\"id\\\":\\\"2015-08-30\\\"}\"},\"styles\":[]}],\"segment\":[\"id\",\"2015-08-30\",\"d\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}],[\"$\",\"footer\",null,{\"style\":{\"marginTop\":100},\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Home\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/archive\",\"children\":\"Blog archive\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"https://twitter.com/cmdcolin\",\"children\":\"Twitter\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/photos\",\"children\":\"Photos\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"c:I{\"id\":6306,\"chunks\":[\"722:static/chunks/app/posts/[id]/page-8cf76b3c924a344e.js\"],\"name\":\"\",\"async\":false}\nb:T1025,"])</script><script>self.__next_f.push([1,"\u003cp\u003eIn the past, I made an app that used RStudio's Shiny platform to plot network\ngraphs with RGraphviz. This worked, and gave some nice results, but when I found\nout about cytoscape.js, I really wanted to try that out.\u003c/p\u003e\n\u003cp\u003eThe app is designed to plot tumblr reblogs, so it has a tree structure, but\nsimply plotting things as a tree is not very space efficient (as in, the\nvisualization takes up too much space). Therefore, using different types of\nlayouts can really help.\u003c/p\u003e\n\u003cp\u003eIn my first app with graphviz \u003ca href=\"https://colindiesh.shinyapps.io/tumblrgraph\"\u003ehttps://colindiesh.shinyapps.io/tumblrgraph\u003c/a\u003e, there\nare several built-in graph layouts including \"neato\" \"twopi\", \"circo\", and \"dot\"\u003c/p\u003e\n\u003cp\u003eI made all of these available for users to try in the Shiny app. The names of\nthe layouts don't lend much to their behavior, but they are built-in functions\nin Graphviz. There are both \"tree\" and \"force-directed\" style graph views. As I\nmentioned, the \"tree\" style view make a lot of sense for the tumblr reblogs, but\nthe force directed graphs are also a lot more compact, so offering both styles\nis useful.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../../media/128000908903_0.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure 1. My default example graph from graphviz using the twopi layout.\u003c/p\u003e\n\u003cp\u003eI wanted to replicate all the features that I had in the Graphviz app in\nCytoscape.js. Here is the breakdown of the basic components that needed\nreplicating:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eBuild the \"graph\" representation of reblogs in memory\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAdd user forms and configurability\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAdd color for distance from root using a breadth first search\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDraw the graph\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eAs I went along, I was happy to learn that the concepts mapped very easily to\njavascript and cytoscape.js. The implementations are a little different, but it\nworked out very nicely.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../../media/128000908903_1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure 2. Same data plotted in Cytoscape.js with the springy layout.\u003c/p\u003e\n\u003cp\u003eIn the new app, we enabled several different layouts similar to the Graphviz app\ntoo. In cytoscape.js, the layouts that are offered include \"arbor\", \"springy\",\n\"cola\", \"cose\", and \"dagre\". I like \"cola\" because it really looks like bubbles\nmoving around in a soda. Others are worth experimenting with too.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../../media/128000908903_2.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure 3. A Cytoscape.js springy layout for a larger tumblr reblog graph\u003c/p\u003e\n\u003cp\u003eThe new cytoscape.js app also has a nice animation feature. The old graphviz app\noffered animation too (using Yihui's animation library for R) but the new\nversion can automatically encode HTML5 video on the client side from individual\npicture frames in the browser using\n\u003ca href=\"https://github.com/antimatter15/whammy\"\u003e\"Whammy\"\u003c/a\u003e! This quite impressive!\u003c/p\u003e\n\u003cp\u003eSo to animate the graph, what is done is\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eAdd nodes/edges and layout the graph (the simulation time is configurable,\nbecause allowing the user to interact with the graph while the simulation is\nrunning is useful)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOnce layout is complete, the user can save the graph as an animation, which\nfirst hides all nodes by adding visibility: hidden to the CSS.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThen the nodes are re-shown one-by-one, preserving the layout, and a frame is\nsaved by the renderer at each step (takes a snapshot of the canvas).\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis strategy for the animation is actually better than the original graphviz\nversion that I had because the layout is only done once, which is time saving\nand it is also more consistent (the layout changes a lot if you re run it on\ndifferent sets of nodes).\u003c/p\u003e\n\u003cp\u003eCheck out the app here \u003ca href=\"http://cmdcolin.github.io/tumblrgraph2/\"\u003ehttp://cmdcolin.github.io/tumblrgraph2/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFuture goals:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTest out super large graphs (I have tested up to about 500 reblogs but after\nthis, around 1000 reblogs, it slows down a lot and produces bad layouts. Needs\nfixing)\u003c/li\u003e\n\u003cli\u003eTest out ability to place importance on certain nodes by increasing node size\nbased on it's degree\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCheck out an example of the HTML5 video here\u003c/p\u003e"])</script><script>self.__next_f.push([1,"a:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Weekend project - graphing tumblr reblogs using cytoscape.js\"}],[\"$\",\"h4\",null,{\"children\":\"2015-08-30\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$b\"}}],[\"$\",\"$Lc\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Weekend project - graphing tumblr reblogs using cytoscape.js\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"128x128\"}]]\n9:null\n"])</script></body></html>