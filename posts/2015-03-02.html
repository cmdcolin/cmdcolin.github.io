<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Creating high-resolution screenshots (of jbrowse) with phantomJS</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/0e13ae09fdc48bba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0e13ae09fdc48bba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-01f10f588aa1f712.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-896947e153b7d53e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d6e6a35eb3960502.js" defer=""></script><script src="/_next/static/chunks/996-9e3c12b77542c098.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-9a0bc1852a8bf540.js" defer=""></script><script src="/_next/static/OTNg1yXSMVyKW0AuuKonA/_buildManifest.js" defer=""></script><script src="/_next/static/OTNg1yXSMVyKW0AuuKonA/_ssgManifest.js" defer=""></script><script src="/_next/static/OTNg1yXSMVyKW0AuuKonA/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Creating high-resolution screenshots (of jbrowse) with phantomJS</h1><h4>2015-03-02</h4></div><p>Generating screenshots that are of high quality can be a great benefit
for things like science publications. PhantomJS is great for automating
this in a reproducible way. While many HTML pages can be rendered in
high resolution without modification, HTML5 canvas apps need special
considerations (see this <!-- --><a href="http://searchvoidstar.tumblr.com/post/86542847038/high-dpi-rendering-on-html5-canvas-some-problems">previous post on the
topic</a>).<!-- --></p>
<!-- --><p>One of the key things that we noticed when we developed the high
resolution canvas rendering (see above link) is that the
&quot;devicePixelRatio&quot; can increase based on the browser&#x27;s zoom level, and
it can also take fractional values. This was a difficult problem, to
make rendering 100% consistent under all devicePixelRatio values, so we
created a config parameter called highResolutionMode to accept arbitrary
resolutions.</p>
<!-- --><p>Later, we learned about PhantomJS and how it can be used for creating
screenshots, it was clear that our design for the settings arbitrary
scaling factors for the HTML5 canvas was very helpful, as we can set
highResolutionMode=4 along with the phantomJS variable
page.zoomFactor=4, which matches the resolutions and creates high-res
canvas screenshots.</p>
<!-- --><p>One of the reasons that this is important is that it doesn&#x27;t look like
PhantomJS allows &quot;devicePixelRatio&quot; to be emulated, so the
page.zoomFactor doesn&#x27;t necessarily set the devicePixelRatio to a higher
number, so being able to set the the arbitrary high resolution canvas
scalings ourselves is a good solution. Reference: issue open Jan 2013
https://github.com/ariya/phantomjs/issues/10964 and we are now in Aug
2015</p>
<!-- --><p>Here are some examples of the rendering process.</p>
<!-- --><h2>Examples</h2>
<!-- --><ol>
<!-- --><li>
<!-- --><p>Rendering screenshots to PNG</p>
<!-- --><p>phantomjs rasterize.js
&quot;http://localhost/jbrowse/?data=sample_data/json/volvox&amp;tracklist=0&quot;
output.png &quot;3800px*1600px&quot; 2</p>
<!-- --><p><a href="http://i.imgur.com/ABLo6WJ.png"><img src="http://i.imgur.com/ABLo6WJ.png" alt=""/></a></p>
<!-- --><p>Figure 1. A basic image output from phantomJS. It uses a
zoomFactor=2 on the command line to match highResolutionMode=2 in
the config file. `</p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Rendering screenshots to PDF. In JBrowse, this requires PhantomJS
2.0. Also see footnote.</p>
<!-- --><p>phantomjs rasterize.js
&quot;http://localhost/jbrowse/?data=sample_data/json/volvox&amp;tracklist=0&quot;
output.pdf &quot;16in*8in&quot;</p>
<!-- --><p><a href="https://www.dropbox.com/s/7pceo4o406dys8s/output.pdf?dl=0">Dropbox PDF
906kb</a></p>
<!-- --><p>Figure 2. Outputted PDF from phantomJS. This still requires setting
the configuration such as highResolutionMode=2 too</p>
<!-- --></li>
<!-- --></ol>
<!-- --><h2>Conclusion</h2>
<!-- --><p>In the future, we want to consider adding highResolutionMode to be
specified via the URL so that it doesn&#x27;t need to be changed
manually, although, setting highResolutionMode=2 by default is not a
bad strategy.</p>
<!-- --><p><strong>Footnote</strong></p>
<!-- --><p>I used the following patch for rasterize.js to help &quot;fill out&quot; the
page space in PDF renderings (otherwise, it is a square page, not
super pretty for a widescreen app). I guess rasterize.js is really
just a template and not meant to be super multi-purposed, so this
custom modification helps for our case.</p>
<!-- --><pre><code>
        diff --git a/examples/rasterize.js b/examples/rasterize.js
        index b0e0f67..3b0b6e4 100644
        --- a/examples/rasterize.js
        +++ b/examples/rasterize.js
        _@@ -14,6 +14,7 @@ if (system.args.length &lt; 3 || system.args.length &gt; 5) {
            page.viewportSize = { width: 600, height: 600 };
            if (system.args.length &gt; 3 &amp;&amp; system.args[2].substr(-4) === &quot;.pdf&quot;) {
                size = system.args[3].split(&#x27;_&#x27;);

        +       page.viewportSize.width *= parseInt(size[0])/parseInt(size[1]);
                page.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: &#x27;0px&#x27; }

</code></pre>
<!-- --><p><strong>Reference</strong></p>
<!-- --><p>https://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS</p>
<!-- --><p><strong>Comparison</strong></p>
<!-- --><p><img src="/media/112494997473_0.png" alt="image"/></p>
<!-- --><p>Big improvement on font rendering</p><div style="margin-top:200px"><giscus-widget id="comments" repo="cmdcolin/cmdcolin.github.io" repoid="MDEwOlJlcG9zaXRvcnkyNjE0OTY3Nw==" category="General" categoryid="DIC_kwDOAY8DLc4CO-L9" mapping="pathname" term="Welcome to @giscus/react component!" reactionsenabled="1" emitmetadata="0" inputposition="top" lang="en" loading="lazy"></giscus-widget></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <!-- --><a href="/archive">Blog archive</a> <!-- --><a href="https://github.com/cmdcolin/">Github</a> <!-- --><a href="https://twitter.com/cmdcolin">Twitter</a> <!-- --><a href="/projects">Projects</a> <!-- --><a href="/photos">Photos</a> <!-- --><a href="/rss.xml">RSS</a><a href="/about">About</a> <!-- --></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Creating high-resolution screenshots (of jbrowse) with phantomJS","date":"2015-03-02","slug":"2015-03-02","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      a: \"a\",\n      h2: \"h2\",\n      ol: \"ol\",\n      li: \"li\",\n      img: \"img\",\n      strong: \"strong\",\n      pre: \"pre\",\n      code: \"code\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsxs(_components.p, {\n        children: [\"Generating screenshots that are of high quality can be a great benefit\\nfor things like science publications. PhantomJS is great for automating\\nthis in a reproducible way. While many HTML pages can be rendered in\\nhigh resolution without modification, HTML5 canvas apps need special\\nconsiderations (see this \", _jsx(_components.a, {\n          href: \"http://searchvoidstar.tumblr.com/post/86542847038/high-dpi-rendering-on-html5-canvas-some-problems\",\n          children: \"previous post on the\\ntopic\"\n        }), \").\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"One of the key things that we noticed when we developed the high\\nresolution canvas rendering (see above link) is that the\\n\\\"devicePixelRatio\\\" can increase based on the browser's zoom level, and\\nit can also take fractional values. This was a difficult problem, to\\nmake rendering 100% consistent under all devicePixelRatio values, so we\\ncreated a config parameter called highResolutionMode to accept arbitrary\\nresolutions.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Later, we learned about PhantomJS and how it can be used for creating\\nscreenshots, it was clear that our design for the settings arbitrary\\nscaling factors for the HTML5 canvas was very helpful, as we can set\\nhighResolutionMode=4 along with the phantomJS variable\\npage.zoomFactor=4, which matches the resolutions and creates high-res\\ncanvas screenshots.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"One of the reasons that this is important is that it doesn't look like\\nPhantomJS allows \\\"devicePixelRatio\\\" to be emulated, so the\\npage.zoomFactor doesn't necessarily set the devicePixelRatio to a higher\\nnumber, so being able to set the the arbitrary high resolution canvas\\nscalings ourselves is a good solution. Reference: issue open Jan 2013\\nhttps://github.com/ariya/phantomjs/issues/10964 and we are now in Aug\\n2015\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Here are some examples of the rendering process.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Examples\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"Rendering screenshots to PNG\"\n          }), \"\\n\", _jsx(_components.p, {\n            children: \"phantomjs rasterize.js\\n\\\"http://localhost/jbrowse/?data=sample_data/json/volvox\u0026tracklist=0\\\"\\noutput.png \\\"3800px*1600px\\\" 2\"\n          }), \"\\n\", _jsx(_components.p, {\n            children: _jsx(_components.a, {\n              href: \"http://i.imgur.com/ABLo6WJ.png\",\n              children: _jsx(_components.img, {\n                src: \"http://i.imgur.com/ABLo6WJ.png\",\n                alt: \"\"\n              })\n            })\n          }), \"\\n\", _jsx(_components.p, {\n            children: \"Figure 1. A basic image output from phantomJS. It uses a\\nzoomFactor=2 on the command line to match highResolutionMode=2 in\\nthe config file. `\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"Rendering screenshots to PDF. In JBrowse, this requires PhantomJS\\n2.0. Also see footnote.\"\n          }), \"\\n\", _jsx(_components.p, {\n            children: \"phantomjs rasterize.js\\n\\\"http://localhost/jbrowse/?data=sample_data/json/volvox\u0026tracklist=0\\\"\\noutput.pdf \\\"16in*8in\\\"\"\n          }), \"\\n\", _jsx(_components.p, {\n            children: _jsx(_components.a, {\n              href: \"https://www.dropbox.com/s/7pceo4o406dys8s/output.pdf?dl=0\",\n              children: \"Dropbox PDF\\n906kb\"\n            })\n          }), \"\\n\", _jsx(_components.p, {\n            children: \"Figure 2. Outputted PDF from phantomJS. This still requires setting\\nthe configuration such as highResolutionMode=2 too\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Conclusion\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"In the future, we want to consider adding highResolutionMode to be\\nspecified via the URL so that it doesn't need to be changed\\nmanually, although, setting highResolutionMode=2 by default is not a\\nbad strategy.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Footnote\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I used the following patch for rasterize.js to help \\\"fill out\\\" the\\npage space in PDF renderings (otherwise, it is a square page, not\\nsuper pretty for a widescreen app). I guess rasterize.js is really\\njust a template and not meant to be super multi-purposed, so this\\ncustom modification helps for our case.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"\\n        diff --git a/examples/rasterize.js b/examples/rasterize.js\\n        index b0e0f67..3b0b6e4 100644\\n        --- a/examples/rasterize.js\\n        +++ b/examples/rasterize.js\\n        _@@ -14,6 +14,7 @@ if (system.args.length \u003c 3 || system.args.length \u003e 5) {\\n            page.viewportSize = { width: 600, height: 600 };\\n            if (system.args.length \u003e 3 \u0026\u0026 system.args[2].substr(-4) === \\\".pdf\\\") {\\n                size = system.args[3].split('_');\\n\\n        +       page.viewportSize.width *= parseInt(size[0])/parseInt(size[1]);\\n                page.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: '0px' }\\n\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Reference\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"https://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Comparison\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/media/112494997473_0.png\",\n          alt: \"image\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Big improvement on font rendering\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2015-03-02"},"buildId":"OTNg1yXSMVyKW0AuuKonA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>