<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/39906f0ead253838.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-cf9978add419332d.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-036ba755ca4c01b9.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-2fd8d12fd0434ef5.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-8727dae2732bf68b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-f44480ff89778119.js" async=""></script><script src="/_next/static/chunks/app/page-df14802d5ca2542f.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-419ffa6790b88dec.js" async=""></script><title>Creating high-resolution screenshots (of jbrowse) with phantomJS</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Creating high-resolution screenshots (of jbrowse) with phantomJS</h1><h4>2015-03-02</h4></div><div><p>Generating screenshots that are of high quality can be a great benefit for
things like science publications. PhantomJS is great for automating this in a
reproducible way. While many HTML pages can be rendered in high resolution
without modification, HTML5 canvas apps need special considerations (see this
<a href="http://searchvoidstar.tumblr.com/post/86542847038/high-dpi-rendering-on-html5-canvas-some-problems">previous post on the topic</a>).</p>
<p>One of the key things that we noticed when we developed the high resolution
canvas rendering (see above link) is that the "devicePixelRatio" can increase
based on the browser's zoom level, and it can also take fractional values. This
was a difficult problem, to make rendering 100% consistent under all
devicePixelRatio values, so we created a config parameter called
highResolutionMode to accept arbitrary resolutions.</p>
<p>Later, we learned about PhantomJS and how it can be used for creating
screenshots, it was clear that our design for the settings arbitrary scaling
factors for the HTML5 canvas was very helpful, as we can set
highResolutionMode=4 along with the phantomJS variable page.zoomFactor=4, which
matches the resolutions and creates high-res canvas screenshots.</p>
<p>One of the reasons that this is important is that it doesn't look like PhantomJS
allows "devicePixelRatio" to be emulated, so the page.zoomFactor doesn't
necessarily set the devicePixelRatio to a higher number, so being able to set
the the arbitrary high resolution canvas scalings ourselves is a good solution.
Reference: issue open Jan 2013 <a href="https://github.com/ariya/phantomjs/issues/10964">https://github.com/ariya/phantomjs/issues/10964</a>
and we are now in Aug 2015</p>
<p>Here are some examples of the rendering process.</p>
<h2 id="examples"><a aria-hidden="true" tabindex="-1" href="#examples"><a href="#examples" style="margin-right: 10px">#</a></a>Examples</h2>
<ol>
<li>
<p>Rendering screenshots to PNG</p>
<p>phantomjs rasterize.js
"<a href="http://localhost/jbrowse/?data=sample_data/json/volvox&#x26;tracklist=0">http://localhost/jbrowse/?data=sample_data/json/volvox&#x26;tracklist=0</a>"
output.png "3800px*1600px" 2</p>
<p><a href="http://i.imgur.com/ABLo6WJ.png"><img src="http://i.imgur.com/ABLo6WJ.png" alt=""></a></p>
<p>Figure 1. A basic image output from phantomJS. It uses a zoomFactor=2 on the
command line to match highResolutionMode=2 in the config file. `</p>
</li>
<li>
<p>Rendering screenshots to PDF. In JBrowse, this requires PhantomJS 2.0. Also
see footnote.</p>
<p>phantomjs rasterize.js
"<a href="http://localhost/jbrowse/?data=sample_data/json/volvox&#x26;tracklist=0">http://localhost/jbrowse/?data=sample_data/json/volvox&#x26;tracklist=0</a>"
output.pdf "16in*8in"</p>
<p><a href="https://www.dropbox.com/s/7pceo4o406dys8s/output.pdf?dl=0">Dropbox PDF 906kb</a></p>
<p>Figure 2. Outputted PDF from phantomJS. This still requires setting the
configuration such as highResolutionMode=2 too</p>
</li>
</ol>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>In the future, we want to consider adding highResolutionMode to be specified via
the URL so that it doesn't need to be changed manually, although, setting
highResolutionMode=2 by default is not a bad strategy.</p>
<p><strong>Footnote</strong></p>
<p>I used the following patch for rasterize.js to help "fill out" the page space in
PDF renderings (otherwise, it is a square page, not super pretty for a
widescreen app). I guess rasterize.js is really just a template and not meant to
be super multi-purposed, so this custom modification helps for our case.</p>
<pre><code>
        diff --git a/examples/rasterize.js b/examples/rasterize.js
        index b0e0f67..3b0b6e4 100644
        --- a/examples/rasterize.js
        +++ b/examples/rasterize.js
        _@@ -14,6 +14,7 @@ if (system.args.length &#x3C; 3 || system.args.length > 5) {
            page.viewportSize = { width: 600, height: 600 };
            if (system.args.length > 3 &#x26;&#x26; system.args[2].substr(-4) === ".pdf") {
                size = system.args[3].split('_');

        +       page.viewportSize.width *= parseInt(size[0])/parseInt(size[1]);
                page.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: '0px' }

</code></pre>
<p><strong>Reference</strong></p>
<p><a href="https://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS">https://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS</a></p>
<p><strong>Comparison</strong></p>
<p><img src="/media/112494997473_0.png" alt="image"></p>
<p>Big improvement on font rendering</p></div><div style="margin-top:200px"></div></article><footer style="margin-top:100px"><a href="/">Home</a><a href="/archive">Blog archive</a><a href="https://github.com/cmdcolin/">Github</a><a href="/projects">Projects</a> <a href="/photos">Photos</a><a href="/books">Books</a><a href="/about">About</a><a href="/uses">Uses</a></footer><script src="/_next/static/chunks/webpack-cf9978add419332d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/39906f0ead253838.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I[7690,[],\"\"]\n6:I[5613,[],\"\"]\n8:I[1778,[],\"\"]\n9:I[5250,[\"250\",\"static/chunks/250-f44480ff89778119.js\",\"931\",\"static/chunks/app/page-df14802d5ca2542f.js\"],\"\"]\nb:I[8955,[],\"\"]\n7:[\"id\",\"2015-03-02\",\"d\"]\nc:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/39906f0ead253838.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"KN7zu-09iBkUlxsS297PW\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2015-03-02\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2015-03-02\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2015-03-02\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2015-03-02\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L4\",\"$L5\",null]]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$7\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"style\":{\"marginBottom\":100},\"children\":[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}],[\"$\",\"footer\",null,{\"style\":{\"marginTop\":100},\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L9\",null,{\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L9\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}],\" \",[\"$\",\"$L9\",null,{\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L9\",null,{\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L9\",null,{\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L9\",null,{\"href\":\"/uses\",\"children\":\"Uses\"}]]}]]}]}],null]],\"initialHead\":[false,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[4883,[\"722\",\"static/chunks/app/posts/%5Bid%5D/page-419ffa6790b88dec.js\"],\"\"]\nd:T12b0,"])</script><script>self.__next_f.push([1,"\u003cp\u003eGenerating screenshots that are of high quality can be a great benefit for\nthings like science publications. PhantomJS is great for automating this in a\nreproducible way. While many HTML pages can be rendered in high resolution\nwithout modification, HTML5 canvas apps need special considerations (see this\n\u003ca href=\"http://searchvoidstar.tumblr.com/post/86542847038/high-dpi-rendering-on-html5-canvas-some-problems\"\u003eprevious post on the topic\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eOne of the key things that we noticed when we developed the high resolution\ncanvas rendering (see above link) is that the \"devicePixelRatio\" can increase\nbased on the browser's zoom level, and it can also take fractional values. This\nwas a difficult problem, to make rendering 100% consistent under all\ndevicePixelRatio values, so we created a config parameter called\nhighResolutionMode to accept arbitrary resolutions.\u003c/p\u003e\n\u003cp\u003eLater, we learned about PhantomJS and how it can be used for creating\nscreenshots, it was clear that our design for the settings arbitrary scaling\nfactors for the HTML5 canvas was very helpful, as we can set\nhighResolutionMode=4 along with the phantomJS variable page.zoomFactor=4, which\nmatches the resolutions and creates high-res canvas screenshots.\u003c/p\u003e\n\u003cp\u003eOne of the reasons that this is important is that it doesn't look like PhantomJS\nallows \"devicePixelRatio\" to be emulated, so the page.zoomFactor doesn't\nnecessarily set the devicePixelRatio to a higher number, so being able to set\nthe the arbitrary high resolution canvas scalings ourselves is a good solution.\nReference: issue open Jan 2013 \u003ca href=\"https://github.com/ariya/phantomjs/issues/10964\"\u003ehttps://github.com/ariya/phantomjs/issues/10964\u003c/a\u003e\nand we are now in Aug 2015\u003c/p\u003e\n\u003cp\u003eHere are some examples of the rendering process.\u003c/p\u003e\n\u003ch2 id=\"examples\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#examples\"\u003e\u003ca href=\"#examples\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eExamples\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eRendering screenshots to PNG\u003c/p\u003e\n\u003cp\u003ephantomjs rasterize.js\n\"\u003ca href=\"http://localhost/jbrowse/?data=sample_data/json/volvox\u0026#x26;tracklist=0\"\u003ehttp://localhost/jbrowse/?data=sample_data/json/volvox\u0026#x26;tracklist=0\u003c/a\u003e\"\noutput.png \"3800px*1600px\" 2\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/ABLo6WJ.png\"\u003e\u003cimg src=\"http://i.imgur.com/ABLo6WJ.png\" alt=\"\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFigure 1. A basic image output from phantomJS. It uses a zoomFactor=2 on the\ncommand line to match highResolutionMode=2 in the config file. `\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRendering screenshots to PDF. In JBrowse, this requires PhantomJS 2.0. Also\nsee footnote.\u003c/p\u003e\n\u003cp\u003ephantomjs rasterize.js\n\"\u003ca href=\"http://localhost/jbrowse/?data=sample_data/json/volvox\u0026#x26;tracklist=0\"\u003ehttp://localhost/jbrowse/?data=sample_data/json/volvox\u0026#x26;tracklist=0\u003c/a\u003e\"\noutput.pdf \"16in*8in\"\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.dropbox.com/s/7pceo4o406dys8s/output.pdf?dl=0\"\u003eDropbox PDF 906kb\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFigure 2. Outputted PDF from phantomJS. This still requires setting the\nconfiguration such as highResolutionMode=2 too\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eIn the future, we want to consider adding highResolutionMode to be specified via\nthe URL so that it doesn't need to be changed manually, although, setting\nhighResolutionMode=2 by default is not a bad strategy.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eFootnote\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eI used the following patch for rasterize.js to help \"fill out\" the page space in\nPDF renderings (otherwise, it is a square page, not super pretty for a\nwidescreen app). I guess rasterize.js is really just a template and not meant to\nbe super multi-purposed, so this custom modification helps for our case.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\n        diff --git a/examples/rasterize.js b/examples/rasterize.js\n        index b0e0f67..3b0b6e4 100644\n        --- a/examples/rasterize.js\n        +++ b/examples/rasterize.js\n        _@@ -14,6 +14,7 @@ if (system.args.length \u0026#x3C; 3 || system.args.length \u003e 5) {\n            page.viewportSize = { width: 600, height: 600 };\n            if (system.args.length \u003e 3 \u0026#x26;\u0026#x26; system.args[2].substr(-4) === \".pdf\") {\n                size = system.args[3].split('_');\n\n        +       page.viewportSize.width *= parseInt(size[0])/parseInt(size[1]);\n                page.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: '0px' }\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eReference\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS\"\u003ehttps://gmod.org/wiki/JBrowse_Configuration_Guide#Rendering_high_resolution_screenshots_using_PhantomJS\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eComparison\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/112494997473_0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eBig improvement on font rendering\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Creating high-resolution screenshots (of jbrowse) with phantomJS\"}],[\"$\",\"h4\",null,{\"children\":\"2015-03-02\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}],[\"$\",\"$Le\",null,{}]]}]\na:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Creating high-resolution screenshots (of jbrowse) with phantomJS\"}],"])</script><script>self.__next_f.push([1,"[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n4:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>