<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Using find . -exec sed is dangerous in a git repo</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/0e13ae09fdc48bba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0e13ae09fdc48bba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-650c232b10a672f9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1e17a6754614af77.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-84373ebc334238b8.js" defer=""></script><script src="/_next/static/MqCJyDTjnrfNSpF-3A_uq/_buildManifest.js" defer=""></script><script src="/_next/static/MqCJyDTjnrfNSpF-3A_uq/_ssgManifest.js" defer=""></script><script src="/_next/static/MqCJyDTjnrfNSpF-3A_uq/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Using find . -exec sed is dangerous in a git repo</h1><h4>2022-05-04</h4></div><p>You want to find and replace in a code, so you google &quot;find replace directory
linux command&quot;. You end up here</p>
<!-- --><p><a href="https://stackoverflow.com/a/6759339/2129219">https://stackoverflow.com/a/6759339/2129219</a></p>
<!-- --><p>They tell us</p>
<!-- --><pre><code class="language-sh">find ./ -type f -exec sed -i -e &#x27;s/apple/orange/g&#x27; {} \;
</code></pre>
<!-- --><p>Ignoring the fact that this syntax is very long and annoying, this command is
dangerous to use in a git repository. Specifically, this can corrupt your .git
contents.</p>
<!-- --><h2>Why?</h2>
<!-- --><p>This command is dangerous because, find . will enumerate dotfiles, including
the .git directory, and then of course will run the find and replace inside
them. We can see this in the following session</p>
<!-- --><pre><code class="language-sh">&gt; mkdir corruptme
&gt; cd corruptme
&gt; git init
&gt; echo &quot;# README&quot; &gt; README.md
&gt; git add README.md
&gt; git commit -m &quot;Initial commit&quot;
&gt; echo &quot;Hello world, it is a beautiful day. I sure hope someone doesn&#x27;t corrupt this git repository&quot; &gt;&gt; README.md
&gt; git commit -am &quot;Update README.md&quot;
&gt; find ./ -type f -exec sed -i -e &quot;s/README/CORRUPTME/g&quot; {} \;
&gt; git status
error: index uses md extension, which we do not understand
fatal: index file corrupt
</code></pre>
<!-- --><p>In this case, you may be able to recover it e.g. with
https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git</p>
<!-- --><p>If you happened to replace some random text that is actually in an object file though e.g. .git/objects</p>
<!-- --><pre><code class="language-sh">&gt; find ./ -type f -exec sed -i -e &quot;s/VHTHJM/OOOOOO/g&quot; {} \;
&gt; git status
error: inflate: data stream error (incorrect data check)
error: corrupt loose object &#x27;26cfc5964dfa5355a1747eb6eec6250aab5212d5&#x27;
fatal: unable to read 26cfc5964dfa5355a1747eb6eec6250aab5212d5
</code></pre>
<!-- --><h2>How to fix?</h2>
<!-- --><p>My take: Use ruplacer <!-- --><a href="https://github.com/dmerejkowsky/ruplacer">https://github.com/dmerejkowsky/ruplacer</a></p>
<!-- --><p>This tool respects .gitignore and won&#x27;t try to replace stuff in your .git
directory. It will not spend time replacing text for your .git or anything in
.gitignore including e.g. node_modules. I was delighted to discover this tool
so, just spreading the word</p></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <!-- --><a href="/archive">Blog archive</a> <!-- --><a href="https://github.com/cmdcolin/">Github</a> <!-- --><a href="https://twitter.com/cmdcolin">Twitter</a> <!-- --><a href="/projects">Projects</a> <!-- --><a href="https://scholar.google.com/citations?view_op=list_works&amp;hl=en&amp;user=--FwzsgAAAAJ">Publications</a> <!-- --><a href="/sketches">Sketches</a> <!-- --><a href="/kitty">Kitty</a> <!-- --><a href="/rss.xml">RSS</a><a href="/about">About</a> <!-- --></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Using find . -exec sed is dangerous in a git repo","date":"2022-05-04","slug":"2022-05-04-findseddangerous","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      a: \"a\",\n      pre: \"pre\",\n      code: \"code\",\n      h2: \"h2\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: \"You want to find and replace in a code, so you google \\\"find replace directory\\nlinux command\\\". You end up here\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.a, {\n          href: \"https://stackoverflow.com/a/6759339/2129219\",\n          children: \"https://stackoverflow.com/a/6759339/2129219\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"They tell us\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-sh\",\n          children: \"find ./ -type f -exec sed -i -e 's/apple/orange/g' {} \\\\;\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Ignoring the fact that this syntax is very long and annoying, this command is\\ndangerous to use in a git repository. Specifically, this can corrupt your .git\\ncontents.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Why?\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This command is dangerous because, find . will enumerate dotfiles, including\\nthe .git directory, and then of course will run the find and replace inside\\nthem. We can see this in the following session\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-sh\",\n          children: \"\u003e mkdir corruptme\\n\u003e cd corruptme\\n\u003e git init\\n\u003e echo \\\"# README\\\" \u003e README.md\\n\u003e git add README.md\\n\u003e git commit -m \\\"Initial commit\\\"\\n\u003e echo \\\"Hello world, it is a beautiful day. I sure hope someone doesn't corrupt this git repository\\\" \u003e\u003e README.md\\n\u003e git commit -am \\\"Update README.md\\\"\\n\u003e find ./ -type f -exec sed -i -e \\\"s/README/CORRUPTME/g\\\" {} \\\\;\\n\u003e git status\\nerror: index uses md extension, which we do not understand\\nfatal: index file corrupt\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"In this case, you may be able to recover it e.g. with\\nhttps://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"If you happened to replace some random text that is actually in an object file though e.g. .git/objects\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-sh\",\n          children: \"\u003e find ./ -type f -exec sed -i -e \\\"s/VHTHJM/OOOOOO/g\\\" {} \\\\;\\n\u003e git status\\nerror: inflate: data stream error (incorrect data check)\\nerror: corrupt loose object '26cfc5964dfa5355a1747eb6eec6250aab5212d5'\\nfatal: unable to read 26cfc5964dfa5355a1747eb6eec6250aab5212d5\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"How to fix?\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"My take: Use ruplacer \", _jsx(_components.a, {\n          href: \"https://github.com/dmerejkowsky/ruplacer\",\n          children: \"https://github.com/dmerejkowsky/ruplacer\"\n        })]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"This tool respects .gitignore and won't try to replace stuff in your .git\\ndirectory. It will not spend time replacing text for your .git or anything in\\n.gitignore including e.g. node_modules. I was delighted to discover this tool\\nso, just spreading the word\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2022-05-04-findseddangerous"},"buildId":"MqCJyDTjnrfNSpF-3A_uq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>