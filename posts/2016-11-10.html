<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Creating a JBrowse plugin</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/50853c3f2e0364c3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/50853c3f2e0364c3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-93aa87d657ed1852.js" defer=""></script><script src="/_next/static/chunks/framework-c0d8f0fd2eea5ac1.js" defer=""></script><script src="/_next/static/chunks/main-b12cd062888056b2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9139de5c3de3b6b.js" defer=""></script><script src="/_next/static/chunks/996-3d2a4318c0ac6f1a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-b6f09b4db8bfc341.js" defer=""></script><script src="/_next/static/zXsOoPt4_HtQEfr4qBXnO/_buildManifest.js" defer=""></script><script src="/_next/static/zXsOoPt4_HtQEfr4qBXnO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Creating a JBrowse plugin</h1><h4>2016-11-10</h4></div><div><p>I have been very impressed with peoples creativity and willingness to
dig into all the details of JBrowse to customize it's features. One
great way to do this in a modular way is to create a "JBrowse plugin".
This concept sounds hard but you can set up a simple couple of files and
refresh your browser and it will "just work"!</p>
<h2 id="introduction-to-the-plugin-mindset"><a aria-hidden="true" tabindex="-1" href="#introduction-to-the-plugin-mindset"><a href="#introduction-to-the-plugin-mindset" style="margin-right: 10px">#</a></a>Introduction to the plugin mindset</h2>
<p>In a plugin, you can define new things like custom track types, custom
adaptors to new file types, new track selectors, or something really
different. A key insight about the custom types of tracks and things
though is that you can put the name of your new custom class in the
jbrowse config file which will then find the code in your plugin and run
it. Plugins can do other things, but the ability to just swap out track
types or other components in the config file is a great benefit.</p>
<h2 id="a-scenario"><a aria-hidden="true" tabindex="-1" href="#a-scenario"><a href="#a-scenario" style="margin-right: 10px">#</a></a>A scenario</h2>
<p>One example that was talked about on the mailing list might involve
adding new menu items for a given track. We might consider a plugin that
defines a custom track type to add that functionality.</p>
<p>Basically, we can use object- oriented principles to "inherit" from some
existing track type like CanvasFeatures and then extend its
functionality by overriding the functions.</p>
<p>If you are not familiar with object-oriented javascript, dojo makes it
pretty easy (but, especially get a background on this if you need to,
see footnotes below).</p>
<p>We can inherit a new track type by using the "define" function to
include the dependencies needed in a file, and they are listed in an
array at the top of your file.</p>
<p>Then the "declare" function creates a new class. The first argument to
declare is the is your parent class, like CanvasFeatures, and we type
"return declare" because we are returning our new track class from the
module.</p>
<div class="highlight highlight-js"><pre><span class="pl-en">define</span>([<span class="pl-s"><span class="pl-pds">'</span>dojo/_base/declare<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>JBrowse/View/Track/CanvasFeatures<span class="pl-pds">'</span></span>], <span class="pl-k">function</span> (
  <span class="pl-smi">declare</span>,
  <span class="pl-smi">CanvasFeatures</span>,
) {
  <span class="pl-k">return</span> <span class="pl-en">declare</span>(CanvasFeatures, {
    <span class="pl-en">_trackMenuOptions</span><span class="pl-k">:</span> <span class="pl-k">function</span> () {
      <span class="pl-k">var</span> opts <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-en">inherited</span>(<span class="pl-c1">arguments</span>) <span class="pl-c">//call the parent classes function</span>

      <span class="pl-smi">opts</span>.<span class="pl-c1">push</span>(
        <span class="pl-c">// add an extra menu item to the array returned from parent class function</span>
        {
          label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Custom item<span class="pl-pds">'</span></span>,
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>dijit/CheckedMenuItem<span class="pl-pds">'</span></span>,
          <span class="pl-en">onClick</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-c1">event</span>) {
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Clicked<span class="pl-pds">'</span></span>)
          },
          iconClass<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>dijitIconPackage<span class="pl-pds">'</span></span>,
        },
      )
      <span class="pl-k">return</span> opts
    },
  })
})
</pre></div>
<p>Code listing 1. an example custom track type, MyTrack.js, that adds an
extra track menu item</p>
<h2 id="now-how-do-we-make-this-a-plugin"><a aria-hidden="true" tabindex="-1" href="#now-how-do-we-make-this-a-plugin"><a href="#now-how-do-we-make-this-a-plugin" style="margin-right: 10px">#</a></a>Now how do we make this a plugin?</h2>
<p>In the above section, we created a new track subclass with a custom menu
option. How do we use this track? We want to turn it into part of afine
the boilerplate code from the <a href="http://gmod.org/wiki/JBrowse_Configuration_Guide#Writing_JBrowse_Plugins">Writing
plugins</a>
guide.</p>
<div class="highlight highlight-js"><pre><span class="pl-en">define</span>([<span class="pl-s"><span class="pl-pds">'</span>dojo/_base/declare<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>JBrowse/Plugin<span class="pl-pds">'</span></span>], <span class="pl-k">function</span> (
  <span class="pl-smi">declare</span>,
  <span class="pl-smi">JBrowsePlugin</span>,
) {
  <span class="pl-k">return</span> <span class="pl-en">declare</span>(
    JBrowsePlugin, <span class="pl-c">// this line says our plugin's main.js derives from the "JBrowse/Plugin" base class</span>
    {
      <span class="pl-en">constructor</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">args</span>) {
        <span class="pl-c">//don't necessarily have to do any initializing here, but you</span>
        <span class="pl-c">//can get a handle to various jbrowse components if any initialization</span>
        <span class="pl-c">//is needed from the args.browser variable</span>
      },
    },
  )
})
</pre></div>
<p>Code listing 2. Our plugin's main.js</p>
<p>After this, we create the plugin directory structure</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin/js</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin/js/main.js</p>
<p>jbrowse/plugins/MyPlugin/js/MyTrack.js</p>
</blockquote>
</blockquote>
</blockquote>
<p>Then we can add our new plugin to a config file like <code>jbrowse_conf.json</code>
as <code>"plugins": ["MyPlugin"]</code> and then make a track in <code>trackList.json</code>
have <code>"type": "MyPlugin/MyTrack"</code> instead of for
example <code>"type": "CanvasFeatures"</code>. That will tell jbrowse to load the
<code>MyTrack</code> class from your plugin instead of the normal <code>CanvasFeatures</code>
class.</p>
<p>That's about it!</p>
<p>Note that the <code>bin/new-plugin.pl</code> script can automatically initialize some
of this directory structure too. Try running <code>bin/new-plugin.pl MyPlugin</code> and see what happens.</p>
<h3 id="footnotes"><a aria-hidden="true" tabindex="-1" href="#footnotes"><a href="#footnotes" style="margin-right: 10px">#</a></a>Footnotes:</h3>
<p>It is important to understand the module format (AMD) which is what the
"define" function is about and the dojo way of definining classes using
the "declare" function. Together, this allows the dojo to create
object-oriented programs that are modular in javascript. See
<a href="http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html">http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html</a>
and <a href="http://dojotoolkit.org/documentation/tutorials/1.9/modules/">http://dojotoolkit.org/documentation/tutorials/1.9/modules/</a>
(understanding this helps you understand the "preamble" for declaring a
jbrowse plugin)</p></div><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Creating a JBrowse plugin","date":"2016-11-10","slug":"2016-11-10","html":"\u003cp\u003eI have been very impressed with peoples creativity and willingness to\ndig into all the details of JBrowse to customize it's features. One\ngreat way to do this in a modular way is to create a \"JBrowse plugin\".\nThis concept sounds hard but you can set up a simple couple of files and\nrefresh your browser and it will \"just work\"!\u003c/p\u003e\n\u003ch2 id=\"introduction-to-the-plugin-mindset\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction-to-the-plugin-mindset\"\u003e\u003ca href=\"#introduction-to-the-plugin-mindset\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIntroduction to the plugin mindset\u003c/h2\u003e\n\u003cp\u003eIn a plugin, you can define new things like custom track types, custom\nadaptors to new file types, new track selectors, or something really\ndifferent. A key insight about the custom types of tracks and things\nthough is that you can put the name of your new custom class in the\njbrowse config file which will then find the code in your plugin and run\nit. Plugins can do other things, but the ability to just swap out track\ntypes or other components in the config file is a great benefit.\u003c/p\u003e\n\u003ch2 id=\"a-scenario\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#a-scenario\"\u003e\u003ca href=\"#a-scenario\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eA scenario\u003c/h2\u003e\n\u003cp\u003eOne example that was talked about on the mailing list might involve\nadding new menu items for a given track. We might consider a plugin that\ndefines a custom track type to add that functionality.\u003c/p\u003e\n\u003cp\u003eBasically, we can use object- oriented principles to \"inherit\" from some\nexisting track type like CanvasFeatures and then extend its\nfunctionality by overriding the functions.\u003c/p\u003e\n\u003cp\u003eIf you are not familiar with object-oriented javascript, dojo makes it\npretty easy (but, especially get a background on this if you need to,\nsee footnotes below).\u003c/p\u003e\n\u003cp\u003eWe can inherit a new track type by using the \"define\" function to\ninclude the dependencies needed in a file, and they are listed in an\narray at the top of your file.\u003c/p\u003e\n\u003cp\u003eThen the \"declare\" function creates a new class. The first argument to\ndeclare is the is your parent class, like CanvasFeatures, and we type\n\"return declare\" because we are returning our new track class from the\nmodule.\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-js\"\u003e\u003cpre\u003e\u003cspan class=\"pl-en\"\u003edefine\u003c/span\u003e([\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003edojo/_base/declare\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003eJBrowse/View/Track/CanvasFeatures\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e], \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e (\n  \u003cspan class=\"pl-smi\"\u003edeclare\u003c/span\u003e,\n  \u003cspan class=\"pl-smi\"\u003eCanvasFeatures\u003c/span\u003e,\n) {\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-en\"\u003edeclare\u003c/span\u003e(CanvasFeatures, {\n    \u003cspan class=\"pl-en\"\u003e_trackMenuOptions\u003c/span\u003e\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e () {\n      \u003cspan class=\"pl-k\"\u003evar\u003c/span\u003e opts \u003cspan class=\"pl-k\"\u003e=\u003c/span\u003e \u003cspan class=\"pl-c1\"\u003ethis\u003c/span\u003e.\u003cspan class=\"pl-en\"\u003einherited\u003c/span\u003e(\u003cspan class=\"pl-c1\"\u003earguments\u003c/span\u003e) \u003cspan class=\"pl-c\"\u003e//call the parent classes function\u003c/span\u003e\n\n      \u003cspan class=\"pl-smi\"\u003eopts\u003c/span\u003e.\u003cspan class=\"pl-c1\"\u003epush\u003c/span\u003e(\n        \u003cspan class=\"pl-c\"\u003e// add an extra menu item to the array returned from parent class function\u003c/span\u003e\n        {\n          label\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003eCustom item\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e,\n          type\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003edijit/CheckedMenuItem\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e,\n          \u003cspan class=\"pl-en\"\u003eonClick\u003c/span\u003e\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e (\u003cspan class=\"pl-c1\"\u003eevent\u003c/span\u003e) {\n            \u003cspan class=\"pl-en\"\u003econsole\u003c/span\u003e.\u003cspan class=\"pl-c1\"\u003elog\u003c/span\u003e(\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003eClicked\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e)\n          },\n          iconClass\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003edijitIconPackage\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e,\n        },\n      )\n      \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e opts\n    },\n  })\n})\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCode listing 1. an example custom track type, MyTrack.js, that adds an\nextra track menu item\u003c/p\u003e\n\u003ch2 id=\"now-how-do-we-make-this-a-plugin\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#now-how-do-we-make-this-a-plugin\"\u003e\u003ca href=\"#now-how-do-we-make-this-a-plugin\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eNow how do we make this a plugin?\u003c/h2\u003e\n\u003cp\u003eIn the above section, we created a new track subclass with a custom menu\noption. How do we use this track? We want to turn it into part of afine\nthe boilerplate code from the \u003ca href=\"http://gmod.org/wiki/JBrowse_Configuration_Guide#Writing_JBrowse_Plugins\"\u003eWriting\nplugins\u003c/a\u003e\nguide.\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-js\"\u003e\u003cpre\u003e\u003cspan class=\"pl-en\"\u003edefine\u003c/span\u003e([\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003edojo/_base/declare\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003eJBrowse/Plugin\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e], \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e (\n  \u003cspan class=\"pl-smi\"\u003edeclare\u003c/span\u003e,\n  \u003cspan class=\"pl-smi\"\u003eJBrowsePlugin\u003c/span\u003e,\n) {\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-en\"\u003edeclare\u003c/span\u003e(\n    JBrowsePlugin, \u003cspan class=\"pl-c\"\u003e// this line says our plugin's main.js derives from the \"JBrowse/Plugin\" base class\u003c/span\u003e\n    {\n      \u003cspan class=\"pl-en\"\u003econstructor\u003c/span\u003e\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e (\u003cspan class=\"pl-smi\"\u003eargs\u003c/span\u003e) {\n        \u003cspan class=\"pl-c\"\u003e//don't necessarily have to do any initializing here, but you\u003c/span\u003e\n        \u003cspan class=\"pl-c\"\u003e//can get a handle to various jbrowse components if any initialization\u003c/span\u003e\n        \u003cspan class=\"pl-c\"\u003e//is needed from the args.browser variable\u003c/span\u003e\n      },\n    },\n  )\n})\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCode listing 2. Our plugin's main.js\u003c/p\u003e\n\u003cp\u003eAfter this, we create the plugin directory structure\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ejbrowse/plugins/MyPlugin\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ejbrowse/plugins/MyPlugin/js\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ejbrowse/plugins/MyPlugin/js/main.js\u003c/p\u003e\n\u003cp\u003ejbrowse/plugins/MyPlugin/js/MyTrack.js\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThen we can add our new plugin to a config file like \u003ccode\u003ejbrowse_conf.json\u003c/code\u003e\nas \u003ccode\u003e\"plugins\": [\"MyPlugin\"]\u003c/code\u003e and then make a track in \u003ccode\u003etrackList.json\u003c/code\u003e\nhave \u003ccode\u003e\"type\": \"MyPlugin/MyTrack\"\u003c/code\u003e instead of for\nexample \u003ccode\u003e\"type\": \"CanvasFeatures\"\u003c/code\u003e. That will tell jbrowse to load the\n\u003ccode\u003eMyTrack\u003c/code\u003e class from your plugin instead of the normal \u003ccode\u003eCanvasFeatures\u003c/code\u003e\nclass.\u003c/p\u003e\n\u003cp\u003eThat's about it!\u003c/p\u003e\n\u003cp\u003eNote that the \u003ccode\u003ebin/new-plugin.pl\u003c/code\u003e script can automatically initialize some\nof this directory structure too. Try running \u003ccode\u003ebin/new-plugin.pl MyPlugin\u003c/code\u003e and see what happens.\u003c/p\u003e\n\u003ch3 id=\"footnotes\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnotes\"\u003e\u003ca href=\"#footnotes\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnotes:\u003c/h3\u003e\n\u003cp\u003eIt is important to understand the module format (AMD) which is what the\n\"define\" function is about and the dojo way of definining classes using\nthe \"declare\" function. Together, this allows the dojo to create\nobject-oriented programs that are modular in javascript. See\n\u003ca href=\"http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html\"\u003ehttp://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html\u003c/a\u003e\nand \u003ca href=\"http://dojotoolkit.org/documentation/tutorials/1.9/modules/\"\u003ehttp://dojotoolkit.org/documentation/tutorials/1.9/modules/\u003c/a\u003e\n(understanding this helps you understand the \"preamble\" for declaring a\njbrowse plugin)\u003c/p\u003e"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2016-11-10"},"buildId":"zXsOoPt4_HtQEfr4qBXnO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>