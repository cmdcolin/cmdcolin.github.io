<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/39906f0ead253838.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-d10a5ca28d3f2087.js"/><script src="/_next/static/chunks/fd9d1056-86b8edb61a7addbb.js" async=""></script><script src="/_next/static/chunks/582-0cff27f5472401dd.js" async=""></script><script src="/_next/static/chunks/main-app-cd804b1a70ba284d.js" async=""></script><script src="/_next/static/chunks/231-26142438061866f4.js" async=""></script><script src="/_next/static/chunks/app/page-963abe75e6aad650.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-ce940a9c9090656b.js" async=""></script><title>Misconceptions your team might have during The Big Rewrite</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Misconceptions your team might have during The Big Rewrite</h1><h4>2020-06-03</h4></div><div><p>Disclaimer: I enjoy the project I am working on and this is still a work in
progress. I just had to rant about the stuff I go through in my job here, but it
does not reflect the opinions of my emplorer, and my personal opinion is despite
these troubles we are coming along nicely</p>
<p>I joined a team that was doing the big rewrite in 2018. I was involved in the
project before then and knew it's ins and outs, and frankly think it's still a
great system. In order to break it's "limitations" a grand v2 gets started. I
think my team has been good. My tech lead is really good at architecture. Where
I really resist kind of "writing new architecture that is not already there", he
can pull up entirely new concepts and abstractions that are all pretty good.
Myself, I don't much enjoy writing "new architecture" if there is something
already there that I can use, and I'll try to refer to the existence of an
existing thing instead of creating new exotic stuff.</p>
<p>Now, what happened during the big rewrite so far. 4 people on the team, 2 years
in</p>
<p>Persistent confusion about sources of slowness in our app</p>
<ul>
<li>it's only slow because devtools is open (maybe it is! but this is definitely a
red herring. the code should work with devtools open. reason that's been
stated: devtools adds a "bunch of instrumentation to the promises that slows
it down"...stated without any evidence during a 3 hour long planning call...)
<ul>
<li>it's only slow because we're using a development build of react, try a
production build (the production build makes some stuff faster, but it is
NOT going to save your butt if you are constantly rerending all your
components unnecessarily every millisecond during user scroll, which is
something we suffered from, and it creeps back in if you are not careful
because you can't write tests against this so often one day I'll be looking
at my devtools and suddenly things are rendering twice per frame (signature
of calling an unnecessary setState), tons of unnecessary components
rendering in every frame (signature of componentShouldUpdate/bad functional
react memoizing, etc))</li>
<li>it's slow because we are hogging the main thread all the time, our killer
new feature in v2 is an intense webworker framework. now main thread
contention is a concern, but really our app needs to just be performant all
around, webworkers just offloads that cpu spinning to another core. what we
have done in v2 is we went whole hog and made our code rely on
OffscreenCanvas which 0 browsers support. also, our webworker bundles
(worker-loader webpack build) are huge webpack things that pretty much
contain all the code that is on the main thread so it's just massive. that
makes it slow at loading time, and makes it harder to think about our worker
threads in a lighter-weight way, and the worker concept is now very deeply
entrenched in a lot of the code (all code has to think of things in terms of
rpc calls)</li>
<li>it's slow because there are processes that haven't been aborted spinning in
the background, so we must build out an intensive AbortController thing that
touches the entirety of all our code including sending abort signals across
the RPC boundary in hopes that a locked up webworker will respond to this
(note: our first version of the software had zero aborting, did not from my
perspective suffer. arguments with the team have gotten accusatory where I
just claim that there is no evidence that the aborting is helping us,
pointing to the fact that our old code works fine, and that if our new code
suffers without aborting, that means something else is wrong. I have not
really been given a proper response for this, and so the curse of passing
AbortSignals onto every function via an extra function parameter drags on</li>
<li>it's slow because we are not multithreading..., so we put two views of the
same data into different webworkers (but now each webworker separately
downloads the same data, which leads to more resource spent, more network
IO, more slowness)</li>
</ul>
</li>
</ul>
<p>confusion about what our old users needs are</p>
<ul>
<li>
<p>tracks not having per-track scroll (problem: leads to many scrolls
within-scrolls, still unresolved problem)</p>
</li>
<li>
<p>the name indexing was always a big problem (yes it is slow but is it really
THE critical problem we face? likely not: bioinformatics people run a data
pipeline, it takes a couple days, so what). use elasticsearch if it sucks so
bad</p>
</li>
<li>
<p>our users are "stupid" so they need to have every single thing GUI editable
(interesting endeavor, but our design for this has been difficult, and has not
yet delivered on simplifying the system for users)</p>
</li>
<li>
<p>our users "do not like modal popups" so we design everything into a tiny
sidedrawer that barely can contain the relevant data that they want to see</p>
</li>
<li>
<p>having interest in catering to obscure or not very clear "user stories" like
displaying the same exact region twice on the screen at once saying "someone
will want to do this", but causing a ton of extra logical weirdness from this</p>
</li>
<li>
<p>not catering to emerging areas of user needs such as breaking our large app
into components that can be re-used, and instead just going full hog on a
large monolith project and treating our monolith as a giant hammer that will
solve everyones problems, when in reality, our users are also programmers that
could benefit from using smaller componentized versions of our code</p>
</li>
<li>
<p>confusion about "what our competitors have". sometimes my team one day was
like "alright we just do that and then we have everything product X has?" and
I just had to be clear and be like, no! the competitor has a really pretty
intricate complex system that we could never hope to replicate. but does that
matter? probably not, but even still, we likely don't have even 20% of the
full set of functions of a competitor. luckily we have our own strengths that
make us compelling besides that 20%</p>
</li>
<li>
<p>making it so our product requires a server side component to run, where our
first version was much more amenable to running as a static site</p>
</li>
<li>
<p>etc...</p>
</li>
</ul>
<p>but what does all this imply?</p>
<p>there are persistent confusion about what the challenges we face are, what the
architectural needs are, what our user stores are, what our new v2 design goals
are, and more. It's really crazy</p></div><div style="margin-top:200px"></div></article><footer style="margin-top:100px"><a href="/">Home</a><a href="/archive">Blog archive</a><a href="https://github.com/cmdcolin/">Github</a><a href="/projects">Projects</a> <a href="/photos">Photos</a><a href="/books">Books</a><a href="/about">About</a><a href="/uses">Uses</a></footer><script src="/_next/static/chunks/webpack-d10a5ca28d3f2087.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/39906f0ead253838.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[231,[\"231\",\"static/chunks/231-26142438061866f4.js\",\"931\",\"static/chunks/app/page-963abe75e6aad650.js\"],\"\"]\na:I[6130,[],\"\"]\n6:[\"id\",\"2020-06-03\",\"d\"]\nb:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/39906f0ead253838.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"buildId\":\"qGd5kBl6-yqUd7-dPC1yf\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2020-06-03\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2020-06-03\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2020-06-03\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2020-06-03\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\"],null],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"style\":{\"marginBottom\":100},\"children\":[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}],[\"$\",\"footer\",null,{\"style\":{\"marginTop\":100},\"children\":[[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L8\",null,{\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L8\",null,{\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L8\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}],\" \",[\"$\",\"$L8\",null,{\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L8\",null,{\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L8\",null,{\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L8\",null,{\"href\":\"/uses\",\"children\":\"Uses\"}]]}]]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$L9\"],\"globalErrorComponent\":\"$a\",\"missingSlots\":\"$Wb\"}]]\n"])</script><script>self.__next_f.push([1,"d:I[4910,[\"722\",\"static/chunks/app/posts/%5Bid%5D/page-ce940a9c9090656b.js\"],\"default\"]\nc:T1939,"])</script><script>self.__next_f.push([1,"\u003cp\u003eDisclaimer: I enjoy the project I am working on and this is still a work in\nprogress. I just had to rant about the stuff I go through in my job here, but it\ndoes not reflect the opinions of my emplorer, and my personal opinion is despite\nthese troubles we are coming along nicely\u003c/p\u003e\n\u003cp\u003eI joined a team that was doing the big rewrite in 2018. I was involved in the\nproject before then and knew it's ins and outs, and frankly think it's still a\ngreat system. In order to break it's \"limitations\" a grand v2 gets started. I\nthink my team has been good. My tech lead is really good at architecture. Where\nI really resist kind of \"writing new architecture that is not already there\", he\ncan pull up entirely new concepts and abstractions that are all pretty good.\nMyself, I don't much enjoy writing \"new architecture\" if there is something\nalready there that I can use, and I'll try to refer to the existence of an\nexisting thing instead of creating new exotic stuff.\u003c/p\u003e\n\u003cp\u003eNow, what happened during the big rewrite so far. 4 people on the team, 2 years\nin\u003c/p\u003e\n\u003cp\u003ePersistent confusion about sources of slowness in our app\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eit's only slow because devtools is open (maybe it is! but this is definitely a\nred herring. the code should work with devtools open. reason that's been\nstated: devtools adds a \"bunch of instrumentation to the promises that slows\nit down\"...stated without any evidence during a 3 hour long planning call...)\n\u003cul\u003e\n\u003cli\u003eit's only slow because we're using a development build of react, try a\nproduction build (the production build makes some stuff faster, but it is\nNOT going to save your butt if you are constantly rerending all your\ncomponents unnecessarily every millisecond during user scroll, which is\nsomething we suffered from, and it creeps back in if you are not careful\nbecause you can't write tests against this so often one day I'll be looking\nat my devtools and suddenly things are rendering twice per frame (signature\nof calling an unnecessary setState), tons of unnecessary components\nrendering in every frame (signature of componentShouldUpdate/bad functional\nreact memoizing, etc))\u003c/li\u003e\n\u003cli\u003eit's slow because we are hogging the main thread all the time, our killer\nnew feature in v2 is an intense webworker framework. now main thread\ncontention is a concern, but really our app needs to just be performant all\naround, webworkers just offloads that cpu spinning to another core. what we\nhave done in v2 is we went whole hog and made our code rely on\nOffscreenCanvas which 0 browsers support. also, our webworker bundles\n(worker-loader webpack build) are huge webpack things that pretty much\ncontain all the code that is on the main thread so it's just massive. that\nmakes it slow at loading time, and makes it harder to think about our worker\nthreads in a lighter-weight way, and the worker concept is now very deeply\nentrenched in a lot of the code (all code has to think of things in terms of\nrpc calls)\u003c/li\u003e\n\u003cli\u003eit's slow because there are processes that haven't been aborted spinning in\nthe background, so we must build out an intensive AbortController thing that\ntouches the entirety of all our code including sending abort signals across\nthe RPC boundary in hopes that a locked up webworker will respond to this\n(note: our first version of the software had zero aborting, did not from my\nperspective suffer. arguments with the team have gotten accusatory where I\njust claim that there is no evidence that the aborting is helping us,\npointing to the fact that our old code works fine, and that if our new code\nsuffers without aborting, that means something else is wrong. I have not\nreally been given a proper response for this, and so the curse of passing\nAbortSignals onto every function via an extra function parameter drags on\u003c/li\u003e\n\u003cli\u003eit's slow because we are not multithreading..., so we put two views of the\nsame data into different webworkers (but now each webworker separately\ndownloads the same data, which leads to more resource spent, more network\nIO, more slowness)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003econfusion about what our old users needs are\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003etracks not having per-track scroll (problem: leads to many scrolls\nwithin-scrolls, still unresolved problem)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe name indexing was always a big problem (yes it is slow but is it really\nTHE critical problem we face? likely not: bioinformatics people run a data\npipeline, it takes a couple days, so what). use elasticsearch if it sucks so\nbad\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eour users are \"stupid\" so they need to have every single thing GUI editable\n(interesting endeavor, but our design for this has been difficult, and has not\nyet delivered on simplifying the system for users)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eour users \"do not like modal popups\" so we design everything into a tiny\nsidedrawer that barely can contain the relevant data that they want to see\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehaving interest in catering to obscure or not very clear \"user stories\" like\ndisplaying the same exact region twice on the screen at once saying \"someone\nwill want to do this\", but causing a ton of extra logical weirdness from this\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003enot catering to emerging areas of user needs such as breaking our large app\ninto components that can be re-used, and instead just going full hog on a\nlarge monolith project and treating our monolith as a giant hammer that will\nsolve everyones problems, when in reality, our users are also programmers that\ncould benefit from using smaller componentized versions of our code\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econfusion about \"what our competitors have\". sometimes my team one day was\nlike \"alright we just do that and then we have everything product X has?\" and\nI just had to be clear and be like, no! the competitor has a really pretty\nintricate complex system that we could never hope to replicate. but does that\nmatter? probably not, but even still, we likely don't have even 20% of the\nfull set of functions of a competitor. luckily we have our own strengths that\nmake us compelling besides that 20%\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emaking it so our product requires a server side component to run, where our\nfirst version was much more amenable to running as a static site\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eetc...\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ebut what does all this imply?\u003c/p\u003e\n\u003cp\u003ethere are persistent confusion about what the challenges we face are, what the\narchitectural needs are, what our user stores are, what our new v2 design goals\nare, and more. It's really crazy\u003c/p\u003e"])</script><script>self.__next_f.push([1,"4:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Misconceptions your team might have during The Big Rewrite\"}],[\"$\",\"h4\",null,{\"children\":\"2020-06-03\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$c\"}}],[\"$\",\"$Ld\",null,{}]]}]\n9:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Misconceptions your team might have during The Big Rewrite\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n3:null\n"])</script></body></html>