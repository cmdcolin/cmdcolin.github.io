<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Using Rust/WASM in a monorepo with create-react-app</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><link rel="preload" href="/_next/static/css/97dc5fe527f5d592.css" as="style"/><link rel="stylesheet" href="/_next/static/css/97dc5fe527f5d592.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8c0202d61bc61a66.js" defer=""></script><script src="/_next/static/chunks/framework-5ac2b14b431a77fa.js" defer=""></script><script src="/_next/static/chunks/main-008d0e41da4e3c22.js" defer=""></script><script src="/_next/static/chunks/pages/_app-577aa7b9aa74ad1d.js" defer=""></script><script src="/_next/static/chunks/996-5423f94aa1dfaf82.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-2f2d5b8e0ced3566.js" defer=""></script><script src="/_next/static/tcNuc6kwzTrgsdvTh3dJN/_buildManifest.js" defer=""></script><script src="/_next/static/tcNuc6kwzTrgsdvTh3dJN/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Using Rust/WASM in a monorepo with create-react-app</h1><h4>2022-08-22</h4></div><div><p>Behold, the buzzwords:</p>
<ul>
<li>Rust / WASM / wasm-bindgen</li>
<li>React</li>
<li>Monorepo / Yarn workspaces</li>
<li>Webpack 5 / create-react-app 5</li>
<li>Typescript</li>
</ul>
<p>The main goal here: To use Rust + WASM in a react app, inside a monorepo.</p>
<p>TLDR: visit the final product!
<a href="https://github.com/cmdcolin/rust_react_monorepo_template">https://github.com/cmdcolin/rust_react_monorepo_template</a>. It is also deployed
live here <a href="https://cmdcolin.github.io/rust_react_monorepo_template">https://cmdcolin.github.io/rust_react_monorepo_template</a></p>
<h2 id="steps-to-create-this-type-of-integration-from-scratch"><a aria-hidden="true" tabindex="-1" href="#steps-to-create-this-type-of-integration-from-scratch"><a href="#steps-to-create-this-type-of-integration-from-scratch" style="margin-right: 10px">#</a></a>Steps to create this type of integration from scratch</h2>
<h3 id="create-repo"><a aria-hidden="true" tabindex="-1" href="#create-repo"><a href="#create-repo" style="margin-right: 10px">#</a></a>Create repo</h3>
<pre><code>mkdir template
cd template
git init
</code></pre>
<h3 id="create-root-packagejson"><a aria-hidden="true" tabindex="-1" href="#create-root-packagejson"><a href="#create-root-packagejson" style="margin-right: 10px">#</a></a>Create root <code>package.json</code></h3>
<p>Then put this in the monorepo's root <code>package.json</code></p>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">private</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">workspaces</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: [</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">hello-wasm</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">app</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">]</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>This sets our repo up as a "monorepo" with two "workspaces". one will be the
wasm code, in <code>hello-wasm</code>, one will be an instance of <code>create-react-app</code></p>
<h3 id="add-a-create-react-app-instance-inside-the-monorepo"><a aria-hidden="true" tabindex="-1" href="#add-a-create-react-app-instance-inside-the-monorepo"><a href="#add-a-create-react-app-instance-inside-the-monorepo" style="margin-right: 10px">#</a></a>Add a <code>create-react-app</code> instance inside the monorepo</h3>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #91B4D5">npx</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">create-react-app</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">--template</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">typescript</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">app</span></span></code></pre>
<p>This will make an <code>app</code> subfolder inside our monorepo</p>
<h3 id="download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm"><a aria-hidden="true" tabindex="-1" href="#download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm"><a href="#download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm" style="margin-right: 10px">#</a></a>Download the hello world rust <code>wasm-bindgen</code> example and put it in a folder named <code>hello-wasm</code></h3>
<p>Download <a href="https://github.com/rustwasm/wasm-bindgen/tree/main/examples/hello_world">https://github.com/rustwasm/wasm-bindgen/tree/main/examples/hello_world</a>
to the hello-wasm folder</p>
<p>This link can help
<a href="https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Frustwasm%2Fwasm-bindgen%2Ftree%2Fmain%2Fexamples%2Fhello_world">https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Frustwasm%2Fwasm-bindgen%2Ftree%2Fmain%2Fexamples%2Fhello_world</a></p>
<h3 id="add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder"><a aria-hidden="true" tabindex="-1" href="#add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder"><a href="#add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder" style="margin-right: 10px">#</a></a>Add some extra fields to the <code>package.json</code> in the <code>hello-wasm</code> folder</h3>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">name</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">hello-wasm</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">version</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">1.0.0</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">files</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: [</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">pkg</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">],</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">main</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">pkg/index.js</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #D0679D">...</span><span style="color: #A6ACCD"> </span><span style="color: #D0679D">rest</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<h3 id="modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert"><a aria-hidden="true" tabindex="-1" href="#modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert"><a href="#modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert" style="margin-right: 10px">#</a></a>Modify the <code>hello-wasm</code> example to return a value instead of making an alert</h3>
<p>I changed the rust code to return a String value instead of making an alert box</p>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #A6ACCD">#[wasm_bindgen]</span></span>
<span class="line"><span style="color: #5DE4C7">pub</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">fn</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">greet</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">name</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">&#x26;</span><span style="color: #A6ACCDC0">str</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">-></span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">String</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #ADD7FF">format!</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">Hello </span><span style="color: #A6ACCD">{}"</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">name</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<h3 id="build-the-hello-wasm-pkg"><a aria-hidden="true" tabindex="-1" href="#build-the-hello-wasm-pkg"><a href="#build-the-hello-wasm-pkg" style="margin-right: 10px">#</a></a>Build the <code>hello-wasm</code> pkg</h3>
<p>Go into the <code>hello-wasm</code> folder and run <code>yarn build</code>. This creates a directory
named <code>pkg</code> which has <code>.wasm</code> files and <code>.js</code> files. Now, the <code>hello-wasm</code>
folder is effectively a node package. We could publish this to <code>NPM</code> (see
footnote 1)</p>
<h3 id="add-the-hello-wasm-package-to-the-app-dependencies"><a aria-hidden="true" tabindex="-1" href="#add-the-hello-wasm-package-to-the-app-dependencies"><a href="#add-the-hello-wasm-package-to-the-app-dependencies" style="margin-right: 10px">#</a></a>Add the <code>hello-wasm</code> package to the <code>app</code> dependencies</h3>
<p>Add <code>"hello-wasm":"^1.0.0"</code> to the <code>dependencies</code> array in <code>app/package.json</code>.
This will refer to our local monorepo's rust wasm package!</p>
<h3 id="create-craco-config-for-create-react-app"><a aria-hidden="true" tabindex="-1" href="#create-craco-config-for-create-react-app"><a href="#create-craco-config-for-create-react-app" style="margin-right: 10px">#</a></a>Create craco config for <code>create-react-app</code></h3>
<p>As of writing, with <code>webpack</code> v5/<code>create-react-app</code> v5, you have to customize
the <code>create-react-app</code> to add extra <code>webpack</code> flags.</p>
<p>So, <code>yarn add @craco/craco</code> in the app folder, then create this
<code>craco.config.js</code></p>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #E4F0FB">module</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">exports</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">webpack</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">configure</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">config</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #91B4D5">const</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">wasmExtensionRegExp</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=</span><span style="color: #5FB3A1"> </span><span style="color: #A6ACCD">/</span><span style="color: #5FB3A1">\.wasm</span><span style="color: #A6ACCD">$/</span></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #E4F0FB">config</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">extensions</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">push</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">.wasm</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #E4F0FB">config</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">experiments</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">syncWebAssembly</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #E4F0FB">config</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">module</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">rules</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">forEach</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">rule</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #ADD7FF">        </span><span style="color: #A6ACCD">;(</span><span style="color: #E4F0FB">rule</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">oneOf</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">||</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">[]).</span><span style="color: #E4F0FBD0">forEach</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">oneOf</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #ADD7FF">          </span><span style="color: #A6ACCD">if</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">oneOf</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">type</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">===</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">asset/resource</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #ADD7FF">            </span><span style="color: #E4F0FB">oneOf</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">exclude</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">push</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">wasmExtensionRegExp</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #ADD7FF">          </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #ADD7FF">        </span><span style="color: #A6ACCD">})</span></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ADD7FF">      </span><span style="color: #5DE4C7C0">return</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">config</span></span>
<span class="line"><span style="color: #ADD7FF">    </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Note: this thread helped me to create the craco config
<a href="https://github.com/Emurgo/cardano-serialization-lib/issues/295">https://github.com/Emurgo/cardano-serialization-lib/issues/295</a></p>
<p>Also see footnote 2 for more info</p>
<h3 id="final-step-use-async-import-to-import-the-hello-wasm-greeting"><a aria-hidden="true" tabindex="-1" href="#final-step-use-async-import-to-import-the-hello-wasm-greeting"><a href="#final-step-use-async-import-to-import-the-hello-wasm-greeting" style="margin-right: 10px">#</a></a>Final step: Use async <code>import()</code> to import the <code>hello-wasm</code> greeting</h3>
<p>We use a <code>useEffect</code> hook to import the code asynchronously, and can call our
rust function, <code>greet</code>, from javascript!</p>
<pre class="shiki poimandres" style="background-color: #1b1e28"><code><span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">App</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">greeting</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setGreeting</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">&#x3C;</span><span style="color: #A6ACCDC0">string</span><span style="color: #A6ACCD">>()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">useEffect</span><span style="color: #A6ACCD">(() </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    ;(</span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #D0679D">try</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">wasm</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">import</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">hello-wasm</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">greeting</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">wasm</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">greet</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">Colin</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FBD0">setGreeting</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">greeting</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">      } </span><span style="color: #D0679D">catch</span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">      }</span></span>
<span class="line"><span style="color: #A6ACCD">    })()</span></span>
<span class="line"><span style="color: #A6ACCD">  }, [])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">    &#x3C;</span><span style="color: #A6ACCDC0">div</span><span style="color: #A6ACCD">></span></span>
<span class="line"><span style="color: #A6ACCD">      &#x3C;</span><span style="color: #A6ACCDC0">h1</span><span style="color: #A6ACCD">></span><span style="color: #E4F0FB">rust</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">monorepo</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">wasm</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">demo</span><span style="color: #91B4D5">&#x3C;/</span><span style="color: #E4F0FB">h1</span><span style="color: #91B4D5">></span></span>
<span class="line"><span style="color: #A6ACCD">      &#x3C;</span><span style="color: #A6ACCDC0">h2</span><span style="color: #A6ACCD">></span><span style="color: #E4F0FB">Greeting</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">from</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">wasm</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> {!</span><span style="color: #A6ACCDC0">greeting</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">?</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">Loading...</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">greeting</span><span style="color: #A6ACCD">}&#x3C;/</span><span style="color: #A6ACCDC0">h2</span><span style="color: #A6ACCD">></span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">&#x3C;/</span><span style="color: #E4F0FB">div</span><span style="color: #91B4D5">></span></span>
<span class="line"><span style="color: #A6ACCD">  )</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>In order to greet an arbitrary person, I modified this slightly in the live
demo. See
<a href="https://github.com/cmdcolin/rust_react_monorepo_template/blob/master/app/src/App.tsx">https://github.com/cmdcolin/rust_react_monorepo_template/blob/master/app/src/App.tsx</a></p>
<h3 id="run-the-app"><a aria-hidden="true" tabindex="-1" href="#run-the-app"><a href="#run-the-app" style="margin-right: 10px">#</a></a>Run the app!</h3>
<p>Go into the <code>app</code> folder, and then run <code>yarn start</code></p>
<h2 id="result"><a aria-hidden="true" tabindex="-1" href="#result"><a href="#result" style="margin-right: 10px">#</a></a>Result!</h2>
<p>A screenshot of the app, showing the string "Hello Colin" which is generated via
rust and wasm</p>
<p><img src="/media/rust_wasm_demo.png" alt=""></p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>My main aim was to demonstrate creating a "simple" monorepo setup showing how
you can integrate Rust+WASM and React. Feel free to ask me any questions and go
check out the repo!</p>
<p><a href="https://github.com/cmdcolin/rust_react_monorepo_template">https://github.com/cmdcolin/rust_react_monorepo_template</a></p>
<h2 id="other-resources"><a aria-hidden="true" tabindex="-1" href="#other-resources"><a href="#other-resources" style="margin-right: 10px">#</a></a>Other resources</h2>
<p>This article is quite helpful also, but uses a file:/ reference in their
<code>package.json</code> while my approach uses a monorepo, it is fundamentally quite
similar though!
<a href="https://tkat0.github.io/posts/how-to-create-a-react-app-with-rust-and-wasm">https://tkat0.github.io/posts/how-to-create-a-react-app-with-rust-and-wasm</a></p>
<h2 id="footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files"><a aria-hidden="true" tabindex="-1" href="#footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files"><a href="#footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files" style="margin-right: 10px">#</a></a>Footnote 1: The <code>hello-wasm</code> folder IS a npm package with wasm files</h2>
<p>The <code>hello-wasm</code> folder can be published to NPM by itself. When consumers of the
package import the module, they would receive <code>pkg/index.js</code> from the <code>main</code>
field in <code>package.json</code>, and then <code>pkg/index.js</code> in turn imports the
<code>index.wasm</code> file. Then it is up to the consumers bundler to package that
correctly.</p>
<h2 id="footnote-2-bundlers-and-wasm"><a aria-hidden="true" tabindex="-1" href="#footnote-2-bundlers-and-wasm"><a href="#footnote-2-bundlers-and-wasm" style="margin-right: 10px">#</a></a>Footnote 2: Bundlers and wasm</h2>
<p>As of writing, I am using <code>webpack</code> v5 (part of <code>create-react-app</code> v5), which
has "native support" for wasm. Still, it is hidden behind a flag called
"experiments" (see first google result for webpack wasm here
<a href="https://webpack.js.org/configuration/experiments/">https://webpack.js.org/configuration/experiments/</a>) so I use <code>@craco/craco</code> to
modify the <code>webpack</code> config of <code>create-react-app</code> v5 to add this.</p>
<p>Note also: The first time I wrote this, I used <code>webpack</code> v4, which used a
slightly different workflow (used a special <code>webpack</code> loader called
<code>wasm-loader</code>)</p>
<p>You can also likely use similar techniques described in this article to
incorporate into <code>next.js</code> since it also uses <code>webpack</code>. If you have info on how
other bundlers use wasm, feel free to leave a comment.</p>
<h2 id="footnote-3-why-do-i-have-to-use-async-imports"><a aria-hidden="true" tabindex="-1" href="#footnote-3-why-do-i-have-to-use-async-imports"><a href="#footnote-3-why-do-i-have-to-use-async-imports" style="margin-right: 10px">#</a></a>Footnote 3: Why do I have to use async imports?</h2>
<p>Fundamentally, the <code>.wasm</code> file has to be fetched asynchronously before it can
be run (it is not in my experience e.g. embedded as binary data inside a js
file) which means it would be difficult to use the wasm code as a synchronous
import.</p>
<p>There are hints that this may be possible but it would rely on the bundler
embedding the wasm code in the js itself, or maybe top-level-await. If anyone
has more info, feel free to leave a comment!</p>
<h2 id="footnote-4-build-setup"><a aria-hidden="true" tabindex="-1" href="#footnote-4-build-setup"><a href="#footnote-4-build-setup" style="margin-right: 10px">#</a></a>Footnote 4: Build setup</h2>
<p>The <code>hello-wasm</code> package does not automatically recompile when we are running
e.g. <code>yarn start</code> in the <code>app</code> folder. Therefore, changes to the rust requires
you to manually run <code>yarn build</code> in the <code>hello-wasm</code> folder. Just something to
be aware of</p>
<h2 id="footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky"><a aria-hidden="true" tabindex="-1" href="#footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky"><a href="#footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky" style="margin-right: 10px">#</a></a>Footnote 5: My first experience with trying to make this work was rocky!</h2>
<p>I first created an example of rust+wasm+react almost two years ago when creating
a fractal viewer <a href="https://github.com/cmdcolin/logistic_chaos_map">https://github.com/cmdcolin/logistic_chaos_map</a> and it has some
development notes on the stumbling blocks I faced
<a href="https://github.com/cmdcolin/logistic_chaos_map/blob/master/NOTES.md">https://github.com/cmdcolin/logistic_chaos_map/blob/master/NOTES.md</a></p>
<h2 id="footnote-6-i-thought-you-said-typescript-too"><a aria-hidden="true" tabindex="-1" href="#footnote-6-i-thought-you-said-typescript-too"><a href="#footnote-6-i-thought-you-said-typescript-too" style="margin-right: 10px">#</a></a>Footnote 6: I thought you said typescript too</h2>
<p>Yep! The <code>hello-wasm</code> example generates typescript <code>.d.ts</code> files! Check out the
<code>hello-wasm/pkg/</code> folder after you build it! This was none of my doing, just a
built-in feature. PS: I highly recommend inspecting the <code>pkg</code> folder that is
produced in the <code>hello-wasm</code> build to help understand the details. I also
recommend reading the <a href="https://rustwasm.github.io/wasm-bindgen/">https://rustwasm.github.io/wasm-bindgen/</a> docs and if you
are getting started with rust, read the Rust Book along with doing rustlings
<a href="https://github.com/rust-lang/rustlings">https://github.com/rust-lang/rustlings</a></p>
<h2 id="footnote-7-another-resource"><a aria-hidden="true" tabindex="-1" href="#footnote-7-another-resource"><a href="#footnote-7-another-resource" style="margin-right: 10px">#</a></a>Footnote 7: Another resource</h2>
<p>This article was posted on reddit and is also a great resource especially about
sync vs async webpack loading schemes for wasm</p>
<p><a href="https://canvasapp.com/blog/building-modern-web-apps-with-rust-wasm-and-webpack/">https://canvasapp.com/blog/building-modern-web-apps-with-rust-wasm-and-webpack/</a></p></div><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a><a href="/photos">Photos</a> <a href="/rss.xml">RSS</a><a href="/about">About</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Using Rust/WASM in a monorepo with create-react-app","date":"2022-08-22","slug":"2022-08-22-rustwasm","html":"\u003cp\u003eBehold, the buzzwords:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRust / WASM / wasm-bindgen\u003c/li\u003e\n\u003cli\u003eReact\u003c/li\u003e\n\u003cli\u003eMonorepo / Yarn workspaces\u003c/li\u003e\n\u003cli\u003eWebpack 5 / create-react-app 5\u003c/li\u003e\n\u003cli\u003eTypescript\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe main goal here: To use Rust + WASM in a react app, inside a monorepo.\u003c/p\u003e\n\u003cp\u003eTLDR: visit the final product!\n\u003ca href=\"https://github.com/cmdcolin/rust_react_monorepo_template\"\u003ehttps://github.com/cmdcolin/rust_react_monorepo_template\u003c/a\u003e. It is also deployed\nlive here \u003ca href=\"https://cmdcolin.github.io/rust_react_monorepo_template\"\u003ehttps://cmdcolin.github.io/rust_react_monorepo_template\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"steps-to-create-this-type-of-integration-from-scratch\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#steps-to-create-this-type-of-integration-from-scratch\"\u003e\u003ca href=\"#steps-to-create-this-type-of-integration-from-scratch\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eSteps to create this type of integration from scratch\u003c/h2\u003e\n\u003ch3 id=\"create-repo\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-repo\"\u003e\u003ca href=\"#create-repo\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eCreate repo\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003emkdir template\ncd template\ngit init\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"create-root-packagejson\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-root-packagejson\"\u003e\u003ca href=\"#create-root-packagejson\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eCreate root \u003ccode\u003epackage.json\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eThen put this in the monorepo's root \u003ccode\u003epackage.json\u003c/code\u003e\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eprivate\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eworkspaces\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: [\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehello-wasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eapp\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis sets our repo up as a \"monorepo\" with two \"workspaces\". one will be the\nwasm code, in \u003ccode\u003ehello-wasm\u003c/code\u003e, one will be an instance of \u003ccode\u003ecreate-react-app\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"add-a-create-react-app-instance-inside-the-monorepo\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-a-create-react-app-instance-inside-the-monorepo\"\u003e\u003ca href=\"#add-a-create-react-app-instance-inside-the-monorepo\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd a \u003ccode\u003ecreate-react-app\u003c/code\u003e instance inside the monorepo\u003c/h3\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003enpx\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecreate-react-app\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e--template\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etypescript\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eapp\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will make an \u003ccode\u003eapp\u003c/code\u003e subfolder inside our monorepo\u003c/p\u003e\n\u003ch3 id=\"download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm\"\u003e\u003ca href=\"#download-the-hello-world-rust-wasm-bindgen-example-and-put-it-in-a-folder-named-hello-wasm\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eDownload the hello world rust \u003ccode\u003ewasm-bindgen\u003c/code\u003e example and put it in a folder named \u003ccode\u003ehello-wasm\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eDownload \u003ca href=\"https://github.com/rustwasm/wasm-bindgen/tree/main/examples/hello_world\"\u003ehttps://github.com/rustwasm/wasm-bindgen/tree/main/examples/hello_world\u003c/a\u003e\nto the hello-wasm folder\u003c/p\u003e\n\u003cp\u003eThis link can help\n\u003ca href=\"https://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Frustwasm%2Fwasm-bindgen%2Ftree%2Fmain%2Fexamples%2Fhello_world\"\u003ehttps://download-directory.github.io/?url=https%3A%2F%2Fgithub.com%2Frustwasm%2Fwasm-bindgen%2Ftree%2Fmain%2Fexamples%2Fhello_world\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder\"\u003e\u003ca href=\"#add-some-extra-fields-to-the-packagejson-in-the-hello-wasm-folder\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd some extra fields to the \u003ccode\u003epackage.json\u003c/code\u003e in the \u003ccode\u003ehello-wasm\u003c/code\u003e folder\u003c/h3\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ename\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehello-wasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eversion\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1.0.0\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003efiles\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: [\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003epkg\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emain\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003epkg/index.js\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003e...\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003erest\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert\"\u003e\u003ca href=\"#modify-the-hello-wasm-example-to-return-a-value-instead-of-making-an-alert\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eModify the \u003ccode\u003ehello-wasm\u003c/code\u003e example to return a value instead of making an alert\u003c/h3\u003e\n\u003cp\u003eI changed the rust code to return a String value instead of making an alert box\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e#[wasm_bindgen]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003epub\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003efn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003egreet\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ename\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003estr\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003eString\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eformat!\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eHello \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{}\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ename\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"build-the-hello-wasm-pkg\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#build-the-hello-wasm-pkg\"\u003e\u003ca href=\"#build-the-hello-wasm-pkg\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eBuild the \u003ccode\u003ehello-wasm\u003c/code\u003e pkg\u003c/h3\u003e\n\u003cp\u003eGo into the \u003ccode\u003ehello-wasm\u003c/code\u003e folder and run \u003ccode\u003eyarn build\u003c/code\u003e. This creates a directory\nnamed \u003ccode\u003epkg\u003c/code\u003e which has \u003ccode\u003e.wasm\u003c/code\u003e files and \u003ccode\u003e.js\u003c/code\u003e files. Now, the \u003ccode\u003ehello-wasm\u003c/code\u003e\nfolder is effectively a node package. We could publish this to \u003ccode\u003eNPM\u003c/code\u003e (see\nfootnote 1)\u003c/p\u003e\n\u003ch3 id=\"add-the-hello-wasm-package-to-the-app-dependencies\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-the-hello-wasm-package-to-the-app-dependencies\"\u003e\u003ca href=\"#add-the-hello-wasm-package-to-the-app-dependencies\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd the \u003ccode\u003ehello-wasm\u003c/code\u003e package to the \u003ccode\u003eapp\u003c/code\u003e dependencies\u003c/h3\u003e\n\u003cp\u003eAdd \u003ccode\u003e\"hello-wasm\":\"^1.0.0\"\u003c/code\u003e to the \u003ccode\u003edependencies\u003c/code\u003e array in \u003ccode\u003eapp/package.json\u003c/code\u003e.\nThis will refer to our local monorepo's rust wasm package!\u003c/p\u003e\n\u003ch3 id=\"create-craco-config-for-create-react-app\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-craco-config-for-create-react-app\"\u003e\u003ca href=\"#create-craco-config-for-create-react-app\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eCreate craco config for \u003ccode\u003ecreate-react-app\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eAs of writing, with \u003ccode\u003ewebpack\u003c/code\u003e v5/\u003ccode\u003ecreate-react-app\u003c/code\u003e v5, you have to customize\nthe \u003ccode\u003ecreate-react-app\u003c/code\u003e to add extra \u003ccode\u003ewebpack\u003c/code\u003e flags.\u003c/p\u003e\n\u003cp\u003eSo, \u003ccode\u003eyarn add @craco/craco\u003c/code\u003e in the app folder, then create this\n\u003ccode\u003ecraco.config.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003emodule\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eexports\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ewebpack\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003econfigure\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econfig\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasmExtensionRegExp\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #5FB3A1\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e/\u003c/span\u003e\u003cspan style=\"color: #5FB3A1\"\u003e\\.wasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e$/\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econfig\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eextensions\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003epush\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e.wasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econfig\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eexperiments\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003esyncWebAssembly\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etrue\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econfig\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emodule\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003erules\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eforEach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003erule\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e;(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003erule\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoneOf\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e||\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e[]).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eforEach\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoneOf\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoneOf\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003etype\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e===\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easset/resource\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eoneOf\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eexclude\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003epush\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasmExtensionRegExp\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e          \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econfig\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #ADD7FF\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FB\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote: this thread helped me to create the craco config\n\u003ca href=\"https://github.com/Emurgo/cardano-serialization-lib/issues/295\"\u003ehttps://github.com/Emurgo/cardano-serialization-lib/issues/295\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAlso see footnote 2 for more info\u003c/p\u003e\n\u003ch3 id=\"final-step-use-async-import-to-import-the-hello-wasm-greeting\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#final-step-use-async-import-to-import-the-hello-wasm-greeting\"\u003e\u003ca href=\"#final-step-use-async-import-to-import-the-hello-wasm-greeting\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFinal step: Use async \u003ccode\u003eimport()\u003c/code\u003e to import the \u003ccode\u003ehello-wasm\u003c/code\u003e greeting\u003c/h3\u003e\n\u003cp\u003eWe use a \u003ccode\u003euseEffect\u003c/code\u003e hook to import the code asynchronously, and can call our\nrust function, \u003ccode\u003egreet\u003c/code\u003e, from javascript!\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eApp\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e [\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003egreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003esetGreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e] \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003euseState\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003estring\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003euseEffect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(() \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    ;(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003etry\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003eimport\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehello-wasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003egreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003egreet\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eColin\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003esetGreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003egreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      } \u003c/span\u003e\u003cspan style=\"color: #D0679D\"\u003ecatch\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ee\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ee\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    })()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  }, [])\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e (\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003ediv\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003eh1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003erust\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emonorepo\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasm\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003edemo\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e\u0026#x3C;/\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eh1\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e      \u0026#x3C;\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003eh2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eGreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ewasm\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {!\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003egreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e?\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eLoading...\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e:\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003egreeting\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u0026#x3C;/\u003c/span\u003e\u003cspan style=\"color: #A6ACCDC0\"\u003eh2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e\u0026#x3C;/\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ediv\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  )\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn order to greet an arbitrary person, I modified this slightly in the live\ndemo. See\n\u003ca href=\"https://github.com/cmdcolin/rust_react_monorepo_template/blob/master/app/src/App.tsx\"\u003ehttps://github.com/cmdcolin/rust_react_monorepo_template/blob/master/app/src/App.tsx\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"run-the-app\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#run-the-app\"\u003e\u003ca href=\"#run-the-app\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eRun the app!\u003c/h3\u003e\n\u003cp\u003eGo into the \u003ccode\u003eapp\u003c/code\u003e folder, and then run \u003ccode\u003eyarn start\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"result\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#result\"\u003e\u003ca href=\"#result\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eResult!\u003c/h2\u003e\n\u003cp\u003eA screenshot of the app, showing the string \"Hello Colin\" which is generated via\nrust and wasm\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/rust_wasm_demo.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eMy main aim was to demonstrate creating a \"simple\" monorepo setup showing how\nyou can integrate Rust+WASM and React. Feel free to ask me any questions and go\ncheck out the repo!\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/cmdcolin/rust_react_monorepo_template\"\u003ehttps://github.com/cmdcolin/rust_react_monorepo_template\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"other-resources\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#other-resources\"\u003e\u003ca href=\"#other-resources\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eOther resources\u003c/h2\u003e\n\u003cp\u003eThis article is quite helpful also, but uses a file:/ reference in their\n\u003ccode\u003epackage.json\u003c/code\u003e while my approach uses a monorepo, it is fundamentally quite\nsimilar though!\n\u003ca href=\"https://tkat0.github.io/posts/how-to-create-a-react-app-with-rust-and-wasm\"\u003ehttps://tkat0.github.io/posts/how-to-create-a-react-app-with-rust-and-wasm\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files\"\u003e\u003ca href=\"#footnote-1-the-hello-wasm-folder-is-a-npm-package-with-wasm-files\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 1: The \u003ccode\u003ehello-wasm\u003c/code\u003e folder IS a npm package with wasm files\u003c/h2\u003e\n\u003cp\u003eThe \u003ccode\u003ehello-wasm\u003c/code\u003e folder can be published to NPM by itself. When consumers of the\npackage import the module, they would receive \u003ccode\u003epkg/index.js\u003c/code\u003e from the \u003ccode\u003emain\u003c/code\u003e\nfield in \u003ccode\u003epackage.json\u003c/code\u003e, and then \u003ccode\u003epkg/index.js\u003c/code\u003e in turn imports the\n\u003ccode\u003eindex.wasm\u003c/code\u003e file. Then it is up to the consumers bundler to package that\ncorrectly.\u003c/p\u003e\n\u003ch2 id=\"footnote-2-bundlers-and-wasm\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-2-bundlers-and-wasm\"\u003e\u003ca href=\"#footnote-2-bundlers-and-wasm\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 2: Bundlers and wasm\u003c/h2\u003e\n\u003cp\u003eAs of writing, I am using \u003ccode\u003ewebpack\u003c/code\u003e v5 (part of \u003ccode\u003ecreate-react-app\u003c/code\u003e v5), which\nhas \"native support\" for wasm. Still, it is hidden behind a flag called\n\"experiments\" (see first google result for webpack wasm here\n\u003ca href=\"https://webpack.js.org/configuration/experiments/\"\u003ehttps://webpack.js.org/configuration/experiments/\u003c/a\u003e) so I use \u003ccode\u003e@craco/craco\u003c/code\u003e to\nmodify the \u003ccode\u003ewebpack\u003c/code\u003e config of \u003ccode\u003ecreate-react-app\u003c/code\u003e v5 to add this.\u003c/p\u003e\n\u003cp\u003eNote also: The first time I wrote this, I used \u003ccode\u003ewebpack\u003c/code\u003e v4, which used a\nslightly different workflow (used a special \u003ccode\u003ewebpack\u003c/code\u003e loader called\n\u003ccode\u003ewasm-loader\u003c/code\u003e)\u003c/p\u003e\n\u003cp\u003eYou can also likely use similar techniques described in this article to\nincorporate into \u003ccode\u003enext.js\u003c/code\u003e since it also uses \u003ccode\u003ewebpack\u003c/code\u003e. If you have info on how\nother bundlers use wasm, feel free to leave a comment.\u003c/p\u003e\n\u003ch2 id=\"footnote-3-why-do-i-have-to-use-async-imports\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-3-why-do-i-have-to-use-async-imports\"\u003e\u003ca href=\"#footnote-3-why-do-i-have-to-use-async-imports\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 3: Why do I have to use async imports?\u003c/h2\u003e\n\u003cp\u003eFundamentally, the \u003ccode\u003e.wasm\u003c/code\u003e file has to be fetched asynchronously before it can\nbe run (it is not in my experience e.g. embedded as binary data inside a js\nfile) which means it would be difficult to use the wasm code as a synchronous\nimport.\u003c/p\u003e\n\u003cp\u003eThere are hints that this may be possible but it would rely on the bundler\nembedding the wasm code in the js itself, or maybe top-level-await. If anyone\nhas more info, feel free to leave a comment!\u003c/p\u003e\n\u003ch2 id=\"footnote-4-build-setup\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-4-build-setup\"\u003e\u003ca href=\"#footnote-4-build-setup\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 4: Build setup\u003c/h2\u003e\n\u003cp\u003eThe \u003ccode\u003ehello-wasm\u003c/code\u003e package does not automatically recompile when we are running\ne.g. \u003ccode\u003eyarn start\u003c/code\u003e in the \u003ccode\u003eapp\u003c/code\u003e folder. Therefore, changes to the rust requires\nyou to manually run \u003ccode\u003eyarn build\u003c/code\u003e in the \u003ccode\u003ehello-wasm\u003c/code\u003e folder. Just something to\nbe aware of\u003c/p\u003e\n\u003ch2 id=\"footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky\"\u003e\u003ca href=\"#footnote-5-my-first-experience-with-trying-to-make-this-work-was-rocky\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 5: My first experience with trying to make this work was rocky!\u003c/h2\u003e\n\u003cp\u003eI first created an example of rust+wasm+react almost two years ago when creating\na fractal viewer \u003ca href=\"https://github.com/cmdcolin/logistic_chaos_map\"\u003ehttps://github.com/cmdcolin/logistic_chaos_map\u003c/a\u003e and it has some\ndevelopment notes on the stumbling blocks I faced\n\u003ca href=\"https://github.com/cmdcolin/logistic_chaos_map/blob/master/NOTES.md\"\u003ehttps://github.com/cmdcolin/logistic_chaos_map/blob/master/NOTES.md\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"footnote-6-i-thought-you-said-typescript-too\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-6-i-thought-you-said-typescript-too\"\u003e\u003ca href=\"#footnote-6-i-thought-you-said-typescript-too\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 6: I thought you said typescript too\u003c/h2\u003e\n\u003cp\u003eYep! The \u003ccode\u003ehello-wasm\u003c/code\u003e example generates typescript \u003ccode\u003e.d.ts\u003c/code\u003e files! Check out the\n\u003ccode\u003ehello-wasm/pkg/\u003c/code\u003e folder after you build it! This was none of my doing, just a\nbuilt-in feature. PS: I highly recommend inspecting the \u003ccode\u003epkg\u003c/code\u003e folder that is\nproduced in the \u003ccode\u003ehello-wasm\u003c/code\u003e build to help understand the details. I also\nrecommend reading the \u003ca href=\"https://rustwasm.github.io/wasm-bindgen/\"\u003ehttps://rustwasm.github.io/wasm-bindgen/\u003c/a\u003e docs and if you\nare getting started with rust, read the Rust Book along with doing rustlings\n\u003ca href=\"https://github.com/rust-lang/rustlings\"\u003ehttps://github.com/rust-lang/rustlings\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"footnote-7-another-resource\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-7-another-resource\"\u003e\u003ca href=\"#footnote-7-another-resource\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 7: Another resource\u003c/h2\u003e\n\u003cp\u003eThis article was posted on reddit and is also a great resource especially about\nsync vs async webpack loading schemes for wasm\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://canvasapp.com/blog/building-modern-web-apps-with-rust-wasm-and-webpack/\"\u003ehttps://canvasapp.com/blog/building-modern-web-apps-with-rust-wasm-and-webpack/\u003c/a\u003e\u003c/p\u003e"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2022-08-22-rustwasm"},"buildId":"tcNuc6kwzTrgsdvTh3dJN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>