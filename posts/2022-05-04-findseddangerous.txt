2:"$Sreact.fragment"
3:I[231,["231","static/chunks/231-2cb6996baa932c49.js","931","static/chunks/app/page-95d4a906a5a795f0.js"],""]
4:I[9275,[],""]
5:I[1343,[],""]
7:I[3120,[],"OutletBoundary"]
9:I[3120,[],"MetadataBoundary"]
b:I[3120,[],"ViewportBoundary"]
d:I[6130,[],""]
1:HL["/_next/static/css/d19cfa26cd1ef694.css","style"]
0:{"P":null,"b":"-T_rulmRAJ9mstexno2QC","p":"","c":["","posts","2022-05-04-findseddangerous"],"i":false,"f":[[["",{"children":["posts",{"children":[["id","2022-05-04-findseddangerous","d"],{"children":["__PAGE__?{\"id\":\"2022-05-04-findseddangerous\"}",{}]}]}]},"$undefined","$undefined",true],["",["$","$2","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d19cfa26cd1ef694.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"className":"mb-8","children":["$","$L3",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}],["$","footer",null,{"className":"mt-16","children":[["$","$L3",null,{"className":"m-2","href":"/","children":"Home"}],["$","$L3",null,{"className":"m-2","href":"/archive","children":"Blog archive"}],["$","$L3",null,{"className":"m-2","href":"https://github.com/cmdcolin/","children":"Github"}],["$","$L3",null,{"className":"m-2","href":"/projects","children":"Projects"}],["$","$L3",null,{"className":"m-2","href":"/photos","children":"Photos"}],["$","$L3",null,{"className":"m-2","href":"/books","children":"Books"}],["$","$L3",null,{"className":"m-2","href":"/about","children":"About"}],["$","$L3",null,{"className":"m-2","href":"/rss.xml","children":"RSS"}]]}]]}]}]]}],{"children":["posts",["$","$2","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":[["id","2022-05-04-findseddangerous","d"],["$","$2","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":["__PAGE__",["$","$2","c",{"children":["$L6",null,["$","$L7",null,{"children":"$L8"}]]}],{},null]},null]},null]},null],["$","$2","h",{"children":[null,["$","$2","tRgj4Bk6chxIGIdGEnDBf",{"children":[["$","$L9",null,{"children":"$La"}],["$","$Lb",null,{"children":"$Lc"}],null]}]]}]]],"m":"$undefined","G":["$d","$undefined"],"s":false,"S":true}
c:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
f:I[1458,["722","static/chunks/app/posts/%5Bid%5D/page-e50cd2f34f19f050.js"],"default"]
e:T1eba,<p>You want to find and replace all instances of a string in your repo, so you
google "find replace directory linux command". You end up here</p>
<p><a href="https://stackoverflow.com/a/6759339/2129219">https://stackoverflow.com/a/6759339/2129219</a></p>
<p>They tell us</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">find</span><span style="color:#98C379"> ./</span><span style="color:#D19A66"> -type</span><span style="color:#98C379"> f</span><span style="color:#D19A66"> -exec</span><span style="color:#98C379"> sed</span><span style="color:#D19A66"> -i</span><span style="color:#D19A66"> -e</span><span style="color:#98C379"> 's/apple/orange/g'</span><span style="color:#98C379"> {}</span><span style="color:#56B6C2"> \;</span></span></code></pre></figure>
<p>Ignoring the fact that this syntax is very long and hard to type, this command
is dangerous to use in a git repository. Specifically, this can corrupt your
.git contents.</p>
<h2 id="why"><a aria-hidden="true" tabindex="-1" href="#why"><a href="#why" style="margin-right: 10px">#</a></a>Why?</h2>
<p>This command is dangerous because, find . will enumerate dotfiles, including the
.git directory, and then of course will run the find and replace inside them. We
can see this in the following session</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">> mkdir corruptme</span></span>
<span data-line=""><span style="color:#ABB2BF">> cd corruptme</span></span>
<span data-line=""><span style="color:#ABB2BF">> git init</span></span>
<span data-line=""><span style="color:#ABB2BF">> echo </span><span style="color:#98C379">"# README"</span><span style="color:#ABB2BF"> > README.md</span></span>
<span data-line=""><span style="color:#ABB2BF">> git add README.md</span></span>
<span data-line=""><span style="color:#ABB2BF">> git commit -m </span><span style="color:#98C379">"Initial commit"</span></span>
<span data-line=""><span style="color:#ABB2BF">> echo </span><span style="color:#98C379">"Hello world, it is a beautiful day. I sure hope someone doesn't corrupt this git repository"</span><span style="color:#ABB2BF"> >> README.md</span></span>
<span data-line=""><span style="color:#ABB2BF">> git commit -am </span><span style="color:#98C379">"Update README.md"</span></span>
<span data-line=""><span style="color:#ABB2BF">> find </span><span style="color:#56B6C2">.</span></span>
<span data-line=""><span style="color:#56B6C2">.</span></span>
<span data-line=""><span style="color:#61AFEF">./README.md</span></span>
<span data-line=""><span style="color:#61AFEF">./.git</span></span>
<span data-line=""><span style="color:#61AFEF">./.git/branches</span></span>
<span data-line=""><span style="color:#61AFEF">./.git/config</span></span>
<span data-line=""><span style="color:#61AFEF">./.git/COMMIT_EDITMSG</span></span>
<span data-line=""><span style="color:#56B6C2">..</span><span style="color:#98C379">.more</span><span style="color:#98C379"> stuff...good</span><span style="color:#98C379"> indication</span><span style="color:#98C379"> the</span><span style="color:#98C379"> next</span><span style="color:#98C379"> command</span><span style="color:#98C379"> might</span><span style="color:#98C379"> be</span><span style="color:#98C379"> dangerous....</span></span>
<span data-line=""><span style="color:#ABB2BF">> find ./ -type f -exec sed -i -e </span><span style="color:#98C379">"s/README/CORRUPTME/g"</span><span style="color:#ABB2BF"> {} </span><span style="color:#56B6C2">\;</span></span>
<span data-line=""><span style="color:#ABB2BF">> </span><span style="color:#61AFEF">git</span><span style="color:#98C379"> status</span></span>
<span data-line=""><span style="color:#61AFEF">error:</span><span style="color:#98C379"> index</span><span style="color:#98C379"> uses</span><span style="color:#98C379"> md</span><span style="color:#98C379"> extension,</span><span style="color:#98C379"> which</span><span style="color:#98C379"> we</span><span style="color:#98C379"> do</span><span style="color:#98C379"> not</span><span style="color:#98C379"> understand</span></span>
<span data-line=""><span style="color:#61AFEF">fatal:</span><span style="color:#98C379"> index</span><span style="color:#98C379"> file</span><span style="color:#98C379"> corrupt</span></span></code></pre></figure>
<p>In this case, you may be able to recover it e.g. with
<a href="https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git">https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git</a></p>
<p>If you happened to replace some random text that is actually in an object file
though e.g. .git/objects</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">> find ./ -type f -exec sed -i -e </span><span style="color:#98C379">"s/VHTHJM/OOOOOO/g"</span><span style="color:#ABB2BF"> {} </span><span style="color:#56B6C2">\;</span></span>
<span data-line=""><span style="color:#ABB2BF">> </span><span style="color:#61AFEF">git</span><span style="color:#98C379"> status</span></span>
<span data-line=""><span style="color:#61AFEF">error:</span><span style="color:#98C379"> inflate:</span><span style="color:#98C379"> data</span><span style="color:#98C379"> stream</span><span style="color:#98C379"> error</span><span style="color:#ABB2BF"> (incorrect </span><span style="color:#98C379">data</span><span style="color:#98C379"> check</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#61AFEF">error:</span><span style="color:#98C379"> corrupt</span><span style="color:#98C379"> loose</span><span style="color:#98C379"> object</span><span style="color:#98C379"> '26cfc5964dfa5355a1747eb6eec6250aab5212d5'</span></span>
<span data-line=""><span style="color:#61AFEF">fatal:</span><span style="color:#98C379"> unable</span><span style="color:#98C379"> to</span><span style="color:#98C379"> read</span><span style="color:#98C379"> 26cfc5964dfa5355a1747eb6eec6250aab5212d5</span></span></code></pre></figure>
<h2 id="what-is-better"><a aria-hidden="true" tabindex="-1" href="#what-is-better"><a href="#what-is-better" style="margin-right: 10px">#</a></a>What is better?</h2>
<p>My take: Use ruplacer <a href="https://github.com/dmerejkowsky/ruplacer">https://github.com/dmerejkowsky/ruplacer</a></p>
<p>This tool won't try to replace stuff in your .git directory. It will also skip
anything in .gitignore including e.g. node_modules. I was delighted to discover
this tool so, just spreading the word</p>
<p>Addendum: Reddit /u/Snarwin also recommended using git ls-files instead of find</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">git</span><span style="color:#98C379"> ls-files</span><span style="color:#ABB2BF"> | </span><span style="color:#61AFEF">xargs</span><span style="color:#98C379"> sed</span><span style="color:#D19A66"> -i</span><span style="color:#D19A66"> -e</span><span style="color:#98C379"> 's/apple/orange/g'</span></span></code></pre></figure>6:["$","div",null,{"className":"lg:w-1/2","children":[["$","div",null,{"children":[["$","h1",null,{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","h4",null,{"children":"2022-05-04"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$e"}}],["$","$Lf",null,{}]]}]
a:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","meta","2",{"name":"description","content":"A blog"}]]
8:null
