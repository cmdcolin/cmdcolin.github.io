0:[[["",{"children":["posts",{"children":[["id","2022-05-04-findseddangerous","d"],{"children":["__PAGE__?{\"id\":\"2022-05-04-findseddangerous\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
3:I{"id":"3619","name":"","chunks":["619:619-d3e80a47715091a2","931:app/page-59752a1737368847"],"async":false}
4:I{"id":"1300","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
5:I{"id":"6022","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
1:[["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L3",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2022-05-04-findseddangerous","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$L6","$@7"],"segment":"__PAGE__?{\"id\":\"2022-05-04-findseddangerous\"}"}}],"segment":["id","2022-05-04-findseddangerous","d"]}}],"segment":"posts"}}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L3",null,{"href":"/","children":"Home"}]," ",["$","$L3",null,{"href":"/archive","children":"Blog archive"}]," ",["$","$L3",null,{"href":"https://github.com/cmdcolin/","children":"Github"}]," ",["$","$L3",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}]," ",["$","$L3",null,{"href":"/projects","children":"Projects"}]," ",["$","$L3",null,{"href":"/photos","children":"Photos"}]," ",["$","$L3",null,{"href":"/rss.xml","children":"RSS"}]," ",["$","$L3",null,{"href":"/about","children":"About"}]]}]]}]}],"$@8"]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","meta",null,{"name":"description","content":"A blog"}],null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
9:I{"id":"3591","name":"","chunks":["722:app/posts/[id]/page-cb4a6e559310dd46"],"async":false}
7:[null,null,[]]
8:[null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97dc5fe527f5d592.css","precedence":"next.js"}]]]
6:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","h4",null,{"children":"2022-05-04"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"<p>You want to find and replace all instances of a string in your repo, so you\ngoogle \"find replace directory linux command\". You end up here</p>\n<p><a href=\"https://stackoverflow.com/a/6759339/2129219\">https://stackoverflow.com/a/6759339/2129219</a></p>\n<p>They tell us</p>\n<pre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #91B4D5\">find</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">./</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-type</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">f</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-exec</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">sed</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-i</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-e</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #A6ACCD\">'</span><span style=\"color: #5DE4C7\">s/apple/orange/g</span><span style=\"color: #A6ACCD\">'</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">{}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #5FB3A1\">\\;</span></span></code></pre>\n<p>Ignoring the fact that this syntax is very long and hard to type, this command\nis dangerous to use in a git repository. Specifically, this can corrupt your\n.git contents.</p>\n<h2 id=\"why\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#why\"><a href=\"#why\" style=\"margin-right: 10px\">#</a></a>Why?</h2>\n<p>This command is dangerous because, find . will enumerate dotfiles, including the\n.git directory, and then of course will run the find and replace inside them. We\ncan see this in the following session</p>\n<pre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> mkdir corruptme</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> cd corruptme</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git init</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> echo</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\"># README</span><span style=\"color: #A6ACCD\">\"</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> README.md</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git add README.md</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git commit -m</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\">Initial commit</span><span style=\"color: #A6ACCD\">\"</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> echo</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\">Hello world, it is a beautiful day. I sure hope someone doesn't corrupt this git repository</span><span style=\"color: #A6ACCD\">\"</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #91B4D5\">>></span><span style=\"color: #A6ACCD\"> README.md</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git commit -am</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\">Update README.md</span><span style=\"color: #A6ACCD\">\"</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> find .</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">.</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">./README.md</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">./.git</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">./.git/branches</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">./.git/config</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">./.git/COMMIT_EDITMSG</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">...more</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">stuff...good</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">indication</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">the</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">next</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">command</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">might</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">be</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">dangerous....</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> find ./ -type f -exec sed -i -e</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\">s/README/CORRUPTME/g</span><span style=\"color: #A6ACCD\">\"</span><span style=\"color: #A6ACCD\"> {} </span><span style=\"color: #5FB3A1\">\\;</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git status</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">error:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">index</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">uses</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">md</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">extension,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">which</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">we</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">do</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">not</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">understand</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">fatal:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">index</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">file</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">corrupt</span></span></code></pre>\n<p>In this case, you may be able to recover it e.g. with\n<a href=\"https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git\">https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git</a></p>\n<p>If you happened to replace some random text that is actually in an object file\nthough e.g. .git/objects</p>\n<pre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> find ./ -type f -exec sed -i -e</span><span style=\"color: #A6ACCD\"> \"</span><span style=\"color: #5DE4C7\">s/VHTHJM/OOOOOO/g</span><span style=\"color: #A6ACCD\">\"</span><span style=\"color: #A6ACCD\"> {} </span><span style=\"color: #5FB3A1\">\\;</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">></span><span style=\"color: #A6ACCD\"> git status</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">error:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">inflate:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">data</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">stream</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">error</span><span style=\"color: #A6ACCD\"> (</span><span style=\"color: #91B4D5\">incorrect</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">data</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">check</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">error:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">corrupt</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">loose</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">object</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #A6ACCD\">'</span><span style=\"color: #5DE4C7\">26cfc5964dfa5355a1747eb6eec6250aab5212d5</span><span style=\"color: #A6ACCD\">'</span></span>\n<span class=\"line\"><span style=\"color: #91B4D5\">fatal:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">unable</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">to</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">read</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">26cfc5964dfa5355a1747eb6eec6250aab5212d5</span></span></code></pre>\n<h2 id=\"what-is-better\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#what-is-better\"><a href=\"#what-is-better\" style=\"margin-right: 10px\">#</a></a>What is better?</h2>\n<p>My take: Use ruplacer <a href=\"https://github.com/dmerejkowsky/ruplacer\">https://github.com/dmerejkowsky/ruplacer</a></p>\n<p>This tool won't try to replace stuff in your .git directory. It will also skip\nanything in .gitignore including e.g. node_modules. I was delighted to discover\nthis tool so, just spreading the word</p>\n<p>Addendum: Reddit /u/Snarwin also recommended using git ls-files instead of find</p>\n<pre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #91B4D5\">git</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">ls-files</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #91B4D5\">|</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #91B4D5\">xargs</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">sed</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-i</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #ADD7FF\">-e</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #A6ACCD\">'</span><span style=\"color: #5DE4C7\">s/apple/orange/g</span><span style=\"color: #A6ACCD\">'</span></span></code></pre>"}}],["$","$L9",null,{}]]}]
