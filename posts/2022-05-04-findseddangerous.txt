1:HL["/_next/static/css/e813e5fb1b51ad26.css",{"as":"style"}]
0:["64kXID8DVbqGk_FooXDz7",[[["",{"children":["posts",{"children":[["id","2022-05-04-findseddangerous","d"],{"children":["__PAGE__?{\"id\":\"2022-05-04-findseddangerous\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e813e5fb1b51ad26.css","precedence":"next"}]],["$L3",null]]]]]
4:I{"id":7095,"chunks":["95:static/chunks/95-fe2423899271355b.js","467:static/chunks/app/archive/page-27a5d9689f809faa.js"],"name":"","async":false}
5:I{"id":9180,"chunks":["272:static/chunks/webpack-6ceb684ef8a65d5e.js","253:static/chunks/bce60fc1-8c4748991edb1ec4.js","698:static/chunks/698-a688277c97192edd.js"],"name":"default","async":false}
6:I{"id":2306,"chunks":["272:static/chunks/webpack-6ceb684ef8a65d5e.js","253:static/chunks/bce60fc1-8c4748991edb1ec4.js","698:static/chunks/698-a688277c97192edd.js"],"name":"default","async":false}
2:[["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L4",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2022-05-04-findseddangerous","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L7",null],"segment":"__PAGE__?{\"id\":\"2022-05-04-findseddangerous\"}"},"styles":[]}],"segment":["id","2022-05-04-findseddangerous","d"]},"styles":[]}],"segment":"posts"},"styles":[]}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L4",null,{"href":"/","children":"Home"}]," ",["$","$L4",null,{"href":"/archive","children":"Blog archive"}]," ",["$","$L4",null,{"href":"https://github.com/cmdcolin/","children":"Github"}]," ",["$","$L4",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}]," ",["$","$L4",null,{"href":"/projects","children":"Projects"}]," ",["$","$L4",null,{"href":"/photos","children":"Photos"}]," ",["$","$L4",null,{"href":"/about","children":"About"}]]}]]}]}],null]
9:I{"id":8298,"chunks":["722:static/chunks/app/posts/[id]/page-e495db9298e19bb0.js"],"name":"","async":false}
8:T27fc,<p>You want to find and replace all instances of a string in your repo, so you
google "find replace directory linux command". You end up here</p>
<p><a href="https://stackoverflow.com/a/6759339/2129219">https://stackoverflow.com/a/6759339/2129219</a></p>
<p>They tell us</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">find</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">./</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-type</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">f</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-exec</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">sed</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-i</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-e</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">s/apple/orange/g</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">{}</span><span style="color: #A6ACCD"> </span><span style="color: #5FB3A1">\;</span></span></code></pre>
<p>Ignoring the fact that this syntax is very long and hard to type, this command
is dangerous to use in a git repository. Specifically, this can corrupt your
.git contents.</p>
<h2 id="why"><a aria-hidden="true" tabindex="-1" href="#why"><a href="#why" style="margin-right: 10px">#</a></a>Why?</h2>
<p>This command is dangerous because, find . will enumerate dotfiles, including the
.git directory, and then of course will run the find and replace inside them. We
can see this in the following session</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> mkdir corruptme</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> cd corruptme</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git init</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> echo </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7"># README</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> README.md</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git add README.md</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git commit -m </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">Initial commit</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> echo </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">Hello world, it is a beautiful day. I sure hope someone doesn't corrupt this git repository</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">>></span><span style="color: #A6ACCD"> README.md</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git commit -am </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">Update README.md</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> find .</span></span>
<span class="line"><span style="color: #91B4D5">.</span></span>
<span class="line"><span style="color: #91B4D5">./README.md</span></span>
<span class="line"><span style="color: #91B4D5">./.git</span></span>
<span class="line"><span style="color: #91B4D5">./.git/branches</span></span>
<span class="line"><span style="color: #91B4D5">./.git/config</span></span>
<span class="line"><span style="color: #91B4D5">./.git/COMMIT_EDITMSG</span></span>
<span class="line"><span style="color: #91B4D5">..</span><span style="color: #A6ACCD">.more </span><span style="color: #ADD7FF">stuff...good</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">indication</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">the</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">next</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">command</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">might</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">be</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">dangerous....</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> find ./ -type f -exec sed -i -e </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">s/README/CORRUPTME/g</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD"> {} </span><span style="color: #5FB3A1">\;</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git status</span></span>
<span class="line"><span style="color: #91B4D5">error:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">index</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">uses</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">md</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">extension,</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">which</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">we</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">do</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">not</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">understand</span></span>
<span class="line"><span style="color: #91B4D5">fatal:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">index</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">file</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">corrupt</span></span></code></pre>
<p>In this case, you may be able to recover it e.g. with
<a href="https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git">https://stackoverflow.com/questions/1115854/how-to-resolve-error-bad-index-fatal-index-file-corrupt-when-using-git</a></p>
<p>If you happened to replace some random text that is actually in an object file
though e.g. .git/objects</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> find ./ -type f -exec sed -i -e </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">s/VHTHJM/OOOOOO/g</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD"> {} </span><span style="color: #5FB3A1">\;</span></span>
<span class="line"><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> git status</span></span>
<span class="line"><span style="color: #91B4D5">error:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">inflate:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">data</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">stream</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">error</span><span style="color: #A6ACCD"> (incorrect </span><span style="color: #ADD7FF">data</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">check</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #91B4D5">error:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">corrupt</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">loose</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">object</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">26cfc5964dfa5355a1747eb6eec6250aab5212d5</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #91B4D5">fatal:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">unable</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">to</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">read</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">26</span><span style="color: #ADD7FF">cfc5964dfa5355a1747eb6eec6250aab5212d5</span></span></code></pre>
<h2 id="what-is-better"><a aria-hidden="true" tabindex="-1" href="#what-is-better"><a href="#what-is-better" style="margin-right: 10px">#</a></a>What is better?</h2>
<p>My take: Use ruplacer <a href="https://github.com/dmerejkowsky/ruplacer">https://github.com/dmerejkowsky/ruplacer</a></p>
<p>This tool won't try to replace stuff in your .git directory. It will also skip
anything in .gitignore including e.g. node_modules. I was delighted to discover
this tool so, just spreading the word</p>
<p>Addendum: Reddit /u/Snarwin also recommended using git ls-files instead of find</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">git</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">ls-files</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">|</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">xargs</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">sed</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-i</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-e</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">s/apple/orange/g</span><span style="color: #A6ACCD">'</span></span></code></pre>7:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","h4",null,{"children":"2022-05-04"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$8"}}],["$","$L9",null,{}]]}]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Using find . -exec sed is dangerous in a git repo"}],["$","meta","2",{"name":"description","content":"A blog"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]]
