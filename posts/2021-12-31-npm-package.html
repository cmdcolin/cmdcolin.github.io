<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/d19cfa26cd1ef694.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-dea5254e1907c5df.js"/><script src="/_next/static/chunks/4bd1b696-7cc559629682b47d.js" async=""></script><script src="/_next/static/chunks/215-0c2c111511fa65fd.js" async=""></script><script src="/_next/static/chunks/main-app-d92e72a2e865503d.js" async=""></script><script src="/_next/static/chunks/231-fc74e6e791c0837d.js" async=""></script><script src="/_next/static/chunks/app/page-95d4a906a5a795f0.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-e50cd2f34f19f050.js" async=""></script><title>How to make your own npm package with typescript</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="mb-8"><a href="/">Misc scribbles</a></div><div class="lg:w-1/2"><div><h1>How to make your own npm package with typescript</h1><h4>2021-12-31</h4></div><div><p>There is a lot of mystery around making your own <code>npm</code> package. Every package
likely does it a bit differently, and it can be tricky to get a setup you like.
Should you use a "starter kit" or a boilerplate example? Or just roll your own?
Should you use a bundler? How do you use typescript? Well, why don't we try
starting from scratch and seeing where we can get?</p>
<p>TLDR: here is a github repo with a template package
<a href="https://github.com/cmdcolin/npm-package-tutorial/">https://github.com/cmdcolin/npm-package-tutorial/</a></p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><a href="#introduction" style="margin-right: 10px">#</a></a>Introduction</h2>
<p>An <code>npm</code> package can be very bare bones. In some sense, npmjs.com is just an
arbitrary file host, and you can upload pretty much anything you want to it.</p>
<p>The magic is in the package.json file, which tells npm:</p>
<ul>
<li>what files are part of your package (by default, the whole folder with your
package.json is published, with the "files" field you can say what particular
folders or files are uploaded or you can use .npmignore to choose which files
NOT to publish)</li>
<li>what to use as the "entry point" (e.g. the file that should be referenced when
you say <code>const lib = require('mypackage')</code>, this is governed by the "main"
field, "module" field which is bundler specific, and "export maps" which are
newer but tricky)</li>
<li>what pre- and post- processing steps should be done when the package is being
published (the various "scripts", where you can have "clean", "build", "test",
"lint", "prebuild", etc)</li>
<li>and more!</li>
</ul>
<p>Let's try an experiment...</p>
<h1 id="part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format"><a aria-hidden="true" tabindex="-1" href="#part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format"><a href="#part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format" style="margin-right: 10px">#</a></a>Part 1: the most basic package with plain JS code in commonjs format</h1>
<p>Open up a terminal, and run</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">mkdir</span><span style="color:#98C379"> mypackage</span></span>
<span data-line=""><span style="color:#56B6C2">cd</span><span style="color:#98C379"> mypackage</span></span>
<span data-line=""><span style="color:#61AFEF">git</span><span style="color:#98C379"> init</span><span style="color:#7F848E;font-style:italic"> # make mypackage version controlled</span></span>
<span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> init</span><span style="color:#7F848E;font-style:italic"> # or yarn init</span></span></code></pre></figure>
<p>This init command outputs something like this, and we accept the defaults</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">This</span><span style="color:#98C379"> utility</span><span style="color:#98C379"> will</span><span style="color:#98C379"> walk</span><span style="color:#98C379"> you</span><span style="color:#98C379"> through</span><span style="color:#98C379"> creating</span><span style="color:#98C379"> a</span><span style="color:#98C379"> package.json</span><span style="color:#98C379"> file.</span></span>
<span data-line=""><span style="color:#61AFEF">It</span><span style="color:#98C379"> only</span><span style="color:#98C379"> covers</span><span style="color:#98C379"> the</span><span style="color:#98C379"> most</span><span style="color:#98C379"> common</span><span style="color:#98C379"> items,</span><span style="color:#98C379"> and</span><span style="color:#98C379"> tries</span><span style="color:#98C379"> to</span><span style="color:#98C379"> guess</span><span style="color:#98C379"> sensible</span><span style="color:#98C379"> defaults.</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#61AFEF">See</span><span style="color:#98C379"> `</span><span style="color:#61AFEF">npm</span><span style="color:#98C379"> help init`</span><span style="color:#C678DD"> for</span><span style="color:#ABB2BF"> definitive documentation on these fields</span></span>
<span data-line=""><span style="color:#61AFEF">and</span><span style="color:#98C379"> exactly</span><span style="color:#98C379"> what</span><span style="color:#98C379"> they</span><span style="color:#98C379"> do.</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#61AFEF">Use</span><span style="color:#98C379"> `</span><span style="color:#61AFEF">npm</span><span style="color:#98C379"> install </span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#98C379">pkg</span><span style="color:#ABB2BF">></span><span style="color:#98C379">`</span><span style="color:#61AFEF"> afterwards</span><span style="color:#98C379"> to</span><span style="color:#98C379"> install</span><span style="color:#98C379"> a</span><span style="color:#98C379"> package</span><span style="color:#98C379"> and</span></span>
<span data-line=""><span style="color:#61AFEF">save</span><span style="color:#98C379"> it</span><span style="color:#98C379"> as</span><span style="color:#98C379"> a</span><span style="color:#98C379"> dependency</span><span style="color:#98C379"> in</span><span style="color:#98C379"> the</span><span style="color:#98C379"> package.json</span><span style="color:#98C379"> file.</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#61AFEF">Press</span><span style="color:#98C379"> ^C</span><span style="color:#98C379"> at</span><span style="color:#98C379"> any</span><span style="color:#98C379"> time</span><span style="color:#98C379"> to</span><span style="color:#98C379"> quit.</span></span>
<span data-line=""><span style="color:#61AFEF">package</span><span style="color:#98C379"> name:</span><span style="color:#ABB2BF"> (mypackage)</span></span>
<span data-line=""><span style="color:#61AFEF">version:</span><span style="color:#ABB2BF"> (1.0.0)</span></span>
<span data-line=""><span style="color:#61AFEF">description:</span></span>
<span data-line=""><span style="color:#61AFEF">entry</span><span style="color:#98C379"> point:</span><span style="color:#ABB2BF"> (index.js)</span></span>
<span data-line=""><span style="color:#56B6C2">test</span><span style="color:#98C379"> command:</span></span>
<span data-line=""><span style="color:#61AFEF">git</span><span style="color:#98C379"> repository:</span></span>
<span data-line=""><span style="color:#61AFEF">keywords:</span></span>
<span data-line=""><span style="color:#61AFEF">license:</span><span style="color:#ABB2BF"> (ISC)</span></span>
<span data-line=""><span style="color:#61AFEF">About</span><span style="color:#98C379"> to</span><span style="color:#98C379"> write</span><span style="color:#98C379"> to</span><span style="color:#98C379"> /home/cdiesh/mypackage/package.json:</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#61AFEF">  "name"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "mypackage",</span></span>
<span data-line=""><span style="color:#61AFEF">  "version"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "1.0.0",</span></span>
<span data-line=""><span style="color:#61AFEF">  "description"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "",</span></span>
<span data-line=""><span style="color:#61AFEF">  "main"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "index.js",</span></span>
<span data-line=""><span style="color:#61AFEF">  "scripts"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> {</span></span>
<span data-line=""><span style="color:#61AFEF">    "test"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "echo </span><span style="color:#56B6C2">\"</span><span style="color:#98C379">Error: no test specified</span><span style="color:#56B6C2">\"</span><span style="color:#98C379"> &#x26;&#x26; exit 1"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#61AFEF">  "author"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "Colin",</span></span>
<span data-line=""><span style="color:#61AFEF">  "license"</span><span style="color:#56B6C2">:</span><span style="color:#98C379"> "ISC"</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span>
<span data-line=""> </span></code></pre></figure>
<p>Then, you can create a file named <code>index.js</code> (in your package.json it says
<code>"main": "index.js"</code> to refer to this file, the entrypoint)</p>
<p>In your <code>index.js</code> file, generally, you would do things like export a function
or functions. I will use commonjs exports here for maximum compatibility:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="js" data-theme="one-dark-pro"><code data-language="js" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#E5C07B">module</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">exports</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#61AFEF">  hello</span><span style="color:#ABB2BF">: () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#E5C07B">    console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'hello world'</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<h2 id="publishing-a-package"><a aria-hidden="true" tabindex="-1" href="#publishing-a-package"><a href="#publishing-a-package" style="margin-right: 10px">#</a></a>Publishing a package</h2>
<p>This npm package, <code>mypackage</code> can now be published to <code>npm</code> with a simple
command.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> publish</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> publish</span></span></code></pre></figure>
<p>This will prompt you for your npmjs.com username, password, email, and if
needed, 2FA token (highly recommended)</p>
<h2 id="using-your-package-after-it-is-published"><a aria-hidden="true" tabindex="-1" href="#using-your-package-after-it-is-published"><a href="#using-your-package-after-it-is-published" style="margin-right: 10px">#</a></a>Using your package after it is published</h2>
<p>Once it is published, you can use it in your create-react-app app or other npm
package.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> install</span><span style="color:#98C379"> mypackage</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#98C379"> mypackage</span></span></code></pre></figure>
<p>Then you can use</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="js" data-theme="one-dark-pro"><code data-language="js" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">hello</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'mypackage'</span></span></code></pre></figure>
<p>in any of your other codebases</p>
<h2 id="summary-of-the-simplest-npm-package"><a aria-hidden="true" tabindex="-1" href="#summary-of-the-simplest-npm-package"><a href="#summary-of-the-simplest-npm-package" style="margin-right: 10px">#</a></a>Summary of the simplest NPM package</h2>
<p>This all seems pretty boring thus far but it tells us a couple things</p>
<ol>
<li>packages can be very very bare bones</li>
<li>no transpiler or bundler is needed for publishing an npm package</li>
<li>our package can consist of a single file and it is uploaded to npm, and the
"main" field in package.json provides an entry point</li>
<li>the filename index.js is not special, probably it is a hangover from the name
index.html. you can use whatever name you want</li>
</ol>
<h1 id="part-2-adding-typescript"><a aria-hidden="true" tabindex="-1" href="#part-2-adding-typescript"><a href="#part-2-adding-typescript" style="margin-right: 10px">#</a></a>Part 2: Adding typescript</h1>
<p>Let's try adding typescript</p>
<p>To do this, we will use the typescript compiler to compile a directory of files
in our "src" directory and output the compiled files to a directory named "dist"</p>
<p>To start, let's add typescript</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> install</span><span style="color:#D19A66"> --save-dev</span><span style="color:#98C379"> typescript</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#D19A66"> -D</span><span style="color:#98C379"> typescript</span></span></code></pre></figure>
<p>Our package.json now will have <code>typescript</code> in it's <code>devDependencies</code> (this
means that when someone installs your package, it they don't get typescript as a
dependency, it is just a dependency for while you are developing the library
locally).</p>
<p>Then we need to create a tsconfig.json for typescript to use</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> tsc</span><span style="color:#D19A66"> --init</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">npx</span><span style="color:#98C379"> tsc</span><span style="color:#D19A66"> --init</span></span></code></pre></figure>
<p>This will generate a <code>tsconfig.json</code> file (needed by <code>typescript</code>) with a bunch
of options, but I have stripped it down in my projects to look like this</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "include"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"src"</span><span style="color:#ABB2BF">],</span></span>
<span data-line=""><span style="color:#E06C75">  "compilerOptions"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "target"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"es2018"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "moduleResolution"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"node"</span><span style="color:#ABB2BF">, </span><span style="color:#7F848E;font-style:italic">// don't have to import actual filenames, can import extensionless files</span></span>
<span data-line=""><span style="color:#E06C75">    "declaration"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">, </span><span style="color:#7F848E;font-style:italic">// generate .d.ts files</span></span>
<span data-line=""><span style="color:#E06C75">    "sourceMap"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">, </span><span style="color:#7F848E;font-style:italic">// generate source map</span></span>
<span data-line=""><span style="color:#E06C75">    "outDir"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"dist"</span><span style="color:#ABB2BF">, </span><span style="color:#7F848E;font-style:italic">// output compiled js, d.ts, and source map to dist folder</span></span>
<span data-line=""><span style="color:#E06C75">    "strict"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "esModuleInterop"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>Now, let's wrote a little typescript. We can now use "ESM" style code, we will
compile it to commonjs format.</p>
<p>util.ts</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> getMessage</span><span style="color:#ABB2BF">() {</span></span>
<span data-line=""><span style="color:#C678DD">  return</span><span style="color:#98C379"> 'hello'</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>index.ts</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">getMessage</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> './util'</span></span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> sayMessage</span><span style="color:#ABB2BF">() {</span></span>
<span data-line=""><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getMessage</span><span style="color:#ABB2BF">())</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>And then we will add a <code>"build"</code> script to <code>package.json</code> to compile the
library, and refer to the <code>"dist"</code> directory for the <code>"files"</code> and <code>"main"</code>
fields in <code>package.json</code></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "name"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"mypackage"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "version"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"1.0.0"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "description"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "main"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"src/index.js"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "files"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"dist"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"src"</span><span style="color:#ABB2BF">], </span><span style="color:#7F848E;font-style:italic">// we publish both dist and src to get proper sourceMaps</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --module commonjs"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "author"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"Colin"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "license"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"ISC"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^4.5.4"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>We can now run</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> run</span><span style="color:#98C379"> build</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> build</span></span></code></pre></figure>
<p>And this will run the <code>"build"</code> script we created, which in turn, just runs
<code>tsc</code> with no arguments.</p>
<p>You can also add a <code>"prebuild"</code> script that clears out the old contents. In
fact, npm scripts generalizes the naming system -- you can make scripts with
whatever name you want, e.g.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "preparty"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"echo preparty"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "party"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"echo party"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "postparty"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"echo postparty"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>Then running</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">$</span><span style="color:#98C379"> yarn</span><span style="color:#98C379"> party</span></span>
<span data-line=""><span style="color:#61AFEF">preparty</span></span>
<span data-line=""><span style="color:#61AFEF">party</span></span>
<span data-line=""><span style="color:#61AFEF">postparty</span></span></code></pre></figure>
<p>To make this useful, we will use <code>rimraf</code> (a node package) to make a
cross-platform removal of the <code>dist</code> directory</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> install</span><span style="color:#D19A66"> --save-dev</span><span style="color:#98C379"> rimraf</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#D19A66"> -D</span><span style="color:#98C379"> rimraf</span></span></code></pre></figure>
<p>and then update your package.json</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#FFFFFF">  ...</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "clean"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"rimraf dist"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "prebuild"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"npm run clean"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --module commonjs"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "rimraf"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^3.0.2"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^4.5.4"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>We could make it say "rm -rf dist" instead of "rimraf dist" (e.g. run arbitrary
shell commands), but rimraf allows it to be cross-platform</p>
<h2 id="making-sure-you-create-a-fresh-build-before-you-publish"><a aria-hidden="true" tabindex="-1" href="#making-sure-you-create-a-fresh-build-before-you-publish"><a href="#making-sure-you-create-a-fresh-build-before-you-publish" style="margin-right: 10px">#</a></a>Making sure you create a fresh build before you publish</h2>
<p>Without extra instructions, your <code>yarn publish</code> command would not create a fresh
build and you could publish an older version that was lingering in the <code>dist</code>
folder.</p>
<p>We can use a <code>preversion</code> script that will automatically get invoked when you
run <code>yarn publish</code> to make sure you get a fresh build in the <code>dist</code> folder
before you publish</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#FFFFFF">  ...</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#FFFFFF">    ...</span></span>
<span data-line=""><span style="color:#E06C75">    "preversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"npm run build"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<h2 id="making-sure-you-push-your-tag-to-github-after-publish"><a aria-hidden="true" tabindex="-1" href="#making-sure-you-push-your-tag-to-github-after-publish"><a href="#making-sure-you-push-your-tag-to-github-after-publish" style="margin-right: 10px">#</a></a>Making sure you push your tag to github after publish</h2>
<p>When you run <code>yarn publish</code>, npm will automatically create a commit with the
version name and a git tag, it <em>will not</em> automatically push tag to your
repository.</p>
<p>Add a <code>postversion</code> script that pushes the tag to your repo after your publish</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#FFFFFF">  ...</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#FFFFFF">    ...</span></span>
<span data-line=""><span style="color:#E06C75">    "postversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"git push --follow-tags"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<h2 id="incremental-builds"><a aria-hidden="true" tabindex="-1" href="#incremental-builds"><a href="#incremental-builds" style="margin-right: 10px">#</a></a>Incremental builds</h2>
<p>We can use this to do incremental/watch builds</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> run</span><span style="color:#98C379"> build</span><span style="color:#D19A66"> --watch</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> build</span><span style="color:#D19A66"> --watch</span></span></code></pre></figure>
<h2 id="adding-testing-with-ts-jest"><a aria-hidden="true" tabindex="-1" href="#adding-testing-with-ts-jest"><a href="#adding-testing-with-ts-jest" style="margin-right: 10px">#</a></a>Adding testing with ts-jest</h2>
<p>You can use ts-jest to test your code. This involves installing jest,
typescript, ts-jest, @types/jest, and then initializing a jest.config.json</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> i</span><span style="color:#D19A66"> -D</span><span style="color:#98C379"> jest</span><span style="color:#98C379"> typescript</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#D19A66"> --dev</span><span style="color:#98C379"> jest</span><span style="color:#98C379"> typescript</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> i</span><span style="color:#D19A66"> -D</span><span style="color:#98C379"> ts-jest</span><span style="color:#98C379"> @types/jest</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#D19A66"> --dev</span><span style="color:#98C379"> ts-jest</span><span style="color:#98C379"> @types/jest</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npx</span><span style="color:#98C379"> ts-jest</span><span style="color:#98C379"> config:init</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> ts-jest</span><span style="color:#98C379"> config:init</span></span></code></pre></figure>
<p>We can then create a test</p>
<p><code>test/util.spec.ts</code></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">getMessage</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> '../src/util'</span></span>
<span data-line=""><span style="color:#61AFEF">test</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'expected message returned'</span><span style="color:#ABB2BF">, () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#61AFEF">  expect</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getMessage</span><span style="color:#ABB2BF">()).</span><span style="color:#61AFEF">toBe</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'hello'</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">})</span></span></code></pre></figure>
<p>Then we can then create a script in the package.json that says <code>"test": "jest"</code>,
and then we can say</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">npm</span><span style="color:#98C379"> run</span><span style="color:#98C379"> test</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic"># or</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> test</span></span></code></pre></figure>
<p>You can also create an alternative system where you use <code>babel-eslint</code> and
various babel strategies to test your code, but if you are using <code>typescript</code>,
<code>ts-jest</code> and <code>typescript</code> works great.</p>
<h2 id="add-a-gitignore"><a aria-hidden="true" tabindex="-1" href="#add-a-gitignore"><a href="#add-a-gitignore" style="margin-right: 10px">#</a></a>Add a .gitignore</h2>
<p>Create a .gitignore with just a line that references this <code>dist</code> folder and
<code>node_modules</code> folder</p>
<pre><code>dist
node_modules
</code></pre>
<h2 id="the-future-of-esm-modules"><a aria-hidden="true" tabindex="-1" href="#the-future-of-esm-modules"><a href="#the-future-of-esm-modules" style="margin-right: 10px">#</a></a>The future of ESM modules</h2>
<p>There is a shift happening where modules are changing to be pure ESM rather than
keeping commonjs equivalents</p>
<p><a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c</a></p>
<p>There are many challenges here, but one shortcut that I have used is to actually
go "halfway to ESM" and just publish a "dual" package: one "main" field in the
package.json referring to a commonjs file, and one "module" field with an ESM
style build for bundlers. I do it like this:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "files"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"dist"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"esm"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"src"</span><span style="color:#ABB2BF">],</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#FFFFFF">     ...</span></span>
<span data-line=""><span style="color:#E06C75">    "clean"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"rimraf dist esm"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "prebuild"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"npm run clean"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build:cjs"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --module commonjs --ourDir dist"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build:esm"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --target es2018 --outDir esm"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"npm run build:esm &#x26;&#x26; npm run build:cjs"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "main"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"dist/index.js"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "module"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"esm/index.js"</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>The "module" field is understood by bundlers like webpack and you can do
slightly less polyfilling/babeling on it (hence the different <code>--target</code>
attributes)</p>
<p>This is not "pure ESM" with the "type":"module" in package.json, but it does
help to have less "babelification" (which in our case is done by tsc) of your
source code.</p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>This tutorial shows you how you can create a basic package that you can publish
to <code>npm</code>. This little boilerplate includes these features:</p>
<ul>
<li>Makes clean build when running <code>yarn build</code> or <code>yarn publish</code></li>
<li>Pushes to github after publish</li>
<li>Uses <code>ts-jest</code> for testing</li>
<li>Uses esm modules</li>
</ul>
<p>You also have full control, and understand the decisions we took to get to this
point. This package does not use any bundling (rollup or webpack or otherwise).
It just uses <code>tsc</code> is used to compile the files to the <code>dist</code> folder, and the
dist folder is published to <code>npm</code>!</p>
<p>If you need your package to be usable by consumers that don't themselves use
bundlers, consider looking into <code>&#x3C;script type="module"></code> for importing ESM
modules in the browser, or you can bundle your library using rollup or webpack
and output e.g. a UMD bundle</p>
<h2 id="final-product"><a aria-hidden="true" tabindex="-1" href="#final-product"><a href="#final-product" style="margin-right: 10px">#</a></a>Final product</h2>
<p>See <a href="https://github.com/cmdcolin/npm-package-tutorial/">https://github.com/cmdcolin/npm-package-tutorial/</a></p>
<p>This is a setup that works for me, but there are many ways to publish a package
so take it with a grain of salt!</p>
<p>Also see my follow up rant: you may not need a bundler
<a href="https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler">https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler</a></p>
<h2 id="footnote-1---what-about-monorepos"><a aria-hidden="true" tabindex="-1" href="#footnote-1---what-about-monorepos"><a href="#footnote-1---what-about-monorepos" style="margin-right: 10px">#</a></a>Footnote 1 - what about monorepos?</h2>
<p>There are many high powered "monorepo" setups like lerna, nx, turborepo, etc.</p>
<p>I think for many purposes, these can be a bit overkill. I would start with yarn
workspaces. Basically, the way this works is you can have e.g. in your root
package.json in your repo something likely</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "name"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"root"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "private"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "workspaces"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"lib"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"app"</span><span style="color:#ABB2BF">]</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>And then in your <code>lib</code> directory you can have your library as we created above
and <code>app</code> for example can be an instance of a <code>vite</code> app that uses your library.
You can reference your lib by name in the <code>app</code> folders package.json, and it
will automatically get the latest version of it that you have built from the
<code>lib</code> directory e.g. your <code>app</code> will look at the libs "dist" folder: it's
compiled outputs. That means you can run <code>yarn tsc --watch</code> in the lib folder to
continuously build it, and then e.g. when you are running e.g. <code>yarn dev</code> in the
<code>app</code> directory, it will see updates to the <code>lib</code> dist directory and auto-update
via hot module refresh</p>
<p>High powered solutions like nx, turborepo, etc may have solutions for
'automatically building all the stuff' without you explicitly having to run the
build in the <code>lib</code> directory, but for simple monorepo setups, this works ok</p></div><div class="mt-5"></div></div><footer class="mt-16"><a class="m-2" href="/">Home</a><a class="m-2" href="/archive">Blog archive</a><a class="m-2" href="https://github.com/cmdcolin/">Github</a><a class="m-2" href="/projects">Projects</a><a class="m-2" href="/photos">Photos</a><a class="m-2" href="/books">Books</a><a class="m-2" href="/about">About</a></footer><script src="/_next/static/chunks/webpack-dea5254e1907c5df.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"2:\"$Sreact.fragment\"\n3:I[231,[\"231\",\"static/chunks/231-fc74e6e791c0837d.js\",\"931\",\"static/chunks/app/page-95d4a906a5a795f0.js\"],\"\"]\n4:I[9275,[],\"\"]\n5:I[1343,[],\"\"]\n7:I[3120,[],\"OutletBoundary\"]\n9:I[3120,[],\"MetadataBoundary\"]\nb:I[3120,[],\"ViewportBoundary\"]\nd:I[6130,[],\"\"]\n1:HL[\"/_next/static/css/d19cfa26cd1ef694.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"H8zRZr_eaA6W0Inm0GAij\",\"p\":\"\",\"c\":[\"\",\"posts\",\"2021-12-31-npm-package\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2021-12-31-npm-package\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2021-12-31-npm-package\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$2\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d19cfa26cd1ef694.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"$L3\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"footer\",null,{\"className\":\"mt-16\",\"children\":[[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L3\",null,{\"className\":\"m-2\",\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$2\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2021-12-31-npm-package\",\"d\"],[\"$\",\"$2\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$2\",\"c\",{\"children\":[\"$L6\",null,[\"$\",\"$L7\",null,{\"children\":\"$L8\"}]]}],{},null]},null]},null]},null],[\"$\",\"$2\",\"h\",{\"children\":[null,[\"$\",\"$2\",\"W4z7At1jfqXXfCN6q4-Mw\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1458,[\"722\",\"static/chunks/app/posts/%5Bid%5D/page-e50cd2f34f19f050.js\"],\"default\"]\ne:Tb1b9,"])</script><script>self.__next_f.push([1,"\u003cp\u003eThere is a lot of mystery around making your own \u003ccode\u003enpm\u003c/code\u003e package. Every package\nlikely does it a bit differently, and it can be tricky to get a setup you like.\nShould you use a \"starter kit\" or a boilerplate example? Or just roll your own?\nShould you use a bundler? How do you use typescript? Well, why don't we try\nstarting from scratch and seeing where we can get?\u003c/p\u003e\n\u003cp\u003eTLDR: here is a github repo with a template package\n\u003ca href=\"https://github.com/cmdcolin/npm-package-tutorial/\"\u003ehttps://github.com/cmdcolin/npm-package-tutorial/\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003ca href=\"#introduction\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eAn \u003ccode\u003enpm\u003c/code\u003e package can be very bare bones. In some sense, npmjs.com is just an\narbitrary file host, and you can upload pretty much anything you want to it.\u003c/p\u003e\n\u003cp\u003eThe magic is in the package.json file, which tells npm:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewhat files are part of your package (by default, the whole folder with your\npackage.json is published, with the \"files\" field you can say what particular\nfolders or files are uploaded or you can use .npmignore to choose which files\nNOT to publish)\u003c/li\u003e\n\u003cli\u003ewhat to use as the \"entry point\" (e.g. the file that should be referenced when\nyou say \u003ccode\u003econst lib = require('mypackage')\u003c/code\u003e, this is governed by the \"main\"\nfield, \"module\" field which is bundler specific, and \"export maps\" which are\nnewer but tricky)\u003c/li\u003e\n\u003cli\u003ewhat pre- and post- processing steps should be done when the package is being\npublished (the various \"scripts\", where you can have \"clean\", \"build\", \"test\",\n\"lint\", \"prebuild\", etc)\u003c/li\u003e\n\u003cli\u003eand more!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's try an experiment...\u003c/p\u003e\n\u003ch1 id=\"part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format\"\u003e\u003ca href=\"#part-1-the-most-basic-package-with-plain-js-code-in-commonjs-format\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003ePart 1: the most basic package with plain JS code in commonjs format\u003c/h1\u003e\n\u003cp\u003eOpen up a terminal, and run\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003emkdir\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e mypackage\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#56B6C2\"\u003ecd\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e mypackage\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003egit\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e init\u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e # make mypackage version controlled\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e init\u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e # or yarn init\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThis init command outputs something like this, and we accept the defaults\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eThis\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e utility\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e will\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e walk\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e you\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e through\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e creating\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e a\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e package.json\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e file.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eIt\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e only\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e covers\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e the\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e most\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e common\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e items,\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e and\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e tries\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e to\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e guess\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e sensible\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e defaults.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eSee\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e `\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e help init`\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e for\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e definitive documentation on these fields\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eand\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e exactly\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e what\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e they\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e do.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eUse\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e `\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e install \u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003epkg\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e afterwards\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e to\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e install\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e a\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e package\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e and\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003esave\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e it\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e a\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e dependency\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e in\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e the\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e package.json\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e file.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003ePress\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e ^C\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e at\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e any\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e time\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e to\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e quit.\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003epackage\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e name:\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e (mypackage)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eversion:\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e (1.0.0)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003edescription:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eentry\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e point:\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e (index.js)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#56B6C2\"\u003etest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e command:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003egit\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e repository:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003ekeywords:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003elicense:\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e (ISC)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eAbout\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e to\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e write\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e to\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e /home/cdiesh/mypackage/package.json:\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"mypackage\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"version\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"1.0.0\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"description\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"main\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"index.js\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e    \"test\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"echo \u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003eError: no test specified\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \u0026#x26;\u0026#x26; exit 1\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"author\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"Colin\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  \"license\"\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e \"ISC\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThen, you can create a file named \u003ccode\u003eindex.js\u003c/code\u003e (in your package.json it says\n\u003ccode\u003e\"main\": \"index.js\"\u003c/code\u003e to refer to this file, the entrypoint)\u003c/p\u003e\n\u003cp\u003eIn your \u003ccode\u003eindex.js\u003c/code\u003e file, generally, you would do things like export a function\nor functions. I will use commonjs exports here for maximum compatibility:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"js\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"js\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E5C07B\"\u003emodule\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#E5C07B\"\u003eexports\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  hello\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: () \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E5C07B\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'hello world'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"publishing-a-package\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#publishing-a-package\"\u003e\u003ca href=\"#publishing-a-package\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003ePublishing a package\u003c/h2\u003e\n\u003cp\u003eThis npm package, \u003ccode\u003emypackage\u003c/code\u003e can now be published to \u003ccode\u003enpm\u003c/code\u003e with a simple\ncommand.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e publish\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e publish\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThis will prompt you for your npmjs.com username, password, email, and if\nneeded, 2FA token (highly recommended)\u003c/p\u003e\n\u003ch2 id=\"using-your-package-after-it-is-published\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-your-package-after-it-is-published\"\u003e\u003ca href=\"#using-your-package-after-it-is-published\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUsing your package after it is published\u003c/h2\u003e\n\u003cp\u003eOnce it is published, you can use it in your create-react-app app or other npm\npackage.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e install\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e mypackage\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e add\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e mypackage\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThen you can use\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"js\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"js\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003ehello\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e 'mypackage'\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003ein any of your other codebases\u003c/p\u003e\n\u003ch2 id=\"summary-of-the-simplest-npm-package\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#summary-of-the-simplest-npm-package\"\u003e\u003ca href=\"#summary-of-the-simplest-npm-package\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eSummary of the simplest NPM package\u003c/h2\u003e\n\u003cp\u003eThis all seems pretty boring thus far but it tells us a couple things\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003epackages can be very very bare bones\u003c/li\u003e\n\u003cli\u003eno transpiler or bundler is needed for publishing an npm package\u003c/li\u003e\n\u003cli\u003eour package can consist of a single file and it is uploaded to npm, and the\n\"main\" field in package.json provides an entry point\u003c/li\u003e\n\u003cli\u003ethe filename index.js is not special, probably it is a hangover from the name\nindex.html. you can use whatever name you want\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"part-2-adding-typescript\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#part-2-adding-typescript\"\u003e\u003ca href=\"#part-2-adding-typescript\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003ePart 2: Adding typescript\u003c/h1\u003e\n\u003cp\u003eLet's try adding typescript\u003c/p\u003e\n\u003cp\u003eTo do this, we will use the typescript compiler to compile a directory of files\nin our \"src\" directory and output the compiled files to a directory named \"dist\"\u003c/p\u003e\n\u003cp\u003eTo start, let's add typescript\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e install\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --save-dev\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e typescript\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e add\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e -D\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e typescript\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eOur package.json now will have \u003ccode\u003etypescript\u003c/code\u003e in it's \u003ccode\u003edevDependencies\u003c/code\u003e (this\nmeans that when someone installs your package, it they don't get typescript as a\ndependency, it is just a dependency for while you are developing the library\nlocally).\u003c/p\u003e\n\u003cp\u003eThen we need to create a tsconfig.json for typescript to use\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e tsc\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --init\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpx\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e tsc\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --init\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThis will generate a \u003ccode\u003etsconfig.json\u003c/code\u003e file (needed by \u003ccode\u003etypescript\u003c/code\u003e) with a bunch\nof options, but I have stripped it down in my projects to look like this\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"include\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: [\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"src\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"compilerOptions\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"target\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"es2018\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"moduleResolution\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"node\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// don't have to import actual filenames, can import extensionless files\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"declaration\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// generate .d.ts files\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"sourceMap\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// generate source map\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"outDir\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// output compiled js, d.ts, and source map to dist folder\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"strict\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"esModuleInterop\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eNow, let's wrote a little typescript. We can now use \"ESM\" style code, we will\ncompile it to commonjs format.\u003c/p\u003e\n\u003cp\u003eutil.ts\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e getMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e 'hello'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eindex.ts\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003egetMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e './util'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e sayMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E5C07B\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003egetMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eAnd then we will add a \u003ccode\u003e\"build\"\u003c/code\u003e script to \u003ccode\u003epackage.json\u003c/code\u003e to compile the\nlibrary, and refer to the \u003ccode\u003e\"dist\"\u003c/code\u003e directory for the \u003ccode\u003e\"files\"\u003c/code\u003e and \u003ccode\u003e\"main\"\u003c/code\u003e\nfields in \u003ccode\u003epackage.json\u003c/code\u003e\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"mypackage\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"version\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"description\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"main\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"src/index.js\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"files\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: [\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"src\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e], \u003c/span\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// we publish both dist and src to get proper sourceMaps\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --module commonjs\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"author\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"Colin\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"license\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"ISC\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"devDependencies\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"typescript\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^4.5.4\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eWe can now run\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e run\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e build\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e build\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eAnd this will run the \u003ccode\u003e\"build\"\u003c/code\u003e script we created, which in turn, just runs\n\u003ccode\u003etsc\u003c/code\u003e with no arguments.\u003c/p\u003e\n\u003cp\u003eYou can also add a \u003ccode\u003e\"prebuild\"\u003c/code\u003e script that clears out the old contents. In\nfact, npm scripts generalizes the naming system -- you can make scripts with\nwhatever name you want, e.g.\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"preparty\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"echo preparty\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"party\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"echo party\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postparty\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"echo postparty\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThen running\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e yarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e party\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003epreparty\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eparty\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003epostparty\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eTo make this useful, we will use \u003ccode\u003erimraf\u003c/code\u003e (a node package) to make a\ncross-platform removal of the \u003ccode\u003edist\u003c/code\u003e directory\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e install\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --save-dev\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e rimraf\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e add\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e -D\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e rimraf\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eand then update your package.json\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"rimraf dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"prebuild\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"npm run clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --module commonjs\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"devDependencies\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"rimraf\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^3.0.2\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"typescript\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^4.5.4\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eWe could make it say \"rm -rf dist\" instead of \"rimraf dist\" (e.g. run arbitrary\nshell commands), but rimraf allows it to be cross-platform\u003c/p\u003e\n\u003ch2 id=\"making-sure-you-create-a-fresh-build-before-you-publish\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#making-sure-you-create-a-fresh-build-before-you-publish\"\u003e\u003ca href=\"#making-sure-you-create-a-fresh-build-before-you-publish\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eMaking sure you create a fresh build before you publish\u003c/h2\u003e\n\u003cp\u003eWithout extra instructions, your \u003ccode\u003eyarn publish\u003c/code\u003e command would not create a fresh\nbuild and you could publish an older version that was lingering in the \u003ccode\u003edist\u003c/code\u003e\nfolder.\u003c/p\u003e\n\u003cp\u003eWe can use a \u003ccode\u003epreversion\u003c/code\u003e script that will automatically get invoked when you\nrun \u003ccode\u003eyarn publish\u003c/code\u003e to make sure you get a fresh build in the \u003ccode\u003edist\u003c/code\u003e folder\nbefore you publish\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"preversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"npm run build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"making-sure-you-push-your-tag-to-github-after-publish\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#making-sure-you-push-your-tag-to-github-after-publish\"\u003e\u003ca href=\"#making-sure-you-push-your-tag-to-github-after-publish\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eMaking sure you push your tag to github after publish\u003c/h2\u003e\n\u003cp\u003eWhen you run \u003ccode\u003eyarn publish\u003c/code\u003e, npm will automatically create a commit with the\nversion name and a git tag, it \u003cem\u003ewill not\u003c/em\u003e automatically push tag to your\nrepository.\u003c/p\u003e\n\u003cp\u003eAdd a \u003ccode\u003epostversion\u003c/code\u003e script that pushes the tag to your repo after your publish\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"git push --follow-tags\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"incremental-builds\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#incremental-builds\"\u003e\u003ca href=\"#incremental-builds\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIncremental builds\u003c/h2\u003e\n\u003cp\u003eWe can use this to do incremental/watch builds\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e run\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e build\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --watch\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e build\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --watch\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"adding-testing-with-ts-jest\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#adding-testing-with-ts-jest\"\u003e\u003ca href=\"#adding-testing-with-ts-jest\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdding testing with ts-jest\u003c/h2\u003e\n\u003cp\u003eYou can use ts-jest to test your code. This involves installing jest,\ntypescript, ts-jest, @types/jest, and then initializing a jest.config.json\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e i\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e -D\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e typescript\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e add\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --dev\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e typescript\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e i\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e -D\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e ts-jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e @types/jest\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e add\u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003e --dev\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e ts-jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e @types/jest\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpx\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e ts-jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e config:init\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e ts-jest\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e config:init\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eWe can then create a test\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etest/util.spec.ts\u003c/code\u003e\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003egetMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e '../src/util'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003etest\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'expected message returned'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, () \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003e  expect\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003egetMessage\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()).\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003etoBe\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'hello'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThen we can then create a script in the package.json that says \u003ccode\u003e\"test\": \"jest\"\u003c/code\u003e,\nand then we can say\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"sh\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"sh\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003enpm\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e run\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e test\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e# or\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003eyarn\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e test\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eYou can also create an alternative system where you use \u003ccode\u003ebabel-eslint\u003c/code\u003e and\nvarious babel strategies to test your code, but if you are using \u003ccode\u003etypescript\u003c/code\u003e,\n\u003ccode\u003ets-jest\u003c/code\u003e and \u003ccode\u003etypescript\u003c/code\u003e works great.\u003c/p\u003e\n\u003ch2 id=\"add-a-gitignore\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-a-gitignore\"\u003e\u003ca href=\"#add-a-gitignore\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd a .gitignore\u003c/h2\u003e\n\u003cp\u003eCreate a .gitignore with just a line that references this \u003ccode\u003edist\u003c/code\u003e folder and\n\u003ccode\u003enode_modules\u003c/code\u003e folder\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003edist\nnode_modules\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"the-future-of-esm-modules\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-future-of-esm-modules\"\u003e\u003ca href=\"#the-future-of-esm-modules\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe future of ESM modules\u003c/h2\u003e\n\u003cp\u003eThere is a shift happening where modules are changing to be pure ESM rather than\nkeeping commonjs equivalents\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\"\u003ehttps://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThere are many challenges here, but one shortcut that I have used is to actually\ngo \"halfway to ESM\" and just publish a \"dual\" package: one \"main\" field in the\npackage.json referring to a commonjs file, and one \"module\" field with an ESM\nstyle build for bundlers. I do it like this:\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"files\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: [\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"src\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#FFFFFF\"\u003e     ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"rimraf dist esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"prebuild\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"npm run clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build:cjs\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --module commonjs --ourDir dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build:esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --target es2018 --outDir esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"npm run build:esm \u0026#x26;\u0026#x26; npm run build:cjs\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"main\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dist/index.js\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"module\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"esm/index.js\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eThe \"module\" field is understood by bundlers like webpack and you can do\nslightly less polyfilling/babeling on it (hence the different \u003ccode\u003e--target\u003c/code\u003e\nattributes)\u003c/p\u003e\n\u003cp\u003eThis is not \"pure ESM\" with the \"type\":\"module\" in package.json, but it does\nhelp to have less \"babelification\" (which in our case is done by tsc) of your\nsource code.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThis tutorial shows you how you can create a basic package that you can publish\nto \u003ccode\u003enpm\u003c/code\u003e. This little boilerplate includes these features:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMakes clean build when running \u003ccode\u003eyarn build\u003c/code\u003e or \u003ccode\u003eyarn publish\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ePushes to github after publish\u003c/li\u003e\n\u003cli\u003eUses \u003ccode\u003ets-jest\u003c/code\u003e for testing\u003c/li\u003e\n\u003cli\u003eUses esm modules\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eYou also have full control, and understand the decisions we took to get to this\npoint. This package does not use any bundling (rollup or webpack or otherwise).\nIt just uses \u003ccode\u003etsc\u003c/code\u003e is used to compile the files to the \u003ccode\u003edist\u003c/code\u003e folder, and the\ndist folder is published to \u003ccode\u003enpm\u003c/code\u003e!\u003c/p\u003e\n\u003cp\u003eIf you need your package to be usable by consumers that don't themselves use\nbundlers, consider looking into \u003ccode\u003e\u0026#x3C;script type=\"module\"\u003e\u003c/code\u003e for importing ESM\nmodules in the browser, or you can bundle your library using rollup or webpack\nand output e.g. a UMD bundle\u003c/p\u003e\n\u003ch2 id=\"final-product\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#final-product\"\u003e\u003ca href=\"#final-product\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFinal product\u003c/h2\u003e\n\u003cp\u003eSee \u003ca href=\"https://github.com/cmdcolin/npm-package-tutorial/\"\u003ehttps://github.com/cmdcolin/npm-package-tutorial/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is a setup that works for me, but there are many ways to publish a package\nso take it with a grain of salt!\u003c/p\u003e\n\u003cp\u003eAlso see my follow up rant: you may not need a bundler\n\u003ca href=\"https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\"\u003ehttps://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"footnote-1---what-about-monorepos\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1---what-about-monorepos\"\u003e\u003ca href=\"#footnote-1---what-about-monorepos\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 1 - what about monorepos?\u003c/h2\u003e\n\u003cp\u003eThere are many high powered \"monorepo\" setups like lerna, nx, turborepo, etc.\u003c/p\u003e\n\u003cp\u003eI think for many purposes, these can be a bit overkill. I would start with yarn\nworkspaces. Basically, the way this works is you can have e.g. in your root\npackage.json in your repo something likely\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"root\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"private\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"workspaces\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: [\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"lib\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e, \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"app\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eAnd then in your \u003ccode\u003elib\u003c/code\u003e directory you can have your library as we created above\nand \u003ccode\u003eapp\u003c/code\u003e for example can be an instance of a \u003ccode\u003evite\u003c/code\u003e app that uses your library.\nYou can reference your lib by name in the \u003ccode\u003eapp\u003c/code\u003e folders package.json, and it\nwill automatically get the latest version of it that you have built from the\n\u003ccode\u003elib\u003c/code\u003e directory e.g. your \u003ccode\u003eapp\u003c/code\u003e will look at the libs \"dist\" folder: it's\ncompiled outputs. That means you can run \u003ccode\u003eyarn tsc --watch\u003c/code\u003e in the lib folder to\ncontinuously build it, and then e.g. when you are running e.g. \u003ccode\u003eyarn dev\u003c/code\u003e in the\n\u003ccode\u003eapp\u003c/code\u003e directory, it will see updates to the \u003ccode\u003elib\u003c/code\u003e dist directory and auto-update\nvia hot module refresh\u003c/p\u003e\n\u003cp\u003eHigh powered solutions like nx, turborepo, etc may have solutions for\n'automatically building all the stuff' without you explicitly having to run the\nbuild in the \u003ccode\u003elib\u003c/code\u003e directory, but for simple monorepo setups, this works ok\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"lg:w-1/2\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"How to make your own npm package with typescript\"}],[\"$\",\"h4\",null,{\"children\":\"2021-12-31\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}],[\"$\",\"$Lf\",null,{}]]}]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"How to make your own npm package with typescript\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n8:null\n"])</script></body></html>