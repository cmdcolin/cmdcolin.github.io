<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>How to make your own npm package with typescript</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/50853c3f2e0364c3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/50853c3f2e0364c3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-93aa87d657ed1852.js" defer=""></script><script src="/_next/static/chunks/framework-c0d8f0fd2eea5ac1.js" defer=""></script><script src="/_next/static/chunks/main-b12cd062888056b2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9139de5c3de3b6b.js" defer=""></script><script src="/_next/static/chunks/996-3d2a4318c0ac6f1a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-b6f09b4db8bfc341.js" defer=""></script><script src="/_next/static/q9ibxNV5809i1M1O2q-f4/_buildManifest.js" defer=""></script><script src="/_next/static/q9ibxNV5809i1M1O2q-f4/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>How to make your own npm package with typescript</h1><h4>2021-12-31</h4></div><div><p>There is a lot of mystery around making your own <code>npm</code> package. Every package
likely does it a bit differently, and it can be tricky to get a setup you like.
Should you use a "starter kit" or a boilerplate example? Or just roll your own?
Should you use a bundler? How do you use typescript?</p>
<p>**Record scratch **</p>
<p>Why don't we try starting from scratch and seeing where we can get?</p>
<p>TLDR: here is a github repo with a template package
<a href="https://github.com/cmdcolin/npm-package-tutorial/">https://github.com/cmdcolin/npm-package-tutorial/</a></p>
<h2 id="introduction"><a aria-hidden="true" tabindex="-1" href="#introduction"><a href="#introduction" style="margin-right: 10px">#</a></a>Introduction</h2>
<p>An <code>npm</code> package can be very bare bones. In some sense, npmjs.com is just an
arbitrary file host, and you can upload pretty much anything you want to it.</p>
<p>The magic is in the package.json file, which tells npm:</p>
<ul>
<li>what files are part of your package</li>
<li>what to use as the "entry point" (e.g. the file that should be referenced
when you say <code>const lib = require('mypackage')</code>)</li>
<li>what pre- and post- processing steps should be done when the package is being
published</li>
<li>and more!</li>
</ul>
<p>Let's try an experiment...</p>
<h2 id="initializing-a-package"><a aria-hidden="true" tabindex="-1" href="#initializing-a-package"><a href="#initializing-a-package" style="margin-right: 10px">#</a></a>Initializing a package</h2>
<p>Open up a terminal, and run</p>
<div class="highlight highlight-shell"><pre>mkdir mypackage
<span class="pl-c1">cd</span> mypackage
git init <span class="pl-c"># make mypackage version controlled</span>
npm init
<span class="pl-c"># or</span>
yarn init
</pre></div>
<p>This init command outputs something like this, and we accept the defaults</p>
<div class="highlight highlight-shell"><pre>This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See <span class="pl-s"><span class="pl-pds">`</span>npm <span class="pl-c1">help</span> init<span class="pl-pds">`</span></span> <span class="pl-k">for</span> definitive documentation on these fields
and exactly what they do.

Use <span class="pl-s"><span class="pl-pds">`</span>npm install <span class="pl-k">&#x3C;</span>pkg<span class="pl-k">></span><span class="pl-pds">`</span></span> afterwards to install a package and
save it as a dependency <span class="pl-k">in</span> the package.json file.

Press ^C at any <span class="pl-k">time</span> to quit.
package name: (mypackage)
version: (1.0.0)
description:
entry point: (index.js)
<span class="pl-c1">test</span> command:
git repository:
keywords:
license: (ISC)
About to write to /home/cdiesh/mypackage/package.json:

{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>mypackage<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1.0.0<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">""</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>main<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>index.js<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>scripts<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-cce">\"</span>Error: no test specified<span class="pl-cce">\"</span> &#x26;&#x26; exit 1<span class="pl-pds">"</span></span>
  },
  <span class="pl-s"><span class="pl-pds">"</span>author<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Colin<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>license<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ISC<span class="pl-pds">"</span></span>
}

</pre></div>
<p>Then, you can create a file named <code>index.js</code> (in your package.json it says
<code>"main": "index.js"</code> to refer to this file, the entrypoint)</p>
<p>In your <code>index.js</code> file, generally, you would do things like export a function
or functions. I will use commonjs exports here for maximum compatibility:</p>
<div class="highlight highlight-js"><pre><span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  <span class="pl-en">hello</span><span class="pl-k">:</span> () <span class="pl-k">=></span> {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>hello world<span class="pl-pds">'</span></span>)
  },
}
</pre></div>
<h2 id="publishing-a-package"><a aria-hidden="true" tabindex="-1" href="#publishing-a-package"><a href="#publishing-a-package" style="margin-right: 10px">#</a></a>Publishing a package</h2>
<p>This npm package, <code>mypackage</code> can now be published to <code>npm</code> with a simple
command.</p>
<div class="highlight highlight-shell"><pre>npm publish
<span class="pl-c"># or</span>
yarn publish
</pre></div>
<p>This will prompt you for your npmjs.com username, password, email, and if
needed, 2FA token (highly recommended)</p>
<h2 id="using-your-package-after-it-is-published"><a aria-hidden="true" tabindex="-1" href="#using-your-package-after-it-is-published"><a href="#using-your-package-after-it-is-published" style="margin-right: 10px">#</a></a>Using your package after it is published</h2>
<p>Once it is published, you can use it in your create-react-app app or other npm
package.</p>
<div class="highlight highlight-shell"><pre>npm install mypackage
<span class="pl-c"># or</span>
yarn add mypackage
</pre></div>
<p>Then you can use</p>
<div class="highlight highlight-js"><pre><span class="pl-k">import</span> { <span class="pl-smi">hello</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>mypackage<span class="pl-pds">'</span></span>
</pre></div>
<p>in any of your other codebases</p>
<h2 id="summary-of-the-simplest-npm-package"><a aria-hidden="true" tabindex="-1" href="#summary-of-the-simplest-npm-package"><a href="#summary-of-the-simplest-npm-package" style="margin-right: 10px">#</a></a>Summary of the simplest NPM package</h2>
<p>This all seems pretty boring thus far but it tells us a couple things</p>
<ol>
<li>packages can be very very bare bones</li>
<li>no transpiler or bundler is needed for publishing an npm package</li>
<li>our package can consist of a single file and it is uploaded to npm, and the
"main" field in package.json provides an entry point</li>
<li>the filename index.js is not special, probably it is a hangover from the
name index.html. you can use whatever name you want</li>
</ol>
<h2 id="adding-typescript"><a aria-hidden="true" tabindex="-1" href="#adding-typescript"><a href="#adding-typescript" style="margin-right: 10px">#</a></a>Adding typescript</h2>
<p>Let's try adding typescript</p>
<p>To do this, we will use the typescript compiler to compile a directory of files
in our "src" directory and output the compiled files to a directory named
"dist"</p>
<p>To start, let's add typescript</p>
<div class="highlight highlight-shell"><pre>npm install --save-dev typescript
<span class="pl-c"># or</span>
yarn add -D typescript
</pre></div>
<p>Our package.json now will have <code>typescript</code> in it's <code>devDependencies</code> (this
means that when someone installs your package, it they don't get typescript as
a dependency, it is just a dependency for while you are developing the library
locally).</p>
<p>Then we need to create a tsconfig.json for typescript to use</p>
<div class="highlight highlight-shell"><pre>yarn tsc --init
<span class="pl-c"># or</span>
npx tsc --init
</pre></div>
<p>This will generate a <code>tsconfig.json</code> file (needed by <code>typescript</code>) with a bunch of
options, but I have stripped it down in my projects to look like this</p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ent">"include"</span>: [<span class="pl-s"><span class="pl-pds">"</span>src<span class="pl-pds">"</span></span>],
  <span class="pl-ent">"compilerOptions"</span>: {
    <span class="pl-ent">"target"</span>: <span class="pl-s"><span class="pl-pds">"</span>es2018<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"moduleResolution"</span>: <span class="pl-s"><span class="pl-pds">"</span>node<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"declaration"</span>: <span class="pl-c1">true</span>, <span class="pl-ii">// generate .d.ts files</span>
    <span class="pl-ent">"sourceMap"</span>: <span class="pl-c1">true</span>, <span class="pl-ii">// generate source map</span>
    <span class="pl-ent">"outDir"</span>: <span class="pl-s"><span class="pl-pds">"</span>dist<span class="pl-pds">"</span></span>, <span class="pl-ii">// output compiled js, d.ts, and source map to dist folder</span>
    <span class="pl-ent">"strict"</span>: <span class="pl-c1">true</span>,
    <span class="pl-ent">"esModuleInterop"</span>: <span class="pl-c1">true</span>
  }
}
</pre></div>
<p>Now, we want to change our <code>js</code> to <code>ts</code> files to use <code>typescript</code>, let's change them
to use normal ESM import/exports</p>
<p>util.ts</p>
<div class="highlight highlight-ts"><pre><span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">getMessage</span>() {
  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>
}
</pre></div>
<p>index.ts</p>
<div class="highlight highlight-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">getMessage</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./util<span class="pl-pds">'</span></span>
<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">sayMessage</span>() {
  <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">getMessage</span>())
}
</pre></div>
<p>And then we will add a <code>"build"</code> script to <code>package.json</code> to compile the
library, and refer to the <code>"dist"</code> directory for the <code>"files"</code> and <code>"main"</code>
fields in <code>package.json</code></p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ent">"name"</span>: <span class="pl-s"><span class="pl-pds">"</span>mypackage<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"version"</span>: <span class="pl-s"><span class="pl-pds">"</span>1.0.0<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"description"</span>: <span class="pl-s"><span class="pl-pds">""</span></span>,
  <span class="pl-ent">"main"</span>: <span class="pl-s"><span class="pl-pds">"</span>src/index.js<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"files"</span>: [<span class="pl-s"><span class="pl-pds">"</span>dist<span class="pl-pds">"</span></span>],
  <span class="pl-ent">"scripts"</span>: {
    <span class="pl-ent">"build"</span>: <span class="pl-s"><span class="pl-pds">"</span>tsc<span class="pl-pds">"</span></span>
  },
  <span class="pl-ent">"author"</span>: <span class="pl-s"><span class="pl-pds">"</span>Colin<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"license"</span>: <span class="pl-s"><span class="pl-pds">"</span>ISC<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"devDependencies"</span>: {
    <span class="pl-ent">"typescript"</span>: <span class="pl-s"><span class="pl-pds">"</span>^4.5.4<span class="pl-pds">"</span></span>
  }
}
</pre></div>
<p>We can now run</p>
<div class="highlight highlight-shell"><pre>npm run build
<span class="pl-c"># or</span>
yarn build
</pre></div>
<p>And this will run the <code>"build"</code> script we created, which in turn, just runs
<code>tsc</code> with no arguments.</p>
<p>You can also add a <code>"prebuild"</code> script that clears out the old contents. In fact,
npm scripts generalizes the naming system -- you can make scripts with whatever name you want, e.g.</p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ent">"scripts"</span>: {
    <span class="pl-ent">"preparty"</span>: <span class="pl-s"><span class="pl-pds">"</span>echo preparty<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"party"</span>: <span class="pl-s"><span class="pl-pds">"</span>echo party<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"postparty"</span>: <span class="pl-s"><span class="pl-pds">"</span>echo postparty<span class="pl-pds">"</span></span>
  }
}
</pre></div>
<p>Then running</p>
<div class="highlight highlight-shell"><pre>$ yarn party
preparty
party
postparty
</pre></div>
<p>To make this useful, we will use <code>rimraf</code> (a node package) to make a
cross-platform removal of the <code>dist</code> directory</p>
<div class="highlight highlight-shell"><pre>npm install --save-dev rimraf
<span class="pl-c"># or</span>
yarn add -D rimraf
</pre></div>
<p>and then update your package.json</p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ii">...</span>
  <span class="pl-ent">"scripts"</span>: {
    <span class="pl-ent">"clean"</span>: <span class="pl-s"><span class="pl-pds">"</span>rimraf dist<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"prebuild"</span>: <span class="pl-s"><span class="pl-pds">"</span>npm run clean<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"build"</span>: <span class="pl-s"><span class="pl-pds">"</span>tsc<span class="pl-pds">"</span></span>
  },
  <span class="pl-ent">"devDependencies"</span>: {
    <span class="pl-ent">"rimraf"</span>: <span class="pl-s"><span class="pl-pds">"</span>^3.0.2<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"typescript"</span>: <span class="pl-s"><span class="pl-pds">"</span>^4.5.4<span class="pl-pds">"</span></span>
  }
}
</pre></div>
<p>We could make it say "rm -rf dist" instead of "rimraf dist" (e.g. run arbitrary
shell commands), but rimraf allows it to be cross-platform</p>
<h2 id="making-sure-you-create-a-fresh-build-before-you-publish"><a aria-hidden="true" tabindex="-1" href="#making-sure-you-create-a-fresh-build-before-you-publish"><a href="#making-sure-you-create-a-fresh-build-before-you-publish" style="margin-right: 10px">#</a></a>Making sure you create a fresh build before you publish</h2>
<p>Without extra instructions, your <code>yarn publish</code> command would not create a
fresh build and you could publish an older version that was lingering in the
<code>dist</code> folder.</p>
<p>We can use a <code>preversion</code> script that will automatically get invoked when you
run <code>yarn publish</code> to make sure you get a fresh build in the <code>dist</code> folder
before you publish</p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ii">...</span>
  <span class="pl-ent">"scripts"</span>: {
    <span class="pl-ii">...</span>
    <span class="pl-ent">"preversion"</span>: <span class="pl-s"><span class="pl-pds">"</span>npm run build<span class="pl-pds">"</span></span>,
  },
}
</pre></div>
<h2 id="making-sure-you-push-your-tag-to-github-after-publish"><a aria-hidden="true" tabindex="-1" href="#making-sure-you-push-your-tag-to-github-after-publish"><a href="#making-sure-you-push-your-tag-to-github-after-publish" style="margin-right: 10px">#</a></a>Making sure you push your tag to github after publish</h2>
<p>When you run <code>yarn publish</code>, npm will automatically create a commit with the
version name and a git tag, it <em>will not</em> automatically push tag to your
repository.</p>
<p>Add a <code>postversion</code> script that pushes the tag to your repo after your publish</p>
<div class="highlight highlight-json"><pre>{
  <span class="pl-ii">...</span>
  <span class="pl-ent">"scripts"</span>: {
    <span class="pl-ii">...</span>
    <span class="pl-ent">"postversion"</span>: <span class="pl-s"><span class="pl-pds">"</span>git push --follow-tags<span class="pl-pds">"</span></span>,
  },
}
</pre></div>
<h2 id="incremental-builds"><a aria-hidden="true" tabindex="-1" href="#incremental-builds"><a href="#incremental-builds" style="margin-right: 10px">#</a></a>Incremental builds</h2>
<p>We can use this to do incremental/watch builds</p>
<pre><code>npm run build --watch
# or
yarn build --watch
</code></pre>
<h2 id="adding-testing-with-ts-jest"><a aria-hidden="true" tabindex="-1" href="#adding-testing-with-ts-jest"><a href="#adding-testing-with-ts-jest" style="margin-right: 10px">#</a></a>Adding testing with ts-jest</h2>
<p>You can use ts-jest to test your code. This involves installing jest, typescript, ts-jest, @types/jest, and then initializing a jest.config.json</p>
<div class="highlight highlight-shell"><pre>npm i -D jest typescript
<span class="pl-c"># or</span>
yarn add --dev jest typescript
</pre></div>
<div class="highlight highlight-shell"><pre>npm i -D ts-jest @types/jest
<span class="pl-c"># or</span>
yarn add --dev ts-jest @types/jest
</pre></div>
<div class="highlight highlight-shell"><pre>npx ts-jest config:init
<span class="pl-c"># or</span>
yarn ts-jest config:init
</pre></div>
<p>We can then create a test</p>
<p><code>test/util.spec.ts</code></p>
<div class="highlight highlight-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">getMessage</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../src/util<span class="pl-pds">'</span></span>
<span class="pl-en">test</span>(<span class="pl-s"><span class="pl-pds">'</span>expected message returned<span class="pl-pds">'</span></span>, () <span class="pl-k">=></span> {
  <span class="pl-en">expect</span>(<span class="pl-en">getMessage</span>()).<span class="pl-en">toBe</span>(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>)
})
</pre></div>
<p>Then we can then create a script in the package.json that says <code>"test": "jest"</code>, and then we can say</p>
<pre><code>npm run test
# or
yarn test
</code></pre>
<p>You can also create an alternative system where you use <code>babel-eslint</code> and
various babel strategies to test your code, but if you are using typescript,
ts-jest+typescript works great.</p>
<h2 id="add-a-gitignore"><a aria-hidden="true" tabindex="-1" href="#add-a-gitignore"><a href="#add-a-gitignore" style="margin-right: 10px">#</a></a>Add a .gitignore</h2>
<p>Create a .gitignore with just a line that references this <code>dist</code> folder and <code>node_modules</code> folder</p>
<pre><code>dist
node_modules
</code></pre>
<h2 id="the-future-of-esm-modules"><a aria-hidden="true" tabindex="-1" href="#the-future-of-esm-modules"><a href="#the-future-of-esm-modules" style="margin-right: 10px">#</a></a>The future of ESM modules</h2>
<p>There is a shift happening where modules are changing to be pure ESM rather
than keeping commonjs equivalents</p>
<p><a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c</a></p>
<p>There are many challenges here, and will not be discussed, but it may be a
useful further reading page</p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>This tutorial shows you how you can create a basic package that you can publish
to <code>npm</code>. This little boilerplate includes these features:</p>
<ul>
<li>Makes clean build when running <code>yarn build</code> or <code>yarn publish</code></li>
<li>Pushes to github after publish</li>
<li>Uses ts-jest for testing</li>
<li>Uses esm modules</li>
</ul>
<p>You also have full control, and understand the decisions we took to get to this
point. This package does not use any bundling (rollup or webpack or otherwise).
It just uses <code>tsc</code> is used to compile the files to the <code>dist</code> folder, and the
dist folder is published to <code>npm</code>! If you need your package to be usable by
consumers that don't themselves use bundlers, consider looking into <code>&#x3C;script type="module"></code> for importing ESM modules in the browser, or you can bundle
your library using rollup or webpack and output e.g. a UMD bundle</p>
<h2 id="final-product"><a aria-hidden="true" tabindex="-1" href="#final-product"><a href="#final-product" style="margin-right: 10px">#</a></a>Final product</h2>
<p>See <a href="https://github.com/cmdcolin/npm-package-tutorial/">https://github.com/cmdcolin/npm-package-tutorial/</a></p></div><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"How to make your own npm package with typescript","date":"2021-12-31","slug":"2021-12-31-npm-package","html":"\u003cp\u003eThere is a lot of mystery around making your own \u003ccode\u003enpm\u003c/code\u003e package. Every package\nlikely does it a bit differently, and it can be tricky to get a setup you like.\nShould you use a \"starter kit\" or a boilerplate example? Or just roll your own?\nShould you use a bundler? How do you use typescript?\u003c/p\u003e\n\u003cp\u003e**Record scratch **\u003c/p\u003e\n\u003cp\u003eWhy don't we try starting from scratch and seeing where we can get?\u003c/p\u003e\n\u003cp\u003eTLDR: here is a github repo with a template package\n\u003ca href=\"https://github.com/cmdcolin/npm-package-tutorial/\"\u003ehttps://github.com/cmdcolin/npm-package-tutorial/\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#introduction\"\u003e\u003ca href=\"#introduction\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eAn \u003ccode\u003enpm\u003c/code\u003e package can be very bare bones. In some sense, npmjs.com is just an\narbitrary file host, and you can upload pretty much anything you want to it.\u003c/p\u003e\n\u003cp\u003eThe magic is in the package.json file, which tells npm:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewhat files are part of your package\u003c/li\u003e\n\u003cli\u003ewhat to use as the \"entry point\" (e.g. the file that should be referenced\nwhen you say \u003ccode\u003econst lib = require('mypackage')\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003ewhat pre- and post- processing steps should be done when the package is being\npublished\u003c/li\u003e\n\u003cli\u003eand more!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet's try an experiment...\u003c/p\u003e\n\u003ch2 id=\"initializing-a-package\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#initializing-a-package\"\u003e\u003ca href=\"#initializing-a-package\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eInitializing a package\u003c/h2\u003e\n\u003cp\u003eOpen up a terminal, and run\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003emkdir mypackage\n\u003cspan class=\"pl-c1\"\u003ecd\u003c/span\u003e mypackage\ngit init \u003cspan class=\"pl-c\"\u003e# make mypackage version controlled\u003c/span\u003e\nnpm init\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn init\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis init command outputs something like this, and we accept the defaults\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003eThis utility will walk you through creating a package.json file.\nIt only covers the most common items, and tries to guess sensible defaults.\n\nSee \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e`\u003c/span\u003enpm \u003cspan class=\"pl-c1\"\u003ehelp\u003c/span\u003e init\u003cspan class=\"pl-pds\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efor\u003c/span\u003e definitive documentation on these fields\nand exactly what they do.\n\nUse \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e`\u003c/span\u003enpm install \u003cspan class=\"pl-k\"\u003e\u0026#x3C;\u003c/span\u003epkg\u003cspan class=\"pl-k\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"pl-pds\"\u003e`\u003c/span\u003e\u003c/span\u003e afterwards to install a package and\nsave it as a dependency \u003cspan class=\"pl-k\"\u003ein\u003c/span\u003e the package.json file.\n\nPress ^C at any \u003cspan class=\"pl-k\"\u003etime\u003c/span\u003e to quit.\npackage name: (mypackage)\nversion: (1.0.0)\ndescription:\nentry point: (index.js)\n\u003cspan class=\"pl-c1\"\u003etest\u003c/span\u003e command:\ngit repository:\nkeywords:\nlicense: (ISC)\nAbout to write to /home/cdiesh/mypackage/package.json:\n\n{\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003ename\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003emypackage\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eversion\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e1.0.0\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003edescription\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003emain\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eindex.js\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003escripts\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: {\n    \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003etest\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eecho \u003cspan class=\"pl-cce\"\u003e\\\"\u003c/span\u003eError: no test specified\u003cspan class=\"pl-cce\"\u003e\\\"\u003c/span\u003e \u0026#x26;\u0026#x26; exit 1\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  },\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eauthor\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eColin\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003elicense\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eISC\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n}\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen, you can create a file named \u003ccode\u003eindex.js\u003c/code\u003e (in your package.json it says\n\u003ccode\u003e\"main\": \"index.js\"\u003c/code\u003e to refer to this file, the entrypoint)\u003c/p\u003e\n\u003cp\u003eIn your \u003ccode\u003eindex.js\u003c/code\u003e file, generally, you would do things like export a function\nor functions. I will use commonjs exports here for maximum compatibility:\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-js\"\u003e\u003cpre\u003e\u003cspan class=\"pl-c1\"\u003emodule\u003c/span\u003e.\u003cspan class=\"pl-smi\"\u003eexports\u003c/span\u003e \u003cspan class=\"pl-k\"\u003e=\u003c/span\u003e {\n  \u003cspan class=\"pl-en\"\u003ehello\u003c/span\u003e\u003cspan class=\"pl-k\"\u003e:\u003c/span\u003e () \u003cspan class=\"pl-k\"\u003e=\u003e\u003c/span\u003e {\n    \u003cspan class=\"pl-en\"\u003econsole\u003c/span\u003e.\u003cspan class=\"pl-c1\"\u003elog\u003c/span\u003e(\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003ehello world\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e)\n  },\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"publishing-a-package\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#publishing-a-package\"\u003e\u003ca href=\"#publishing-a-package\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003ePublishing a package\u003c/h2\u003e\n\u003cp\u003eThis npm package, \u003ccode\u003emypackage\u003c/code\u003e can now be published to \u003ccode\u003enpm\u003c/code\u003e with a simple\ncommand.\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm publish\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn publish\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will prompt you for your npmjs.com username, password, email, and if\nneeded, 2FA token (highly recommended)\u003c/p\u003e\n\u003ch2 id=\"using-your-package-after-it-is-published\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-your-package-after-it-is-published\"\u003e\u003ca href=\"#using-your-package-after-it-is-published\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUsing your package after it is published\u003c/h2\u003e\n\u003cp\u003eOnce it is published, you can use it in your create-react-app app or other npm\npackage.\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm install mypackage\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn add mypackage\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen you can use\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-js\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e { \u003cspan class=\"pl-smi\"\u003ehello\u003c/span\u003e } \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003emypackage\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ein any of your other codebases\u003c/p\u003e\n\u003ch2 id=\"summary-of-the-simplest-npm-package\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#summary-of-the-simplest-npm-package\"\u003e\u003ca href=\"#summary-of-the-simplest-npm-package\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eSummary of the simplest NPM package\u003c/h2\u003e\n\u003cp\u003eThis all seems pretty boring thus far but it tells us a couple things\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003epackages can be very very bare bones\u003c/li\u003e\n\u003cli\u003eno transpiler or bundler is needed for publishing an npm package\u003c/li\u003e\n\u003cli\u003eour package can consist of a single file and it is uploaded to npm, and the\n\"main\" field in package.json provides an entry point\u003c/li\u003e\n\u003cli\u003ethe filename index.js is not special, probably it is a hangover from the\nname index.html. you can use whatever name you want\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"adding-typescript\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#adding-typescript\"\u003e\u003ca href=\"#adding-typescript\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdding typescript\u003c/h2\u003e\n\u003cp\u003eLet's try adding typescript\u003c/p\u003e\n\u003cp\u003eTo do this, we will use the typescript compiler to compile a directory of files\nin our \"src\" directory and output the compiled files to a directory named\n\"dist\"\u003c/p\u003e\n\u003cp\u003eTo start, let's add typescript\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm install --save-dev typescript\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn add -D typescript\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOur package.json now will have \u003ccode\u003etypescript\u003c/code\u003e in it's \u003ccode\u003edevDependencies\u003c/code\u003e (this\nmeans that when someone installs your package, it they don't get typescript as\na dependency, it is just a dependency for while you are developing the library\nlocally).\u003c/p\u003e\n\u003cp\u003eThen we need to create a tsconfig.json for typescript to use\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003eyarn tsc --init\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nnpx tsc --init\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will generate a \u003ccode\u003etsconfig.json\u003c/code\u003e file (needed by \u003ccode\u003etypescript\u003c/code\u003e) with a bunch of\noptions, but I have stripped it down in my projects to look like this\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ent\"\u003e\"include\"\u003c/span\u003e: [\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003esrc\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e],\n  \u003cspan class=\"pl-ent\"\u003e\"compilerOptions\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"target\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003ees2018\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"moduleResolution\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003enode\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"declaration\"\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e, \u003cspan class=\"pl-ii\"\u003e// generate .d.ts files\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003e\"sourceMap\"\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e, \u003cspan class=\"pl-ii\"\u003e// generate source map\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003e\"outDir\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003edist\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"pl-ii\"\u003e// output compiled js, d.ts, and source map to dist folder\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003e\"strict\"\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"esModuleInterop\"\u003c/span\u003e: \u003cspan class=\"pl-c1\"\u003etrue\u003c/span\u003e\n  }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, we want to change our \u003ccode\u003ejs\u003c/code\u003e to \u003ccode\u003ets\u003c/code\u003e files to use \u003ccode\u003etypescript\u003c/code\u003e, let's change them\nto use normal ESM import/exports\u003c/p\u003e\n\u003cp\u003eutil.ts\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-ts\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-en\"\u003egetMessage\u003c/span\u003e() {\n  \u003cspan class=\"pl-k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003ehello\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eindex.ts\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-ts\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e { \u003cspan class=\"pl-smi\"\u003egetMessage\u003c/span\u003e } \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e./util\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"pl-k\"\u003eexport\u003c/span\u003e \u003cspan class=\"pl-k\"\u003efunction\u003c/span\u003e \u003cspan class=\"pl-en\"\u003esayMessage\u003c/span\u003e() {\n  \u003cspan class=\"pl-c1\"\u003econsole\u003c/span\u003e.\u003cspan class=\"pl-c1\"\u003elog\u003c/span\u003e(\u003cspan class=\"pl-en\"\u003egetMessage\u003c/span\u003e())\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd then we will add a \u003ccode\u003e\"build\"\u003c/code\u003e script to \u003ccode\u003epackage.json\u003c/code\u003e to compile the\nlibrary, and refer to the \u003ccode\u003e\"dist\"\u003c/code\u003e directory for the \u003ccode\u003e\"files\"\u003c/code\u003e and \u003ccode\u003e\"main\"\u003c/code\u003e\nfields in \u003ccode\u003epackage.json\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ent\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003emypackage\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"version\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e1.0.0\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"description\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"main\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003esrc/index.js\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"files\"\u003c/span\u003e: [\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003edist\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e],\n  \u003cspan class=\"pl-ent\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"build\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003etsc\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  },\n  \u003cspan class=\"pl-ent\"\u003e\"author\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eColin\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"license\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eISC\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  \u003cspan class=\"pl-ent\"\u003e\"devDependencies\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"typescript\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e^4.5.4\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can now run\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm run build\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn build\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd this will run the \u003ccode\u003e\"build\"\u003c/code\u003e script we created, which in turn, just runs\n\u003ccode\u003etsc\u003c/code\u003e with no arguments.\u003c/p\u003e\n\u003cp\u003eYou can also add a \u003ccode\u003e\"prebuild\"\u003c/code\u003e script that clears out the old contents. In fact,\nnpm scripts generalizes the naming system -- you can make scripts with whatever name you want, e.g.\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ent\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"preparty\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eecho preparty\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"party\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eecho party\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"postparty\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003eecho postparty\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen running\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003e$ yarn party\npreparty\nparty\npostparty\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo make this useful, we will use \u003ccode\u003erimraf\u003c/code\u003e (a node package) to make a\ncross-platform removal of the \u003ccode\u003edist\u003c/code\u003e directory\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm install --save-dev rimraf\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn add -D rimraf\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand then update your package.json\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ii\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"pl-ent\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"clean\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003erimraf dist\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"prebuild\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003enpm run clean\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"build\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003etsc\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  },\n  \u003cspan class=\"pl-ent\"\u003e\"devDependencies\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ent\"\u003e\"rimraf\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e^3.0.2\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n    \u003cspan class=\"pl-ent\"\u003e\"typescript\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e^4.5.4\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n  }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe could make it say \"rm -rf dist\" instead of \"rimraf dist\" (e.g. run arbitrary\nshell commands), but rimraf allows it to be cross-platform\u003c/p\u003e\n\u003ch2 id=\"making-sure-you-create-a-fresh-build-before-you-publish\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#making-sure-you-create-a-fresh-build-before-you-publish\"\u003e\u003ca href=\"#making-sure-you-create-a-fresh-build-before-you-publish\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eMaking sure you create a fresh build before you publish\u003c/h2\u003e\n\u003cp\u003eWithout extra instructions, your \u003ccode\u003eyarn publish\u003c/code\u003e command would not create a\nfresh build and you could publish an older version that was lingering in the\n\u003ccode\u003edist\u003c/code\u003e folder.\u003c/p\u003e\n\u003cp\u003eWe can use a \u003ccode\u003epreversion\u003c/code\u003e script that will automatically get invoked when you\nrun \u003ccode\u003eyarn publish\u003c/code\u003e to make sure you get a fresh build in the \u003ccode\u003edist\u003c/code\u003e folder\nbefore you publish\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ii\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"pl-ent\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ii\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003e\"preversion\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003enpm run build\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  },\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"making-sure-you-push-your-tag-to-github-after-publish\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#making-sure-you-push-your-tag-to-github-after-publish\"\u003e\u003ca href=\"#making-sure-you-push-your-tag-to-github-after-publish\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eMaking sure you push your tag to github after publish\u003c/h2\u003e\n\u003cp\u003eWhen you run \u003ccode\u003eyarn publish\u003c/code\u003e, npm will automatically create a commit with the\nversion name and a git tag, it \u003cem\u003ewill not\u003c/em\u003e automatically push tag to your\nrepository.\u003c/p\u003e\n\u003cp\u003eAdd a \u003ccode\u003epostversion\u003c/code\u003e script that pushes the tag to your repo after your publish\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-json\"\u003e\u003cpre\u003e{\n  \u003cspan class=\"pl-ii\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"pl-ent\"\u003e\"scripts\"\u003c/span\u003e: {\n    \u003cspan class=\"pl-ii\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"pl-ent\"\u003e\"postversion\"\u003c/span\u003e: \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003egit push --follow-tags\u003cspan class=\"pl-pds\"\u003e\"\u003c/span\u003e\u003c/span\u003e,\n  },\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"incremental-builds\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#incremental-builds\"\u003e\u003ca href=\"#incremental-builds\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eIncremental builds\u003c/h2\u003e\n\u003cp\u003eWe can use this to do incremental/watch builds\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003enpm run build --watch\n# or\nyarn build --watch\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"adding-testing-with-ts-jest\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#adding-testing-with-ts-jest\"\u003e\u003ca href=\"#adding-testing-with-ts-jest\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdding testing with ts-jest\u003c/h2\u003e\n\u003cp\u003eYou can use ts-jest to test your code. This involves installing jest, typescript, ts-jest, @types/jest, and then initializing a jest.config.json\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm i -D jest typescript\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn add --dev jest typescript\n\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpm i -D ts-jest @types/jest\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn add --dev ts-jest @types/jest\n\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight highlight-shell\"\u003e\u003cpre\u003enpx ts-jest config:init\n\u003cspan class=\"pl-c\"\u003e# or\u003c/span\u003e\nyarn ts-jest config:init\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can then create a test\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003etest/util.spec.ts\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight highlight-ts\"\u003e\u003cpre\u003e\u003cspan class=\"pl-k\"\u003eimport\u003c/span\u003e { \u003cspan class=\"pl-smi\"\u003egetMessage\u003c/span\u003e } \u003cspan class=\"pl-k\"\u003efrom\u003c/span\u003e \u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e../src/util\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"pl-en\"\u003etest\u003c/span\u003e(\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003eexpected message returned\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e, () \u003cspan class=\"pl-k\"\u003e=\u003e\u003c/span\u003e {\n  \u003cspan class=\"pl-en\"\u003eexpect\u003c/span\u003e(\u003cspan class=\"pl-en\"\u003egetMessage\u003c/span\u003e()).\u003cspan class=\"pl-en\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"pl-s\"\u003e\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003ehello\u003cspan class=\"pl-pds\"\u003e'\u003c/span\u003e\u003c/span\u003e)\n})\n\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen we can then create a script in the package.json that says \u003ccode\u003e\"test\": \"jest\"\u003c/code\u003e, and then we can say\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003enpm run test\n# or\nyarn test\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can also create an alternative system where you use \u003ccode\u003ebabel-eslint\u003c/code\u003e and\nvarious babel strategies to test your code, but if you are using typescript,\nts-jest+typescript works great.\u003c/p\u003e\n\u003ch2 id=\"add-a-gitignore\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-a-gitignore\"\u003e\u003ca href=\"#add-a-gitignore\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd a .gitignore\u003c/h2\u003e\n\u003cp\u003eCreate a .gitignore with just a line that references this \u003ccode\u003edist\u003c/code\u003e folder and \u003ccode\u003enode_modules\u003c/code\u003e folder\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003edist\nnode_modules\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"the-future-of-esm-modules\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-future-of-esm-modules\"\u003e\u003ca href=\"#the-future-of-esm-modules\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe future of ESM modules\u003c/h2\u003e\n\u003cp\u003eThere is a shift happening where modules are changing to be pure ESM rather\nthan keeping commonjs equivalents\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\"\u003ehttps://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThere are many challenges here, and will not be discussed, but it may be a\nuseful further reading page\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThis tutorial shows you how you can create a basic package that you can publish\nto \u003ccode\u003enpm\u003c/code\u003e. This little boilerplate includes these features:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMakes clean build when running \u003ccode\u003eyarn build\u003c/code\u003e or \u003ccode\u003eyarn publish\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ePushes to github after publish\u003c/li\u003e\n\u003cli\u003eUses ts-jest for testing\u003c/li\u003e\n\u003cli\u003eUses esm modules\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eYou also have full control, and understand the decisions we took to get to this\npoint. This package does not use any bundling (rollup or webpack or otherwise).\nIt just uses \u003ccode\u003etsc\u003c/code\u003e is used to compile the files to the \u003ccode\u003edist\u003c/code\u003e folder, and the\ndist folder is published to \u003ccode\u003enpm\u003c/code\u003e! If you need your package to be usable by\nconsumers that don't themselves use bundlers, consider looking into \u003ccode\u003e\u0026#x3C;script type=\"module\"\u003e\u003c/code\u003e for importing ESM modules in the browser, or you can bundle\nyour library using rollup or webpack and output e.g. a UMD bundle\u003c/p\u003e\n\u003ch2 id=\"final-product\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#final-product\"\u003e\u003ca href=\"#final-product\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFinal product\u003c/h2\u003e\n\u003cp\u003eSee \u003ca href=\"https://github.com/cmdcolin/npm-package-tutorial/\"\u003ehttps://github.com/cmdcolin/npm-package-tutorial/\u003c/a\u003e\u003c/p\u003e"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-12-31-npm-package"},"buildId":"q9ibxNV5809i1M1O2q-f4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>