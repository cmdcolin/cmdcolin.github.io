<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/cc26266985a3f391.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-5c625475d344240d.js"/><script src="/_next/static/chunks/4bd1b696-7bed151428114f76.js" async=""></script><script src="/_next/static/chunks/517-7148de81becf7fa5.js" async=""></script><script src="/_next/static/chunks/main-app-e726294d98178033.js" async=""></script><script src="/_next/static/chunks/173-6b587cfeb6dde470.js" async=""></script><script src="/_next/static/chunks/app/page-57a57e19ddd8ea21.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-efdb81ac98a36819.js" async=""></script><title>Making a pure-ESM package using `tsc`</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="mb-8"><a href="/">Misc scribbles</a></div><div class="lg:w-1/2 m-auto"><div><h1>Making a pure-ESM package using `tsc`</h1><h4>2025-01-12</h4></div><div><p>In the past, I have written about making NPM packages with just the typscript
compiler (<a href="https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler">https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler</a>).
There, I focused on "CJS" build because it is/was arguably simpler</p>
<p>TLDR: here is the minimal github repo for a pure ESM package using the tsc
compiler to generate the distribution files</p>
<p>Now, I am addressing the ESM case</p>
<h2 id="why-pure-esm-now"><a aria-hidden="true" tabindex="-1" href="#why-pure-esm-now"><a href="#why-pure-esm-now" style="margin-right: 10px">#</a></a>Why pure-ESM now?</h2>
<ul>
<li>As my previous article mentions, I like taking a 'bundler-less' approach to
library distribution</li>
<li>That means that multiple files might end up in the <code>dist</code> folder which
reference each other</li>
<li>Pure ESM requires these files that reference each other to import the actual
path, with the file extension</li>
</ul>
<h2 id="new-tsconfigjson-settings"><a aria-hidden="true" tabindex="-1" href="#new-tsconfigjson-settings"><a href="#new-tsconfigjson-settings" style="margin-right: 10px">#</a></a>New tsconfig.json settings</h2>
<p>The recent addition of the <code>tsc</code> settings <code>allowImportingTsExtensions</code> and
<code>rewriteRelativeImportExtensions</code> have now made it sane, or at least less
awkward now</p>
<p>These two settings make it so that if I can write two files e.g.</p>
<p>src/index.ts</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">foo</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> './bar.ts'</span></span>
<span data-line=""><span style="color:#61AFEF">foo</span><span style="color:#ABB2BF">()</span></span></code></pre></figure>
<p>src/bar.ts</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> foo</span><span style="color:#ABB2BF">() {</span></span>
<span data-line=""><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'foo in bar.ts'</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>then running tsc over these files will produce</p>
<pre><code> ❯❯❯ ll dist
total 24K
-rw-rw-r-- 1 cdiesh cdiesh  37 Jan 14 06:07 bar.d.ts
-rw-rw-r-- 1 cdiesh cdiesh  91 Jan 14 06:07 bar.js
-rw-rw-r-- 1 cdiesh cdiesh  43 Jan 14 06:07 index.d.ts
-rw-rw-r-- 1 cdiesh cdiesh 116 Jan 14 06:07 index.js

</code></pre>
<p>where dist/index.js says</p>
<pre><code>
import { foo } from "./bar.js";
export default function mypackage() {
    foo();
}
//# sourceMappingURL=index.js.map%
</code></pre>
<p>and dist/foo.js says</p>
<pre><code>
export function foo() {
    console.log("foo in bar.ts");
}
//# sourceMappingURL=bar.js.map%
</code></pre>
<h2 id="the-packagejson"><a aria-hidden="true" tabindex="-1" href="#the-packagejson"><a href="#the-packagejson" style="margin-right: 10px">#</a></a>The package.json</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "name"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"minimalpackage"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "version"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"1.0.0"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "description"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"simple pure-esm package compatible with tsc"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "license"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"MIT"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "type"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"module"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "main"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./dist/index.js"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "clean"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"rimraf dist"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "prebuild"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn clean"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "preversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn build"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "postversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"git push --follow-tags"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "rimraf"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^6.0.1"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^5.7.3"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>You can see from the above, I did not need to specify "exports" or "types". I
use rimraf to clear the dist folder before building. I can use "yarn build
--watch" for a tsc watcher</p>
<p>I can run <code>yarn publish</code> to publish to NPM, and it will automatically clean and
build, via the preversion script, and then will automatically push the version
and tag to github once done</p>
<h2 id="using-minimalpackage"><a aria-hidden="true" tabindex="-1" href="#using-minimalpackage"><a href="#using-minimalpackage" style="margin-right: 10px">#</a></a>Using minimalpackage</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="typescript" data-theme="one-dark-pro"><code data-language="typescript" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#E06C75"> thing</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> 'minimalpackage'</span></span>
<span data-line=""><span style="color:#61AFEF">thing</span><span style="color:#ABB2BF">()</span></span></code></pre></figure>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>This article proposes a bundler-less approach to distributing typescript
packages on NPM. It was possible before, but I think the addition of the
<code>allowImportingTsExtensions</code> and <code>rewriteRelativeImportExtensions</code> made it more
sane. Previously you had to use "import {thing} from './localFile.js'" even when
you were writing .ts which was awkward</p>
<h2 id="footnote-1---publishing-dual-esmcjs-using-this-technique"><a aria-hidden="true" tabindex="-1" href="#footnote-1---publishing-dual-esmcjs-using-this-technique"><a href="#footnote-1---publishing-dual-esmcjs-using-this-technique" style="margin-right: 10px">#</a></a>Footnote 1 - Publishing dual ESM/CJS using this technique</h2>
<p>If you want to publish ESM/CJS you can update your package.json to use the
"exports" field, and run the tsc compiler twice over the code, once using
--module cjs</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "name"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"dualpackage"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "version"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"1.0.0"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "description"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"demo of dual esm/cjs package"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "type"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"module"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "main"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./cjs/index.js"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "types"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./cjs/index.d.ts"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "exports"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "import"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">      "types"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./esm/index.d.ts"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">      "import"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./esm/index.js"</span></span>
<span data-line=""><span style="color:#ABB2BF">    },</span></span>
<span data-line=""><span style="color:#E06C75">    "require"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">      "types"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./cjs/index.d.ts"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">      "require"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./cjs/index.js"</span></span>
<span data-line=""><span style="color:#ABB2BF">    }</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "clean"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"rimraf cjs"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "prebuild"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn clean"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "preversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn build"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "postversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"git push --follow-tags"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build:esm"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --outDir esm"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build:cjs"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc --module commonjs --outDir cjs"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "postbuild:cjs"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"echo '{</span><span style="color:#56B6C2">\"</span><span style="color:#98C379">type</span><span style="color:#56B6C2">\"</span><span style="color:#98C379">: </span><span style="color:#56B6C2">\"</span><span style="color:#98C379">commonjs</span><span style="color:#56B6C2">\"</span><span style="color:#98C379">}' > cjs/package.json"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn build:esm &#x26;&#x26; yarn build:cjs"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "rimraf"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^6.0.1"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^5.7.3"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>Note that postbuild:cjs (which is automatically run after any invocation of
build:cjs) outputs a "one line" <strong>extra</strong> package.json to the cjs folder that
says type:cjs specifically in the cjs distribution (credit:
<a href="https://evertpot.com/universal-cjs-esm-typescript-packages/">https://evertpot.com/universal-cjs-esm-typescript-packages/</a>).</p>
<p>You can alternatively name the all the files in the cjs folder with the .cjs
file extension, which node will recognize as being commonjs and not ESM module
files, if you do not want to use the one-line-package.json-with-type:cjs trick,
but the tsc compiler does not currently have an option to output the .cjs file
extension natively</p></div><div class="mt-5"></div></div><footer class="mt-16"><a class="m-2" href="/">Home</a><a class="m-2" href="/archive">Blog archive</a><a class="m-2" href="https://github.com/cmdcolin/">Github</a><a class="m-2" href="/projects">Projects</a><a class="m-2" href="/photos">Photos</a><a class="m-2" href="/books">Books</a><a class="m-2" href="/about">About</a><a class="m-2" href="/rss.xml">RSS</a></footer><script src="/_next/static/chunks/webpack-5c625475d344240d.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"173\",\"static/chunks/173-6b587cfeb6dde470.js\",\"974\",\"static/chunks/app/page-57a57e19ddd8ea21.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n6:I[6213,[],\"OutletBoundary\"]\n8:I[6213,[],\"MetadataBoundary\"]\na:I[6213,[],\"ViewportBoundary\"]\nc:I[4835,[],\"\"]\n:HL[\"/_next/static/css/cc26266985a3f391.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"RS75djI6QShH5j-mtgfZ2\",\"p\":\"\",\"c\":[\"\",\"posts\",\"2025-01-12-pureesm\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2025-01-12-pureesm\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cc26266985a3f391.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"mt-16\",\"children\":[[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/rss.xml\",\"children\":\"RSS\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2025-01-12-pureesm\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"1v5I08sGo__7I4oEuilvY\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[7928,[\"880\",\"static/chunks/app/posts/%5Bid%5D/page-efdb81ac98a36819.js\"],\"default\"]\nd:T3be8,"])</script><script>self.__next_f.push([1,"\u003cp\u003eIn the past, I have written about making NPM packages with just the typscript\ncompiler (\u003ca href=\"https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\"\u003ehttps://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\u003c/a\u003e).\nThere, I focused on \"CJS\" build because it is/was arguably simpler\u003c/p\u003e\n\u003cp\u003eTLDR: here is the minimal github repo for a pure ESM package using the tsc\ncompiler to generate the distribution files\u003c/p\u003e\n\u003cp\u003eNow, I am addressing the ESM case\u003c/p\u003e\n\u003ch2 id=\"why-pure-esm-now\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#why-pure-esm-now\"\u003e\u003ca href=\"#why-pure-esm-now\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWhy pure-ESM now?\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eAs my previous article mentions, I like taking a 'bundler-less' approach to\nlibrary distribution\u003c/li\u003e\n\u003cli\u003eThat means that multiple files might end up in the \u003ccode\u003edist\u003c/code\u003e folder which\nreference each other\u003c/li\u003e\n\u003cli\u003ePure ESM requires these files that reference each other to import the actual\npath, with the file extension\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"new-tsconfigjson-settings\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#new-tsconfigjson-settings\"\u003e\u003ca href=\"#new-tsconfigjson-settings\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eNew tsconfig.json settings\u003c/h2\u003e\n\u003cp\u003eThe recent addition of the \u003ccode\u003etsc\u003c/code\u003e settings \u003ccode\u003eallowImportingTsExtensions\u003c/code\u003e and\n\u003ccode\u003erewriteRelativeImportExtensions\u003c/code\u003e have now made it sane, or at least less\nawkward now\u003c/p\u003e\n\u003cp\u003eThese two settings make it so that if I can write two files e.g.\u003c/p\u003e\n\u003cp\u003esrc/index.ts\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e './bar.ts'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003esrc/bar.ts\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e foo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E5C07B\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'foo in bar.ts'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003ethen running tsc over these files will produce\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e ❯❯❯ ll dist\ntotal 24K\n-rw-rw-r-- 1 cdiesh cdiesh  37 Jan 14 06:07 bar.d.ts\n-rw-rw-r-- 1 cdiesh cdiesh  91 Jan 14 06:07 bar.js\n-rw-rw-r-- 1 cdiesh cdiesh  43 Jan 14 06:07 index.d.ts\n-rw-rw-r-- 1 cdiesh cdiesh 116 Jan 14 06:07 index.js\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhere dist/index.js says\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\nimport { foo } from \"./bar.js\";\nexport default function mypackage() {\n    foo();\n}\n//# sourceMappingURL=index.js.map%\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand dist/foo.js says\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\nexport function foo() {\n    console.log(\"foo in bar.ts\");\n}\n//# sourceMappingURL=bar.js.map%\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"the-packagejson\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-packagejson\"\u003e\u003ca href=\"#the-packagejson\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe package.json\u003c/h2\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"minimalpackage\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"version\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"description\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"simple pure-esm package compatible with tsc\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"license\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"MIT\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"type\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"module\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"main\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./dist/index.js\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"rimraf dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"prebuild\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"preversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"git push --follow-tags\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"devDependencies\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"rimraf\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^6.0.1\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"typescript\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^5.7.3\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eYou can see from the above, I did not need to specify \"exports\" or \"types\". I\nuse rimraf to clear the dist folder before building. I can use \"yarn build\n--watch\" for a tsc watcher\u003c/p\u003e\n\u003cp\u003eI can run \u003ccode\u003eyarn publish\u003c/code\u003e to publish to NPM, and it will automatically clean and\nbuild, via the preversion script, and then will automatically push the version\nand tag to github once done\u003c/p\u003e\n\u003ch2 id=\"using-minimalpackage\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-minimalpackage\"\u003e\u003ca href=\"#using-minimalpackage\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUsing minimalpackage\u003c/h2\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"typescript\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"typescript\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003e thing\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e 'minimalpackage'\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#61AFEF\"\u003ething\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThis article proposes a bundler-less approach to distributing typescript\npackages on NPM. It was possible before, but I think the addition of the\n\u003ccode\u003eallowImportingTsExtensions\u003c/code\u003e and \u003ccode\u003erewriteRelativeImportExtensions\u003c/code\u003e made it more\nsane. Previously you had to use \"import {thing} from './localFile.js'\" even when\nyou were writing .ts which was awkward\u003c/p\u003e\n\u003ch2 id=\"footnote-1---publishing-dual-esmcjs-using-this-technique\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1---publishing-dual-esmcjs-using-this-technique\"\u003e\u003ca href=\"#footnote-1---publishing-dual-esmcjs-using-this-technique\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 1 - Publishing dual ESM/CJS using this technique\u003c/h2\u003e\n\u003cp\u003eIf you want to publish ESM/CJS you can update your package.json to use the\n\"exports\" field, and run the tsc compiler twice over the code, once using\n--module cjs\u003c/p\u003e\n\u003cfigure data-rehype-pretty-code-figure=\"\"\u003e\u003cpre style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\" data-language=\"json\" data-theme=\"one-dark-pro\"\u003e\u003ccode data-language=\"json\" data-theme=\"one-dark-pro\" style=\"display: grid;\"\u003e\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dualpackage\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"version\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"description\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"demo of dual esm/cjs package\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"type\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"module\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"main\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./cjs/index.js\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"types\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./cjs/index.d.ts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"exports\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"import\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e      \"types\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./esm/index.d.ts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e      \"import\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./esm/index.js\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e    },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"require\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e      \"types\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./cjs/index.d.ts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e      \"require\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./cjs/index.js\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e \u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"rimraf cjs\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"prebuild\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"preversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"git push --follow-tags\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build:esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --outDir esm\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build:cjs\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc --module commonjs --outDir cjs\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postbuild:cjs\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"echo '{\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003ecommonjs\u003c/span\u003e\u003cspan style=\"color:#56B6C2\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e}' \u003e cjs/package.json\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn build:esm \u0026#x26;\u0026#x26; yarn build:cjs\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"devDependencies\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"rimraf\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^6.0.1\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"typescript\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^5.7.3\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan data-line=\"\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/figure\u003e\n\u003cp\u003eNote that postbuild:cjs (which is automatically run after any invocation of\nbuild:cjs) outputs a \"one line\" \u003cstrong\u003eextra\u003c/strong\u003e package.json to the cjs folder that\nsays type:cjs specifically in the cjs distribution (credit:\n\u003ca href=\"https://evertpot.com/universal-cjs-esm-typescript-packages/\"\u003ehttps://evertpot.com/universal-cjs-esm-typescript-packages/\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eYou can alternatively name the all the files in the cjs folder with the .cjs\nfile extension, which node will recognize as being commonjs and not ESM module\nfiles, if you do not want to use the one-line-package.json-with-type:cjs trick,\nbut the tsc compiler does not currently have an option to output the .cjs file\nextension natively\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"lg:w-1/2 m-auto\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Making a pure-ESM package using `tsc`\"}],[\"$\",\"h4\",null,{\"children\":\"2025-01-12\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}],[\"$\",\"$Le\",null,{}]]}]\n9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Making a pure-ESM package using `tsc`\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n7:null\n"])</script></body></html>