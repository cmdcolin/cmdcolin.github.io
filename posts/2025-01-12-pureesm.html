<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/53ac0649e8acd1de.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-5c625475d344240d.js"/><script src="/_next/static/chunks/4bd1b696-7bed151428114f76.js" async=""></script><script src="/_next/static/chunks/517-b7d557e68f3808c7.js" async=""></script><script src="/_next/static/chunks/main-app-bba03a714545c59d.js" async=""></script><script src="/_next/static/chunks/173-c4204d8a61969f1d.js" async=""></script><script src="/_next/static/chunks/app/page-587629221be7b0d2.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-cc4771b5e3a551f2.js" async=""></script><title>Making a pure-ESM package using `tsc`</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="mb-8"><a href="/">Misc scribbles</a></div><div class="lg:w-1/2 m-auto"><div><h1>Making a pure-ESM package using `tsc`</h1><h4>2025-01-12</h4></div><div><p>In the past, I have written about making NPM packages with just the typescript
compiler (<a href="https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler">https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler</a>).
There, I focused on "CJS" build because it was arguably simpler</p>
<p>Now, I am addressing the "ESM" case</p>
<p>TLDR: here is the minimal github repo for this post
<a href="https://github.com/cmdcolin/minimal_pureesm_package/">https://github.com/cmdcolin/minimal_pureesm_package/</a></p>
<h2 id="why-pure-esm-now"><a aria-hidden="true" tabindex="-1" href="#why-pure-esm-now"><a href="#why-pure-esm-now" style="margin-right: 10px">#</a></a>Why pure-ESM now?</h2>
<p>As my previous article mentions, I like taking a 'bundler-less' approach to
library distribution. That means that multiple files might end up in the <code>dist</code>
folder which reference each other. However, using "pure ESM" requires these
files that reference each other to import the actual path, with the file
extensions</p>
<p>Which was awkward before...but now</p>
<h2 id="we-have-some-new-tsconfigjson-settings-to-help"><a aria-hidden="true" tabindex="-1" href="#we-have-some-new-tsconfigjson-settings-to-help"><a href="#we-have-some-new-tsconfigjson-settings-to-help" style="margin-right: 10px">#</a></a>We have some new tsconfig.json settings to help</h2>
<p>The recent addition of the <code>tsc</code> settings
<a href="https://www.typescriptlang.org/tsconfig/allowImportingTsExtensions.html"><code>allowImportingTsExtensions</code></a>
and
<a href="https://devblogs.microsoft.com/typescript/announcing-typescript-5-7/#path-rewriting-for-relative-paths"><code>rewriteRelativeImportExtensions</code></a>
have now allow us to import from the .ts file extension in the src folder, and
it automatically rewrites to use the .js file extension in the dist folder</p>
<p>For example we can have</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic">// src/index.ts</span></span>
<span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">foo</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> './bar.ts'</span></span>
<span class="line"><span style="color:#61AFEF">foo</span><span style="color:#ABB2BF">()</span></span></code></pre>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic">// src/bar.ts</span></span>
<span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> foo</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'foo in bar.ts'</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>
<p>then running tsc over these files will produce</p>
<pre><code> ❯❯❯ ll dist
total 24K
-rw-rw-r-- 1 cdiesh cdiesh  37 Jan 14 06:07 bar.d.ts
-rw-rw-r-- 1 cdiesh cdiesh  91 Jan 14 06:07 bar.js
-rw-rw-r-- 1 cdiesh cdiesh  43 Jan 14 06:07 index.d.ts
-rw-rw-r-- 1 cdiesh cdiesh 116 Jan 14 06:07 index.js

</code></pre>
<p>where dist/index.js now contains an import with the .js extension</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">foo</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> './bar.js'</span></span>
<span class="line"><span style="color:#61AFEF">foo</span><span style="color:#ABB2BF">()</span></span></code></pre>
<p>and dist/bar.js says</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">export</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> foo</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#E5C07B">  console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'foo in bar.ts'</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>
<p>Previously you had to write <code>import {foo} from './bar.js'</code> in the src folder to
have this behavior, but now you can reference the actual file, bar.ts</p>
<h2 id="the-packagejson"><a aria-hidden="true" tabindex="-1" href="#the-packagejson"><a href="#the-packagejson" style="margin-right: 10px">#</a></a>The package.json</h2>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">  "name"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"minimalpackage"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "version"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"1.0.0"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "description"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"simple pure-esm package compatible with tsc"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "license"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"MIT"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "type"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"module"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "exports"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"./dist/index.js"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "clean"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"rimraf dist"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "prebuild"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn clean"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "preversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn build"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "postversion"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"git push --follow-tags"</span></span>
<span class="line"><span style="color:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">    "rimraf"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^6.0.1"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^5.7.3"</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>
<p>You can see from the above, I did not need to specify "exports" or "types". I
also don't even specify "main" (or "module", which is non-standard), just
"exports"</p>
<p>Lots of usages of exports have a complex object but it can simply point to a
file</p>
<p>Other random things you can observe</p>
<ul>
<li>
<p>I use rimraf to clear the dist folder before building. I can use "yarn build
--watch" for a tsc watcher</p>
</li>
<li>
<p>You can run <code>yarn publish</code> to publish to NPM, and it will automatically run
the clean and build via the preversion script, and then will automatically
push the updated version and tag to github once it is finished via the
postversion script</p>
</li>
</ul>
<h2 id="the-tsconfigjson"><a aria-hidden="true" tabindex="-1" href="#the-tsconfigjson"><a href="#the-tsconfigjson" style="margin-right: 10px">#</a></a>The tsconfig.json</h2>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75">  "include"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"src"</span><span style="color:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75">  "compilerOptions"</span><span style="color:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75">    "outDir"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"dist"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "target"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"es2020"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "declaration"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "strict"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "allowImportingTsExtensions"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">    "rewriteRelativeImportExtensions"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>
<h2 id="using-minimalpackage"><a aria-hidden="true" tabindex="-1" href="#using-minimalpackage"><a href="#using-minimalpackage" style="margin-right: 10px">#</a></a>Using minimalpackage</h2>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">import</span><span style="color:#E06C75"> thing</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> 'minimalpackage'</span></span>
<span class="line"><span style="color:#61AFEF">thing</span><span style="color:#ABB2BF">()</span></span></code></pre>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>This article proposes a bundler-less approach to distributing typescript
packages on NPM. It was possible before, but I think the addition of the
<code>allowImportingTsExtensions</code> and <code>rewriteRelativeImportExtensions</code> made it more
sane. Previously you had to use "import {thing} from './localFile.js'" even when
you were writing .ts which was awkward</p>
<h2 id="footnote-1---publishing-dual-esmcjs-using-this-technique"><a aria-hidden="true" tabindex="-1" href="#footnote-1---publishing-dual-esmcjs-using-this-technique"><a href="#footnote-1---publishing-dual-esmcjs-using-this-technique" style="margin-right: 10px">#</a></a>Footnote 1 - Publishing dual ESM/CJS using this technique</h2>
<p>I don't even know if I fully stand behind doing a dual publish this way, but for
reference, here is a potential way to dual ESM/CJS publish with this method
<a href="https://gist.github.com/cmdcolin/c3089a4b37f2ff8c8eabce5ebd3b4082">https://gist.github.com/cmdcolin/c3089a4b37f2ff8c8eabce5ebd3b4082</a></p></div><div class="mt-5"></div></div><footer class="mt-16"><a class="m-2" href="/">Home</a><a class="m-2" href="/archive">Blog archive</a><a class="m-2" href="https://github.com/cmdcolin/">Github</a><a class="m-2" href="/projects">Projects</a><a class="m-2" href="/photos">Photos</a><a class="m-2" href="/books">Books</a><a class="m-2" href="/about">About</a><a class="m-2" href="/rss.xml">RSS</a></footer><script src="/_next/static/chunks/webpack-5c625475d344240d.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"173\",\"static/chunks/173-c4204d8a61969f1d.js\",\"974\",\"static/chunks/app/page-587629221be7b0d2.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n6:I[6213,[],\"OutletBoundary\"]\n8:I[6213,[],\"MetadataBoundary\"]\na:I[6213,[],\"ViewportBoundary\"]\nc:I[4835,[],\"\"]\n:HL[\"/_next/static/css/53ac0649e8acd1de.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"M2yIPI-FI3CTAHFMfu9Ji\",\"p\":\"\",\"c\":[\"\",\"posts\",\"2025-01-12-pureesm\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2025-01-12-pureesm\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/53ac0649e8acd1de.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"mt-16\",\"children\":[[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/rss.xml\",\"children\":\"RSS\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2025-01-12-pureesm\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"5Krr2fzOh6iEVCEEbqJeS\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[7928,[\"880\",\"static/chunks/app/posts/%5Bid%5D/page-cc4771b5e3a551f2.js\"],\"default\"]\nd:T3109,"])</script><script>self.__next_f.push([1,"\u003cp\u003eIn the past, I have written about making NPM packages with just the typescript\ncompiler (\u003ca href=\"https://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\"\u003ehttps://cmdcolin.github.io/posts/2022-05-27-youmaynotneedabundler\u003c/a\u003e).\nThere, I focused on \"CJS\" build because it was arguably simpler\u003c/p\u003e\n\u003cp\u003eNow, I am addressing the \"ESM\" case\u003c/p\u003e\n\u003cp\u003eTLDR: here is the minimal github repo for this post\n\u003ca href=\"https://github.com/cmdcolin/minimal_pureesm_package/\"\u003ehttps://github.com/cmdcolin/minimal_pureesm_package/\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"why-pure-esm-now\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#why-pure-esm-now\"\u003e\u003ca href=\"#why-pure-esm-now\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWhy pure-ESM now?\u003c/h2\u003e\n\u003cp\u003eAs my previous article mentions, I like taking a 'bundler-less' approach to\nlibrary distribution. That means that multiple files might end up in the \u003ccode\u003edist\u003c/code\u003e\nfolder which reference each other. However, using \"pure ESM\" requires these\nfiles that reference each other to import the actual path, with the file\nextensions\u003c/p\u003e\n\u003cp\u003eWhich was awkward before...but now\u003c/p\u003e\n\u003ch2 id=\"we-have-some-new-tsconfigjson-settings-to-help\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#we-have-some-new-tsconfigjson-settings-to-help\"\u003e\u003ca href=\"#we-have-some-new-tsconfigjson-settings-to-help\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eWe have some new tsconfig.json settings to help\u003c/h2\u003e\n\u003cp\u003eThe recent addition of the \u003ccode\u003etsc\u003c/code\u003e settings\n\u003ca href=\"https://www.typescriptlang.org/tsconfig/allowImportingTsExtensions.html\"\u003e\u003ccode\u003eallowImportingTsExtensions\u003c/code\u003e\u003c/a\u003e\nand\n\u003ca href=\"https://devblogs.microsoft.com/typescript/announcing-typescript-5-7/#path-rewriting-for-relative-paths\"\u003e\u003ccode\u003erewriteRelativeImportExtensions\u003c/code\u003e\u003c/a\u003e\nhave now allow us to import from the .ts file extension in the src folder, and\nit automatically rewrites to use the .js file extension in the dist folder\u003c/p\u003e\n\u003cp\u003eFor example we can have\u003c/p\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// src/index.ts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e './bar.ts'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#61AFEF\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#7F848E;font-style:italic\"\u003e// src/bar.ts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C678DD\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e foo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C07B\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'foo in bar.ts'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethen running tsc over these files will produce\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e ❯❯❯ ll dist\ntotal 24K\n-rw-rw-r-- 1 cdiesh cdiesh  37 Jan 14 06:07 bar.d.ts\n-rw-rw-r-- 1 cdiesh cdiesh  91 Jan 14 06:07 bar.js\n-rw-rw-r-- 1 cdiesh cdiesh  43 Jan 14 06:07 index.d.ts\n-rw-rw-r-- 1 cdiesh cdiesh 116 Jan 14 06:07 index.js\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhere dist/index.js now contains an import with the .js extension\u003c/p\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e } \u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e './bar.js'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#61AFEF\"\u003efoo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand dist/bar.js says\u003c/p\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C678DD\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003e foo\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E5C07B\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#61AFEF\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e'foo in bar.ts'\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePreviously you had to write \u003ccode\u003eimport {foo} from './bar.js'\u003c/code\u003e in the src folder to\nhave this behavior, but now you can reference the actual file, bar.ts\u003c/p\u003e\n\u003ch2 id=\"the-packagejson\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-packagejson\"\u003e\u003ca href=\"#the-packagejson\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe package.json\u003c/h2\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"name\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"minimalpackage\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"version\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"1.0.0\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"description\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"simple pure-esm package compatible with tsc\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"license\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"MIT\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"type\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"module\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"exports\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"./dist/index.js\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"scripts\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"tsc\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"rimraf dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"prebuild\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn clean\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"preversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"yarn build\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"postversion\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"git push --follow-tags\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"devDependencies\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"rimraf\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^6.0.1\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"typescript\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"^5.7.3\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can see from the above, I did not need to specify \"exports\" or \"types\". I\nalso don't even specify \"main\" (or \"module\", which is non-standard), just\n\"exports\"\u003c/p\u003e\n\u003cp\u003eLots of usages of exports have a complex object but it can simply point to a\nfile\u003c/p\u003e\n\u003cp\u003eOther random things you can observe\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eI use rimraf to clear the dist folder before building. I can use \"yarn build\n--watch\" for a tsc watcher\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou can run \u003ccode\u003eyarn publish\u003c/code\u003e to publish to NPM, and it will automatically run\nthe clean and build via the preversion script, and then will automatically\npush the updated version and tag to github once it is finished via the\npostversion script\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"the-tsconfigjson\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-tsconfigjson\"\u003e\u003ca href=\"#the-tsconfigjson\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eThe tsconfig.json\u003c/h2\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"include\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: [\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"src\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e  \"compilerOptions\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"outDir\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"dist\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"target\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e\"es2020\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"declaration\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"strict\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"allowImportingTsExtensions\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#E06C75\"\u003e    \"rewriteRelativeImportExtensions\"\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#D19A66\"\u003etrue\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ABB2BF\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"using-minimalpackage\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#using-minimalpackage\"\u003e\u003ca href=\"#using-minimalpackage\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eUsing minimalpackage\u003c/h2\u003e\n\u003cpre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C678DD\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#E06C75\"\u003e thing\u003c/span\u003e\u003cspan style=\"color:#C678DD\"\u003e from\u003c/span\u003e\u003cspan style=\"color:#98C379\"\u003e 'minimalpackage'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#61AFEF\"\u003ething\u003c/span\u003e\u003cspan style=\"color:#ABB2BF\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eThis article proposes a bundler-less approach to distributing typescript\npackages on NPM. It was possible before, but I think the addition of the\n\u003ccode\u003eallowImportingTsExtensions\u003c/code\u003e and \u003ccode\u003erewriteRelativeImportExtensions\u003c/code\u003e made it more\nsane. Previously you had to use \"import {thing} from './localFile.js'\" even when\nyou were writing .ts which was awkward\u003c/p\u003e\n\u003ch2 id=\"footnote-1---publishing-dual-esmcjs-using-this-technique\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1---publishing-dual-esmcjs-using-this-technique\"\u003e\u003ca href=\"#footnote-1---publishing-dual-esmcjs-using-this-technique\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 1 - Publishing dual ESM/CJS using this technique\u003c/h2\u003e\n\u003cp\u003eI don't even know if I fully stand behind doing a dual publish this way, but for\nreference, here is a potential way to dual ESM/CJS publish with this method\n\u003ca href=\"https://gist.github.com/cmdcolin/c3089a4b37f2ff8c8eabce5ebd3b4082\"\u003ehttps://gist.github.com/cmdcolin/c3089a4b37f2ff8c8eabce5ebd3b4082\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"lg:w-1/2 m-auto\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Making a pure-ESM package using `tsc`\"}],[\"$\",\"h4\",null,{\"children\":\"2025-01-12\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}],[\"$\",\"$Le\",null,{}]]}]\n9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Making a pure-ESM package using `tsc`\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n7:null\n"])</script></body></html>