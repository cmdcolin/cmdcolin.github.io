<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Astro description"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Beware! If you make custom React hooks, eslint-plugin-react-hooks may not catch some issues</title><style>.container[data-astro-cid-4oxc2zqz]{max-width:800px;margin:0 auto;padding:0 1rem}article[data-astro-cid-lvjzyg5v]{max-width:100%}.post-content[data-astro-cid-lvjzyg5v]{margin:2rem 0;line-height:1.6}
.footer-style[data-astro-cid-k2f5zb5c]{margin-top:4rem}.footer-link[data-astro-cid-k2f5zb5c]{margin:.5rem}body{font-family:Helvetica,Arial,sans-serif;background-color:Canvas;color:CanvasText;color-scheme:light dark;overflow-wrap:break-word}img{max-width:100%}pre{max-width:100%;overflow:auto}li+li{margin-top:10px}pre{padding:10px;border-radius:5px}
</style></head> <body> <div class="mb-8"> <a href="/">Misc scribbles</a> </div>  <div class="container" data-astro-cid-4oxc2zqz>  <article data-astro-cid-lvjzyg5v> <div data-astro-cid-lvjzyg5v> <h1 data-astro-cid-lvjzyg5v>Beware! If you make custom React hooks, eslint-plugin-react-hooks may not catch some issues</h1> <h4 data-astro-cid-lvjzyg5v>2025-12-27</h4> </div> <div class="post-content" data-astro-cid-lvjzyg5v> <p>I am reporting to you live from the debugging session…A useEffect in my
codebase has triggered in an infinite loop in my code. But this doesn’t just
cause trouble for me…</p>
<h2 id="a-problem-for-everybody">A problem for everybody</h2>
<p>This type of issue is something probably everyone has seen. Even CloudFlare saw
this bug in Sept 2025, and it caused some big troubles</p>
<blockquote>
<p>The incident’s impact stemmed from several issues, but the immediate trigger
was a bug in the dashboard. This bug caused repeated, unnecessary calls to the
Tenant Service API. The API calls were managed by a React useEffect hook, but
we mistakenly included a problematic object in its dependency array. Because
this object was recreated on every state or prop change, React treated it as
“always new,” causing the useEffect to re-run each time. As a result, the API
call executed many times during a single dashboard render instead of just
once. This behavior coincided with a service update to the Tenant Service API,
compounding instability and ultimately overwhelming the service, which then
failed to recover.</p>
<p>Source:
<a href="https://blog.cloudflare.com/deep-dive-into-cloudflares-sept-12-dashboard-and-api-outage/">https://blog.cloudflare.com/deep-dive-into-cloudflares-sept-12-dashboard-and-api-outage/</a></p>
</blockquote>
<p>Maybe interestingly, their “takeaways” going forward did not include more static
analysis of React to identify issues like this. Their takeaways were to try to
narrow the blast radius of things like this by “Reducing impact” and “Improving
visibility”. That is fine, every postmortem has a complex set of conditions that
leads to failure, but could this issue have been caught at compile time? (the
best time!)</p>
<h2 id="i-have-eslint-plugin-react-hooks-its-supposed-to-warn-about-this-why-is-this-happening">I have eslint-plugin-react-hooks, it’s supposed to warn about this, why is this happening???</h2>
<p>The critical reader may slap their forehead and say…you may not NEED a
useEffect! don’t you know? <code>&#x3C;link to react docs here></code></p>
<p>Sometimes you just do though. Ok moving on</p>
<p>Lets see what eslint-plugin-react-hooks can help catch</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#B392F0">useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {}, [</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Number</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">94</span><span style="color:#E1E4E8">)])</span></span></code></pre>
<p>This produces</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>  warning  React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked  react-hooks/exhaustive-deps</span></span>
<span class="line"><span></span></span></code></pre>
<p>What about</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> num</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Number</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">94</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {}, [num])</span></span></code></pre>
<p>This says</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>  warning  The 'num' object construction makes the dependencies of useEffect Hook (at line 11) change on every render. Move it inside the useEffect callback. Alternatively, wrap the initialization of 'num' in its own useMemo() Hook  react-hooks/exhaustive-deps</span></span></code></pre>
<p>But what about…</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { useEffect, useState } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'react'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> useMyHook</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">myVariable</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> number</span><span style="color:#E1E4E8">[]) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">result</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setResult</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">  useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'look mom custom hook'</span><span style="color:#E1E4E8">, myVariable)</span></span>
<span class="line"><span style="color:#E1E4E8">    ;(</span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      setResult</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">result</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    })()</span></span>
<span class="line"><span style="color:#E1E4E8">  }, [myVariable])</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> result</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> App</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> ret</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#B392F0">  useMyHook</span><span style="color:#E1E4E8">(ret)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#B392F0">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      Hello{</span><span style="color:#9ECBFF">' '</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span><span style="color:#FFAB70">ret</span><span style="color:#E1E4E8">.</span><span style="color:#FFAB70">map</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">r</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#F97583">        &#x3C;</span><span style="color:#E1E4E8">div key</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{r}</span><span style="color:#F97583">></span><span style="color:#E1E4E8">{r}</span><span style="color:#F97583">&#x3C;/</span><span style="color:#E1E4E8">div</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#E1E4E8">      ))}</span></span>
<span class="line"><span style="color:#F97583">    &#x3C;/</span><span style="color:#E1E4E8">h1</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#E1E4E8">  )</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> App</span></span>
<span class="line"><span style="color:#9ECBFF">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">This, as the console.log suggests, is an infinite loop, and we are not informed</span></span>
<span class="line"><span style="color:#9ECBFF">by the lint rule because we have extracted it to a different file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">### A thought to leave you with</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">Things like typescript eliminate huge classes of bugs via static analysis, and</span></span>
<span class="line"><span style="color:#9ECBFF">typescript-eslint is able to push it even further by adding typed lints, but</span></span>
<span class="line"><span style="color:#9ECBFF">what about this class of bugs. It appears to only be able to be detected via</span></span>
<span class="line"><span style="color:#9ECBFF">heuristics. I was already a bit wary of using custom hooks in my code and this</span></span>
<span class="line"><span style="color:#9ECBFF">will make me think twice or three more times about it, since the heuristic,</span></span>
<span class="line"><span style="color:#9ECBFF">while imperfect, can help. There are of course also other reasons this failure</span></span>
<span class="line"><span style="color:#9ECBFF">case could be triggered... a prop being used probably breaks the heuristic also.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">Are there other ways we can catch or fix this issue? Feel free to let me know</span></span></code></pre> </div> <div id="giscus"></div> <script>
  const script = document.createElement('script');
  script.src = 'https://giscus.app/client.js';
  script.setAttribute('data-repo', 'cmdcolin/cmdcolin.github.io');
  script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNjE0OTY3Nw==');
  script.setAttribute('data-category', 'General');
  script.setAttribute('data-category-id', 'DIC_kwDOAY8DLc4CO-L9');
  script.setAttribute('data-mapping', 'pathname');
  script.setAttribute('data-strict', '0');
  script.setAttribute('data-reactions-enabled', '1');
  script.setAttribute('data-emit-metadata', '0');
  script.setAttribute('data-input-position', 'bottom');
  script.setAttribute('data-theme', 'light');
  script.setAttribute('data-lang', 'en');
  script.setAttribute('crossorigin', 'anonymous');
  script.async = true;
  document.getElementById('giscus').appendChild(script);
</script> </article>  </div>   <footer class="footer-style" data-astro-cid-k2f5zb5c> <a class="footer-link" href="/" data-astro-cid-k2f5zb5c>Home</a> <a class="footer-link" href="/archive" data-astro-cid-k2f5zb5c>Blog archive</a> <a class="footer-link" href="https://github.com/cmdcolin/" data-astro-cid-k2f5zb5c>Github</a> <a class="footer-link" href="/projects" data-astro-cid-k2f5zb5c>Projects</a> <a class="footer-link" href="/about" data-astro-cid-k2f5zb5c>About</a> </footer> </body></html> 