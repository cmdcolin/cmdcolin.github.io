<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/97dc5fe527f5d592.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-40edba06f6f71edb.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-2b15443312687f8a.js" async=""></script><script src="/_next/static/chunks/596-adeabdb313a347d9.js" async=""></script><script src="/_next/static/chunks/main-app-326dcaa46b1410fc.js" async=""></script><title>Jest parallelization, globals, mocks, and squawkless tests</title><meta name="description" content="A blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="128x128"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Jest parallelization, globals, mocks, and squawkless tests</h1><h4>2021-10-05</h4></div><div><p>I found that there is a little bit of confusion and misunderstanding around how
things like parallelization work in jest, which sometimes leads to additional
hacking around problems that may not exist or speculating incorrectly about test
failure. This is also of course a point of concern when you have code that for
some reason or another uses global variables. Here are a short summary of things
that may cause confusion.</p>
<h2 id="tests-in-a-single-file-are-not-run-in-parallel"><a aria-hidden="true" tabindex="-1" href="#tests-in-a-single-file-are-not-run-in-parallel"><a href="#tests-in-a-single-file-are-not-run-in-parallel" style="margin-right: 10px">#</a></a>Tests in a single file are NOT run in parallel</h2>
<p>Simple example, the global variable r is included in the test condition, but it
is accurately run in all cases because the tests are not run in parallel.</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">let</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">r</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">ms</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">setTimeout</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">ms</span><span style="color: #A6ACCD">))</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">describe</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">tests</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">it</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">t1</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1000</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">r</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toBe</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">r</span><span style="color: #91B4D5">++</span></span>
<span class="line"><span style="color: #A6ACCD">  })</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">it</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">t2</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1000</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">r</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toBe</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">r</span><span style="color: #91B4D5">++</span></span>
<span class="line"><span style="color: #A6ACCD">  })</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">it</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">t3</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1000</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">r</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toBe</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">2</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">r</span><span style="color: #91B4D5">++</span></span>
<span class="line"><span style="color: #A6ACCD">  })</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span></code></pre>
<p>This test will take 3 seconds, and will accurately count the global variable. If
it was in parallel, it may only take 1 second, and would inaccurately count the
global variable due to race conditions</p>
<h2 id="tests-in-different-files-are-run-in-parallel"><a aria-hidden="true" tabindex="-1" href="#tests-in-different-files-are-run-in-parallel"><a href="#tests-in-different-files-are-run-in-parallel" style="margin-right: 10px">#</a></a>Tests in different files ARE run in parallel</h2>
<p>Let's take another example where we use a global variable, and then two
different tests use the global variable.</p>
<p>file_using_some_globals.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">let</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">myGlobal</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">doStuff</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">myGlobal</span><span style="color: #91B4D5">++</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">myGlobal</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">resetMyGlobal</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">myGlobal</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">0</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">ms</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">setTimeout</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">resolve</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">ms</span><span style="color: #A6ACCD">))</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>test_global_vars1.test.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">doStuff</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">timeout</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">./dostuff</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">file1</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">doStuff</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1000</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FBD0">doStuff</span><span style="color: #A6ACCD">()).</span><span style="color: #E4F0FBD0">toEqual</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">2</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span></code></pre>
<p>test_global_vars2.test.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">doStuff</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">timeout</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">./dostuff</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">file1</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">timeout</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1000</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FBD0">doStuff</span><span style="color: #A6ACCD">()).</span><span style="color: #E4F0FBD0">toEqual</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">1</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span></code></pre>
<p>This test completes in less than 2 seconds, and these tests are run in parallel.
They use different instances of the global state, and therefore have no worries
with colliding their state.</p>
<h2 id="does-a-mock-from-one-test-affect-another-test"><a aria-hidden="true" tabindex="-1" href="#does-a-mock-from-one-test-affect-another-test"><a href="#does-a-mock-from-one-test-affect-another-test" style="margin-right: 10px">#</a></a>Does a mock from one test affect another test?</h2>
<p>While seeking the fabled "squawk-less" test, it is often useful to mock console
so that tests that produce an expected error don't actually print an error
message. However, if not done carefully, you will remove errors across tests</p>
<p>So, could a mock from one test affect another test? If it's in the same file,
yes!</p>
<p>mock_console.test.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">test1</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">jest</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">fn</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">wow</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toHaveBeenCalled</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">test2</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// this console.error will not appear because test1 mocked away console.error</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">// without restoring it</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">Help I can't see!</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span></code></pre>
<p>To properly mock these, you should restore the console mock at the end of your
function</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">test1</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">orig</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">jest</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">fn</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">I should not see this!</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FBD0">expect</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">toHaveBeenCalled</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">orig</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">test2</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">consoleMock</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">jest</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">spyOn</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">error</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">mockImplementation</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">I should not see this!</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">consoleMock</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">mockRestore</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">test</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">test3</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">console</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">I should see this error!</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">})</span></span></code></pre>
<h2 id="add-on-achieve-squawkless-tests"><a aria-hidden="true" tabindex="-1" href="#add-on-achieve-squawkless-tests"><a href="#add-on-achieve-squawkless-tests" style="margin-right: 10px">#</a></a>Add-on: Achieve squawkless tests!</h2>
<p>Your test output should just be a big list of PASS statements, not interleaved
with console.error outputs from when you are testing error conditions of your
code</p>
<p>"Squawkless tests" is a term I made up, but it means that if you have code under
test that prints some errors to the console, then mock the console.error
function, as in the previous section. Don't stand for having a bunch of verbose
errors in your CI logs! However, I also suggest only mocking out console.error
for tests that are <strong>expected</strong> to have errors, lest you paper over unexpected
errors.</p>
<p><img src="/media/squawkless_tests.png" alt=""></p>
<p>Figure: a nice clean test suite without a bunch of crazy console.error outputs</p>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>Getting better at testing requires exercise, and understanding the basics of
your tools can help! Hopefully this helps you achieve a better understanding and
write cleaner jest tests.</p></div><div style="margin-top:200px"></div></article><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/about">About</a></footer><script src="/_next/static/chunks/webpack-40edba06f6f71edb.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/97dc5fe527f5d592.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n5:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-3ae734227e2e8975.js\",\"185:static/chunks/app/layout-3759995e3b279a75.js\"],\"na"])</script><script>self.__next_f.push([1,"me\":\"\",\"async\":false}\n7:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-40edba06f6f71edb.js\",\"971:static/chunks/fd9d1056-2b15443312687f8a.js\",\"596:static/chunks/596-adeabdb313a347d9.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/97dc5fe527f5d592.css\",\"precedence\":\"next\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"el_51bU2PTC0UEFsQCQDY\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2021-10-05-jest\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2021-10-05-jest\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2021-10-05-jest\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"style\":{\"marginBottom\":100},\"children\":[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"id\",\"2021-10-05-jest\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L9\",\"$La\",null],\"segment\":\"__PAGE__?{\\\"id\\\":\\\"2021-10-05-jest\\\"}\"},\"styles\":[]}],\"segment\":[\"id\",\"2021-10-05-jest\",\"d\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}],[\"$\",\"footer\",null,{\"style\":{\"marginTop\":100},\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Home\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/archive\",\"children\":\"Blog archive\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"https://twitter.com/cmdcolin\",\"children\":\"Twitter\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/photos\",\"children\":\"Photos\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"c:I{\"id\":6306,\"chunks\":[\"722:static/chunks/app/posts/[id]/page-8cf76b3c924a344e.js\"],\"name\":\"\",\"async\":false}\nb:T5ff6,"])</script><script>self.__next_f.push([1,"\u003cp\u003eI found that there is a little bit of confusion and misunderstanding around how\nthings like parallelization work in jest, which sometimes leads to additional\nhacking around problems that may not exist or speculating incorrectly about test\nfailure. This is also of course a point of concern when you have code that for\nsome reason or another uses global variables. Here are a short summary of things\nthat may cause confusion.\u003c/p\u003e\n\u003ch2 id=\"tests-in-a-single-file-are-not-run-in-parallel\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tests-in-a-single-file-are-not-run-in-parallel\"\u003e\u003ca href=\"#tests-in-a-single-file-are-not-run-in-parallel\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eTests in a single file are NOT run in parallel\u003c/h2\u003e\n\u003cp\u003eSimple example, the global variable r is included in the test condition, but it\nis accurately run in all cases because the tests are not run in parallel.\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003elet\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ems\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003esetTimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ems\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003edescribe\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etests\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eit\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003et1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoBe\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e++\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  })\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eit\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003et2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoBe\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e++\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  })\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eit\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003et3\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoBe\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003er\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e++\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  })\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis test will take 3 seconds, and will accurately count the global variable. If\nit was in parallel, it may only take 1 second, and would inaccurately count the\nglobal variable due to race conditions\u003c/p\u003e\n\u003ch2 id=\"tests-in-different-files-are-run-in-parallel\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tests-in-different-files-are-run-in-parallel\"\u003e\u003ca href=\"#tests-in-different-files-are-run-in-parallel\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eTests in different files ARE run in parallel\u003c/h2\u003e\n\u003cp\u003eLet's take another example where we use a global variable, and then two\ndifferent tests use the global variable.\u003c/p\u003e\n\u003cp\u003efile_using_some_globals.js\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003elet\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emyGlobal\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emyGlobal\u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e++\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emyGlobal\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eresetMyGlobal\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003emyGlobal\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eexport\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ems\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003esetTimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ems\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etest_global_vars1.test.js\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e./dostuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003efile1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoEqual\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003etest_global_vars2.test.js\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #5DE4C7\"\u003eimport \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e./dostuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003efile1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003easync\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #5DE4C7C0\"\u003eawait\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etimeout\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1000\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003edoStuff\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoEqual\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis test completes in less than 2 seconds, and these tests are run in parallel.\nThey use different instances of the global state, and therefore have no worries\nwith colliding their state.\u003c/p\u003e\n\u003ch2 id=\"does-a-mock-from-one-test-affect-another-test\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#does-a-mock-from-one-test-affect-another-test\"\u003e\u003ca href=\"#does-a-mock-from-one-test-affect-another-test\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eDoes a mock from one test affect another test?\u003c/h2\u003e\n\u003cp\u003eWhile seeking the fabled \"squawk-less\" test, it is often useful to mock console\nso that tests that produce an expected error don't actually print an error\nmessage. However, if not done carefully, you will remove errors across tests\u003c/p\u003e\n\u003cp\u003eSo, could a mock from one test affect another test? If it's in the same file,\nyes!\u003c/p\u003e\n\u003cp\u003emock_console.test.js\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etest1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ejest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003efn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ewow\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoHaveBeenCalled\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etest2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// this console.error will not appear because test1 mocked away console.error\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e// without restoring it\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eHelp I can't see!\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo properly mock these, you should restore the console mock at the end of your\nfunction\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etest1\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eorig\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ejest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003efn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eI should not see this!\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eexpect\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etoHaveBeenCalled\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eorig\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etest2\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsoleMock\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003ejest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003espyOn\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e).\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emockImplementation\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eI should not see this!\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsoleMock\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003emockRestore\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003etest\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003etest3\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e, () \u003c/span\u003e\u003cspan style=\"color: #91B4D5\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003econsole\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E4F0FBD0\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003eI should see this error!\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"add-on-achieve-squawkless-tests\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-on-achieve-squawkless-tests\"\u003e\u003ca href=\"#add-on-achieve-squawkless-tests\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eAdd-on: Achieve squawkless tests!\u003c/h2\u003e\n\u003cp\u003eYour test output should just be a big list of PASS statements, not interleaved\nwith console.error outputs from when you are testing error conditions of your\ncode\u003c/p\u003e\n\u003cp\u003e\"Squawkless tests\" is a term I made up, but it means that if you have code under\ntest that prints some errors to the console, then mock the console.error\nfunction, as in the previous section. Don't stand for having a bunch of verbose\nerrors in your CI logs! However, I also suggest only mocking out console.error\nfor tests that are \u003cstrong\u003eexpected\u003c/strong\u003e to have errors, lest you paper over unexpected\nerrors.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/squawkless_tests.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure: a nice clean test suite without a bunch of crazy console.error outputs\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"\u003e\u003ca href=\"#conclusion\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eGetting better at testing requires exercise, and understanding the basics of\nyour tools can help! Hopefully this helps you achieve a better understanding and\nwrite cleaner jest tests.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"a:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Jest parallelization, globals, mocks, and squawkless tests\"}],[\"$\",\"h4\",null,{\"children\":\"2021-10-05\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$b\"}}],[\"$\",\"$Lc\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Jest parallelization, globals, mocks, and squawkless tests\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"128x128\"}]]\n9:null\n"])</script></body></html>