<!DOCTYPE html><html lang="en"><head><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Making a HTTPS accessible S3 powered static site with CloudFront+route 53</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/53d80a6545e3cb78.css" as="style"/><link rel="stylesheet" href="/_next/static/css/53d80a6545e3cb78.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-d98b4a7f39fdfc80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-76cd57bf65f05d70.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-6db65d5e18d8108f.js" defer=""></script><script src="/_next/static/qSxsSjGcSa5yO2GS4XqXZ/_buildManifest.js" defer=""></script><script src="/_next/static/qSxsSjGcSa5yO2GS4XqXZ/_ssgManifest.js" defer=""></script><script src="/_next/static/qSxsSjGcSa5yO2GS4XqXZ/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Making a HTTPS accessible S3 powered static site with CloudFront+route 53</h1><h4>2020-12-26</h4></div><p>This is not a very authoritative post because I stumbled though this but
I think I got it working now on my website :)</p><h2>Setup your S3 bucket</h2><p>First setup your S3 bucket, your bucket must be named yourdomain.com
e.g. named after your domain</p><p>Then if you have a create-react-app setup I add a script in package.json
that runs</p><pre><code> &quot;predeploy&quot;: &quot;npm run build&quot;,
 &quot;deploy&quot;: &quot;aws sync --delete build s3://yourdomain.com&quot;
</code></pre><p>Then we can run &quot;yarn deploy&quot; and it will automatically upload our
create-react-app website to our S3 static site bucket.</p><p>Then make sure your bucket has public permissions enabled
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2">https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2</a>Then
make sure your bucket has &quot;static site hosting&quot; enabled too</p><h2>Setup route 53, and make your NS entries in domains.google.com</h2><p>I bought a domain with domains.google.com</p><p>Google then emailed me to validate my ownership</p><p>Then I went to aws.amazon.com route 53 and I created a hosted zone</p><p>This generated 4 name server entries and I added those to the
domains.google.com site</p><p><img src="/media/638618421776515072_0.png"/></p><p>Screenshot shows copying the NS values from route 53 to the name servers
area of domains.google.com</p><h2>Setup your Amazon certificate for making SSL work on CloudFront</h2><p>To properly setup However, this does not work so you need to go to
Amazon Certificates-&gt;Provision certificates</p><p>We request the certificate for</p><p><a href="http://www.yourdomain.com">www.yourdomain.com</a>
yourdomain.com</p><p>Then it generates some codes for a CNAME value for each of those two
entries, and has a button to autoimport those CNAME values to route53</p><p>Then it will say &quot;Pending validation&quot;...I waited like an hour and then
it changed to &quot;Success&quot;.</p><p><img src="/media/638618421776515072_1.png"/></p><p>Screenshot shows the now successful Amazon Certificate. After you get
this, you can proceed to finishing your cloudfront</p><h2>Create a CloudFront distribution and add &quot;Alternative CNAME&quot; entries for your domain</h2><p>Then we can update our CloudFront distribution and add these to
the &quot;Alternative CNAME&quot; input box</p><p>yourdomain.com
<a href="http://www.yourdomain.com">www.yourdomain.com</a></p><p>Note also that I first generated my certificate in us-east-2 but the
&quot;Import certificate form&quot; in cloudfront said I had to create it in
us-east-1</p><p><img src="/media/638618421776515072_2.png"/></p><h2>Add a default object index.html to the CloudFront setting</h2><p>Make your CloudFront &quot;default object&quot; is index.html</p><p>You have to manually type this in :)</p><h2>Add the CloudFront distribution to your Route 53</h2><p>Add a Route 53 &quot;A&quot; record that points to the CloudFront domain name e.g.
d897d897d87d98dd.cloudfront.net</p><h2>Summary of steps needed</h2><p>The general hindsight 20/20 procedure is</p><ol><li>Upload your static content to an S3 bucket called yoursite.com (must
be your domain name)</li><li>Make your S3 bucket have the &quot;static website&quot; setting on in the
properties menu and add a permissions policy that supports getObject
e.g. <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2">https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2</a></li><li>Create a CloudFront distribution for your website</li><li>Make the CloudFront default object index.html</li><li>Create your domain with domains.google.com or similar</li><li>Point the google domain&#x27;s name server to Route 53 NS list from AWS</li><li>Add Route 53 A records that point to the CloudFront domain name e.g.
d897d897d87d98dd.cloudfront.net</li><li>Create Amazon issued certificate for yourdomain.com, which can
auto-import a validation CNAME to your Route 53</li><li>Make your CloudFront domain support your Alternative CNAME&#x27;s e.g.
yourdomain.com which requires importing (e.g. selecting from a list
that they auto-populate) your Amazon-issued-certificate</li></ol><h2>Troubleshooting and notes</h2><p>Problem: Your website gives 403 CloudFlare error
Solution: You have to get the Alternateive CNAME configuration setup
(pre-step involves the certificate request and validation)</p><p>Problem: Your website gives an object not found error
Solution: Set the CloudFront &quot;default object&quot; to index.html</p><h2>Random comment</h2><p>This is one of those processes (creating the cloudfront/route 53) that
probably could have done with the aws-sam CLI and it would have possibly
been easier, it is quite fiddly doing all these steps in the web
interface</p></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="https://scholar.google.com/citations?view_op=list_works&amp;hl=en&amp;user=--FwzsgAAAAJ">Publications</a> <a href="/sketches">Sketches</a> <a href="/kitty">Kitty</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Making a HTTPS accessible S3 powered static site with CloudFront+route 53","date":"2020-12-26","slug":"2020-12-26-pt2","mdxSource":{"compiledSource":"var l=Object.defineProperty,m=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var p=(e,t,o)=\u003et in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=\u003e{for(var o in t||(t={}))r.call(t,o)\u0026\u0026p(e,o,t[o]);if(n)for(var o of n(t))s.call(t,o)\u0026\u0026p(e,o,t[o]);return e},u=(e,t)=\u003em(e,c(t));var d=(e,t)=\u003e{var o={};for(var a in e)r.call(e,a)\u0026\u0026t.indexOf(a)\u003c0\u0026\u0026(o[a]=e[a]);if(e!=null\u0026\u0026n)for(var a of n(e))t.indexOf(a)\u003c0\u0026\u0026s.call(e,a)\u0026\u0026(o[a]=e[a]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var a=o,{components:e}=a,t=d(a,[\"components\"]);return mdx(MDXLayout,u(i(i({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`This is not a very authoritative post because I stumbled though this but\nI think I got it working now on my website :)`),mdx(\"h2\",null,\"Setup your S3 bucket\"),mdx(\"p\",null,`First setup your S3 bucket, your bucket must be named yourdomain.com\ne.g. named after your domain`),mdx(\"p\",null,`Then if you have a create-react-app setup I add a script in package.json\nthat runs`),mdx(\"pre\",null,mdx(\"code\",i({parentName:\"pre\"},{}),` \"predeploy\": \"npm run build\",\n \"deploy\": \"aws sync --delete build s3://yourdomain.com\"\n`)),mdx(\"p\",null,`Then we can run \"yarn deploy\" and it will automatically upload our\ncreate-react-app website to our S3 static site bucket.`),mdx(\"p\",null,`Then make sure your bucket has public permissions enabled\n`,mdx(\"a\",i({parentName:\"p\"},{href:\"https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2\"}),\"https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2\"),`Then\nmake sure your bucket has \"static site hosting\" enabled too`),mdx(\"h2\",null,\"Setup route 53, and make your NS entries in domains.google.com\"),mdx(\"p\",null,\"I bought a domain with domains.google.com\"),mdx(\"p\",null,\"Google then emailed me to validate my ownership\"),mdx(\"p\",null,\"Then I went to aws.amazon.com route 53\\xA0and I created a hosted zone\"),mdx(\"p\",null,`This generated 4 name server entries and I added those to the\ndomains.google.com site`),mdx(\"p\",null,mdx(\"img\",i({parentName:\"p\"},{src:\"/media/638618421776515072_0.png\",alt:null}))),mdx(\"p\",null,`Screenshot shows copying the NS values from route 53 to the name servers\narea of domains.google.com`),mdx(\"h2\",null,\"Setup your Amazon certificate for making SSL work on CloudFront\"),mdx(\"p\",null,`To properly setup However, this does not work so you need to go to\nAmazon Certificates-\u003eProvision certificates`),mdx(\"p\",null,\"We request the certificate for\"),mdx(\"p\",null,mdx(\"a\",i({parentName:\"p\"},{href:\"http://www.yourdomain.com\"}),\"www.yourdomain.com\"),`\nyourdomain.com`),mdx(\"p\",null,`Then it generates some codes for a CNAME value for each of those two\nentries, and has a button to autoimport those CNAME values to route53`),mdx(\"p\",null,`Then it will say\\xA0\"Pending validation\"...I waited like an hour and then\nit changed to\\xA0\"Success\".`),mdx(\"p\",null,mdx(\"img\",i({parentName:\"p\"},{src:\"/media/638618421776515072_1.png\",alt:null}))),mdx(\"p\",null,`Screenshot shows the now successful Amazon Certificate. After you get\nthis, you can proceed to finishing your cloudfront`),mdx(\"h2\",null,'Create a CloudFront distribution and add \"Alternative CNAME\" entries for your domain'),mdx(\"p\",null,`Then we can update our CloudFront distribution and add these to\nthe\\xA0\"Alternative CNAME\" input box`),mdx(\"p\",null,`yourdomain.com\n`,mdx(\"a\",i({parentName:\"p\"},{href:\"http://www.yourdomain.com\"}),\"www.yourdomain.com\")),mdx(\"p\",null,`Note also that I first generated my certificate in us-east-2 but the\n\"Import certificate form\" in cloudfront said I had to create it in\nus-east-1`),mdx(\"p\",null,mdx(\"img\",i({parentName:\"p\"},{src:\"/media/638618421776515072_2.png\",alt:null}))),mdx(\"h2\",null,\"Add a default object index.html to the CloudFront setting\"),mdx(\"p\",null,'Make your CloudFront\\xA0\"default object\" is index.html'),mdx(\"p\",null,\"You have to manually type this in :)\"),mdx(\"h2\",null,\"Add the CloudFront distribution to your Route 53\"),mdx(\"p\",null,`Add a Route 53 \"A\" record that points to the CloudFront domain name e.g.\nd897d897d87d98dd.cloudfront.net`),mdx(\"h2\",null,\"Summary of steps needed\"),mdx(\"p\",null,\"The general hindsight 20/20 procedure is\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},`Upload your static content to an S3 bucket called yoursite.com (must\nbe your domain name)`),mdx(\"li\",{parentName:\"ol\"},`Make your S3 bucket have the \"static website\" setting on in the\nproperties menu and add a permissions policy that supports getObject\ne.g.\\xA0`,mdx(\"a\",i({parentName:\"li\"},{href:\"https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2\"}),\"https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2\")),mdx(\"li\",{parentName:\"ol\"},\"Create a CloudFront distribution for your website\"),mdx(\"li\",{parentName:\"ol\"},\"Make the CloudFront default object index.html\"),mdx(\"li\",{parentName:\"ol\"},\"Create your domain with domains.google.com or similar\"),mdx(\"li\",{parentName:\"ol\"},\"Point the google domain's name server to Route 53 NS list from AWS\"),mdx(\"li\",{parentName:\"ol\"},`Add Route 53 A records that point to the CloudFront domain name e.g.\nd897d897d87d98dd.cloudfront.net`),mdx(\"li\",{parentName:\"ol\"},`Create Amazon issued certificate for yourdomain.com, which can\nauto-import a validation CNAME to your Route 53`),mdx(\"li\",{parentName:\"ol\"},`Make your CloudFront domain support your Alternative CNAME's e.g.\nyourdomain.com which requires importing (e.g. selecting from a list\nthat they auto-populate) your Amazon-issued-certificate`)),mdx(\"h2\",null,\"Troubleshooting and notes\"),mdx(\"p\",null,`Problem: Your website gives 403 CloudFlare error\nSolution: You have to get the Alternateive CNAME configuration setup\n(pre-step involves the certificate request and validation)`),mdx(\"p\",null,`Problem: Your website gives an object not found error\nSolution: Set the CloudFront \"default object\" to index.html`),mdx(\"h2\",null,\"Random comment\"),mdx(\"p\",null,`This is one of those processes (creating the cloudfront/route 53) that\nprobably could have done with the aws-sam CLI and it would have possibly\nbeen easier, it is quite fiddly doing all these steps in the web\ninterface`))}MDXContent.isMDXComponent=!0;\n","scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2020-12-26-pt2"},"buildId":"qSxsSjGcSa5yO2GS4XqXZ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>