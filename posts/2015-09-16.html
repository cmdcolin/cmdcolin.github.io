<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><title>Fixing spiky CPU issues with Tomcat</title><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/895e0128ed383e47.css" as="style"/><link rel="stylesheet" href="/_next/static/css/895e0128ed383e47.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e1f6961df2961232.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e1f6961df2961232.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-7c3bf82eed00c281.js" defer=""></script><script src="/_next/static/chunks/pages/_app-76cd57bf65f05d70.js" defer=""></script><script src="/_next/static/chunks/162-34cdd443a23a768b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-2c663bbcac870718.js" defer=""></script><script src="/_next/static/FvdnmdoxC4LeHhwE7eYCN/_buildManifest.js" defer=""></script><script src="/_next/static/FvdnmdoxC4LeHhwE7eYCN/_ssgManifest.js" defer=""></script><script src="/_next/static/FvdnmdoxC4LeHhwE7eYCN/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="container mx-auto px-5"><div class="text-2xl md:text-4xl font-bold py-14 border-b border-accent-2 flex flex-col lg:flex-row items-center"><a class="hover:underline" href="/">Misc scribbles</a></div><article class="mb-32"><h1 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Fixing spiky CPU issues with Tomcat<!-- --> - <!-- -->2016-09-16</h1><div class="max-w-1xl mx-auto"><div class="markdown-styles_markdown__h_8de"><p>The symptoms of spiking that we saw were simply that after light usage
of the applications, the CPU usage would start spiking and rapidly cycle
from many CPU cores (e.g. 2000% CPU usage) back to 0% CPU for no
apparent reason.</p>
<p>We now know this was due to memory issues and garbage collection, but it
was confusing because it wasn't strictly showing up as GC usage in
JVisualVm (the GC usage, blue spikes on the left in fig 1, are small,
but the orange spikes are large, even though the memory issues are the
problem)</p>
<p>Here is what it looked like during spiking (obviously, pushing the
memory limits here, a linked in article suggests having 6GB of "newgen"
memory, so on top of the old gen, tomcat needs a bunch more for the
newgen to make things happy.</p>
<p><img src="/media/129241954103_0.png" alt=""></p>
<p>Here is what it looks like when it is not spiking</p>
<p><img src="/media/129241954103_1.png" alt=""></p>
<p>Edit: See this follow up post for showing that increasing memory helps
<a href="http://searchvoidstar.tumblr.com/post/131229569383/tomcat-memory-debugging">http://searchvoidstar.tumblr.com/post/131229569383/tomcat-memory-debugging</a></p>
<p>::: {#footer}
[ September 16th, 2015 6:37pm ]{#timestamp} [tomcat]{.tag} [java]{.tag}
[programming]{.tag} [coding]{.tag} [troubleshooting]{.tag}
[intermine]{.tag} [bioinformatics]{.tag}
:::</p>
<p>export default ({ children }) => {children}</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-14 flex flex-col lg:flex-row items-center"><div class="m-4"><a class="hover:underline" href="/">Home</a></div><div class="m-4"><a class="hover:underline" href="https://github.com/cmdcolin">Github</a></div><div class="m-4"><a class="hover:underline" href="https://twitter.com/cmdcolin">Twitter</a></div><div class="m-4"><a class="hover:underline" href="/projects">Projects</a></div><div class="m-4"><a class="hover:underline" href="/rss.xml">RSS</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Fixing spiky CPU issues with Tomcat","date":"2016-09-16","slug":"2015-09-16","content":"\u003cp\u003eThe symptoms of spiking that we saw were simply that after light usage\nof the applications, the CPU usage would start spiking and rapidly cycle\nfrom many CPU cores (e.g. 2000% CPU usage) back to 0% CPU for no\napparent reason.\u003c/p\u003e\n\u003cp\u003eWe now know this was due to memory issues and garbage collection, but it\nwas confusing because it wasn't strictly showing up as GC usage in\nJVisualVm (the GC usage, blue spikes on the left in fig 1, are small,\nbut the orange spikes are large, even though the memory issues are the\nproblem)\u003c/p\u003e\n\u003cp\u003eHere is what it looked like during spiking (obviously, pushing the\nmemory limits here, a linked in article suggests having 6GB of \"newgen\"\nmemory, so on top of the old gen, tomcat needs a bunch more for the\nnewgen to make things happy.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/129241954103_0.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eHere is what it looks like when it is not spiking\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/129241954103_1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEdit: See this follow up post for showing that increasing memory helps\n\u003ca href=\"http://searchvoidstar.tumblr.com/post/131229569383/tomcat-memory-debugging\"\u003ehttp://searchvoidstar.tumblr.com/post/131229569383/tomcat-memory-debugging\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e::: {#footer}\n[ September 16th, 2015 6:37pm ]{#timestamp} [tomcat]{.tag} [java]{.tag}\n[programming]{.tag} [coding]{.tag} [troubleshooting]{.tag}\n[intermine]{.tag} [bioinformatics]{.tag}\n:::\u003c/p\u003e\n\u003cp\u003eexport default ({ children }) =\u003e {children}\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2015-09-16"},"buildId":"FvdnmdoxC4LeHhwE7eYCN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>