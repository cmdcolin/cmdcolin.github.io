<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Fixing spiky CPU issues and unresponsiveness with Tomcat</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/9d066bf523979bbf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9d066bf523979bbf.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-8b8836cfd4de0dcd.js" defer=""></script><script src="/_next/static/chunks/framework-c0d8f0fd2eea5ac1.js" defer=""></script><script src="/_next/static/chunks/main-ad18704b098b4264.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9139de5c3de3b6b.js" defer=""></script><script src="/_next/static/chunks/996-f78e375898643c6a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-34e532adea304c66.js" defer=""></script><script src="/_next/static/Yxv3CwXPgMVfJj9ujaEMj/_buildManifest.js" defer=""></script><script src="/_next/static/Yxv3CwXPgMVfJj9ujaEMj/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Fixing spiky CPU issues and unresponsiveness with Tomcat</h1><h4>2015-09-16</h4></div><p>The symptoms of spiking and the server was lagging after light usage of the
applications, the CPU usage would start spiking and rapidly cycle from many CPU
cores (e.g. 2000% CPU usage) back to 0% CPU for no apparent reason.</p>
<p>We now know this was due to memory issues and garbage collection, but it was
confusing because it wasn&#x27;t strictly showing up as GC usage in JVisualVm (the
GC usage, blue spikes on the left in fig 1, are small, but the orange spikes
are large, even though the memory issues are the problem)</p>
<p>Here is what it looked like during spiking (obviously, pushing the memory
limits here, a linked in article suggests having 6GB of &quot;newgen&quot; memory, so on
top of the old gen, tomcat needs a bunch more for the newgen to make things
happy.</p>
<p><img src="/media/129241954103_0.png" alt=""/></p>
<p>Here is what it looks like when it is not spiking</p>
<p><img src="/media/129241954103_1.png" alt=""/></p>
<p>Edit: See this follow up post for showing that increasing memory helps
<a href="https://cmdcolin.github.io/posts/2015-10-15">https://cmdcolin.github.io/posts/2015-10-15</a></p><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Fixing spiky CPU issues and unresponsiveness with Tomcat","date":"2015-09-16","slug":"2015-09-16","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    a: \"a\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"The symptoms of spiking and the server was lagging after light usage of the\\napplications, the CPU usage would start spiking and rapidly cycle from many CPU\\ncores (e.g. 2000% CPU usage) back to 0% CPU for no apparent reason.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We now know this was due to memory issues and garbage collection, but it was\\nconfusing because it wasn't strictly showing up as GC usage in JVisualVm (the\\nGC usage, blue spikes on the left in fig 1, are small, but the orange spikes\\nare large, even though the memory issues are the problem)\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is what it looked like during spiking (obviously, pushing the memory\\nlimits here, a linked in article suggests having 6GB of \\\"newgen\\\" memory, so on\\ntop of the old gen, tomcat needs a bunch more for the newgen to make things\\nhappy.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/media/129241954103_0.png\",\n        alt: \"\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is what it looks like when it is not spiking\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/media/129241954103_1.png\",\n        alt: \"\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Edit: See this follow up post for showing that increasing memory helps\\n\", _jsx(_components.a, {\n        href: \"https://cmdcolin.github.io/posts/2015-10-15\",\n        children: \"https://cmdcolin.github.io/posts/2015-10-15\"\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2015-09-16"},"buildId":"Yxv3CwXPgMVfJj9ujaEMj","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>