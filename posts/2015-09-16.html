<!DOCTYPE html><!--fH_SOSNxuUEv0DVpDA7WK--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/fc00ee8e5a95dbad.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8a89e82a4a55982b.js"/><script src="/_next/static/chunks/4bd1b696-9344bf5691f6d832.js" async=""></script><script src="/_next/static/chunks/964-ec5796515d9e571b.js" async=""></script><script src="/_next/static/chunks/main-app-cbc407ba2e5e7122.js" async=""></script><script src="/_next/static/chunks/874-e7fdbaf82ac68004.js" async=""></script><script src="/_next/static/chunks/app/page-47abc72aede9475f.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-1528a3506652b6df.js" async=""></script><title>Fixing spiky CPU issues and unresponsiveness with Tomcat</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><div class="mb-8"><a href="/">Misc scribbles</a></div><div class="lg:w-1/2 m-auto"><div><h1>Fixing spiky CPU issues and unresponsiveness with Tomcat</h1><h4>2015-09-16</h4></div><div><p>Once upon a time, our server was lagging after light usage of the applications,
and the CPU usage would start spiking and rapidly cycle from many CPU cores
(e.g. 2000% CPU usage) back to 0% CPU for no apparent reason.</p>
<p>After some debugging (<a href="https://cmdcolin.github.io/posts/2015-10-15">https://cmdcolin.github.io/posts/2015-10-15</a>) I found it
was related to memory issues and garbage collection, but it was confusing
because it wasn't strictly showing up as GC usage in JVisualVm (the GC usage,
blue spikes on the left in fig 1, are small, but the orange spikes are large,
even though the memory issues are the problem)</p>
<p>Here is what it looked like during spiking (obviously, pushing the memory limits
here, a linked in article suggests having 6GB of "newgen" memory, so on top of
the old gen, tomcat needs a bunch more for the newgen to make things happy.</p>
<p><img src="/media/129241954103_0.png" alt=""></p>
<p>Here is what it looks like when it is not spiking</p>
<p><img src="/media/129241954103_1.png" alt=""></p>
<p>See this follow up post for a little more info
<a href="https://cmdcolin.github.io/posts/2015-10-15">https://cmdcolin.github.io/posts/2015-10-15</a></p></div><div class="mt-5"></div></div><!--$--><!--/$--><footer class="mt-16"><a class="m-2" href="/">Home</a><a class="m-2" href="/archive">Blog archive</a><a class="m-2" href="https://github.com/cmdcolin/">Github</a><a class="m-2" href="/projects">Projects</a><a class="m-2" href="/books">Books</a><a class="m-2" href="/about">About</a><a class="m-2" href="/rss.xml">RSS</a></footer><script src="/_next/static/chunks/webpack-8a89e82a4a55982b.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[6874,[\"874\",\"static/chunks/874-e7fdbaf82ac68004.js\",\"974\",\"static/chunks/app/page-47abc72aede9475f.js\"],\"\"]\n3:I[7555,[],\"\"]\n4:I[1295,[],\"\"]\n6:I[9665,[],\"OutletBoundary\"]\n8:I[4911,[],\"AsyncMetadataOutlet\"]\na:I[9665,[],\"ViewportBoundary\"]\nc:I[9665,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[8393,[],\"\"]\n:HL[\"/_next/static/css/fc00ee8e5a95dbad.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"fH_SOSNxuUEv0DVpDA7WK\",\"p\":\"\",\"c\":[\"\",\"posts\",\"2015-09-16\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2015-09-16\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fc00ee8e5a95dbad.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"mt-16\",\"children\":[[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L2\",null,{\"className\":\"m-2\",\"href\":\"/rss.xml\",\"children\":\"RSS\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2015-09-16\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"11:I[1401,[\"880\",\"static/chunks/app/posts/%5Bid%5D/page-1528a3506652b6df.js\"],\"default\"]\n10:T4b4,"])</script><script>self.__next_f.push([1,"\u003cp\u003eOnce upon a time, our server was lagging after light usage of the applications,\nand the CPU usage would start spiking and rapidly cycle from many CPU cores\n(e.g. 2000% CPU usage) back to 0% CPU for no apparent reason.\u003c/p\u003e\n\u003cp\u003eAfter some debugging (\u003ca href=\"https://cmdcolin.github.io/posts/2015-10-15\"\u003ehttps://cmdcolin.github.io/posts/2015-10-15\u003c/a\u003e) I found it\nwas related to memory issues and garbage collection, but it was confusing\nbecause it wasn't strictly showing up as GC usage in JVisualVm (the GC usage,\nblue spikes on the left in fig 1, are small, but the orange spikes are large,\neven though the memory issues are the problem)\u003c/p\u003e\n\u003cp\u003eHere is what it looked like during spiking (obviously, pushing the memory limits\nhere, a linked in article suggests having 6GB of \"newgen\" memory, so on top of\nthe old gen, tomcat needs a bunch more for the newgen to make things happy.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/129241954103_0.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eHere is what it looks like when it is not spiking\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/129241954103_1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eSee this follow up post for a little more info\n\u003ca href=\"https://cmdcolin.github.io/posts/2015-10-15\"\u003ehttps://cmdcolin.github.io/posts/2015-10-15\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"lg:w-1/2 m-auto\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Fixing spiky CPU issues and unresponsiveness with Tomcat\"}],[\"$\",\"h4\",null,{\"children\":\"2015-09-16\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$10\"}}],[\"$\",\"$L11\",null,{}]]}]\n9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Fixing spiky CPU issues and unresponsiveness with Tomcat\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"A blog\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:\"$9:metadata\"\n"])</script></body></html>