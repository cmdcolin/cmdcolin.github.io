<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Creating a testing framework for JBrowse plugins</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/0e13ae09fdc48bba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0e13ae09fdc48bba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-3e9e72f6d5fa0854.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-896947e153b7d53e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d6e6a35eb3960502.js" defer=""></script><script src="/_next/static/chunks/996-9e3c12b77542c098.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-23a4b3bec5e8663d.js" defer=""></script><script src="/_next/static/Y0e_o01CmJs6OFggiPydq/_buildManifest.js" defer=""></script><script src="/_next/static/Y0e_o01CmJs6OFggiPydq/_ssgManifest.js" defer=""></script><script src="/_next/static/Y0e_o01CmJs6OFggiPydq/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Creating a testing framework for JBrowse plugins</h1><h4>2016-04-19</h4></div><p>Testing client side apps requires a couple of tedious steps: Organizing
the git clone, the dependencies, wrangling up a web server, the test
framework, etc.</p>
<!-- --><p>When testing a plugin for jbrowse, the dependency tree is interesting
because the plugin &quot;depends&quot; on JBrowse to run, but we will use
travis-CI and bower inside the git repo for our plugin to accomplish
this.</p>
<!-- --><p>In this scenario, we will</p>
<!-- --><ol>
<!-- --><li>
<!-- --><p>Use bower to install jasmine and JBrowse (our platform that we write
the plugin for)</p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Use nginx to launch a webserver on travis-CI</p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Use the phantomjs run-jasmine.js script to check jasmine test
results</p>
<!-- --></li>
<!-- --></ol>
<!-- --><p>Without further ado</p>
<!-- --><p>Here is the .travis.yml</p>
<!-- --><pre><code>    sudo: false
    addons:
      apt:
        packages:
        - nginx
    cache:
      apt: true
      directories:
      - $HOME/.cache/bower
    before_install:
      - npm install -g jshint bower
    install:
      - bower install
    before_script:
      - cat test/travis.conf | envsubst &gt; test/travis-envsubst.conf
      - nginx -c `pwd`/test/travis-envsubst.conf
    script:
      - phantomjs test/run-jasmine.js http://localhost:9000/test/
      - jshint js

</code></pre>
<!-- --><p>Refer to
http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2
for details on the nginx setup</p>
<!-- --><p>Here is the bower.json</p>
<!-- --><pre><code>    {
      &quot;name&quot;: &quot;sashimiplot&quot;,
      &quot;homepage&quot;: &quot;https://github.com/cmdcolin/sashimiplot&quot;,
      &quot;description&quot;: &quot;Sashimi track type for jbrowse&quot;,
      &quot;main&quot;: &quot;js/main.js&quot;,
      &quot;keywords&quot;: [
        &quot;bioinformatics&quot;,
        &quot;jbrowse&quot;
      ],
      &quot;license&quot;: &quot;MIT&quot;,
      &quot;ignore&quot;: [
        &quot;**/.*&quot;,
        &quot;node_modules&quot;,
        &quot;bower_components&quot;,
        &quot;src&quot;,
        &quot;test&quot;,
        &quot;tests&quot;
      ],
      &quot;devDependencies&quot;: {
        &quot;jasmine-core&quot;: &quot;jasmine#^2.4.1&quot;,
        &quot;jbrowse&quot;: &quot;git://github.com/GMOD/jbrowse.git#master&quot;
      }
    }
</code></pre>
<!-- --><p>The key thing here is that it installs jasmine and JBrowse. I set
.bowerrc to install both jasmine and JBrowse to the &quot;test&quot; directory</p>
<!-- --><pre><code>    {
        &quot;directory&quot;: &quot;test&quot;
    }
</code></pre>
<!-- --><p>With this setup, bower will make a &quot;flat dependency tree&quot; in the test
directory, so it will look like this</p>
<!-- --><pre><code>    $ ls -1 test
    FileSaver
    dbind
    dgrid
    dijit
    dojo
    dojox
    *index.html*
    jDataView
    jasmine-core
    jbrowse
    json-schema
    jszlib
    lazyload
    put-selector
    *run-jasmine.js*
    *spec*
    *travis.conf*
    util
    xstyle
</code></pre>
<!-- --><p>Here the asterisks indicate things that are part of our app, other&#x27;s are
automatically installed by bower (jbrowse, jasmine-core, the dojo
dependencies, and other things)</p>
<!-- --><p>Then we can create the jasmine test/index.html to be something like this</p>
<!-- --><pre><code>    &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
      &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;


      &lt;meta&gt;
      Jasmine Spec Runner

      &lt;link rel=&quot;stylesheet&quot; href=&quot;jasmine-core/lib/jasmine-core/jasmine.css&quot;&gt;&lt;script src=&quot;jasmine-core/lib/jasmine-core/jasmine.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;jasmine-core/lib/jasmine-core/boot.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;dojo/dojo.js&quot; data-dojo-config=&quot;async: 1&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;
        require( { baseUrl: &#x27;.&#x27;,
                   packages: [
                       &#x27;dojo&#x27;,
                       &#x27;dijit&#x27;,
                       &#x27;dojox&#x27;,
                       &#x27;jszlib&#x27;,
                       { name: &#x27;lazyload&#x27;, location: &#x27;lazyload&#x27;, main: &#x27;lazyload&#x27; },
                       &#x27;dgrid&#x27;,
                       &#x27;xstyle&#x27;,
                       &#x27;put-selector&#x27;,
                       &#x27;FileSaver&#x27;,
                       { name: &#x27;jDataView&#x27;, location: &#x27;jDataView/src&#x27;, main: &#x27;jdataview&#x27; },
                       { name: &#x27;JBrowse&#x27;, location: &#x27;jbrowse/src/JBrowse&#x27; },
                       { name: &#x27;SashimiPlot&#x27;, location: &#x27;../js&#x27; }
                   ]
        });
      &lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;spec/SashimiPlot.spec.js&quot;&gt;&lt;/script&gt;&lt;div id=&quot;sandbox&quot; style=&quot;overflow:hidden; height:1px;&quot;&gt;&lt;/div&gt;
</code></pre>
<!-- --><p>The &quot;packages&quot; in the require statement puts all these packages in the
right &quot;namespace&quot; for the AMD includes, and the &quot;specs&quot; are defined like
<!-- --><code>&lt;script type=&quot;text/javascript&quot; src=&quot;spec/Projection.spec.js&quot;&gt;&lt;/script&gt;</code></p>
<!-- --><p>Finally, run-jasmine.js is used to check the results of the jasmine tests (it
is run via phantomjs in the travis-CI script). It is a special version for the
most recent version of jasmine (2.4)
https://gist.github.com/vmeln/b6cbb319d9a0efc816be</p>
<!-- --><p>For an example of the project using this, see
https://github.com/cmdcolin/sashimiplot</p><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <!-- --><a href="/archive">Blog archive</a> <!-- --><a href="https://github.com/cmdcolin/">Github</a> <!-- --><a href="https://twitter.com/cmdcolin">Twitter</a> <!-- --><a href="/projects">Projects</a> <!-- --><a href="/photos">Photos</a> <!-- --><a href="/rss.xml">RSS</a><a href="/about">About</a> <!-- --></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Creating a testing framework for JBrowse plugins","date":"2016-04-19","slug":"2016-04-19","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      ol: \"ol\",\n      li: \"li\",\n      pre: \"pre\",\n      code: \"code\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: \"Testing client side apps requires a couple of tedious steps: Organizing\\nthe git clone, the dependencies, wrangling up a web server, the test\\nframework, etc.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"When testing a plugin for jbrowse, the dependency tree is interesting\\nbecause the plugin \\\"depends\\\" on JBrowse to run, but we will use\\ntravis-CI and bower inside the git repo for our plugin to accomplish\\nthis.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"In this scenario, we will\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"Use bower to install jasmine and JBrowse (our platform that we write\\nthe plugin for)\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"Use nginx to launch a webserver on travis-CI\"\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: \"Use the phantomjs run-jasmine.js script to check jasmine test\\nresults\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Without further ado\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Here is the .travis.yml\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"    sudo: false\\n    addons:\\n      apt:\\n        packages:\\n        - nginx\\n    cache:\\n      apt: true\\n      directories:\\n      - $HOME/.cache/bower\\n    before_install:\\n      - npm install -g jshint bower\\n    install:\\n      - bower install\\n    before_script:\\n      - cat test/travis.conf | envsubst \u003e test/travis-envsubst.conf\\n      - nginx -c `pwd`/test/travis-envsubst.conf\\n    script:\\n      - phantomjs test/run-jasmine.js http://localhost:9000/test/\\n      - jshint js\\n\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Refer to\\nhttp://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2\\nfor details on the nginx setup\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Here is the bower.json\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"    {\\n      \\\"name\\\": \\\"sashimiplot\\\",\\n      \\\"homepage\\\": \\\"https://github.com/cmdcolin/sashimiplot\\\",\\n      \\\"description\\\": \\\"Sashimi track type for jbrowse\\\",\\n      \\\"main\\\": \\\"js/main.js\\\",\\n      \\\"keywords\\\": [\\n        \\\"bioinformatics\\\",\\n        \\\"jbrowse\\\"\\n      ],\\n      \\\"license\\\": \\\"MIT\\\",\\n      \\\"ignore\\\": [\\n        \\\"**/.*\\\",\\n        \\\"node_modules\\\",\\n        \\\"bower_components\\\",\\n        \\\"src\\\",\\n        \\\"test\\\",\\n        \\\"tests\\\"\\n      ],\\n      \\\"devDependencies\\\": {\\n        \\\"jasmine-core\\\": \\\"jasmine#^2.4.1\\\",\\n        \\\"jbrowse\\\": \\\"git://github.com/GMOD/jbrowse.git#master\\\"\\n      }\\n    }\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The key thing here is that it installs jasmine and JBrowse. I set\\n.bowerrc to install both jasmine and JBrowse to the \\\"test\\\" directory\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"    {\\n        \\\"directory\\\": \\\"test\\\"\\n    }\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"With this setup, bower will make a \\\"flat dependency tree\\\" in the test\\ndirectory, so it will look like this\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"    $ ls -1 test\\n    FileSaver\\n    dbind\\n    dgrid\\n    dijit\\n    dojo\\n    dojox\\n    *index.html*\\n    jDataView\\n    jasmine-core\\n    jbrowse\\n    json-schema\\n    jszlib\\n    lazyload\\n    put-selector\\n    *run-jasmine.js*\\n    *spec*\\n    *travis.conf*\\n    util\\n    xstyle\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Here the asterisks indicate things that are part of our app, other's are\\nautomatically installed by bower (jbrowse, jasmine-core, the dojo\\ndependencies, and other things)\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Then we can create the jasmine test/index.html to be something like this\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          children: \"    \u003c!DOCTYPE HTML PUBLIC \\\"-//W3C//DTD HTML 4.01 Transitional//EN\\\"\\n      \\\"http://www.w3.org/TR/html4/loose.dtd\\\"\u003e\\n\\n\\n      \u003cmeta\u003e\\n      Jasmine Spec Runner\\n\\n      \u003clink rel=\\\"stylesheet\\\" href=\\\"jasmine-core/lib/jasmine-core/jasmine.css\\\"\u003e\u003cscript src=\\\"jasmine-core/lib/jasmine-core/jasmine.js\\\"\u003e\u003c/script\u003e\u003cscript src=\\\"jasmine-core/lib/jasmine-core/boot.js\\\"\u003e\u003c/script\u003e\u003cscript type=\\\"text/javascript\\\" src=\\\"dojo/dojo.js\\\" data-dojo-config=\\\"async: 1\\\"\u003e\u003c/script\u003e\u003cscript type=\\\"text/javascript\\\"\u003e\\n        require( { baseUrl: '.',\\n                   packages: [\\n                       'dojo',\\n                       'dijit',\\n                       'dojox',\\n                       'jszlib',\\n                       { name: 'lazyload', location: 'lazyload', main: 'lazyload' },\\n                       'dgrid',\\n                       'xstyle',\\n                       'put-selector',\\n                       'FileSaver',\\n                       { name: 'jDataView', location: 'jDataView/src', main: 'jdataview' },\\n                       { name: 'JBrowse', location: 'jbrowse/src/JBrowse' },\\n                       { name: 'SashimiPlot', location: '../js' }\\n                   ]\\n        });\\n      \u003c/script\u003e\u003cscript type=\\\"text/javascript\\\" src=\\\"spec/SashimiPlot.spec.js\\\"\u003e\u003c/script\u003e\u003cdiv id=\\\"sandbox\\\" style=\\\"overflow:hidden; height:1px;\\\"\u003e\u003c/div\u003e\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \\\"packages\\\" in the require statement puts all these packages in the\\nright \\\"namespace\\\" for the AMD includes, and the \\\"specs\\\" are defined like\\n\", _jsx(_components.code, {\n          children: \"\u003cscript type=\\\"text/javascript\\\" src=\\\"spec/Projection.spec.js\\\"\u003e\u003c/script\u003e\"\n        })]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Finally, run-jasmine.js is used to check the results of the jasmine tests (it\\nis run via phantomjs in the travis-CI script). It is a special version for the\\nmost recent version of jasmine (2.4)\\nhttps://gist.github.com/vmeln/b6cbb319d9a0efc816be\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"For an example of the project using this, see\\nhttps://github.com/cmdcolin/sashimiplot\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2016-04-19"},"buildId":"Y0e_o01CmJs6OFggiPydq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>