<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Creating a testing framework for JBrowse plugins</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/c32b3d2522b06381.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c32b3d2522b06381.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-1b2cde50635286d1.js" defer=""></script><script src="/_next/static/chunks/framework-c0d8f0fd2eea5ac1.js" defer=""></script><script src="/_next/static/chunks/main-b12cd062888056b2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d9139de5c3de3b6b.js" defer=""></script><script src="/_next/static/chunks/996-3d2a4318c0ac6f1a.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-b6f09b4db8bfc341.js" defer=""></script><script src="/_next/static/i9vmI0eBx7RPb5Yk124js/_buildManifest.js" defer=""></script><script src="/_next/static/i9vmI0eBx7RPb5Yk124js/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Creating a testing framework for JBrowse plugins</h1><h4>2016-04-19</h4></div><div><p>Testing client side apps requires a couple of tedious steps: Organizing
the git clone, the dependencies, wrangling up a web server, the test
framework, etc.</p>
<p>When testing a plugin for jbrowse, the dependency tree is interesting
because the plugin "depends" on JBrowse to run, but we will use
travis-CI and bower inside the git repo for our plugin to accomplish
this.</p>
<p>In this scenario, we will</p>
<ol>
<li>
<p>Use bower to install jasmine and JBrowse (our platform that we write
the plugin for)</p>
</li>
<li>
<p>Use nginx to launch a webserver on travis-CI</p>
</li>
<li>
<p>Use the phantomjs run-jasmine.js script to check jasmine test
results</p>
</li>
</ol>
<p>Without further ado</p>
<p>Here is the .travis.yml</p>
<pre><code>    sudo: false
    addons:
      apt:
        packages:
        - nginx
    cache:
      apt: true
      directories:
      - $HOME/.cache/bower
    before_install:
      - npm install -g jshint bower
    install:
      - bower install
    before_script:
      - cat test/travis.conf | envsubst > test/travis-envsubst.conf
      - nginx -c `pwd`/test/travis-envsubst.conf
    script:
      - phantomjs test/run-jasmine.js http://localhost:9000/test/
      - jshint js

</code></pre>
<p>Refer to
<a href="http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2">http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2</a>
for details on the nginx setup</p>
<p>Here is the bower.json</p>
<pre><code>    {
      "name": "sashimiplot",
      "homepage": "https://github.com/cmdcolin/sashimiplot",
      "description": "Sashimi track type for jbrowse",
      "main": "js/main.js",
      "keywords": [
        "bioinformatics",
        "jbrowse"
      ],
      "license": "MIT",
      "ignore": [
        "**/.*",
        "node_modules",
        "bower_components",
        "src",
        "test",
        "tests"
      ],
      "devDependencies": {
        "jasmine-core": "jasmine#^2.4.1",
        "jbrowse": "git://github.com/GMOD/jbrowse.git#master"
      }
    }
</code></pre>
<p>The key thing here is that it installs jasmine and JBrowse. I set
.bowerrc to install both jasmine and JBrowse to the "test" directory</p>
<pre><code>    {
        "directory": "test"
    }
</code></pre>
<p>With this setup, bower will make a "flat dependency tree" in the test
directory, so it will look like this</p>
<pre><code>    $ ls -1 test
    FileSaver
    dbind
    dgrid
    dijit
    dojo
    dojox
    *index.html*
    jDataView
    jasmine-core
    jbrowse
    json-schema
    jszlib
    lazyload
    put-selector
    *run-jasmine.js*
    *spec*
    *travis.conf*
    util
    xstyle
</code></pre>
<p>Here the asterisks indicate things that are part of our app, other's are
automatically installed by bower (jbrowse, jasmine-core, the dojo
dependencies, and other things)</p>
<p>Then we can create the jasmine test/index.html to be something like this</p>
<pre><code>    &#x3C;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
      "http://www.w3.org/TR/html4/loose.dtd">


      &#x3C;meta>
      Jasmine Spec Runner

      &#x3C;link rel="stylesheet" href="jasmine-core/lib/jasmine-core/jasmine.css">&#x3C;script src="jasmine-core/lib/jasmine-core/jasmine.js">&#x3C;/script>&#x3C;script src="jasmine-core/lib/jasmine-core/boot.js">&#x3C;/script>&#x3C;script type="text/javascript" src="dojo/dojo.js" data-dojo-config="async: 1">&#x3C;/script>&#x3C;script type="text/javascript">
        require( { baseUrl: '.',
                   packages: [
                       'dojo',
                       'dijit',
                       'dojox',
                       'jszlib',
                       { name: 'lazyload', location: 'lazyload', main: 'lazyload' },
                       'dgrid',
                       'xstyle',
                       'put-selector',
                       'FileSaver',
                       { name: 'jDataView', location: 'jDataView/src', main: 'jdataview' },
                       { name: 'JBrowse', location: 'jbrowse/src/JBrowse' },
                       { name: 'SashimiPlot', location: '../js' }
                   ]
        });
      &#x3C;/script>&#x3C;script type="text/javascript" src="spec/SashimiPlot.spec.js">&#x3C;/script>&#x3C;div id="sandbox" style="overflow:hidden; height:1px;">&#x3C;/div>
</code></pre>
<p>The "packages" in the require statement puts all these packages in the
right "namespace" for the AMD includes, and the "specs" are defined like
<code>&#x3C;script type="text/javascript" src="spec/Projection.spec.js">&#x3C;/script></code></p>
<p>Finally, run-jasmine.js is used to check the results of the jasmine tests (it
is run via phantomjs in the travis-CI script). It is a special version for the
most recent version of jasmine (2.4)
<a href="https://gist.github.com/vmeln/b6cbb319d9a0efc816be">https://gist.github.com/vmeln/b6cbb319d9a0efc816be</a></p>
<p>For an example of the project using this, see
<a href="https://github.com/cmdcolin/sashimiplot">https://github.com/cmdcolin/sashimiplot</a></p></div><div style="margin-top:200px"></div></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="/photos">Photos</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Creating a testing framework for JBrowse plugins","date":"2016-04-19","slug":"2016-04-19","html":"\u003cp\u003eTesting client side apps requires a couple of tedious steps: Organizing\nthe git clone, the dependencies, wrangling up a web server, the test\nframework, etc.\u003c/p\u003e\n\u003cp\u003eWhen testing a plugin for jbrowse, the dependency tree is interesting\nbecause the plugin \"depends\" on JBrowse to run, but we will use\ntravis-CI and bower inside the git repo for our plugin to accomplish\nthis.\u003c/p\u003e\n\u003cp\u003eIn this scenario, we will\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eUse bower to install jasmine and JBrowse (our platform that we write\nthe plugin for)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUse nginx to launch a webserver on travis-CI\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eUse the phantomjs run-jasmine.js script to check jasmine test\nresults\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWithout further ado\u003c/p\u003e\n\u003cp\u003eHere is the .travis.yml\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    sudo: false\n    addons:\n      apt:\n        packages:\n        - nginx\n    cache:\n      apt: true\n      directories:\n      - $HOME/.cache/bower\n    before_install:\n      - npm install -g jshint bower\n    install:\n      - bower install\n    before_script:\n      - cat test/travis.conf | envsubst \u003e test/travis-envsubst.conf\n      - nginx -c `pwd`/test/travis-envsubst.conf\n    script:\n      - phantomjs test/run-jasmine.js http://localhost:9000/test/\n      - jshint js\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRefer to\n\u003ca href=\"http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2\"\u003ehttp://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2\u003c/a\u003e\nfor details on the nginx setup\u003c/p\u003e\n\u003cp\u003eHere is the bower.json\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    {\n      \"name\": \"sashimiplot\",\n      \"homepage\": \"https://github.com/cmdcolin/sashimiplot\",\n      \"description\": \"Sashimi track type for jbrowse\",\n      \"main\": \"js/main.js\",\n      \"keywords\": [\n        \"bioinformatics\",\n        \"jbrowse\"\n      ],\n      \"license\": \"MIT\",\n      \"ignore\": [\n        \"**/.*\",\n        \"node_modules\",\n        \"bower_components\",\n        \"src\",\n        \"test\",\n        \"tests\"\n      ],\n      \"devDependencies\": {\n        \"jasmine-core\": \"jasmine#^2.4.1\",\n        \"jbrowse\": \"git://github.com/GMOD/jbrowse.git#master\"\n      }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe key thing here is that it installs jasmine and JBrowse. I set\n.bowerrc to install both jasmine and JBrowse to the \"test\" directory\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    {\n        \"directory\": \"test\"\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith this setup, bower will make a \"flat dependency tree\" in the test\ndirectory, so it will look like this\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    $ ls -1 test\n    FileSaver\n    dbind\n    dgrid\n    dijit\n    dojo\n    dojox\n    *index.html*\n    jDataView\n    jasmine-core\n    jbrowse\n    json-schema\n    jszlib\n    lazyload\n    put-selector\n    *run-jasmine.js*\n    *spec*\n    *travis.conf*\n    util\n    xstyle\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere the asterisks indicate things that are part of our app, other's are\nautomatically installed by bower (jbrowse, jasmine-core, the dojo\ndependencies, and other things)\u003c/p\u003e\n\u003cp\u003eThen we can create the jasmine test/index.html to be something like this\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    \u0026#x3C;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n      \"http://www.w3.org/TR/html4/loose.dtd\"\u003e\n\n\n      \u0026#x3C;meta\u003e\n      Jasmine Spec Runner\n\n      \u0026#x3C;link rel=\"stylesheet\" href=\"jasmine-core/lib/jasmine-core/jasmine.css\"\u003e\u0026#x3C;script src=\"jasmine-core/lib/jasmine-core/jasmine.js\"\u003e\u0026#x3C;/script\u003e\u0026#x3C;script src=\"jasmine-core/lib/jasmine-core/boot.js\"\u003e\u0026#x3C;/script\u003e\u0026#x3C;script type=\"text/javascript\" src=\"dojo/dojo.js\" data-dojo-config=\"async: 1\"\u003e\u0026#x3C;/script\u003e\u0026#x3C;script type=\"text/javascript\"\u003e\n        require( { baseUrl: '.',\n                   packages: [\n                       'dojo',\n                       'dijit',\n                       'dojox',\n                       'jszlib',\n                       { name: 'lazyload', location: 'lazyload', main: 'lazyload' },\n                       'dgrid',\n                       'xstyle',\n                       'put-selector',\n                       'FileSaver',\n                       { name: 'jDataView', location: 'jDataView/src', main: 'jdataview' },\n                       { name: 'JBrowse', location: 'jbrowse/src/JBrowse' },\n                       { name: 'SashimiPlot', location: '../js' }\n                   ]\n        });\n      \u0026#x3C;/script\u003e\u0026#x3C;script type=\"text/javascript\" src=\"spec/SashimiPlot.spec.js\"\u003e\u0026#x3C;/script\u003e\u0026#x3C;div id=\"sandbox\" style=\"overflow:hidden; height:1px;\"\u003e\u0026#x3C;/div\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \"packages\" in the require statement puts all these packages in the\nright \"namespace\" for the AMD includes, and the \"specs\" are defined like\n\u003ccode\u003e\u0026#x3C;script type=\"text/javascript\" src=\"spec/Projection.spec.js\"\u003e\u0026#x3C;/script\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eFinally, run-jasmine.js is used to check the results of the jasmine tests (it\nis run via phantomjs in the travis-CI script). It is a special version for the\nmost recent version of jasmine (2.4)\n\u003ca href=\"https://gist.github.com/vmeln/b6cbb319d9a0efc816be\"\u003ehttps://gist.github.com/vmeln/b6cbb319d9a0efc816be\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFor an example of the project using this, see\n\u003ca href=\"https://github.com/cmdcolin/sashimiplot\"\u003ehttps://github.com/cmdcolin/sashimiplot\u003c/a\u003e\u003c/p\u003e"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2016-04-19"},"buildId":"i9vmI0eBx7RPb5Yk124js","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>