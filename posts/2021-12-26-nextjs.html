<!DOCTYPE html><html lang="en"><head><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>My next.js static blog setup</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/53d80a6545e3cb78.css" as="style"/><link rel="stylesheet" href="/_next/static/css/53d80a6545e3cb78.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-d98b4a7f39fdfc80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-76cd57bf65f05d70.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-6db65d5e18d8108f.js" defer=""></script><script src="/_next/static/0dVAyZjoL3vhco3wtn9YT/_buildManifest.js" defer=""></script><script src="/_next/static/0dVAyZjoL3vhco3wtn9YT/_ssgManifest.js" defer=""></script><script src="/_next/static/0dVAyZjoL3vhco3wtn9YT/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>My next.js static blog setup</h1><h4>2021-12-26</h4></div><p>My personal homepage originally used statocles, a perl-based static site
generator (<a href="http://preaction.me/statocles/">http://preaction.me/statocles/</a>). I didn&#x27;t really blog using it, just
a homepage for myself plus some links to my tumblr blog. But, if I linked
people to the tumblr blog directly, it would give people terrible popup ads and
trackers. So, I switched to github pages+next.js this year. I considered a
number of alternative static site systems, but next.js seemed to hit some nice
goals</p><ul><li>Flexible</li><li>React-based (as opposed to template-based like jekyll, eleventy, etc.)</li><li>Markdown driven, and can use MDX</li><li>RSS feed (bonus)</li><li>Active community</li></ul><p>Other systems almost worked and were attempted but aborted</p><h3>First and second iterations</h3><p>The first iteration of my next.js blog</p><ul><li>I put every blog post in the &quot;pages&quot; folder. This worked ok but I had to
manually edit the index.mdx file to have long lists of stuff like this
<code>![link to new blogpost](manually_inserted_link_here)</code></li></ul><p>The second iteration, I wanted to automatically generate a list of recent
blogposts from files on disk</p><ul><li><p>I used the next.js &quot;blog-template-typescript&quot; example folder from their
<a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript">monorepo</a>.</p></li><li><p>The new blog posts are generated from markdown files in the <code>_posts</code> folder,
and get rendered by the file <code>pages/posts/[slug].tsx</code> (yes, the filename
includes square brackets).</p></li><li><p>getAllPosts in<br/>
<a href="https://github.com/cmdcolin/cmdcolin.github.io/blob/master/lib/api.ts"><code>lib/api.ts</code></a>
gets a listing of the files in <!-- -->_<!-- -->posts folder, which I can call from the <code>getStaticProps</code> method on next.js pages</p></li></ul><h3>Stripping off unnecessary stuff from blog-starter-typescript</h3><p>The <code>blog-starter-typescript</code> template has many tiny components, I removed some
of them to make it easier for me to orient myself</p><ul><li><a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript/components">theirs</a></li><li><a href="https://github.com/cmdcolin/cmdcolin.github.io/tree/master/components">mine</a></li></ul><h3>Removing tailwind CSS</h3><p>The <code>blog-starter-typescript</code> template uses tailwind CSS and uses &quot;modern web design&quot; (aka:
gigantic &quot;tiles&quot; instead of links, images that are way too large, etc)</p><p>I started making a more basic design. I tried to roll with the tailwind CSS for
a bit, but ended up removing it entirely.</p><p>Tailwind CSS is sort of like a CSS-in-JS system, except every CSS attribute is encoded in a CSS classname. For example, here are some tailwind CSS snippets</p><pre><code class="language-html">&lt;div className=&quot;container mx-auto px-5&quot;&gt;&lt;/div&gt;
&lt;footer className=&quot;bg-accent-1 border-t border-accent-2&quot;&gt;&lt;/footer&gt;
&lt;div className=&quot;max-w-1xl mx-auto&quot;&gt;&lt;/div&gt;
&lt;div className=&quot;min-h-screen&quot;&gt;&lt;/div&gt;
&lt;a className=&quot;hover:underline&quot;&gt;&lt;/a&gt;
&lt;h1
  className=&quot;text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left&quot;
&gt;&lt;/h1&gt;
</code></pre><p>They claim this is better than using external CSS (see comparison here
<a href="https://tailwindcss.com/docs/utility-first">https://tailwindcss.com/docs/utility-first</a>) but it is yet another language to
learn, and kind of tricky.</p><p>But, the reason I gave up with tailwind is actually because tailwind CSS resets
a lot of HTML styles so things like <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;a&gt;</code> have
no styling at all. This is done by <code>tailwind preflight</code>
<a href="https://tailwindcss.com/docs/preflight">https://tailwindcss.com/docs/preflight</a> (which you can disable, but it is
enabled by default)</p><p>Stackoverflow has some ways to help restore styling and keep preflight, but it
still struck me as odd. Examples</p><ul><li><p><a href="https://stackoverflow.com/a/68853223/2129219">Example: you have to manually restore underlines on <code>&lt;a&gt;</code> elements if using tailwind XSS</a></p></li><li><p><a href="https://stackoverflow.com/questions/69264976/cant-display-markdown-on-nextjs">Another example: &quot;It looks like you&#x27;re using TailwindCSS, the default
styles for elements are reset, that&#x27;s why the h1 text will look like any other
text.&quot;</a></p></li><li><p><a href="https://raw.githubusercontent.com/vercel/next.js/canary/examples/blog-starter-typescript/components/markdown-styles.module.css">Another example <code>blog-template-typescript</code> uses this file to try to style
the markdown using some general
styles</a></p></li></ul><p>To me it was surprising the extend that tailwind goes to unstyle the default
browser styles, removing &quot;idiomatic HTML&quot; styles, so I removed tailwind for
now. Perhaps I&#x27;ll return to it another time</p><h2>Using MDX for blogposts in next.js</h2><p>In the template from next.js team, the <code>blog-template-typescript</code>, it uses a
fairly simple <code>lib/markdownToHtml.ts</code> function right in the
<code>pages/posts/[slug].tsx</code> file (the markdown is statically pre-rendered in the
true static blog sense, using the getStaticProps function). This is,
unfortunately, over-simplified for the MDX case, because MDX properly needs to
hydrate the components using react on the client side also</p><p>To fix, the module <a href="https://github.com/hashicorp/next-mdx-remote">https://github.com/hashicorp/next-mdx-remote</a> offers a way to
load actual MDX files.</p><h2>Adding syntax highlighting the next.js code snippets</h2><p>There are a couple results from google about how to add syntax highlighting to
next.js but I still found it difficult.</p><p>My method ended up a bit different where I manually included the prism JS and
CSS from a CDN essentially and it worked</p><p><a href="https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15">https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15</a></p><p><a href="https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17">https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17</a></p><p>Other methods e.g. adding react-prism in next.config.js (like
<a href="https://github.com/mikeesto/next-mdx-prism-example">https://github.com/mikeesto/next-mdx-prism-example</a> does) I think clashed with
MDXRemote perhaps, or maybe I was tussling with tailwind CSS too much to make a
clear thought out of it, but syntax blocks on my blogposts should now be
properly highlighted</p><h2>RSS feed</h2><p>I also followed this great guide to add a RSS file for next.js
<a href="https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site">https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site</a></p><p>Link here, for your feed readers
<a href="https://cmdcolin.github.io/rss.xml">https://cmdcolin.github.io/rss.xml</a></p><p>Not many people may use RSS much anymore, but I do use it (via feedly), and I
love music blogs that keep posting on blogspot year after year, and the
occasional programming post is nice too</p></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="https://scholar.google.com/citations?view_op=list_works&amp;hl=en&amp;user=--FwzsgAAAAJ">Publications</a> <a href="/sketches">Sketches</a> <a href="/kitty">Kitty</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"My next.js static blog setup","date":"2021-12-26","slug":"2021-12-26-nextjs","mdxSource":{"compiledSource":"var d=Object.defineProperty,h=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var r=(t,a,i)=\u003ea in t?d(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,e=(t,a)=\u003e{for(var i in a||(a={}))s.call(a,i)\u0026\u0026r(t,i,a[i]);if(o)for(var i of o(a))l.call(a,i)\u0026\u0026r(t,i,a[i]);return t},p=(t,a)=\u003eh(t,c(a));var m=(t,a)=\u003e{var i={};for(var n in t)s.call(t,n)\u0026\u0026a.indexOf(n)\u003c0\u0026\u0026(i[n]=t[n]);if(t!=null\u0026\u0026o)for(var n of o(t))a.indexOf(n)\u003c0\u0026\u0026l.call(t,n)\u0026\u0026(i[n]=t[n]);return i};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(i){var n=i,{components:t}=n,a=m(n,[\"components\"]);return mdx(MDXLayout,p(e(e({},layoutProps),a),{components:t,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`My personal homepage originally used statocles, a perl-based static site\ngenerator (`,mdx(\"a\",e({parentName:\"p\"},{href:\"http://preaction.me/statocles/\"}),\"http://preaction.me/statocles/\"),`). I didn't really blog using it, just\na homepage for myself plus some links to my tumblr blog. But, if I linked\npeople to the tumblr blog directly, it would give people terrible popup ads and\ntrackers. So, I switched to github pages+next.js this year. I considered a\nnumber of alternative static site systems, but next.js seemed to hit some nice\ngoals`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Flexible\"),mdx(\"li\",{parentName:\"ul\"},\"React-based (as opposed to template-based like jekyll, eleventy, etc.)\"),mdx(\"li\",{parentName:\"ul\"},\"Markdown driven, and can use MDX\"),mdx(\"li\",{parentName:\"ul\"},\"RSS feed (bonus)\"),mdx(\"li\",{parentName:\"ul\"},\"Active community\")),mdx(\"p\",null,\"Other systems almost worked and were attempted but aborted\"),mdx(\"h3\",null,\"First and second iterations\"),mdx(\"p\",null,\"The first iteration of my next.js blog\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`I put every blog post in the \"pages\" folder. This worked ok but I had to\nmanually edit the index.mdx file to have long lists of stuff like this\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"![link to new blogpost](manually_inserted_link_here)\"))),mdx(\"p\",null,`The second iteration, I wanted to automatically generate a list of recent\nblogposts from files on disk`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`I used the next.js \"blog-template-typescript\" example folder from their\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript\"}),\"monorepo\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"The new blog posts are generated from markdown files in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"_posts\"),` folder,\nand get rendered by the file `,mdx(\"inlineCode\",{parentName:\"p\"},\"pages/posts/[slug].tsx\"),` (yes, the filename\nincludes square brackets).`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"getAllPosts in\",mdx(\"br\",{parentName:\"p\"}),`\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/master/lib/api.ts\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"lib/api.ts\")),`\ngets a listing of the files in `,\"_\",\"posts folder, which I can call from the \",mdx(\"inlineCode\",{parentName:\"p\"},\"getStaticProps\"),\" method on next.js pages\"))),mdx(\"h3\",null,\"Stripping off unnecessary stuff from blog-starter-typescript\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-starter-typescript\"),` template has many tiny components, I removed some\nof them to make it easier for me to orient myself`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript/components\"}),\"theirs\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/tree/master/components\"}),\"mine\"))),mdx(\"h3\",null,\"Removing tailwind CSS\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-starter-typescript\"),` template uses tailwind CSS and uses \"modern web design\" (aka:\ngigantic \"tiles\" instead of links, images that are way too large, etc)`),mdx(\"p\",null,`I started making a more basic design. I tried to roll with the tailwind CSS for\na bit, but ended up removing it entirely.`),mdx(\"p\",null,\"Tailwind CSS is sort of like a CSS-in-JS system, except every CSS attribute is encoded in a CSS classname. For example, here are some tailwind CSS snippets\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-html\"}),`\u003cdiv className=\"container mx-auto px-5\"\u003e\u003c/div\u003e\n\u003cfooter className=\"bg-accent-1 border-t border-accent-2\"\u003e\u003c/footer\u003e\n\u003cdiv className=\"max-w-1xl mx-auto\"\u003e\u003c/div\u003e\n\u003cdiv className=\"min-h-screen\"\u003e\u003c/div\u003e\n\u003ca className=\"hover:underline\"\u003e\u003c/a\u003e\n\u003ch1\n  className=\"text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left\"\n\u003e\u003c/h1\u003e\n`)),mdx(\"p\",null,`They claim this is better than using external CSS (see comparison here\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tailwindcss.com/docs/utility-first\"}),\"https://tailwindcss.com/docs/utility-first\"),`) but it is yet another language to\nlearn, and kind of tricky.`),mdx(\"p\",null,`But, the reason I gave up with tailwind is actually because tailwind CSS resets\na lot of HTML styles so things like `,mdx(\"inlineCode\",{parentName:\"p\"},\"\u003ch1\u003e\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003ch2\u003e\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003cul\u003e\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003cli\u003e\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"\u003ca\u003e\"),` have\nno styling at all. This is done by `,mdx(\"inlineCode\",{parentName:\"p\"},\"tailwind preflight\"),`\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tailwindcss.com/docs/preflight\"}),\"https://tailwindcss.com/docs/preflight\"),` (which you can disable, but it is\nenabled by default)`),mdx(\"p\",null,`Stackoverflow has some ways to help restore styling and keep preflight, but it\nstill struck me as odd. Examples`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackoverflow.com/a/68853223/2129219\"}),\"Example: you have to manually restore underlines on \",mdx(\"inlineCode\",{parentName:\"a\"},\"\u003ca\u003e\"),\" elements if using tailwind XSS\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackoverflow.com/questions/69264976/cant-display-markdown-on-nextjs\"}),`Another example: \"It looks like you're using TailwindCSS, the default\nstyles for elements are reset, that's why the h1 text will look like any other\ntext.\"`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://raw.githubusercontent.com/vercel/next.js/canary/examples/blog-starter-typescript/components/markdown-styles.module.css\"}),\"Another example \",mdx(\"inlineCode\",{parentName:\"a\"},\"blog-template-typescript\"),` uses this file to try to style\nthe markdown using some general\nstyles`)))),mdx(\"p\",null,`To me it was surprising the extend that tailwind goes to unstyle the default\nbrowser styles, removing \"idiomatic HTML\" styles, so I removed tailwind for\nnow. Perhaps I'll return to it another time`),mdx(\"h2\",null,\"Using MDX for blogposts in next.js\"),mdx(\"p\",null,\"In the template from next.js team, the \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-template-typescript\"),`, it uses a\nfairly simple `,mdx(\"inlineCode\",{parentName:\"p\"},\"lib/markdownToHtml.ts\"),` function right in the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"pages/posts/[slug].tsx\"),` file (the markdown is statically pre-rendered in the\ntrue static blog sense, using the getStaticProps function). This is,\nunfortunately, over-simplified for the MDX case, because MDX properly needs to\nhydrate the components using react on the client side also`),mdx(\"p\",null,\"To fix, the module \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/next-mdx-remote\"}),\"https://github.com/hashicorp/next-mdx-remote\"),` offers a way to\nload actual MDX files.`),mdx(\"h2\",null,\"Adding syntax highlighting the next.js code snippets\"),mdx(\"p\",null,`There are a couple results from google about how to add syntax highlighting to\nnext.js but I still found it difficult.`),mdx(\"p\",null,`My method ended up a bit different where I manually included the prism JS and\nCSS from a CDN essentially and it worked`),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15\"}),\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15\")),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17\"}),\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17\")),mdx(\"p\",null,`Other methods e.g. adding react-prism in next.config.js (like\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/mikeesto/next-mdx-prism-example\"}),\"https://github.com/mikeesto/next-mdx-prism-example\"),` does) I think clashed with\nMDXRemote perhaps, or maybe I was tussling with tailwind CSS too much to make a\nclear thought out of it, but syntax blocks on my blogposts should now be\nproperly highlighted`),mdx(\"h2\",null,\"RSS feed\"),mdx(\"p\",null,`I also followed this great guide to add a RSS file for next.js\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site\"}),\"https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site\")),mdx(\"p\",null,`Link here, for your feed readers\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://cmdcolin.github.io/rss.xml\"}),\"https://cmdcolin.github.io/rss.xml\")),mdx(\"p\",null,`Not many people may use RSS much anymore, but I do use it (via feedly), and I\nlove music blogs that keep posting on blogspot year after year, and the\noccasional programming post is nice too`))}MDXContent.isMDXComponent=!0;\n","scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-12-26-nextjs"},"buildId":"0dVAyZjoL3vhco3wtn9YT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>