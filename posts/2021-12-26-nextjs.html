<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>My next.js static blog setup</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="favicon.ico"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><meta name="description" content="Blogging for the future"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="preload" href="/_next/static/css/0e13ae09fdc48bba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0e13ae09fdc48bba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-fd1bc4a65a80e5c8.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-a6b7581332edf7c2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1e17a6754614af77.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-12d1f4c4d63ac780.js" defer=""></script><script src="/_next/static/LZcb5RDWtLylaGTwO6fbM/_buildManifest.js" defer=""></script><script src="/_next/static/LZcb5RDWtLylaGTwO6fbM/_ssgManifest.js" defer=""></script><script src="/_next/static/LZcb5RDWtLylaGTwO6fbM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><main><div><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>My next.js static blog setup</h1><h4>2021-12-26</h4></div><p>TLDR src here <a href="https://github.com/cmdcolin/cmdcolin.github.io">https://github.com/cmdcolin/cmdcolin.github.io</a></p>
<p>My personal homepage originally used statocles, a perl-based static site
generator (http://preaction.me/statocles/). I didn&#x27;t really blog using it, just
a homepage for myself plus some links to my tumblr blog. But, if I linked
people to the tumblr blog directly, it would give people terrible popup ads and
trackers. So, I switched to github pages+next.js this year. I considered a
number of alternative static site systems, but next.js seemed to hit some nice
goals</p>
<ul>
<li>Flexible</li>
<li>React-based (as opposed to template-based like jekyll, eleventy, etc.)</li>
<li>Markdown driven, and can use MDX</li>
<li>RSS feed (bonus)</li>
<li>Active community</li>
</ul>
<p>Other systems almost worked and were attempted but aborted</p>
<h3>First and second iterations</h3>
<p>The first iteration of my next.js blog</p>
<ul>
<li>I put every blog post in the &quot;pages&quot; folder. This worked ok but I had to
manually edit the index.mdx file to have long lists of stuff like this
<code>![link to new blogpost](manually_inserted_link_here)</code></li>
</ul>
<p>The second iteration, I wanted to automatically generate a list of recent
blogposts from files on disk</p>
<ul>
<li>
<p>I used the next.js &quot;blog-template-typescript&quot; example folder from their
<a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript">monorepo</a>.</p>
</li>
<li>
<p>The new blog posts are generated from markdown files in the <code>_posts</code> folder,
and get rendered by the file <code>pages/posts/[slug].tsx</code> (yes, the filename
includes square brackets).</p>
</li>
<li>
<p>getAllPosts in<br/>
<a href="https://github.com/cmdcolin/cmdcolin.github.io/blob/master/lib/api.ts"><code>lib/api.ts</code></a>
gets a listing of the files in _posts folder, which I can call from the <code>getStaticProps</code> method on next.js pages</p>
</li>
</ul>
<h3>Stripping off unnecessary stuff from blog-starter-typescript</h3>
<p>The <code>blog-starter-typescript</code> template has many tiny components, I removed some
of them to make it easier for me to orient myself</p>
<ul>
<li><a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript/components">theirs</a></li>
<li><a href="https://github.com/cmdcolin/cmdcolin.github.io/tree/master/components">mine</a></li>
</ul>
<h3>Removing tailwind CSS</h3>
<p>The <code>blog-starter-typescript</code> template uses tailwind CSS and uses &quot;modern web design&quot; (aka:
gigantic &quot;tiles&quot; instead of links, images that are way too large, etc)</p>
<p>I started making a more basic design. I tried to roll with the tailwind CSS for
a bit, but ended up removing it entirely.</p>
<p>Tailwind CSS is sort of like a CSS-in-JS system, except every CSS attribute is encoded in a CSS classname. For example, here are some tailwind CSS snippets</p>
<pre><code class="language-html">&lt;div className=&quot;container mx-auto px-5&quot;&gt;&lt;/div&gt;
&lt;footer className=&quot;bg-accent-1 border-t border-accent-2&quot;&gt;&lt;/footer&gt;
&lt;div className=&quot;max-w-1xl mx-auto&quot;&gt;&lt;/div&gt;
&lt;div className=&quot;min-h-screen&quot;&gt;&lt;/div&gt;
&lt;a className=&quot;hover:underline&quot;&gt;&lt;/a&gt;
&lt;h1
  className=&quot;text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left&quot;
&gt;&lt;/h1&gt;
</code></pre>
<p>They claim this is better than using external CSS (see comparison here
https://tailwindcss.com/docs/utility-first) but it is yet another language to
learn, and kind of tricky.</p>
<p>But, the reason I gave up with tailwind is actually because tailwind CSS resets
a lot of HTML styles so things like <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;a&gt;</code> have
no styling at all. This is done by <code>tailwind preflight</code>
https://tailwindcss.com/docs/preflight (which you can disable, but it is
enabled by default)</p>
<p>Stackoverflow has some ways to help restore styling and keep preflight, but it
still struck me as odd. Examples</p>
<ul>
<li>
<p><a href="https://stackoverflow.com/a/68853223/2129219">Example: you have to manually restore underlines on <code>&lt;a&gt;</code> elements if using tailwind XSS</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/69264976/cant-display-markdown-on-nextjs">Another example: &quot;It looks like you&#x27;re using TailwindCSS, the default
styles for elements are reset, that&#x27;s why the h1 text will look like any other
text.&quot;</a></p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/vercel/next.js/canary/examples/blog-starter-typescript/components/markdown-styles.module.css">Another example <code>blog-template-typescript</code> uses this file to try to style
the markdown using some general
styles</a></p>
</li>
</ul>
<p>To me it was surprising the extend that tailwind goes to unstyle the default
browser styles, removing &quot;idiomatic HTML&quot; styles, so I removed tailwind for
now. Perhaps I&#x27;ll return to it another time</p>
<h2>Using MDX for blogposts in next.js</h2>
<p>In the template from next.js team, the <code>blog-template-typescript</code>, it uses a
fairly simple <code>lib/markdownToHtml.ts</code> function right in the
<code>pages/posts/[slug].tsx</code> file (the markdown is statically pre-rendered in the
true static blog sense, using the getStaticProps function). This is,
unfortunately, over-simplified for the MDX case, because MDX properly needs to
hydrate the components using react on the client side also</p>
<p>To fix, the module https://github.com/hashicorp/next-mdx-remote offers a way to
load actual MDX files.</p>
<h2>Adding syntax highlighting the next.js code snippets</h2>
<p>There are a couple results from google about how to add syntax highlighting to
next.js but I still found it difficult.</p>
<p>My method ended up a bit different where I manually included the prism JS and
CSS from a CDN essentially and it worked</p>
<p>https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15</p>
<p>https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17</p>
<p>Other methods e.g. adding react-prism in next.config.js (like
https://github.com/mikeesto/next-mdx-prism-example does) I think clashed with
MDXRemote perhaps, or maybe I was tussling with tailwind CSS too much to make a
clear thought out of it, but syntax blocks on my blogposts should now be
properly highlighted</p>
<h2>RSS feed</h2>
<p>I also followed this great guide to add a RSS file for next.js
https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site</p>
<p>Link here, for your feed readers
https://cmdcolin.github.io/rss.xml</p>
<p>Not many people may use RSS much anymore, but I do use it (via feedly), and I
love music blogs that keep posting on blogspot year after year, and the
occasional programming post is nice too</p></article></div></main></div><footer style="margin-top:100px"><a href="/">Home</a> <a href="/archive">Blog archive</a> <a href="https://github.com/cmdcolin/">Github</a> <a href="https://twitter.com/cmdcolin">Twitter</a> <a href="/projects">Projects</a> <a href="https://scholar.google.com/citations?view_op=list_works&amp;hl=en&amp;user=--FwzsgAAAAJ">Publications</a> <a href="/sketches">Sketches</a> <a href="/kitty">Kitty</a> <a href="/rss.xml">RSS</a><a href="/about">About</a> </footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"My next.js static blog setup","date":"2021-12-26","slug":"2021-12-26-nextjs","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      a: \"a\",\n      ul: \"ul\",\n      li: \"li\",\n      h3: \"h3\",\n      code: \"code\",\n      br: \"br\",\n      pre: \"pre\",\n      h2: \"h2\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsxs(_components.p, {\n        children: [\"TLDR src here \", _jsx(_components.a, {\n          href: \"https://github.com/cmdcolin/cmdcolin.github.io\",\n          children: \"https://github.com/cmdcolin/cmdcolin.github.io\"\n        })]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"My personal homepage originally used statocles, a perl-based static site\\ngenerator (http://preaction.me/statocles/). I didn't really blog using it, just\\na homepage for myself plus some links to my tumblr blog. But, if I linked\\npeople to the tumblr blog directly, it would give people terrible popup ads and\\ntrackers. So, I switched to github pages+next.js this year. I considered a\\nnumber of alternative static site systems, but next.js seemed to hit some nice\\ngoals\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"Flexible\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"React-based (as opposed to template-based like jekyll, eleventy, etc.)\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"Markdown driven, and can use MDX\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"RSS feed (bonus)\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"Active community\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Other systems almost worked and were attempted but aborted\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"First and second iterations\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The first iteration of my next.js blog\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"I put every blog post in the \\\"pages\\\" folder. This worked ok but I had to\\nmanually edit the index.mdx file to have long lists of stuff like this\\n\", _jsx(_components.code, {\n            children: \"![link to new blogpost](manually_inserted_link_here)\"\n          })]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"The second iteration, I wanted to automatically generate a list of recent\\nblogposts from files on disk\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsxs(_components.p, {\n            children: [\"I used the next.js \\\"blog-template-typescript\\\" example folder from their\\n\", _jsx(_components.a, {\n              href: \"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript\",\n              children: \"monorepo\"\n            }), \".\"]\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsxs(_components.p, {\n            children: [\"The new blog posts are generated from markdown files in the \", _jsx(_components.code, {\n              children: \"_posts\"\n            }), \" folder,\\nand get rendered by the file \", _jsx(_components.code, {\n              children: \"pages/posts/[slug].tsx\"\n            }), \" (yes, the filename\\nincludes square brackets).\"]\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsxs(_components.p, {\n            children: [\"getAllPosts in\", _jsx(_components.br, {}), \"\\n\", _jsx(_components.a, {\n              href: \"https://github.com/cmdcolin/cmdcolin.github.io/blob/master/lib/api.ts\",\n              children: _jsx(_components.code, {\n                children: \"lib/api.ts\"\n              })\n            }), \"\\ngets a listing of the files in _posts folder, which I can call from the \", _jsx(_components.code, {\n              children: \"getStaticProps\"\n            }), \" method on next.js pages\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Stripping off unnecessary stuff from blog-starter-typescript\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"blog-starter-typescript\"\n        }), \" template has many tiny components, I removed some\\nof them to make it easier for me to orient myself\"]\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: _jsx(_components.a, {\n            href: \"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript/components\",\n            children: \"theirs\"\n          })\n        }), \"\\n\", _jsx(_components.li, {\n          children: _jsx(_components.a, {\n            href: \"https://github.com/cmdcolin/cmdcolin.github.io/tree/master/components\",\n            children: \"mine\"\n          })\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Removing tailwind CSS\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"blog-starter-typescript\"\n        }), \" template uses tailwind CSS and uses \\\"modern web design\\\" (aka:\\ngigantic \\\"tiles\\\" instead of links, images that are way too large, etc)\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I started making a more basic design. I tried to roll with the tailwind CSS for\\na bit, but ended up removing it entirely.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Tailwind CSS is sort of like a CSS-in-JS system, except every CSS attribute is encoded in a CSS classname. For example, here are some tailwind CSS snippets\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-html\",\n          children: \"\u003cdiv className=\\\"container mx-auto px-5\\\"\u003e\u003c/div\u003e\\n\u003cfooter className=\\\"bg-accent-1 border-t border-accent-2\\\"\u003e\u003c/footer\u003e\\n\u003cdiv className=\\\"max-w-1xl mx-auto\\\"\u003e\u003c/div\u003e\\n\u003cdiv className=\\\"min-h-screen\\\"\u003e\u003c/div\u003e\\n\u003ca className=\\\"hover:underline\\\"\u003e\u003c/a\u003e\\n\u003ch1\\n  className=\\\"text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left\\\"\\n\u003e\u003c/h1\u003e\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"They claim this is better than using external CSS (see comparison here\\nhttps://tailwindcss.com/docs/utility-first) but it is yet another language to\\nlearn, and kind of tricky.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"But, the reason I gave up with tailwind is actually because tailwind CSS resets\\na lot of HTML styles so things like \", _jsx(_components.code, {\n          children: \"\u003ch1\u003e\"\n        }), \", \", _jsx(_components.code, {\n          children: \"\u003ch2\u003e\"\n        }), \", \", _jsx(_components.code, {\n          children: \"\u003cul\u003e\"\n        }), \", \", _jsx(_components.code, {\n          children: \"\u003cli\u003e\"\n        }), \", \", _jsx(_components.code, {\n          children: \"\u003ca\u003e\"\n        }), \" have\\nno styling at all. This is done by \", _jsx(_components.code, {\n          children: \"tailwind preflight\"\n        }), \"\\nhttps://tailwindcss.com/docs/preflight (which you can disable, but it is\\nenabled by default)\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Stackoverflow has some ways to help restore styling and keep preflight, but it\\nstill struck me as odd. Examples\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: _jsxs(_components.a, {\n              href: \"https://stackoverflow.com/a/68853223/2129219\",\n              children: [\"Example: you have to manually restore underlines on \", _jsx(_components.code, {\n                children: \"\u003ca\u003e\"\n              }), \" elements if using tailwind XSS\"]\n            })\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: _jsx(_components.a, {\n              href: \"https://stackoverflow.com/questions/69264976/cant-display-markdown-on-nextjs\",\n              children: \"Another example: \\\"It looks like you're using TailwindCSS, the default\\nstyles for elements are reset, that's why the h1 text will look like any other\\ntext.\\\"\"\n            })\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"\\n\", _jsx(_components.p, {\n            children: _jsxs(_components.a, {\n              href: \"https://raw.githubusercontent.com/vercel/next.js/canary/examples/blog-starter-typescript/components/markdown-styles.module.css\",\n              children: [\"Another example \", _jsx(_components.code, {\n                children: \"blog-template-typescript\"\n              }), \" uses this file to try to style\\nthe markdown using some general\\nstyles\"]\n            })\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"To me it was surprising the extend that tailwind goes to unstyle the default\\nbrowser styles, removing \\\"idiomatic HTML\\\" styles, so I removed tailwind for\\nnow. Perhaps I'll return to it another time\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Using MDX for blogposts in next.js\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"In the template from next.js team, the \", _jsx(_components.code, {\n          children: \"blog-template-typescript\"\n        }), \", it uses a\\nfairly simple \", _jsx(_components.code, {\n          children: \"lib/markdownToHtml.ts\"\n        }), \" function right in the\\n\", _jsx(_components.code, {\n          children: \"pages/posts/[slug].tsx\"\n        }), \" file (the markdown is statically pre-rendered in the\\ntrue static blog sense, using the getStaticProps function). This is,\\nunfortunately, over-simplified for the MDX case, because MDX properly needs to\\nhydrate the components using react on the client side also\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"To fix, the module https://github.com/hashicorp/next-mdx-remote offers a way to\\nload actual MDX files.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Adding syntax highlighting the next.js code snippets\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"There are a couple results from google about how to add syntax highlighting to\\nnext.js but I still found it difficult.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"My method ended up a bit different where I manually included the prism JS and\\nCSS from a CDN essentially and it worked\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Other methods e.g. adding react-prism in next.config.js (like\\nhttps://github.com/mikeesto/next-mdx-prism-example does) I think clashed with\\nMDXRemote perhaps, or maybe I was tussling with tailwind CSS too much to make a\\nclear thought out of it, but syntax blocks on my blogposts should now be\\nproperly highlighted\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"RSS feed\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"I also followed this great guide to add a RSS file for next.js\\nhttps://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Link here, for your feed readers\\nhttps://cmdcolin.github.io/rss.xml\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Not many people may use RSS much anymore, but I do use it (via feedly), and I\\nlove music blogs that keep posting on blogspot year after year, and the\\noccasional programming post is nice too\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-12-26-nextjs"},"buildId":"LZcb5RDWtLylaGTwO6fbM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>