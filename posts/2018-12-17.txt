0:[[["",{"children":["posts",{"children":[["id","2018-12-17","d"],{"children":["__PAGE__?{\"id\":\"2018-12-17\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
3:I{"id":"3619","name":"","chunks":["619:619-d3e80a47715091a2","931:app/page-59752a1737368847"],"async":false}
4:I{"id":"1300","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
5:I{"id":"6022","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
1:[["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L3",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2018-12-17","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$L6","$@7"],"segment":"__PAGE__?{\"id\":\"2018-12-17\"}"}}],"segment":["id","2018-12-17","d"]}}],"segment":"posts"}}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L3",null,{"href":"/","children":"Home"}]," ",["$","$L3",null,{"href":"/archive","children":"Blog archive"}]," ",["$","$L3",null,{"href":"https://github.com/cmdcolin/","children":"Github"}]," ",["$","$L3",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}]," ",["$","$L3",null,{"href":"/projects","children":"Projects"}]," ",["$","$L3",null,{"href":"/photos","children":"Photos"}]," ",["$","$L3",null,{"href":"/rss.xml","children":"RSS"}]," ",["$","$L3",null,{"href":"/about","children":"About"}]]}]]}]}],"$@8"]
7:[null,null,[]]
8:[null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97dc5fe527f5d592.css","precedence":"next.js"}]]]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"Behind the release - the story of the bugs and features in JBrowse 1.16.0"}],["$","meta",null,{"name":"description","content":"A blog"}],null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
9:I{"id":"3591","name":"","chunks":["722:app/posts/[id]/page-cb4a6e559310dd46"],"async":false}
6:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Behind the release - the story of the bugs and features in JBrowse 1.16.0"}],["$","h4",null,{"children":"2018-12-17"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"<p>Every once in awhile, you might see that your favorite program, JBrowse, has a\nnew release. There are a ton of little snippets in the release notes, you might\nas well just go ahead and upgrade, but what went into all those little fixes?\nGoing to the blog post has links to the github issues,\n<a href=\"http://jbrowse.org/blog/2018/12/13/jbrowse-1-16-0.html\">http://jbrowse.org/blog/2018/12/13/jbrowse-1-16-0.html</a> but I felt like maybe I'd\nadd a little more context for some of them:</p>\n<p>PS This is sort of motivated by @zcbenz blog on Electron\n(<a href=\"https://twitter.com/zcbenz\">https://twitter.com/zcbenz</a> <a href=\"http://cheng.guru/\">http://cheng.guru/</a>) which tells the software in\nterms of actual commit messages and such.</p>\n<ul>\n<li>\n<p>The <code>webpack</code> build doing a production build by default. This seems pretty\nstraightforward, but was also difficult because I use WSL and the UglifyJs\nplugin had trouble on WSL using the parallel: 4 option to use multiple\nprocessors. This was really annoying and resulted in the webpack build just\nhanging for no reason and only careful google-fu really uncovered other people\nhaving this issue. I removed the parallelism as the speed gain wasn't even\nreally justifiable <a href=\"https://github.com/gmod/jbrowse/pull/1223\">https://github.com/gmod/jbrowse/pull/1223</a></p>\n</li>\n<li>\n<p>The incorporation of the <code>@gmod/bam</code> module. This was an almost 2 months\nprocess after my first module, <code>@gmod/indexedfasta</code>. It required really\ngetting down to the binary level for BAM and was pretty tough. The module has\nalready itself had 12 releases\n<a href=\"https://github.com/GMOD/bam-js/blob/master/CHANGELOG.md\">here</a></p>\n</li>\n<li>\n<p>Added support for indexing arbitrary fields from GFF3Tabix files. This was\nfairly straightforward but required making design decisions about this.\nPreviously flatfile-to-json.pl files would have a command line flag to index\narbitrary fields. Since gff3tabix files are specified via config, I allowed\nspecifying arbitrary fields via config.</p>\n</li>\n<li>\n<p>Added ability to render non-coding transcript types to the default Gene glyph.\nThis one was a nice feature and enables you to see non-coding types, but\nrequired some weird design decisions because I could not override the\n<code>box->style->color</code> from a higher level type simply using the <code>_defaultConfig</code>\nfunction, so I needed to override the <code>getStyle</code> callback that was passed down\nto the lower levels, so that it was able to use the default lower level style\nand also our non-coding transcript style. See this part of the code for\ndetails\n<a href=\"https://github.com/GMOD/jbrowse/commit/ec638ea1cc62c8727#diff-a14e88322d8f4e8e940f995417277878R22\">https://github.com/GMOD/jbrowse/commit/ec638ea1cc62c8727#diff-a14e88322d8f4e8e940f995417277878R22</a></p>\n</li>\n<li>\n<p>Added <code>hideImproperPairs</code> filter. This was fairly straightforward but it is\none of these bugs that went unnoticed for years...the <code>hideMissingMatepairs</code>\nflag would hide things didn't have the sam 0x02 flag for \"read mapped in\nproper pair\", but reads with this flag could still be paired. Doing the 1.16\nrelease that focused on paired reads helped focus on this issue and now\nhideMissingMatepairs filters on \"mate unmapped\" and <code>hideImproperPairs</code> is the\n\"read mapped in proper pair\"</p>\n</li>\n<li>\n<p>Added <code>useTS</code> flag. This one is fairly straightforward, it is similar to\n<code>useXS</code> which colors reads based on their alignment in canonical splice site\norientations. I figured I could just copy the <code>useXS</code> to the <code>useTS</code> since I\nfigured they are the same, but I went ahead and manually generated RNA-seq\nalignments with minimap2 and found that the useTS is actually flipped the\nopposite of <code>useXS</code>, so it was valuable to get actual test data here.</p>\n</li>\n<li>\n<p>Fixed issue where some <code>generate-names</code> setups would fail to index features.\nThis was a bad bug that was brought to light by a user. I was kind of mind\nboggled when I saw it. In JBrowse 1.13-JBrowse 1.15 a change was introduced to\nname indexing with a memory leak. In JBrowse 1.15 that was removed. But, there\nwas another change where refseqs could return empty name records, because they\nwere handled separately. But if the initial fill up of the name buffer of\n50000 was exceeded by the reference sequence, then there would be empty name\nrecords after this point and cause the name indexing to stop. Therefore this\nbug would only happen when the reference sequence indexing buffer exceeded\n50000 items which could happen even when there are less than 50000 refseqs due\nto autocompletions</p>\n</li>\n<li>\n<p>Fixed issue with getting feature density from BAM files via the index stats\nestimation. This involved parsing the \"dummy bin\" from index files, and I\nfound it was failing on certain 1000 genomes files. I actually don't really\nknow what the story behind this was, but our tabix code was better at parsing\nthe dummy bins than my bam code, and it was the same concept, so I took a note\nfrom their codebase to use it in bam-js code. Commit here\n<a href=\"https://github.com/GMOD/bam-js/commit/d5796dfc8750378ac8b875615ae0a7e81371af76\">https://github.com/GMOD/bam-js/commit/d5796dfc8750378ac8b875615ae0a7e81371af76</a></p>\n</li>\n<li>\n<p>Fixed issue with some GFF3Tabix tracks having some inconsistent layout of\nfeatures. This is a persistently annoying fact in tabix files where we cannot\nreally get a unique ID of a feature based on it's file offset. Therefore this\ntakes the full crc32 of a line as it's unique ID.</p>\n</li>\n<li>\n<p>Fixed CRAM store not renaming reference sequences in the same way as other\nstores. This one was interesting because rbuels made a fix but it caused\nfeatures from one chromosome to show up on the wrong ones, so chr1 reads where\nshowing up on chrMT. This happened because it was falling back to the refseq\nindex if it chrMT wasn't in the embedded \"sam header\" in the CRAM file, but it\nshould only fallback to refseq index if there is not any embedded \"sam header\"\nin the CRAM file.</p>\n</li>\n<li>\n<p>Fixed bug where older browsers e.g. IE11 were not being properly supported via\nbabel. This was a absolutely terrible bug that I found over thanksgiving\nbreak. It was a regression from 1.15 branch of JBrowse. Previous versions from\n1.13 when webpack was up until 1.15 used <code>@babel/env</code>. It was changed to\nbabel-preset-2015 but it was not being run correctly. Then I found that even\nif I did get it running correctly, it was unable to properly babel-ify the\nlru-cache module because it used something called\n<code>Object.defineProperty('length', ...)</code> to change how the length property was\ninterpreted which was illegal in IE11. The 'util.promisify' NPM module also\ndid this in some contexts. I found that I could use the quick-lru module and\nthe es6-promisify module instead of lru-cache and util.promisify as a\nworkaround. Then I had to update all <code>@gmod/tabix</code>, <code>@gmod/vcf</code>,\n<code>@gmod/bgzf-filehandle</code>, <code>@gmod/indexedfasta</code>, <code>@gmod/tribble-index</code>,\n<code>@gmod/bam</code>, and JBrowse proper to use these modules instead, and make the\nbabel chain, which typically does not parse node_modules, to build these\nmodules specifically (I didn't want to setup babel toolchains for every single\none of these modules, just one in the jbrowse main codebase...). This was\nreally a lot of work to support IE11 but now that works so ...ya</p>\n</li>\n<li>\n<p>Fixed bug where some files were not being fetched properly when changing\nrefseqs. This was actually fixed when I changed out lru-cache for quick-lru\nand fixed a bug where the cache size was set to 0 due to a erroneous comment\nthat said <code>50*1024 // 50MB</code>...of course it should have said\n<code>50*1024*1024 // 50MB</code> <a href=\"https://github.com/GMOD/jbrowse/commit/2025dc0aa0091b70\">https://github.com/GMOD/jbrowse/commit/2025dc0aa0091b70</a></p>\n</li>\n<li>\n<p>Fixed issue where JBrowse would load the wrong area of the refseq on startup\nresulting in bad layouts and excessive data fetches. This was actually a\nheinous bug where jbrowse upon loading would just navigateTo the start of the\nreference sequence automatically and then to wherever was specified by the\nuser. This resulted in track data to start downloading immediately from the\nstart of the chromosome and resulted in for example 350 kilobases of reference\nsequence from all tracks to start downloading, which when I was implementing\nview as pairs, was causing me to download over 100MB routinely. This was\nterrible, and after fixing I only download about 10MB over even large regions\nfor most BAM files. Additionally, this bug was causing the track heights to be\ncalculated incorrectly because the track heights would actually be calculated\nbased on distorted canvas bitmaps. <a href=\"https://github.com/gmod/jbrowse/issues/1187\">https://github.com/gmod/jbrowse/issues/1187</a></p>\n</li>\n<li>\n<p>JBrowse Desktop was not fetching remote files. This was a weird issue where\nremote file requests were considered a CORS requests to any external remote.\nThis was solved by changing the usage of the fetch API in JBrowse for\nnode-fetch which does not obey CORS. Note that electron-fetch was also\nconsidered, which uses Chromiums network stack instead of node's, but that had\nspecific assumptions about the context in which it was called.</p>\n</li>\n<li>\n<p>Fixed issue where some parts of a CRAM file would not be displayed in JBrowse\ndue to a CRAM index parsing issue. This was based on a sort of binary search\nthat was implemented in JBrowse where the elements of the lists were\nnon-overlapping regions, and the query was a region, and the output should be\na list of the non-overlapping regions that overlap the query. Most algorithms\nfor binary search don't really tell you how to do searches on ranges so needed\nto roll up my sleeves and write a little custom code. An interval tree could\nhave been used but this is too heavy-weight for non-overlapping regions from\nthe index <a href=\"https://github.com/GMOD/cram-js/pull/10\">https://github.com/GMOD/cram-js/pull/10</a></p>\n</li>\n<li>\n<p>Fixed an issue where BAM features were not lazily evaluating their tags. When\na function <code>feature.get('blahblah')</code> is called on a BAM feature, it checks to\nsee if it's part of a default list of things that are parsed like feature\nstart, end, id, but if not, it has to parse all the BAM tags to see if it is a\ntag. Since they are called \"lazy features\" the tag processing is deferred\nuntil it is absolutely needed. As it turned out, the incorporation of CRAM in\n1.15 was calling a function to try to get the CRAM's version of CIGAR/MD on\nthe BAM features unnecessarily invoking the tag parsing on every feature up\nfront and therefore making the feature not really lazy anymore. This restored\nthe \"laziness\" aspect of BAM.</p>\n</li>\n<li>\n<p>Fixed issue where CRAM layout and mouseover would be glitchy due to ID\ncollisions on features. In the 1.15 releases, CRAM was introduced, and we\nthought that the concept of taking CRC32 of the entire feature data days were\nover because there is the concept of a \"unique ID\" on the features. However,\nthis ID was only unique within the slices, so around the slice boundaries\nthere were a lot of bad feature layouts and mouseovers would fail because they\nwould map to multiple features, etc. I found a way to unique-ify this by\ngiving it the sliceHeader file offset. <a href=\"https://github.com/GMOD/cram-js/pull/10\">https://github.com/GMOD/cram-js/pull/10</a></p>\n</li>\n<li>\n<p>We also had behind the scenes work by igv.js team member jrobinso who helped\non the CRAM codebase to incorporate a feature where for lossy read names, so\nthat a read and it's mate pair would consistently be assigned the same read\nname based on the unique ID mentioned above. There was also a rare issue where\nsometimes the mate pair's orientation was incorrectly reported based on the\nCRAM flags, but the embedded BAM flags correctly reported it.</p>\n</li>\n<li>\n<p>Finally the paired reads feature. This was a feature that I really wanted to\nget right. It started when garrett and rbuels were going to san diego for the\nCIVIC hackathon, and we talked about doing something that matched a \"variant\nreview system\" that they had done for the IGV codebase, which involved\ndetailed inspection of reads. I thought it would probably be feasible for\njbrowse to do this, but I thought essentially at some point that enhancing\njbrowse's read visualizations with paired reads would be a big win. I had\nthought about this at the JBrowse hackathon also and my discussions then were\nthat this was very hard. Overall, I invented a compromise that I thought was\nreasonable which was that there can be a \"maxInsertSize\" for the pileup view\nbeyond which the pairing wouldn't be resolved. This allowed (a) a significant\nreduction in data fetches because I implemented a \"read redispatcher\" that\nwould actually literally resolve the read pairs in the separate chunks and (b)\na cleaner view because the layout wouldn't be polluted by very long read\ninserts all the time and also, for example, if you scrolled to the right, and\nsuddenly a read was paired to the left side of your view, it would result in a\nbad layout (but with max insert size, the window of all reads within\nmaxinsertsize are always resolved so this does not happen) and finally ( c)\nthe paired arc view was incorporated which does not use read redispatching and\nwhich can do very long reads. All of these things took time to think through\nand resolve, but it is now I think a pretty solid system and I look forward to\nuser feedback!</p>\n</li>\n</ul>"}}],["$","$L9",null,{}]]}]
