1:HL["/_next/static/css/97dc5fe527f5d592.css","style",{"crossOrigin":""}]
0:["eb2v3byYftPamgm7GueHa",[[["",{"children":["posts",{"children":[["id","2023-04-08-nextjs-appdir-blog","d"],{"children":["__PAGE__?{\"id\":\"2023-04-08-nextjs-appdir-blog\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97dc5fe527f5d592.css","precedence":"next","crossOrigin":""}]],"$L3"]]]]
4:I[8326,["326","static/chunks/326-f70436363102ecf4.js","931","static/chunks/app/page-0c1302a539e2db94.js"],""]
5:I[6954,[],""]
6:I[7264,[],""]
2:[null,["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L4",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2023-04-08-nextjs-appdir-blog","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L7","$L8",null],"segment":"__PAGE__?{\"id\":\"2023-04-08-nextjs-appdir-blog\"}"},"styles":null}],"segment":["id","2023-04-08-nextjs-appdir-blog","d"]},"styles":null}],"segment":"posts"},"styles":null}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L4",null,{"href":"/","children":"Home"}],["$","$L4",null,{"href":"/archive","children":"Blog archive"}],["$","$L4",null,{"href":"https://github.com/cmdcolin/","children":"Github"}],["$","$L4",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}],["$","$L4",null,{"href":"/projects","children":"Projects"}]," ",["$","$L4",null,{"href":"/photos","children":"Photos"}],["$","$L4",null,{"href":"/books","children":"Books"}],["$","$L4",null,{"href":"/about","children":"About"}]]}]]}]}],null]
a:I[5854,["722","static/chunks/app/posts/%5Bid%5D/page-64ff32a4d1c61109.js"],""]
9:Tf24b,<p>I just converted my blog to use the Next.js 'app' directory, and thought I'd
show how you can make your own static site with it. Static export of the Next.js
'app' directory was added in version 13.3
<a href="https://nextjs.org/blog/next-13-3#static-export-for-app-router">https://nextjs.org/blog/next-13-3#static-export-for-app-router</a></p>
<h2 id="tldr"><a aria-hidden="true" tabindex="-1" href="#tldr"><a href="#tldr" style="margin-right: 10px">#</a></a>TL;DR</h2>
<p>See here</p>
<p><a href="https://github.com/cmdcolin/next13-appdir-blog">https://github.com/cmdcolin/next13-appdir-blog</a></p>
<p>If you take nothing else away from this article, let it be that</p>
<ul>
<li>
<p>The 'app' dir, with react server components, can be used to create static
websites</p>
</li>
<li>
<p>That react server components can be just like, async function components. It's
quite interesting</p>
</li>
</ul>
<p>The exact step-by-step here is probably unnecessary but just trying to show the
raw basics</p>
<h2 id="step-1-run-create-next-app"><a aria-hidden="true" tabindex="-1" href="#step-1-run-create-next-app"><a href="#step-1-run-create-next-app" style="margin-right: 10px">#</a></a>Step 1. Run create-next-app</h2>
<p>I accepted all defaults but added "YES" to the use experimental app directory</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color: #91B4D5">$</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">npx</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">create-next-app</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">myblog</span></span>
<span class="line"><span style="color: #91B4D5">✔</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Would</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">you</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">like</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">to</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">use</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">TypeScript</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">with</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">this</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">project?</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">…</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">No</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">/</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">YES</span></span>
<span class="line"><span style="color: #91B4D5">✔</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Would</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">you</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">like</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">to</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">use</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">ESLint</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">with</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">this</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">project?</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">…</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">No</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">/</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">YES</span></span>
<span class="line"><span style="color: #91B4D5">✔</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Would</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">you</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">like</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">to</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">use</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`</span><span style="color: #91B4D5">src/</span><span style="color: #A6ACCD">`</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">directory</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">with</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">this</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">project?</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">…</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">NO</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">/</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Yes</span></span>
<span class="line"><span style="color: #91B4D5">✔</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Would</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">you</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">like</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">to</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">use</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">experimental</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`</span><span style="color: #91B4D5">app/</span><span style="color: #A6ACCD">`</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">directory</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">with</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">this</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">project?</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">…</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">No</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">/</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">YES</span></span>
<span class="line"><span style="color: #91B4D5">✔</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">What</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">import</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">alias</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">would</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">you</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">like</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">configured?</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">…</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">@/</span><span style="color: #ADD7FF; font-style: italic">*</span></span>
<span class="line"><span style="color: #91B4D5">Creating</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">a</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Next.js</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">app</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">in</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">/home/cdiesh/myblog.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">Using</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">npm.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">Initializing</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">project</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">with</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">template:</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">app</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">Installing</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">dependencies:</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">react</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">react-dom</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">next</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">typescript</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">@types/react</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">@types/node</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">@types/react-dom</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">eslint</span></span>
<span class="line"><span style="color: #91B4D5">-</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">eslint-config-next</span></span></code></pre>
<h2 id="step-2-edit-nextconfigjs"><a aria-hidden="true" tabindex="-1" href="#step-2-edit-nextconfigjs"><a href="#step-2-edit-nextconfigjs" style="margin-right: 10px">#</a></a>Step 2. Edit next.config.js</h2>
<p>Add 'output': 'export' to the next.config.js file</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #767C9DB0; font-style: italic">/** </span><span style="color: #A6ACCD; font-style: italic">@</span><span style="color: #91B4D5; font-style: italic">type</span><span style="color: #767C9DB0; font-style: italic"> </span><span style="color: #A6ACCD; font-style: italic">{</span><span style="color: #A6ACCDC0; font-style: italic">import('next').NextConfig</span><span style="color: #A6ACCD; font-style: italic">}</span><span style="color: #767C9DB0; font-style: italic"> */</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">nextConfig</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">experimental</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">appDir</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">output</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">module</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">exports</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">nextConfig</span></span></code></pre>
<h2 id="step-3-create-the-page-that-will-display-your-posts"><a aria-hidden="true" tabindex="-1" href="#step-3-create-the-page-that-will-display-your-posts"><a href="#step-3-create-the-page-that-will-display-your-posts" style="margin-right: 10px">#</a></a>Step 3. Create the page that will display your posts</h2>
<p>Create a new directory like this on the command line, yes there are square
brackets in the directory name</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">mkdir</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">-p</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">app/posts/</span><span style="color: #5FB3A1">\[</span><span style="color: #ADD7FF">id</span><span style="color: #5FB3A1">\]</span><span style="color: #ADD7FF">/</span></span></code></pre>
<p>Then make a file page.tsx in there so it is 'app/posts/[id]/page.tsx'</p>
<p>Then on this page, fill in with this</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">getPostById</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">getAllPosts</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">@/lib/api</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Generate the post, note that this is a "react server component"! it is</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// allowed to be async</span></span>
<span class="line"><span style="color: #5DE4C7">export default async </span><span style="color: #91B4D5">function</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">Post</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #5DE4C7">  params</span><span style="color: #A6ACCD">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">id</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #A6ACCD">}</span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">  params</span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> id</span><span style="color: #91B4D5">:</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCDC0">string</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">})</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">html</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">title</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">date</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">getPostById</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #E4F0FB">&#x3C;</span><span style="color: #5DE4C7">article</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">h1</span><span style="color: #E4F0FB">>{title}&#x3C;/</span><span style="color: #5DE4C7">h1</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">h4</span><span style="color: #E4F0FB">>{date}&#x3C;/</span><span style="color: #5DE4C7">h4</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">div</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">dangerouslySetInnerHTML</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">__html</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">html</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">} /></span></span>
<span class="line"><span style="color: #E4F0FB">    &#x3C;/</span><span style="color: #5DE4C7">article</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// This function can statically allow nextjs to find all the posts that you</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// have made, and statically generate them</span></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">generateStaticParams</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">posts</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getAllPosts</span><span style="color: #A6ACCD">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">posts</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">map</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">post</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> ({</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">id</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">post</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">}))</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Set the title of the page to be the post title, note that we no longer use</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// e.g. next/head in app dir, and this can be async just like the server</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// component</span></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">generateMetadata</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #A6ACCD">  params: { </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD"> },</span></span>
<span class="line"><span style="color: #A6ACCD">}</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  params</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> { id</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">string</span><span style="color: #A6ACCD"> }</span></span>
<span class="line"><span style="color: #A6ACCD">}) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">title</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getPostById</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">    title</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<h2 id="step-4-fix-the-cart-being-ahead-of-the-horse-parse-the-markdown-blogposts"><a aria-hidden="true" tabindex="-1" href="#step-4-fix-the-cart-being-ahead-of-the-horse-parse-the-markdown-blogposts"><a href="#step-4-fix-the-cart-being-ahead-of-the-horse-parse-the-markdown-blogposts" style="margin-right: 10px">#</a></a>Step 4. Fix the cart being ahead of the horse: parse the markdown blogposts</h2>
<p>In the last post, I use functions "getAllPosts" and "getPostById", these are
functions that I define that parse my markdown blog posts.</p>
<p>So let's make those functions. The code below performs markdown parsing manually
using unified/remark/rehype and allows github flavored markdown. See Footnote 1
for more info. So first install these</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">npm</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">install</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">gray-matter</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">unified</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">remark-gfm</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">remark-parse</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">remark-rehype</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">rehype-stringify</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">rehype-autolink-headings</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">rehype-slug</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">@leafac/rehype-shiki</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">shiki</span></span></code></pre>
<p>And then, add this code</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #767C9DB0; font-style: italic">// lib/api.ts</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">fs</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">fs</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">matter</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">gray-matter</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">join</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">path</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">unified</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">unified</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">remarkGfm</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">remark-gfm</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">rehypeSlug</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">rehype-slug</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">rehypeAutolinkHeadings</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">rehype-autolink-headings</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">remarkParse</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">remark-parse</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">remarkRehype</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">remark-rehype</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">rehypeStringify</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">rehype-stringify</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">rehypeShiki</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">@leafac/rehype-shiki</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import * </span><span style="color: #A6ACCDC0">as</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">shiki</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">shiki</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// memoize/cache the creation of the markdown parser, this sped up the</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// building of the blog from ~60s->~10s</span></span>
<span class="line"><span style="color: #91B4D5">let</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">p</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">ReturnType</span><span style="color: #A6ACCD">&#x3C;</span><span style="color: #91B4D5">typeof</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">getParserPre</span><span style="color: #A6ACCD">> </span><span style="color: #91B4D5">|</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getParserPre</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">unified</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">remarkParse</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">remarkRehype</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">remarkGfm</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">rehypeShiki</span><span style="color: #A6ACCD">, {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">highlighter</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">shiki</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">getHighlighter</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">theme</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">poimandres</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">})</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">rehypeStringify</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">rehypeSlug</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    .</span><span style="color: #E4F0FBD0">use</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">rehypeAutolinkHeadings</span><span style="color: #A6ACCD">, {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">content</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">arg</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">=></span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">type</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">element</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">tagName</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">a</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">properties</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #ADD7FF">href</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">#</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #91B4D5">+</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">arg</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">properties</span><span style="color: #A6ACCD">?.</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #ADD7FF">style</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">margin-right: 10px</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">children</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">[{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">type</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">text</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">value</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">#</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}],</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">}),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">})</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getParser</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  if (</span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">p</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">p</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getParserPre</span><span style="color: #A6ACCD">().</span><span style="color: #E4F0FBD0">catch</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #E4F0FB">p</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #D0679D">undefined</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #D0679D">throw</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">e</span></span>
<span class="line"><span style="color: #A6ACCD">    })</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">p</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getPostById</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">string</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">realId</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">replace</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">/</span><span style="color: #5FB3A1">\.md</span><span style="color: #A6ACCD">$/</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">''</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">fullPath</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">join</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">_posts</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">realId</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">.md</span><span style="color: #A6ACCD">`</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">content</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">matter</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">fs</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">promises</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">readFile</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">fullPath</span><span style="color: #A6ACCD">, </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">utf8</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">parser</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getParser</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">html</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">parser</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">process</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">content</span><span style="color: #A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #91B4D5">...</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">title</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">title</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">id</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">realId</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">date</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD">?.</span><span style="color: #E4F0FBD0">toISOString</span><span style="color: #A6ACCD">().</span><span style="color: #E4F0FBD0">slice</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">,</span><span style="color: #5DE4C7"> 10</span><span style="color: #A6ACCD">)</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">html</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">html</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">toString</span><span style="color: #A6ACCD">(),</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getAllPosts</span><span style="color: #A6ACCD">() {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">posts</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">all</span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">fs</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">readdirSync</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">_posts</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">map</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getPostById</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">)),</span></span>
<span class="line"><span style="color: #A6ACCD">  )</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">posts</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">sort</span><span style="color: #A6ACCD">((</span><span style="color: #E4F0FB">post1</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">post2</span><span style="color: #A6ACCD">) </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">post1</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">></span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">post2</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">?</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">-</span><span style="color: #5DE4C7">1</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">1</span><span style="color: #A6ACCD">))</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<h2 id="step-5-create-a-blog-index-showing-all-your-blogposts"><a aria-hidden="true" tabindex="-1" href="#step-5-create-a-blog-index-showing-all-your-blogposts"><a href="#step-5-create-a-blog-index-showing-all-your-blogposts" style="margin-right: 10px">#</a></a>Step 5. Create a 'blog index' showing all your blogposts</h2>
<p>Edit the <code>app/page.tsx</code> file, and replace with the below: this is the root of
your site</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #767C9DB0; font-style: italic">// app/page.tsx</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #ADD7FF">Link</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">next/link</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #5DE4C7">import </span><span style="color: #A6ACCD">{</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">getAllPosts</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">from</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">@/lib/api</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">export default async </span><span style="color: #91B4D5">function</span><span style="color: #5DE4C7"> </span><span style="color: #ADD7FF">Page</span><span style="color: #A6ACCD">()</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #91B4D5">const</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FB">posts</span><span style="color: #5DE4C7"> </span><span style="color: #91B4D5">=</span><span style="color: #5DE4C7"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #5DE4C7"> </span><span style="color: #E4F0FBD0">getAllPosts</span><span style="color: #A6ACCD">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #5DE4C7">    </span><span style="color: #E4F0FB">&#x3C;</span><span style="color: #5DE4C7">div</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">h1</span><span style="color: #E4F0FB">>My blog&#x3C;/</span><span style="color: #5DE4C7">h1</span><span style="color: #E4F0FB">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">h2</span><span style="color: #E4F0FB">>All posts:&#x3C;/</span><span style="color: #5DE4C7">h2</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">ul</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        {posts</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">map</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">post </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5">const</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> id</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> date</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> title </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> post</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #5DE4C7C0">return</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">            &#x3C;</span><span style="color: #5DE4C7">li</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">key</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{id}></span></span>
<span class="line"><span style="color: #E4F0FB">              &#x3C;</span><span style="color: #5DE4C7">Link</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">href</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #A6ACCD">`</span><span style="color: #5DE4C7">/posts/</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">id</span><span style="color: #A6ACCD">}`</span><span style="color: #E4F0FB">}></span></span>
<span class="line"><span style="color: #E4F0FB">                {date} - {title}</span></span>
<span class="line"><span style="color: #E4F0FB">              &#x3C;/</span><span style="color: #5DE4C7">Link</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">            &#x3C;/</span><span style="color: #5DE4C7">li</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">})</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;/</span><span style="color: #5DE4C7">ul</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">    &#x3C;/</span><span style="color: #5DE4C7">div</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #5DE4C7">  </span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<h2 id="step-6-put-markdown-files-in-the-_posts-dir"><a aria-hidden="true" tabindex="-1" href="#step-6-put-markdown-files-in-the-_posts-dir"><a href="#step-6-put-markdown-files-in-the-_posts-dir" style="margin-right: 10px">#</a></a>Step 6. Put markdown files in the <code>_posts</code> dir</h2>
<p>Example</p>
<p>_posts/2023-04-08-first-post.md</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FB">---</span></span>
<span class="line"><span style="color: #5DE4C7">title</span><span style="color: #A6ACCD">:</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">First post</span></span>
<span class="line"><span style="color: #5DE4C7">date</span><span style="color: #A6ACCD">:</span><span style="color: #E4F0FB"> 2023-04-08</span></span>
<span class="line"><span style="color: #E4F0FB">---</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FBD0">Hello world!</span></span></code></pre>
<h2 id="step-7-deploy-to-github-pages"><a aria-hidden="true" tabindex="-1" href="#step-7-deploy-to-github-pages"><a href="#step-7-deploy-to-github-pages" style="margin-right: 10px">#</a></a>Step 7. Deploy to Github Pages</h2>
<p>Create your repo named <code>yourname.github.io</code> under yourname account</p>
<p>Then run</p>
<pre><code>npm install gh-pages
</code></pre>
<p>Then add a "predeploy" and "deploy" script to package.json</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">private</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">scripts</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">dev</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">next</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">build</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">next build</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">start</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">next dev</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">lint</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">next lint</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">predeploy</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">npm run build &#x26;&#x26; touch out/.nojekyll</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">deploy</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">gh-pages -d out -t true</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #A6ACCD">"</span><span style="color: #ADD7FF">postdeploy</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">git push --follow-tags</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #A6ACCD">  },</span></span>
<span class="line"><span style="color: #D0679D">...</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Then when you use <code>npm run deploy</code> it will build, push to github pages, and push
to the the regular content to the main branch too</p>
<h2 id="result"><a aria-hidden="true" tabindex="-1" href="#result"><a href="#result" style="margin-right: 10px">#</a></a>Result</h2>
<p>Source <a href="https://github.com/cmdcolin/next13-appdir-blog">https://github.com/cmdcolin/next13-appdir-blog</a></p>
<p>Deployed <a href="https://cmdcolin.github.io/next13-appdir-blog">https://cmdcolin.github.io/next13-appdir-blog</a></p>
<p>I manually added <code>basePath: "/next13-appdir-blog",</code> to <code>next.config.js</code> to
deploy it to that sub-URI, if you deploy without a sub-URI, you won't need this</p>
<h2 id="footnote-1-the-unifiedremarkrehype-stack"><a aria-hidden="true" tabindex="-1" href="#footnote-1-the-unifiedremarkrehype-stack"><a href="#footnote-1-the-unifiedremarkrehype-stack" style="margin-right: 10px">#</a></a>Footnote 1. The unified/remark/rehype stack</h2>
<p>I use the 'unified/remark/rehype' stack for parsing my blogpost markdown. My
unified/remark/rehype setup allows github flavored markdown (so e.g. links are
automatically converted to <code>&#x3C;a href></code>s) and code will be highlighted by
<a href="https://github.com/shikijs/shiki">https://github.com/shikijs/shiki</a> which I found did a pretty good job with e.g.
typescript (I look forward to maybe a treesitter powered coloring, if you find
this let me know)</p>
<h2 id="footnote-2-why-not-mdx"><a aria-hidden="true" tabindex="-1" href="#footnote-2-why-not-mdx"><a href="#footnote-2-why-not-mdx" style="margin-right: 10px">#</a></a>Footnote 2. Why not MDX?</h2>
<p>There may be some temptation to use things like MDX for your blog, and indeed, I
used MDX with my original blog setup with the <code>pages</code> directory
(<a href="https://cmdcolin.github.io/posts/2021-12-26-nextjs#using-mdx-for-blogposts-in-nextjs">https://cmdcolin.github.io/posts/2021-12-26-nextjs#using-mdx-for-blogposts-in-nextjs</a>)
but to me it is overkill and harder to understand. If it is desirable or needed
to use it for your setup, see
<a href="https://github.com/hashicorp/next-mdx-remote#react-server-components-rsc--nextjs-app-directory-support">https://github.com/hashicorp/next-mdx-remote#react-server-components-rsc--nextjs-app-directory-support</a></p>8:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Making a static site blog with the Next.js 'app' directory"}],["$","h4",null,{"children":"2023-04-08"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$9"}}],["$","$La",null,{}]]}]
3:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Making a static site blog with the Next.js 'app' directory"}],["$","meta","3",{"name":"description","content":"A blog"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"128x128"}]]
7:null
