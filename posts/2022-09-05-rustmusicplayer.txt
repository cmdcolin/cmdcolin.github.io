0:[[["",{"children":["posts",{"children":[["id","2022-09-05-rustmusicplayer","d"],{"children":["__PAGE__?{\"id\":\"2022-09-05-rustmusicplayer\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
3:I{"id":"3619","name":"","chunks":["619:619-d3e80a47715091a2","931:app/page-59752a1737368847"],"async":false}
4:I{"id":"1300","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
5:I{"id":"6022","name":"","chunks":["272:webpack-3224743bbfce757e","667:2443530c-7c83a1ec49cb3fce","961:961-0b7193e5f574b882"],"async":false}
1:[["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L3",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2022-09-05-rustmusicplayer","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L5",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$L6","$@7"],"segment":"__PAGE__?{\"id\":\"2022-09-05-rustmusicplayer\"}"}}],"segment":["id","2022-09-05-rustmusicplayer","d"]}}],"segment":"posts"}}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L3",null,{"href":"/","children":"Home"}]," ",["$","$L3",null,{"href":"/archive","children":"Blog archive"}]," ",["$","$L3",null,{"href":"https://github.com/cmdcolin/","children":"Github"}]," ",["$","$L3",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}]," ",["$","$L3",null,{"href":"/projects","children":"Projects"}]," ",["$","$L3",null,{"href":"/photos","children":"Photos"}]," ",["$","$L3",null,{"href":"/rss.xml","children":"RSS"}]," ",["$","$L3",null,{"href":"/about","children":"About"}]]}]]}]}],"$@8"]
9:I{"id":"3591","name":"","chunks":["722:app/posts/[id]/page-cb4a6e559310dd46"],"async":false}
7:[null,null,[]]
8:[null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97dc5fe527f5d592.css","precedence":"next.js"}]]]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"Creating a music player using Rust/GTK4 - fml9000"}],["$","meta",null,{"name":"description","content":"A blog"}],null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
6:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Creating a music player using Rust/GTK4 - fml9000"}],["$","h4",null,{"children":"2022-09-05"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"<p>I have started endeavoring to learn Rust. I did the rustlings exercises but I\nknew the concepts would fade rapidly from my brain without some practice. I have\nnow started making a music player using Rust+GTK4.</p>\n<p>I chose GTK4 to have a linux native GUI music player. Particularly, I have a\nparticular <code>foobar2000</code> setup that I wanted to emulate. I have used <code>foobar2000</code>\nunder wine (windows emulator on linux) and it's not terrible, but it has\nbackground CPU consumption of about 15% idle and doesn't feel quite right\nsometimes. I have used a variety of other linux music players such as\n<code>quodlibet</code> (GUI/GTK based) and <code>cmus</code> (command line) but they didn't really\nfeel quite right.</p>\n<h3 id=\"choosing-a-tech-stack\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#choosing-a-tech-stack\"><a href=\"#choosing-a-tech-stack\" style=\"margin-right: 10px\">#</a></a>Choosing a tech stack</h3>\n<p>I started by attempting with <code>Relm4</code>, which I may return to at some point, but\ntrying to juggle learning Relm4-style widgets, GTK, and rust all at once was a\nbit much. I stepped to using <code>gtk4-rs</code> directly.</p>\n<h3 id=\"create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\"><a href=\"#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\" style=\"margin-right: 10px\">#</a></a>Create a \"spreadsheet style\" data grid of tracks with <code>ColumnView</code></h3>\n<p>Then, I wanted to create a data grid showing to display e.g. a table with\nartist, track, album, etc. I chose to use the GTK\n<a href=\"https://docs.gtk.org/gtk4/class.ColumnView.html\"><code>ColumnView</code></a> to drive this. I\nstumbled around looking for example code, but there was none specifically for\nthe <code>ColumnView</code>. I also realized the <code>ListView</code> example from the <code>gtk4-rs</code>\nexamples with it's factory function had similar needs that the <code>ColumnView</code>.</p>\n<p>I found out that I basically needed to create a <code>ListStore</code>. I thought if I\ncould make my own <code>GObject</code> subclass, it would solve everything, but I had\ntrouble getting making this work (rust doesn't have the concept of extending a\nclass for one thing, you implement various traits instead). Finally, I randomly\nstumbled on this link using a <code>BoxedAnyObject</code> with a good example of storing\ndata in a ListStore\n<a href=\"https://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html\">https://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html</a></p>\n<p>The <code>BoxedAnyObject</code> is a <code>GObject</code>, so this was an good route to storing the\n<code>ListView</code> items. There was no example code for connecting the <code>ListStore</code> with\nthe <code>ColumnView</code>, so I stuggled for awhile before realizing that the <code>ListView</code>\nexample in the <code>gtk4-rs</code> codebase has similar concepts.</p>\n<p>See [1] for minimal usage of <code>ColumnView</code> that I contributed to the <code>gtk4-rs</code>\nrepo!</p>\n<h3 id=\"choosing-an-audio-library\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#choosing-an-audio-library\"><a href=\"#choosing-an-audio-library\" style=\"margin-right: 10px\">#</a></a>Choosing an audio library</h3>\n<p>To actually play audio, I looked at a couple options. There was even one option\ncalled GTK\n<a href=\"https://gtk-rs.org/gtk4-rs/git/docs/gtk4/struct.MediaFile.html\"><code>MediaFile</code></a>\nwhich should to be able to play e.g. mp3s, making my job of making a media\nplayer much simpler, but it produced an error\n<a href=\"https://www.google.com/search?q=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22&#x26;oq=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22&#x26;aqs=chrome..69i57.267j0j7&#x26;sourceid=chrome&#x26;ie=UTF-8\">\"GTK could not find a media module. Check your installation.\"</a>\nwhich had very few references on the internet. I figured this could be difficult\nto solve or point to issues I could face later on making minimal executables for\nusers.</p>\n<p>So, next I tried out <code>symphonia</code> (<a href=\"https://github.com/pdeljanov/Symphonia/\">https://github.com/pdeljanov/Symphonia/</a>).\nSymphonia requires a lot more code to work (~1000 lines so far, copying from the\n<code>symphonia-play</code> example) but it has broad file format support, pure-rust audio\nstack, etc. I got confused about how to package it into an easy-to-use system\nthough, having to create a symphonia player on a separate thread, so I looked\nelsewhere...</p>\n<p>Next I turned to <code>rodio</code>. This works well, and automatically plays on a separate\nthread, but I found two issues 1) I have to initialize the rodio player in \"fn\nmain\" and not anywhere else, or it would just play a short blip of audio\n(<a href=\"https://github.com/RustAudio/rodio/issues/381\">https://github.com/RustAudio/rodio/issues/381</a>). Then, it turned out that the\n<code>rodio</code>\n<a href=\"https://docs.rs/rodio/0.14.0/rodio/struct.Sink.html#method.stop\"><code>Sink</code></a>\ninstance (which you pass audio to) cannot stop and then play new song xref\n(<a href=\"https://github.com/RustAudio/rodio/issues/315\">https://github.com/RustAudio/rodio/issues/315</a>). To workaround, I replace it\nwith a new <code>Sink</code>.</p>\n<p>This required me to learn about <code>RefCell</code>. I googled probably about 50 things\njust grasping at straws for awhile, but then landed on the solution of putting\nthe <code>Sink</code> in a <code>Rc&#x3C;RefCell&#x3C;Sink>></code>, then that allows me to pass it into my\ncallback that handles double clicking the songs in the <code>ColumnView</code>, and then I\nborrow the <code>RefCell</code> mutably to replace it with a new <code>Sink</code>.</p>\n<h3 id=\"reading-audio-metadata-into-an-sqlite-db\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#reading-audio-metadata-into-an-sqlite-db\"><a href=\"#reading-audio-metadata-into-an-sqlite-db\" style=\"margin-right: 10px\">#</a></a>Reading audio metadata into an <code>sqlite</code> DB</h3>\n<p>I also wanted to have the option of reading and writing audio metadata.\nSymphonia only reads metadata, so I found the <code>lofty</code> crate.</p>\n<p>I also realized that reading tens of thousands of file's metadata at each app\nstartup would be slow, so I endeavored to store that data in an <code>sqlite</code>\ndatabase. I found that music players like <code>foobar2000</code> and <code>0xdeadbeef</code> have\ndatabases of track metadata also (Example folder on <code>foobar2000</code> (1.x) for this\nsnap/foobar2000/433/foobar2000/profile/library/74E45640B1C695CC/meta-0001,\nmeta-0002, etc.)</p>\n<p>I used the <code>walkdir</code> crate to walk a directory for files, <code>lofty</code> to read the\nmetadata, and then finally inserted the data into the <code>sqlite</code> db. I am still\nworking out the schema for the database but it provisionally associates data\nwith a primary key of filename.</p>\n<h3 id=\"learning-about-reference-counting-and-move-semantics\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#learning-about-reference-counting-and-move-semantics\"><a href=\"#learning-about-reference-counting-and-move-semantics\" style=\"margin-right: 10px\">#</a></a>Learning about reference counting and move semantics</h3>\n<p>Originally I queried the sqlite database and stored a <code>Vec&#x3C;Track></code>, where\n<code>Track</code> is a struct with artist, album, song title, etc. I realized that this\ncauses issues passing this around to different functions, and storing them in\nthe <code>BoxedAnyObject</code>, (example thread discussing issue\n<a href=\"https://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust\">https://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust</a>)\nso I changed functions to accept slices of the Vec, and to make it a\n<code>Vec&#x3C;Rc&#x3C;Track>></code> instead of just <code>Vec&#x3C;Track></code> (another related thread\n<a href=\"https://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3\">https://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3</a>).</p>\n<h3 id=\"result\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#result\"><a href=\"#result\" style=\"margin-right: 10px\">#</a></a>Result</h3>\n<p>The current work is at <a href=\"https://github.com/cmdcolin/fml9000\">https://github.com/cmdcolin/fml9000</a></p>\n<p><img src=\"/media/fml9000_1.png\" alt=\"\"></p>\n<p>Screenshot shows the current look and feel. Some stuff in the screenshot is\nmocked and not fully functional, but it has been a great learning experience\nthus far</p>\n<h3 id=\"footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\"><a href=\"#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\" style=\"margin-right: 10px\">#</a></a>Footnote 1: Creating a PR to the <code>gtk4-rs</code> repo to demonstrate example ColumnView usage</h3>\n<p>I created a PR (<a href=\"https://github.com/gtk-rs/gtk4-rs/pull/1111\">https://github.com/gtk-rs/gtk4-rs/pull/1111</a>) to demonstrate\nsimple <code>ColumnView</code> usage. The code review that was given on the PR was\nexcellent. They explained how to simplify the code I submitted so that each grid\ncell was very minimal (starting from a <code>gtk::Box</code> with a <code>gtk::Label</code> inside of\nit, to just being a <code>gtk::Inscription</code> which is very fast). Big thanks to the\nteam for helping out with this!</p>\n<p>After this hurdle was crossed, I felt much more comfortable in the GTK mindset,\nand I quickly fleshed out some more UI for the app</p>"}}],["$","$L9",null,{}]]}]
