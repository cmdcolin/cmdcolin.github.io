<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/d19cfa26cd1ef694.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-7b15b647f74e5256.js"/><script src="/_next/static/chunks/fd9d1056-a3cb5f355ce7bbbb.js" async=""></script><script src="/_next/static/chunks/582-f9ccb69edeb4b970.js" async=""></script><script src="/_next/static/chunks/main-app-cd804b1a70ba284d.js" async=""></script><script src="/_next/static/chunks/231-142f89de81886a79.js" async=""></script><script src="/_next/static/chunks/app/page-963abe75e6aad650.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-eab76b8f11630cf7.js" async=""></script><title>Creating a music player using Rust/GTK4 - fml9000</title><meta name="description" content="A blog"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body><div class="mb-8"><a href="/">Misc scribbles</a></div><div class="lg:w-1/2"><div><h1>Creating a music player using Rust/GTK4 - fml9000</h1><h4>2022-09-05</h4></div><div><p>I have started endeavoring to learn Rust. I did the rustlings exercises but I
knew the concepts would fade rapidly from my brain without some practice. I have
now started making a music player using Rust+GTK4.</p>
<p>I chose GTK4 to have a linux native GUI music player. Particularly, I have a
particular <code>foobar2000</code> setup that I wanted to emulate. I have used <code>foobar2000</code>
under wine (windows emulator on linux) and it's not terrible, but it has
background CPU consumption of about 15% idle and doesn't feel quite right
sometimes. I have used a variety of other linux music players such as
<code>quodlibet</code> (GUI/GTK based) and <code>cmus</code> (command line) but they didn't really
feel quite right.</p>
<h3 id="choosing-a-tech-stack"><a aria-hidden="true" tabindex="-1" href="#choosing-a-tech-stack"><a href="#choosing-a-tech-stack" style="margin-right: 10px">#</a></a>Choosing a tech stack</h3>
<p>I started by attempting with <code>Relm4</code>, which I may return to at some point, but
trying to juggle learning Relm4-style widgets, GTK, and rust all at once was a
bit much. I stepped to using <code>gtk4-rs</code> directly.</p>
<h3 id="create-a-spreadsheet-style-data-grid-of-tracks-with-columnview"><a aria-hidden="true" tabindex="-1" href="#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview"><a href="#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview" style="margin-right: 10px">#</a></a>Create a "spreadsheet style" data grid of tracks with <code>ColumnView</code></h3>
<p>Then, I wanted to create a data grid showing to display e.g. a table with
artist, track, album, etc. I chose to use the GTK
<a href="https://docs.gtk.org/gtk4/class.ColumnView.html"><code>ColumnView</code></a> to drive this. I
stumbled around looking for example code, but there was none specifically for
the <code>ColumnView</code>. I also realized the <code>ListView</code> example from the <code>gtk4-rs</code>
examples with it's factory function had similar needs that the <code>ColumnView</code>.</p>
<p>I found out that I basically needed to create a <code>ListStore</code>. I thought if I
could make my own <code>GObject</code> subclass, it would solve everything, but I had
trouble getting making this work (rust doesn't have the concept of extending a
class for one thing, you implement various traits instead). Finally, I randomly
stumbled on this link using a <code>BoxedAnyObject</code> with a good example of storing
data in a ListStore
<a href="https://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html">https://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html</a></p>
<p>The <code>BoxedAnyObject</code> is a <code>GObject</code>, so this was an good route to storing the
<code>ListView</code> items. There was no example code for connecting the <code>ListStore</code> with
the <code>ColumnView</code>, so I stuggled for awhile before realizing that the <code>ListView</code>
example in the <code>gtk4-rs</code> codebase has similar concepts.</p>
<p>See [1] for minimal usage of <code>ColumnView</code> that I contributed to the <code>gtk4-rs</code>
repo!</p>
<h3 id="choosing-an-audio-library"><a aria-hidden="true" tabindex="-1" href="#choosing-an-audio-library"><a href="#choosing-an-audio-library" style="margin-right: 10px">#</a></a>Choosing an audio library</h3>
<p>To actually play audio, I looked at a couple options. There was even one option
called GTK
<a href="https://gtk-rs.org/gtk4-rs/git/docs/gtk4/struct.MediaFile.html"><code>MediaFile</code></a>
which should to be able to play e.g. mp3s, making my job of making a media
player much simpler, but it produced an error
<a href="https://www.google.com/search?q=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22&#x26;oq=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22&#x26;aqs=chrome..69i57.267j0j7&#x26;sourceid=chrome&#x26;ie=UTF-8">"GTK could not find a media module. Check your installation."</a>
which had very few references on the internet. I figured this could be difficult
to solve or point to issues I could face later on making minimal executables for
users.</p>
<p>So, next I tried out <code>symphonia</code> (<a href="https://github.com/pdeljanov/Symphonia/">https://github.com/pdeljanov/Symphonia/</a>).
Symphonia requires a lot more code to work (~1000 lines so far, copying from the
<code>symphonia-play</code> example) but it has broad file format support, pure-rust audio
stack, etc. I got confused about how to package it into an easy-to-use system
though, having to create a symphonia player on a separate thread, so I looked
elsewhere...</p>
<p>Next I turned to <code>rodio</code>. This works well, and automatically plays on a separate
thread, but I found two issues 1) I have to initialize the rodio player in "fn
main" and not anywhere else, or it would just play a short blip of audio
(<a href="https://github.com/RustAudio/rodio/issues/381">https://github.com/RustAudio/rodio/issues/381</a>). Then, it turned out that the
<code>rodio</code>
<a href="https://docs.rs/rodio/0.14.0/rodio/struct.Sink.html#method.stop"><code>Sink</code></a>
instance (which you pass audio to) cannot stop and then play new song xref
(<a href="https://github.com/RustAudio/rodio/issues/315">https://github.com/RustAudio/rodio/issues/315</a>). To workaround, I replace it
with a new <code>Sink</code>.</p>
<p>This required me to learn about <code>RefCell</code>. I googled probably about 50 things
just grasping at straws for awhile, but then landed on the solution of putting
the <code>Sink</code> in a <code>Rc&#x3C;RefCell&#x3C;Sink>></code>, then that allows me to pass it into my
callback that handles double clicking the songs in the <code>ColumnView</code>, and then I
borrow the <code>RefCell</code> mutably to replace it with a new <code>Sink</code>.</p>
<h3 id="reading-audio-metadata-into-an-sqlite-db"><a aria-hidden="true" tabindex="-1" href="#reading-audio-metadata-into-an-sqlite-db"><a href="#reading-audio-metadata-into-an-sqlite-db" style="margin-right: 10px">#</a></a>Reading audio metadata into an <code>sqlite</code> DB</h3>
<p>I also wanted to have the option of reading and writing audio metadata.
Symphonia only reads metadata, so I found the <code>lofty</code> crate.</p>
<p>I also realized that reading tens of thousands of file's metadata at each app
startup would be slow, so I endeavored to store that data in an <code>sqlite</code>
database. I found that music players like <code>foobar2000</code> and <code>0xdeadbeef</code> have
databases of track metadata also (Example folder on <code>foobar2000</code> (1.x) for this
snap/foobar2000/433/foobar2000/profile/library/74E45640B1C695CC/meta-0001,
meta-0002, etc.)</p>
<p>I used the <code>walkdir</code> crate to walk a directory for files, <code>lofty</code> to read the
metadata, and then finally inserted the data into the <code>sqlite</code> db. I am still
working out the schema for the database but it provisionally associates data
with a primary key of filename.</p>
<h3 id="learning-about-reference-counting-and-move-semantics"><a aria-hidden="true" tabindex="-1" href="#learning-about-reference-counting-and-move-semantics"><a href="#learning-about-reference-counting-and-move-semantics" style="margin-right: 10px">#</a></a>Learning about reference counting and move semantics</h3>
<p>Originally I queried the sqlite database and stored a <code>Vec&#x3C;Track></code>, where
<code>Track</code> is a struct with artist, album, song title, etc. I realized that this
causes issues passing this around to different functions, and storing them in
the <code>BoxedAnyObject</code>, (example thread discussing issue
<a href="https://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust">https://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust</a>)
so I changed functions to accept slices of the Vec, and to make it a
<code>Vec&#x3C;Rc&#x3C;Track>></code> instead of just <code>Vec&#x3C;Track></code> (another related thread
<a href="https://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3">https://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3</a>).</p>
<h3 id="result"><a aria-hidden="true" tabindex="-1" href="#result"><a href="#result" style="margin-right: 10px">#</a></a>Result</h3>
<p>The current work is at <a href="https://github.com/cmdcolin/fml9000">https://github.com/cmdcolin/fml9000</a></p>
<p><img src="/media/fml9000_1.png" alt=""></p>
<p>Screenshot shows the current look and feel. Some stuff in the screenshot is
mocked and not fully functional, but it has been a great learning experience
thus far</p>
<h3 id="footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage"><a aria-hidden="true" tabindex="-1" href="#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage"><a href="#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage" style="margin-right: 10px">#</a></a>Footnote 1: Creating a PR to the <code>gtk4-rs</code> repo to demonstrate example ColumnView usage</h3>
<p>I created a PR (<a href="https://github.com/gtk-rs/gtk4-rs/pull/1111">https://github.com/gtk-rs/gtk4-rs/pull/1111</a>) to demonstrate
simple <code>ColumnView</code> usage. The code review that was given on the PR was
excellent. They explained how to simplify the code I submitted so that each grid
cell was very minimal (starting from a <code>gtk::Box</code> with a <code>gtk::Label</code> inside of
it, to just being a <code>gtk::Inscription</code> which is very fast). Big thanks to the
team for helping out with this!</p>
<p>After this hurdle was crossed, I felt much more comfortable in the GTK mindset,
and I quickly fleshed out some more UI for the app</p></div><div class="mt-5"></div></div><footer class="mt-16"><a class="m-2" href="/">Home</a><a class="m-2" href="/archive">Blog archive</a><a class="m-2" href="https://github.com/cmdcolin/">Github</a><a class="m-2" href="/projects">Projects</a><a class="m-2" href="/photos">Photos</a><a class="m-2" href="/books">Books</a><a class="m-2" href="/about">About</a></footer><script src="/_next/static/chunks/webpack-7b15b647f74e5256.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/d19cfa26cd1ef694.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[231,[\"231\",\"static/chunks/231-142f89de81886a79.js\",\"931\",\"static/chunks/app/page-963abe75e6aad650.js\"],\"\"]\na:I[6130,[],\"\"]\n6:[\"id\",\"2022-09-05-rustmusicplayer\",\"d\"]\nb:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d19cfa26cd1ef694.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"buildId\":\"3zz_HhnvXCVLWd6JLYaBm\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2022-09-05-rustmusicplayer\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2022-09-05-rustmusicplayer\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2022-09-05-rustmusicplayer\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2022-09-05-rustmusicplayer\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\"],null],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-8\",\"children\":[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}],[\"$\",\"footer\",null,{\"className\":\"mt-16\",\"children\":[[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L8\",null,{\"className\":\"m-2\",\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$L9\"],\"globalErrorComponent\":\"$a\",\"missingSlots\":\"$Wb\"}]]\n"])</script><script>self.__next_f.push([1,"d:I[1458,[\"722\",\"static/chunks/app/posts/%5Bid%5D/page-eab76b8f11630cf7.js\"],\"default\"]\nc:T26bd,"])</script><script>self.__next_f.push([1,"\u003cp\u003eI have started endeavoring to learn Rust. I did the rustlings exercises but I\nknew the concepts would fade rapidly from my brain without some practice. I have\nnow started making a music player using Rust+GTK4.\u003c/p\u003e\n\u003cp\u003eI chose GTK4 to have a linux native GUI music player. Particularly, I have a\nparticular \u003ccode\u003efoobar2000\u003c/code\u003e setup that I wanted to emulate. I have used \u003ccode\u003efoobar2000\u003c/code\u003e\nunder wine (windows emulator on linux) and it's not terrible, but it has\nbackground CPU consumption of about 15% idle and doesn't feel quite right\nsometimes. I have used a variety of other linux music players such as\n\u003ccode\u003equodlibet\u003c/code\u003e (GUI/GTK based) and \u003ccode\u003ecmus\u003c/code\u003e (command line) but they didn't really\nfeel quite right.\u003c/p\u003e\n\u003ch3 id=\"choosing-a-tech-stack\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#choosing-a-tech-stack\"\u003e\u003ca href=\"#choosing-a-tech-stack\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eChoosing a tech stack\u003c/h3\u003e\n\u003cp\u003eI started by attempting with \u003ccode\u003eRelm4\u003c/code\u003e, which I may return to at some point, but\ntrying to juggle learning Relm4-style widgets, GTK, and rust all at once was a\nbit much. I stepped to using \u003ccode\u003egtk4-rs\u003c/code\u003e directly.\u003c/p\u003e\n\u003ch3 id=\"create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\"\u003e\u003ca href=\"#create-a-spreadsheet-style-data-grid-of-tracks-with-columnview\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eCreate a \"spreadsheet style\" data grid of tracks with \u003ccode\u003eColumnView\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003eThen, I wanted to create a data grid showing to display e.g. a table with\nartist, track, album, etc. I chose to use the GTK\n\u003ca href=\"https://docs.gtk.org/gtk4/class.ColumnView.html\"\u003e\u003ccode\u003eColumnView\u003c/code\u003e\u003c/a\u003e to drive this. I\nstumbled around looking for example code, but there was none specifically for\nthe \u003ccode\u003eColumnView\u003c/code\u003e. I also realized the \u003ccode\u003eListView\u003c/code\u003e example from the \u003ccode\u003egtk4-rs\u003c/code\u003e\nexamples with it's factory function had similar needs that the \u003ccode\u003eColumnView\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI found out that I basically needed to create a \u003ccode\u003eListStore\u003c/code\u003e. I thought if I\ncould make my own \u003ccode\u003eGObject\u003c/code\u003e subclass, it would solve everything, but I had\ntrouble getting making this work (rust doesn't have the concept of extending a\nclass for one thing, you implement various traits instead). Finally, I randomly\nstumbled on this link using a \u003ccode\u003eBoxedAnyObject\u003c/code\u003e with a good example of storing\ndata in a ListStore\n\u003ca href=\"https://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html\"\u003ehttps://gtk-rs.org/gtk-rs-core/git/docs/glib/struct.BoxedAnyObject.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eBoxedAnyObject\u003c/code\u003e is a \u003ccode\u003eGObject\u003c/code\u003e, so this was an good route to storing the\n\u003ccode\u003eListView\u003c/code\u003e items. There was no example code for connecting the \u003ccode\u003eListStore\u003c/code\u003e with\nthe \u003ccode\u003eColumnView\u003c/code\u003e, so I stuggled for awhile before realizing that the \u003ccode\u003eListView\u003c/code\u003e\nexample in the \u003ccode\u003egtk4-rs\u003c/code\u003e codebase has similar concepts.\u003c/p\u003e\n\u003cp\u003eSee [1] for minimal usage of \u003ccode\u003eColumnView\u003c/code\u003e that I contributed to the \u003ccode\u003egtk4-rs\u003c/code\u003e\nrepo!\u003c/p\u003e\n\u003ch3 id=\"choosing-an-audio-library\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#choosing-an-audio-library\"\u003e\u003ca href=\"#choosing-an-audio-library\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eChoosing an audio library\u003c/h3\u003e\n\u003cp\u003eTo actually play audio, I looked at a couple options. There was even one option\ncalled GTK\n\u003ca href=\"https://gtk-rs.org/gtk4-rs/git/docs/gtk4/struct.MediaFile.html\"\u003e\u003ccode\u003eMediaFile\u003c/code\u003e\u003c/a\u003e\nwhich should to be able to play e.g. mp3s, making my job of making a media\nplayer much simpler, but it produced an error\n\u003ca href=\"https://www.google.com/search?q=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22\u0026#x26;oq=%22GTK+could+not+find+a+media+module.+Check+your+installation.%22\u0026#x26;aqs=chrome..69i57.267j0j7\u0026#x26;sourceid=chrome\u0026#x26;ie=UTF-8\"\u003e\"GTK could not find a media module. Check your installation.\"\u003c/a\u003e\nwhich had very few references on the internet. I figured this could be difficult\nto solve or point to issues I could face later on making minimal executables for\nusers.\u003c/p\u003e\n\u003cp\u003eSo, next I tried out \u003ccode\u003esymphonia\u003c/code\u003e (\u003ca href=\"https://github.com/pdeljanov/Symphonia/\"\u003ehttps://github.com/pdeljanov/Symphonia/\u003c/a\u003e).\nSymphonia requires a lot more code to work (~1000 lines so far, copying from the\n\u003ccode\u003esymphonia-play\u003c/code\u003e example) but it has broad file format support, pure-rust audio\nstack, etc. I got confused about how to package it into an easy-to-use system\nthough, having to create a symphonia player on a separate thread, so I looked\nelsewhere...\u003c/p\u003e\n\u003cp\u003eNext I turned to \u003ccode\u003erodio\u003c/code\u003e. This works well, and automatically plays on a separate\nthread, but I found two issues 1) I have to initialize the rodio player in \"fn\nmain\" and not anywhere else, or it would just play a short blip of audio\n(\u003ca href=\"https://github.com/RustAudio/rodio/issues/381\"\u003ehttps://github.com/RustAudio/rodio/issues/381\u003c/a\u003e). Then, it turned out that the\n\u003ccode\u003erodio\u003c/code\u003e\n\u003ca href=\"https://docs.rs/rodio/0.14.0/rodio/struct.Sink.html#method.stop\"\u003e\u003ccode\u003eSink\u003c/code\u003e\u003c/a\u003e\ninstance (which you pass audio to) cannot stop and then play new song xref\n(\u003ca href=\"https://github.com/RustAudio/rodio/issues/315\"\u003ehttps://github.com/RustAudio/rodio/issues/315\u003c/a\u003e). To workaround, I replace it\nwith a new \u003ccode\u003eSink\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThis required me to learn about \u003ccode\u003eRefCell\u003c/code\u003e. I googled probably about 50 things\njust grasping at straws for awhile, but then landed on the solution of putting\nthe \u003ccode\u003eSink\u003c/code\u003e in a \u003ccode\u003eRc\u0026#x3C;RefCell\u0026#x3C;Sink\u003e\u003e\u003c/code\u003e, then that allows me to pass it into my\ncallback that handles double clicking the songs in the \u003ccode\u003eColumnView\u003c/code\u003e, and then I\nborrow the \u003ccode\u003eRefCell\u003c/code\u003e mutably to replace it with a new \u003ccode\u003eSink\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"reading-audio-metadata-into-an-sqlite-db\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#reading-audio-metadata-into-an-sqlite-db\"\u003e\u003ca href=\"#reading-audio-metadata-into-an-sqlite-db\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eReading audio metadata into an \u003ccode\u003esqlite\u003c/code\u003e DB\u003c/h3\u003e\n\u003cp\u003eI also wanted to have the option of reading and writing audio metadata.\nSymphonia only reads metadata, so I found the \u003ccode\u003elofty\u003c/code\u003e crate.\u003c/p\u003e\n\u003cp\u003eI also realized that reading tens of thousands of file's metadata at each app\nstartup would be slow, so I endeavored to store that data in an \u003ccode\u003esqlite\u003c/code\u003e\ndatabase. I found that music players like \u003ccode\u003efoobar2000\u003c/code\u003e and \u003ccode\u003e0xdeadbeef\u003c/code\u003e have\ndatabases of track metadata also (Example folder on \u003ccode\u003efoobar2000\u003c/code\u003e (1.x) for this\nsnap/foobar2000/433/foobar2000/profile/library/74E45640B1C695CC/meta-0001,\nmeta-0002, etc.)\u003c/p\u003e\n\u003cp\u003eI used the \u003ccode\u003ewalkdir\u003c/code\u003e crate to walk a directory for files, \u003ccode\u003elofty\u003c/code\u003e to read the\nmetadata, and then finally inserted the data into the \u003ccode\u003esqlite\u003c/code\u003e db. I am still\nworking out the schema for the database but it provisionally associates data\nwith a primary key of filename.\u003c/p\u003e\n\u003ch3 id=\"learning-about-reference-counting-and-move-semantics\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#learning-about-reference-counting-and-move-semantics\"\u003e\u003ca href=\"#learning-about-reference-counting-and-move-semantics\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eLearning about reference counting and move semantics\u003c/h3\u003e\n\u003cp\u003eOriginally I queried the sqlite database and stored a \u003ccode\u003eVec\u0026#x3C;Track\u003e\u003c/code\u003e, where\n\u003ccode\u003eTrack\u003c/code\u003e is a struct with artist, album, song title, etc. I realized that this\ncauses issues passing this around to different functions, and storing them in\nthe \u003ccode\u003eBoxedAnyObject\u003c/code\u003e, (example thread discussing issue\n\u003ca href=\"https://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust\"\u003ehttps://stackoverflow.com/questions/42954008/how-to-pass-one-vec-to-multiple-functions-in-rust\u003c/a\u003e)\nso I changed functions to accept slices of the Vec, and to make it a\n\u003ccode\u003eVec\u0026#x3C;Rc\u0026#x3C;Track\u003e\u003e\u003c/code\u003e instead of just \u003ccode\u003eVec\u0026#x3C;Track\u003e\u003c/code\u003e (another related thread\n\u003ca href=\"https://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3\"\u003ehttps://users.rust-lang.org/t/self-has-an-anonymous-lifetime-but-it-needs-to-satisfy-a-static-lifetime-requirement/58641/3\u003c/a\u003e).\u003c/p\u003e\n\u003ch3 id=\"result\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#result\"\u003e\u003ca href=\"#result\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eResult\u003c/h3\u003e\n\u003cp\u003eThe current work is at \u003ca href=\"https://github.com/cmdcolin/fml9000\"\u003ehttps://github.com/cmdcolin/fml9000\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/fml9000_1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eScreenshot shows the current look and feel. Some stuff in the screenshot is\nmocked and not fully functional, but it has been a great learning experience\nthus far\u003c/p\u003e\n\u003ch3 id=\"footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\"\u003e\u003ca href=\"#footnote-1-creating-a-pr-to-the-gtk4-rs-repo-to-demonstrate-example-columnview-usage\" style=\"margin-right: 10px\"\u003e#\u003c/a\u003e\u003c/a\u003eFootnote 1: Creating a PR to the \u003ccode\u003egtk4-rs\u003c/code\u003e repo to demonstrate example ColumnView usage\u003c/h3\u003e\n\u003cp\u003eI created a PR (\u003ca href=\"https://github.com/gtk-rs/gtk4-rs/pull/1111\"\u003ehttps://github.com/gtk-rs/gtk4-rs/pull/1111\u003c/a\u003e) to demonstrate\nsimple \u003ccode\u003eColumnView\u003c/code\u003e usage. The code review that was given on the PR was\nexcellent. They explained how to simplify the code I submitted so that each grid\ncell was very minimal (starting from a \u003ccode\u003egtk::Box\u003c/code\u003e with a \u003ccode\u003egtk::Label\u003c/code\u003e inside of\nit, to just being a \u003ccode\u003egtk::Inscription\u003c/code\u003e which is very fast). Big thanks to the\nteam for helping out with this!\u003c/p\u003e\n\u003cp\u003eAfter this hurdle was crossed, I felt much more comfortable in the GTK mindset,\nand I quickly fleshed out some more UI for the app\u003c/p\u003e"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"lg:w-1/2\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Creating a music player using Rust/GTK4 - fml9000\"}],[\"$\",\"h4\",null,{\"children\":\"2022-09-05\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$c\"}}],[\"$\",\"$Ld\",null,{}]]}]\n9:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Creating a music player using Rust/GTK4 - fml9000\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A blog\"}]]\n3:null\n"])</script></body></html>