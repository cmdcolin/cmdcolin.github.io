2:"$Sreact.fragment"
3:I[231,["231","static/chunks/231-fc74e6e791c0837d.js","931","static/chunks/app/page-95d4a906a5a795f0.js"],""]
4:I[9275,[],""]
5:I[1343,[],""]
7:I[3120,[],"OutletBoundary"]
9:I[3120,[],"MetadataBoundary"]
b:I[3120,[],"ViewportBoundary"]
d:I[6130,[],""]
1:HL["/_next/static/css/d19cfa26cd1ef694.css","style"]
0:{"P":null,"b":"gjl4pP9KlTWS0QJ9LUaZp","p":"","c":["","posts","2022-08-26-twitterbot"],"i":false,"f":[[["",{"children":["posts",{"children":[["id","2022-08-26-twitterbot","d"],{"children":["__PAGE__?{\"id\":\"2022-08-26-twitterbot\"}",{}]}]}]},"$undefined","$undefined",true],["",["$","$2","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d19cfa26cd1ef694.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"className":"mb-8","children":["$","$L3",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}],["$","footer",null,{"className":"mt-16","children":[["$","$L3",null,{"className":"m-2","href":"/","children":"Home"}],["$","$L3",null,{"className":"m-2","href":"/archive","children":"Blog archive"}],["$","$L3",null,{"className":"m-2","href":"https://github.com/cmdcolin/","children":"Github"}],["$","$L3",null,{"className":"m-2","href":"/projects","children":"Projects"}],["$","$L3",null,{"className":"m-2","href":"/photos","children":"Photos"}],["$","$L3",null,{"className":"m-2","href":"/books","children":"Books"}],["$","$L3",null,{"className":"m-2","href":"/about","children":"About"}]]}]]}]}]]}],{"children":["posts",["$","$2","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":[["id","2022-08-26-twitterbot","d"],["$","$2","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":["__PAGE__",["$","$2","c",{"children":["$L6",null,["$","$L7",null,{"children":"$L8"}]]}],{},null]},null]},null]},null],["$","$2","h",{"children":[null,["$","$2","WwltgKp2nzNIfFrhSyjRr",{"children":[["$","$L9",null,{"children":"$La"}],["$","$Lb",null,{"children":"$Lc"}],null]}]]}]]],"m":"$undefined","G":"$d","s":false,"S":true}
c:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
f:I[1458,["722","static/chunks/app/posts/%5Bid%5D/page-e50cd2f34f19f050.js"],"default",1]
e:T80b8,<p>Recently, we made the logistic map fractal visualizer app, but, how do we keep
USER ENGAGEMENT METRICS up? Gotta make a twitter bot to post fractals, that's
how!</p>
<p>I found it somewhat tricky to get this working, because there is a lot of odd
lingo out there. There are libraries that may help you, but this post goes
through making an OAuth client in node.js to post to the twitter API with fairly
unabstracted code. OAuth still confuses me, but if you follow these steps, you
can make a bot!</p>
<h3 id="step-1"><a aria-hidden="true" tabindex="-1" href="#step-1"><a href="#step-1" style="margin-right: 10px">#</a></a>Step 1</h3>
<p>Get your keys. I forget the exact procedure for this but go to
<a href="https://developer.twitter.com">https://developer.twitter.com</a> and sign up, register an "app" with them, and poke
around for awhile. This github repo provides a couple more details about the
process of registering
<a href="https://github.com/manzt/cron-tweet#create-a-standalone-app-in-the-developer-portal">https://github.com/manzt/cron-tweet#create-a-standalone-app-in-the-developer-portal</a></p>
<p>After sometime, you should get a screen that looks like this. Keep this around
for Step 4. Note: I did not have to apply for any elevated access for this
article, just the basic level you get from the initial registration! I believe
in twitter terms, this article only requires "Essential" access and not any
"Elevated" access.</p>
<p><img src="https://github.com/cmdcolin/twitter_fractal_bot/blob/master/img/devpanel.png?raw=true" alt=""></p>
<h3 id="step-2"><a aria-hidden="true" tabindex="-1" href="#step-2"><a href="#step-2" style="margin-right: 10px">#</a></a>Step 2</h3>
<p>Make a repo with a couple dependencies</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="sh" data-theme="one-dark-pro"><code data-language="sh" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#61AFEF">mkdir</span><span style="color:#98C379"> mybot</span></span>
<span data-line=""><span style="color:#56B6C2">cd</span><span style="color:#98C379"> mybot</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> init</span></span>
<span data-line=""><span style="color:#61AFEF">yarn</span><span style="color:#98C379"> add</span><span style="color:#98C379"> node-fetch</span><span style="color:#98C379"> formdata-node</span><span style="color:#98C379"> oauth</span><span style="color:#98C379"> dotenv</span><span style="color:#98C379"> typescript</span></span></code></pre></figure>
<h3 id="step-3"><a aria-hidden="true" tabindex="-1" href="#step-3"><a href="#step-3" style="margin-right: 10px">#</a></a>Step 3</h3>
<p>Update <code>package.json</code> with a couple scripts to build these typescript files
(alternatively use <code>ts-node</code> or similar to run the ts files directly)</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "dependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "dotenv"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^16.0.1"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "formdata-node"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^4.4.1"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "node-fetch"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^3.2.10"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "oauth"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^0.10.0"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "typescript"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^4.7.4"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "license"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"MIT"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "type"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"module"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  "devDependencies"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "@types/node"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^18.7.9"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "@types/oauth"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"^0.9.1"</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#E06C75">  "scripts"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "build"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"tsc"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "prepost"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"yarn build"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "post"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"node dist/bot.js"</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>And <code>tsconfig.json</code> file</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#ABB2BF">{</span></span>
<span data-line=""><span style="color:#E06C75">  "include"</span><span style="color:#ABB2BF">: [</span><span style="color:#98C379">"src"</span><span style="color:#ABB2BF">],</span></span>
<span data-line=""><span style="color:#E06C75">  "compilerOptions"</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    "target"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"esnext"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "outDir"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"dist"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "moduleResolution"</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">"node"</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "declaration"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "strict"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    "esModuleInterop"</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>This compiles the <code>src</code> folder and outputs js files to the <code>dist</code> directory, and
we can run the <code>node dist/bot.js</code> file with node to post the file</p>
<h3 id="step-4"><a aria-hidden="true" tabindex="-1" href="#step-4"><a href="#step-4" style="margin-right: 10px">#</a></a>Step 4</h3>
<p>Create a .env file with your keys that you found in the above screenshot
corresponding to the box1 (which gives you API_KEY/API_SECRET, sometimes also
referred to as consumer keys in other documents) and box2 (which gives you
ACCESS_TOKEN and ACCESS_TOKEN_SECRET) from the above screenshot</p>
<pre><code>API_KEY="xxxxxxxxxxxxxxxxxxxxxxxxx"
API_SECRET="yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy"
ACCESS_TOKEN="aaaaaaaaaaaaaaaaaaa-aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
ACCESS_TOKEN_SECRET="bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
</code></pre>
<p>Important: Also add the .env to your .gitignore, you don't want to commit this
to github!</p>
<h3 id="step-5"><a aria-hidden="true" tabindex="-1" href="#step-5"><a href="#step-5" style="margin-right: 10px">#</a></a>Step 5</h3>
<p>Make the bot! Create <code>src/bot.ts</code></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#E06C75"> fs</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> 'fs'</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#D19A66"> *</span><span style="color:#C678DD"> as</span><span style="color:#E06C75"> dotenv</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> 'dotenv'</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#E06C75"> OAuth</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> 'oauth'</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#E06C75"> fetch</span><span style="color:#ABB2BF">, { </span><span style="color:#E06C75">RequestInit</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'node-fetch'</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">FormData</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">File</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> 'formdata-node'</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E5C07B">dotenv</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">config</span><span style="color:#ABB2BF">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">async</span><span style="color:#C678DD"> function</span><span style="color:#61AFEF"> mfetch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">url</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">params</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">RequestInit</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#C678DD">  const</span><span style="color:#E5C07B"> response</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#61AFEF"> fetch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">url</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">params</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">  if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">response</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">ok</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> text</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#E5C07B"> response</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">text</span><span style="color:#ABB2BF">()</span></span>
<span data-line=""><span style="color:#C678DD">    throw</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Error</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">`HTTP </span><span style="color:#C678DD">${</span><span style="color:#E5C07B">response</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">status</span><span style="color:#C678DD">}</span><span style="color:#C678DD"> ${</span><span style="color:#E06C75">text</span><span style="color:#C678DD">}</span><span style="color:#98C379">`</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#C678DD">  return</span><span style="color:#E5C07B"> response</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">json</span><span style="color:#ABB2BF">() </span><span style="color:#C678DD">as</span><span style="color:#E5C07B"> Promise</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">Record</span><span style="color:#ABB2BF">&#x3C;</span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">unknown</span><span style="color:#ABB2BF">>></span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">function</span><span style="color:#61AFEF"> getAuthHeader</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">oauth</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">OAuth</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">OAuth</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">url</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#C678DD">  return</span><span style="color:#E5C07B"> oauth</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">authHeader</span><span style="color:#ABB2BF">(</span></span>
<span data-line=""><span style="color:#E06C75">    url</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E5C07B">    process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">ACCESS_TOKEN</span><span style="color:#C678DD"> as</span><span style="color:#E5C07B"> string</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E5C07B">    process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">ACCESS_TOKEN_SECRET</span><span style="color:#C678DD"> as</span><span style="color:#E5C07B"> string</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">    'post'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">  )</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ABB2BF">;(</span><span style="color:#C678DD">async</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=></span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#C678DD">  try</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> client</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> OAuth</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">OAuth</span><span style="color:#ABB2BF">(</span></span>
<span data-line=""><span style="color:#98C379">      'https://api.twitter.com/oauth/request_token'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">      'https://api.twitter.com/oauth/access_token'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E5C07B">      process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">API_KEY</span><span style="color:#C678DD"> as</span><span style="color:#E5C07B"> string</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E5C07B">      process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">API_SECRET</span><span style="color:#C678DD"> as</span><span style="color:#E5C07B"> string</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">      '1.0A'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#D19A66">      null</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">      'HMAC-SHA1'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">    )</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> picEndpoint</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> 'https://upload.twitter.com/1.1/media/upload.json'</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> tweetEndpoint</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> 'https://api.twitter.com/2/tweets'</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> clientName</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> 'v3CreateTweetJS'</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> form</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> FormData</span><span style="color:#ABB2BF">()</span></span>
<span data-line=""><span style="color:#E5C07B">    form</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">set</span><span style="color:#ABB2BF">(</span></span>
<span data-line=""><span style="color:#98C379">      'media'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#C678DD">      new</span><span style="color:#61AFEF"> File</span><span style="color:#ABB2BF">([</span><span style="color:#E5C07B">fs</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">readFileSync</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'yourpicture.png'</span><span style="color:#ABB2BF">)], </span><span style="color:#98C379">'yourpicture.png'</span><span style="color:#ABB2BF">),</span></span>
<span data-line=""><span style="color:#ABB2BF">    )</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#7F848E;font-style:italic">    // first post a picture</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> response1</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#61AFEF"> mfetch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">picEndpoint</span><span style="color:#ABB2BF">, {</span></span>
<span data-line=""><span style="color:#E06C75">      headers</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">        Authorization</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">getAuthHeader</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">client</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">picEndpoint</span><span style="color:#ABB2BF">),</span></span>
<span data-line=""><span style="color:#98C379">        'user-agent'</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">clientName</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">      },</span></span>
<span data-line=""><span style="color:#E06C75">      method</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'POST'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic">      //@ts-ignore</span></span>
<span data-line=""><span style="color:#E06C75">      body</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">form</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">    })</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#7F848E;font-style:italic">    // then post a tweet, referring to the media_id_string from response1</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> response2</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#61AFEF"> mfetch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">tweetEndpoint</span><span style="color:#ABB2BF">, {</span></span>
<span data-line=""><span style="color:#E06C75">      headers</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">        Authorization</span><span style="color:#ABB2BF">: </span><span style="color:#61AFEF">getAuthHeader</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">client</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">tweetEndpoint</span><span style="color:#ABB2BF">),</span></span>
<span data-line=""><span style="color:#98C379">        'user-agent'</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">clientName</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">        'content-type'</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'application/json'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">        accept</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'application/json'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">      },</span></span>
<span data-line=""><span style="color:#E06C75">      body</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">JSON</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stringify</span><span style="color:#ABB2BF">({</span></span>
<span data-line=""><span style="color:#E06C75">        media</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">media_ids</span><span style="color:#ABB2BF">: [</span><span style="color:#E5C07B">response1</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">media_id_string</span><span style="color:#ABB2BF">] },</span></span>
<span data-line=""><span style="color:#E06C75">        text</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'Hello world!'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">      }),</span></span>
<span data-line=""><span style="color:#E06C75">      method</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'post'</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">    })</span></span>
<span data-line=""><span style="color:#E5C07B">    console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">response2</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">  } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">e</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#E5C07B">    console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">error</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">e</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#E5C07B">    process</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exit</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">})()</span></span></code></pre></figure>
<h3 id="step-6"><a aria-hidden="true" tabindex="-1" href="#step-6"><a href="#step-6" style="margin-right: 10px">#</a></a>Step 6</h3>
<p>Now that you have the bot, you can run it locally with <code>yarn post</code> (runs the
"post" script in <code>package.json</code>) to test it out</p>
<h3 id="step-7"><a aria-hidden="true" tabindex="-1" href="#step-7"><a href="#step-7" style="margin-right: 10px">#</a></a>Step 7</h3>
<p>Now to create a github action to run the bot.</p>
<p>Navigate to your repo's settings page, then go to Secrets->Actions and paste the
keys one by one, see below screenshot</p>
<p><img src="https://user-images.githubusercontent.com/6511937/187038172-80b35e34-03dd-4613-b6f6-9f8e25d2fc34.png" alt=""></p>
<h3 id="step-8"><a aria-hidden="true" tabindex="-1" href="#step-8"><a href="#step-8" style="margin-right: 10px">#</a></a>Step 8</h3>
<p>Create a file with the path <code>.github/workflows/post.yml</code> in your repo to make
the post</p>
<p>You can use a cron/scheduled workflow in the github action, which the below
example does
<a href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule">https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule</a></p>
<p>The below github action posts every 5 hours on the hour (see
<a href="https://crontab.guru/">https://crontab.guru/</a> for more info on cron syntax)</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="yaml" data-theme="one-dark-pro"><code data-language="yaml" data-theme="one-dark-pro" style="display: grid;"><span data-line=""><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Post tweet</span></span>
<span data-line=""><span style="color:#D19A66">on</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#E06C75">  schedule</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#ABB2BF">    - </span><span style="color:#E06C75">cron</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'0 */5 * * *'</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E06C75">jobs</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#E06C75">  test</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#E06C75">    name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Post tweet</span></span>
<span data-line=""><span style="color:#E06C75">    runs-on</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ubuntu-latest</span></span>
<span data-line=""><span style="color:#E06C75">    steps</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">actions/checkout@v2</span></span>
<span data-line=""><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Use Node.js 14.x</span></span>
<span data-line=""><span style="color:#E06C75">        uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">actions/setup-node@v2</span></span>
<span data-line=""><span style="color:#E06C75">        with</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#E06C75">          node-version</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">'14'</span></span>
<span data-line=""><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install deps (with cache)</span></span>
<span data-line=""><span style="color:#E06C75">        uses</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">bahmutov/npm-install@v1</span></span>
<span data-line=""><span style="color:#ABB2BF">      - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Post tweet</span></span>
<span data-line=""><span style="color:#E06C75">        env</span><span style="color:#ABB2BF">:</span></span>
<span data-line=""><span style="color:#E06C75">          API_KEY</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ secrets.API_KEY }}</span></span>
<span data-line=""><span style="color:#E06C75">          API_SECRET</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ secrets.API_SECRET }}</span></span>
<span data-line=""><span style="color:#E06C75">          ACCESS_TOKEN</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ secrets.ACCESS_TOKEN }}</span></span>
<span data-line=""><span style="color:#E06C75">          ACCESS_TOKEN_SECRET</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">${{ secrets.ACCESS_TOKEN_SECRET }}</span></span>
<span data-line=""><span style="color:#E06C75">        run</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">yarn post</span></span></code></pre></figure>
<h2 id="conclusion"><a aria-hidden="true" tabindex="-1" href="#conclusion"><a href="#conclusion" style="margin-right: 10px">#</a></a>Conclusion</h2>
<p>See <a href="https://github.com/cmdcolin/twitter_fractal_bot">https://github.com/cmdcolin/twitter_fractal_bot</a> for working example. I could
have, in retrospect, used a library like <code>twit</code>
(<a href="https://www.npmjs.com/package/twit">https://www.npmjs.com/package/twit</a>) but this code sample is not substantially
more complicated than using the <code>twit</code> library.</p>
<p>You can also adapt this to post only when you push to your repo, or release a
new version from your repo!</p>
<h2 id="footnote-1-examples-of-odd-lingo-or-stumbling-blocks-you-might-come-across"><a aria-hidden="true" tabindex="-1" href="#footnote-1-examples-of-odd-lingo-or-stumbling-blocks-you-might-come-across"><a href="#footnote-1-examples-of-odd-lingo-or-stumbling-blocks-you-might-come-across" style="margin-right: 10px">#</a></a>Footnote 1: Examples of odd lingo or stumbling blocks you might come across</h2>
<ul>
<li>Bearer token - The Bearer token is an alternative method of authenticating,
but it cannot be used to post tweets</li>
<li>Twitter API v1 vs v2 - We use a mix of v1 and v2, it's just the different URLs
that we are posting to and can be mixed in our example</li>
<li>Consumer key vs API key - they are the same thing in our example. If you look
closely at the box 1 in the screenshot it says "Consumer keys" and then gives
you an API key below *</li>
</ul>
<h2 id="footnote-2-posting-on-release-with-a-github-action"><a aria-hidden="true" tabindex="-1" href="#footnote-2-posting-on-release-with-a-github-action"><a href="#footnote-2-posting-on-release-with-a-github-action" style="margin-right: 10px">#</a></a>Footnote 2: Posting on release with a github action</h2>
<p>Replace the cron section of the github action with</p>
<pre><code>on: release
</code></pre>
<h2 id="footnote-3-additional-reading"><a aria-hidden="true" tabindex="-1" href="#footnote-3-additional-reading"><a href="#footnote-3-additional-reading" style="margin-right: 10px">#</a></a>Footnote 3: Additional reading</h2>
<p><a href="https://aaronparecki.com/oauth-2-simplified/">https://aaronparecki.com/oauth-2-simplified/</a></p>6:["$","div",null,{"className":"lg:w-1/2","children":[["$","div",null,{"children":[["$","h1",null,{"children":"Making a twitter bot in the year 2022 with node.js"}],["$","h4",null,{"children":"2022-08-26"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$e"}}],["$","$Lf",null,{}]]}]
a:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Making a twitter bot in the year 2022 with node.js"}],["$","meta","2",{"name":"description","content":"A blog"}]]
8:null
