<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/97dc5fe527f5d592.css" crossorigin="" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-19ac6e418b88dab7.js" as="script" fetchPriority="low" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-e43fdc25c1167267.js" async="" crossorigin=""></script><script src="/_next/static/chunks/864-f0261ea346b46dc5.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-fe7c20d256316568.js" async="" crossorigin=""></script><title>Making a serverless website for photo upload pt. 1</title><meta name="description" content="A blog"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="128x128"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div style="margin-bottom:100px"><a href="/">Misc scribbles</a></div><article><div><h1>Making a serverless website for photo upload pt. 1</h1><h4>2020-12-24</h4></div><div><p>I set out to make a serverless website for photo uploads. Our dearly departed
dixie dog needed a place to have photo uploads.</p>
<p>I didn't want to get charged dollars per month for a running ec2 instance, so I
wanted something that was lightweight e.g. serverless, and easy</p>
<p>I decided to follow this tutorial</p>
<p><a href="https://aws.amazon.com/blogs/compute/uploading-to-amazon-s3-directly-from-a-web-or-mobile-application/">https://aws.amazon.com/blogs/compute/uploading-to-amazon-s3-directly-from-a-web-or-mobile-application/</a></p>
<p>I really liked the command line deployment (aws-sam) because fiddling around
with the AWS web based control panel is ridiculously complicated</p>
<p>For example I also tried following this tutorial which uses the web based UI
(<a href="https://www.youtube.com/watch?v=mw_-0iCVpUc">https://www.youtube.com/watch?v=mw_-0iCVpUc</a>) and it just did not work for
me....I couldn't stay focused (blame ADHD or just my CLI obsession?) and certain
things like "Execution role" that they say to modify are not there in the web UI
anymore, so I just gave up (I did try though!)</p>
<p>To install aws-sam I used homebrew</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">brew</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">tap</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">aws/tap</span></span>
<span class="line"><span style="color: #91B4D5">brew</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">install</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">aws-sam-cli</span></span>
<span class="line"><span style="color: #91B4D5">brew</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">install</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">aws-sam-cli</span><span style="color: #A6ACCD"> </span><span style="color: #767C9DB0; font-style: italic"># I had to run the install command twice ref https://github.com/aws/aws-sam-cli/issues/2320#issuecomment-721414971</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">git</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">clone</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">https://github.com/aws-samples/amazon-s3-presigned-urls-aws-sam</span></span>
<span class="line"><span style="color: #91B4D5">cd</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">amazon-s3-presigned-urls-aws-sam</span></span>
<span class="line"><span style="color: #91B4D5">sam</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">deploy</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">--guided</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic"># proceeds with a guided installation, I used all defaults except I</span></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic"># made "UploadRequestFunction may not have authorization definedIs</span></span>
<span class="line"><span style="color: #91B4D5">Is</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">this</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">okay?</span><span style="color: #A6ACCD"> [y/N]: y</span><span style="color: #A6ACCD">"</span></span></code></pre>
<p><img src="/media/638408397901987840_0.png" alt=""></p>
<p>They then in the tutorial describe trying to use postman to test</p>
<p>I test with <code>curl</code> instead</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">curl</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">https://fjgbqj5436.execute-api.us-east-2.amazonaws.com/uploads</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span></code></pre>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">uploadURL</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">https://sam-app-s3uploadbucket-1653634.s3.us-east-2.amazonaws.com/112162.jpg?Content-Type=image%2Fjpeg&#x26;X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Credential=xxx&#x26;X-Amz-Date=20201224T174804Z&#x26;X-Amz-Expires=300&#x26;X-Amz-Security-Token=yyy&#x26;X-Amz-SignedHeaders=host</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">Key</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">112162.jpg</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>The premise of this is you make a request, and then the response from the API is
a pre-signed URL that then allows you to upload directly to S3. You can use
<code>curl &#x3C;url> --upload-file yourfile.jpg</code>. This automatically does a PUT request
to the s3 bucket (yes, this is talking directly to s3 now, not the lambda! the
lambda is just for generating the "pre-signed URL" to let you upload). Careful
to copy it exactly as is</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">curl</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">https://sam-app-s3uploadbucket-1653634.s3.us-east-2.amazonaws.com/112162.jpg?Content-Type=image%2Fjpeg&#x26;X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Credential=xxx&#x26;X-Amz-Date=20201224T174804Z&#x26;X-Amz-Expires=300&#x26;X-Amz-Security-Token=yyy&#x26;X-Amz-SignedHeaders=host</span><span style="color: #A6ACCD">"</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">--upload-file</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">test.jpg</span></span></code></pre>
<p>There is no response, but I can then check the s3 console and see the file
upload is successful (all files are renamed)</p>
<p><img src="/media/638408397901987840_1.png" alt=""></p>
<p>Figure shows that the file upload is successful :)</p>
<p>Then we can edit the file frontend/index.html from the repo we cloned to contain
the lambda with the /uploads/ suffix</p>
<p>Then we manually upload this file to another s3 bucket or test it locally</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">aws</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">s3</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">cp</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">index.html</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">s3://mybucket/</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic"># then ...visit that in the browser</span></span></code></pre>
<p>At this point the files are getting uploaded but not publicly accessible. To
make them publicly accessible we uncomment the ACL: 'public-read' in the
getSignedURL/app.js folder in the github repo</p>
<p><img src="/media/638408397901987840_3.png" alt=""></p>
<p>Figure showing the public-read uncommented</p>
<p><img src="/media/638408397901987840_4.png" alt=""></p>
<p>Figure showing the lines that need uncommenting in template.yaml in the root of
the github repo that allows putObject in s3 with the public-read ACL</p>
<p>Re-run <code>sam deploy --guided</code>, same thing as at the start</p>
<p>Now the objects are publicly accessible!</p></div><div style="margin-top:200px"></div></article><footer style="margin-top:100px"><a href="/">Home</a><a href="/archive">Blog archive</a><a href="https://github.com/cmdcolin/">Github</a><a href="https://twitter.com/cmdcolin">Twitter</a><a href="/projects">Projects</a> <a href="/photos">Photos</a><a href="/books">Books</a><a href="/about">About</a></footer><script src="/_next/static/chunks/webpack-19ac6e418b88dab7.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/97dc5fe527f5d592.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I{\"id\":6054,\"chunks\":[\"272:static/chunks/webpack-19ac6e418b88dab7.js\",\"971:static/chunks/fd9d1056-e43fdc25c1167267.js\",\"864:static/chunks/864-f0261ea346b46dc5.js\"],\"name\":\"\",\"async\":false}\n5:I{\"id\":1729,\"chunks\":[\"272:static/chunks/webpack-19ac6e418b88dab7.js\",\"971:static/chunks/fd9d1056-e43fdc25c1167267.js\",\"864:static/chunks/864-f0261ea346b46dc5.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":4724,\"chunks\":[\"724:static/chunks/724-f777e11942c9f205.js\",\"931:static/chunks/app/page-dc728b3619945451.js\"],\"name\":\"\",\"a"])</script><script>self.__next_f.push([1,"sync\":false}\n7:I{\"id\":1443,\"chunks\":[\"272:static/chunks/webpack-19ac6e418b88dab7.js\",\"971:static/chunks/fd9d1056-e43fdc25c1167267.js\",\"864:static/chunks/864-f0261ea346b46dc5.js\"],\"name\":\"\",\"async\":false}\n8:I{\"id\":8639,\"chunks\":[\"272:static/chunks/webpack-19ac6e418b88dab7.js\",\"971:static/chunks/fd9d1056-e43fdc25c1167267.js\",\"864:static/chunks/864-f0261ea346b46dc5.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/97dc5fe527f5d592.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"HZWKiAG0-CvP4MZ9crumU\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2020-12-24\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2020-12-24\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"2020-12-24\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"div\",null,{\"style\":{\"marginBottom\":100},\"children\":[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Misc scribbles\"}]}],[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"id\",\"2020-12-24\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L9\",\"$La\",null],\"segment\":\"__PAGE__?{\\\"id\\\":\\\"2020-12-24\\\"}\"},\"styles\":[]}],\"segment\":[\"id\",\"2020-12-24\",\"d\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}],[\"$\",\"footer\",null,{\"style\":{\"marginTop\":100},\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L6\",null,{\"href\":\"/archive\",\"children\":\"Blog archive\"}],[\"$\",\"$L6\",null,{\"href\":\"https://github.com/cmdcolin/\",\"children\":\"Github\"}],[\"$\",\"$L6\",null,{\"href\":\"https://twitter.com/cmdcolin\",\"children\":\"Twitter\"}],[\"$\",\"$L6\",null,{\"href\":\"/projects\",\"children\":\"Projects\"}],\" \",[\"$\",\"$L6\",null,{\"href\":\"/photos\",\"children\":\"Photos\"}],[\"$\",\"$L6\",null,{\"href\":\"/books\",\"children\":\"Books\"}],[\"$\",\"$L6\",null,{\"href\":\"/about\",\"children\":\"About\"}]]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"c:I{\"id\":2775,\"chunks\":[\"722:static/chunks/app/posts/[id]/page-cca14fd8141e3e22.js\"],\"name\":\"\",\"async\":false}\nb:T2028,"])</script><script>self.__next_f.push([1,"\u003cp\u003eI set out to make a serverless website for photo uploads. Our dearly departed\ndixie dog needed a place to have photo uploads.\u003c/p\u003e\n\u003cp\u003eI didn't want to get charged dollars per month for a running ec2 instance, so I\nwanted something that was lightweight e.g. serverless, and easy\u003c/p\u003e\n\u003cp\u003eI decided to follow this tutorial\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://aws.amazon.com/blogs/compute/uploading-to-amazon-s3-directly-from-a-web-or-mobile-application/\"\u003ehttps://aws.amazon.com/blogs/compute/uploading-to-amazon-s3-directly-from-a-web-or-mobile-application/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI really liked the command line deployment (aws-sam) because fiddling around\nwith the AWS web based control panel is ridiculously complicated\u003c/p\u003e\n\u003cp\u003eFor example I also tried following this tutorial which uses the web based UI\n(\u003ca href=\"https://www.youtube.com/watch?v=mw_-0iCVpUc\"\u003ehttps://www.youtube.com/watch?v=mw_-0iCVpUc\u003c/a\u003e) and it just did not work for\nme....I couldn't stay focused (blame ADHD or just my CLI obsession?) and certain\nthings like \"Execution role\" that they say to modify are not there in the web UI\nanymore, so I just gave up (I did try though!)\u003c/p\u003e\n\u003cp\u003eTo install aws-sam I used homebrew\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ebrew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etap\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eaws/tap\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ebrew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eaws-sam-cli\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ebrew\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003einstall\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eaws-sam-cli\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e# I had to run the install command twice ref https://github.com/aws/aws-sam-cli/issues/2320#issuecomment-721414971\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003egit\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eclone\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ehttps://github.com/aws-samples/amazon-s3-presigned-urls-aws-sam\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ecd\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eamazon-s3-presigned-urls-aws-sam\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003esam\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003edeploy\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e--guided\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e# proceeds with a guided installation, I used all defaults except I\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e# made \"UploadRequestFunction may not have authorization definedIs\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003eIs\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ethis\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eokay?\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e [y/N]: y\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/media/638408397901987840_0.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThey then in the tutorial describe trying to use postman to test\u003c/p\u003e\n\u003cp\u003eI test with \u003ccode\u003ecurl\u003c/code\u003e instead\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehttps://fjgbqj5436.execute-api.us-east-2.amazonaws.com/uploads\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003euploadURL\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehttps://sam-app-s3uploadbucket-1653634.s3.us-east-2.amazonaws.com/112162.jpg?Content-Type=image%2Fjpeg\u0026#x26;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026#x26;X-Amz-Credential=xxx\u0026#x26;X-Amz-Date=20201224T174804Z\u0026#x26;X-Amz-Expires=300\u0026#x26;X-Amz-Security-Token=yyy\u0026#x26;X-Amz-SignedHeaders=host\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E4F0FB\"\u003eKey\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003e112162.jpg\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #A6ACCD\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe premise of this is you make a request, and then the response from the API is\na pre-signed URL that then allows you to upload directly to S3. You can use\n\u003ccode\u003ecurl \u0026#x3C;url\u003e --upload-file yourfile.jpg\u003c/code\u003e. This automatically does a PUT request\nto the s3 bucket (yes, this is talking directly to s3 now, not the lambda! the\nlambda is just for generating the \"pre-signed URL\" to let you upload). Careful\nto copy it exactly as is\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003ecurl\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #5DE4C7\"\u003ehttps://sam-app-s3uploadbucket-1653634.s3.us-east-2.amazonaws.com/112162.jpg?Content-Type=image%2Fjpeg\u0026#x26;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026#x26;X-Amz-Credential=xxx\u0026#x26;X-Amz-Date=20201224T174804Z\u0026#x26;X-Amz-Expires=300\u0026#x26;X-Amz-Security-Token=yyy\u0026#x26;X-Amz-SignedHeaders=host\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003e--upload-file\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003etest.jpg\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThere is no response, but I can then check the s3 console and see the file\nupload is successful (all files are renamed)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/638408397901987840_1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure shows that the file upload is successful :)\u003c/p\u003e\n\u003cp\u003eThen we can edit the file frontend/index.html from the repo we cloned to contain\nthe lambda with the /uploads/ suffix\u003c/p\u003e\n\u003cp\u003eThen we manually upload this file to another s3 bucket or test it locally\u003c/p\u003e\n\u003cpre class=\"shiki poimandres\" style=\"background-color: #1b1e28\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #91B4D5\"\u003eaws\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003es3\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003ecp\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003eindex.html\u003c/span\u003e\u003cspan style=\"color: #A6ACCD\"\u003e \u003c/span\u003e\u003cspan style=\"color: #ADD7FF\"\u003es3://mybucket/\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #767C9DB0; font-style: italic\"\u003e# then ...visit that in the browser\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAt this point the files are getting uploaded but not publicly accessible. To\nmake them publicly accessible we uncomment the ACL: 'public-read' in the\ngetSignedURL/app.js folder in the github repo\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/638408397901987840_3.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure showing the public-read uncommented\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/media/638408397901987840_4.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eFigure showing the lines that need uncommenting in template.yaml in the root of\nthe github repo that allows putObject in s3 with the public-read ACL\u003c/p\u003e\n\u003cp\u003eRe-run \u003ccode\u003esam deploy --guided\u003c/code\u003e, same thing as at the start\u003c/p\u003e\n\u003cp\u003eNow the objects are publicly accessible!\u003c/p\u003e"])</script><script>self.__next_f.push([1,"a:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"Making a serverless website for photo upload pt. 1\"}],[\"$\",\"h4\",null,{\"children\":\"2020-12-24\"}]]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$b\"}}],[\"$\",\"$Lc\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Making a serverless website for photo upload pt. 1\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"128x128\"}]]\n9:null\n"])</script></body></html>