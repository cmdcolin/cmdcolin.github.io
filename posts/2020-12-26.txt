1:HL["/_next/static/css/97dc5fe527f5d592.css",{"as":"style"}]
0:["udpFakWG8rWdx1Msx2uS4",[[["",{"children":["posts",{"children":[["id","2020-12-26","d"],{"children":["__PAGE__?{\"id\":\"2020-12-26\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/97dc5fe527f5d592.css","precedence":"next"}]],"$L3"]]]]
4:I{"id":6685,"chunks":["685:static/chunks/685-869e9938cb1ebda6.js","185:static/chunks/app/layout-3759995e3b279a75.js"],"name":"","async":false}
5:I{"id":7767,"chunks":["272:static/chunks/webpack-40edba06f6f71edb.js","971:static/chunks/fd9d1056-442c50ae6fbbd388.js","596:static/chunks/596-e461af40035e62db.js"],"name":"default","async":false}
6:I{"id":7920,"chunks":["272:static/chunks/webpack-40edba06f6f71edb.js","971:static/chunks/fd9d1056-442c50ae6fbbd388.js","596:static/chunks/596-e461af40035e62db.js"],"name":"default","async":false}
2:[null,["$","html",null,{"lang":"en","children":["$","body",null,{"children":[["$","div",null,{"style":{"marginBottom":100},"children":["$","$L4",null,{"href":"/","children":"Misc scribbles"}]}],["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["id","2020-12-26","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L7","$L8",null],"segment":"__PAGE__?{\"id\":\"2020-12-26\"}"},"styles":[]}],"segment":["id","2020-12-26","d"]},"styles":[]}],"segment":"posts"},"styles":[]}],["$","footer",null,{"style":{"marginTop":100},"children":[["$","$L4",null,{"href":"/","children":"Home"}]," ",["$","$L4",null,{"href":"/archive","children":"Blog archive"}]," ",["$","$L4",null,{"href":"https://github.com/cmdcolin/","children":"Github"}]," ",["$","$L4",null,{"href":"https://twitter.com/cmdcolin","children":"Twitter"}]," ",["$","$L4",null,{"href":"/projects","children":"Projects"}]," ",["$","$L4",null,{"href":"/photos","children":"Photos"}]," ",["$","$L4",null,{"href":"/about","children":"About"}]]}]]}]}],null]
a:I{"id":6306,"chunks":["722:static/chunks/app/posts/[id]/page-8cf76b3c924a344e.js"],"name":"","async":false}
9:T175f9,<p>This post follows onhttps://cmdcolin.github.io/2020-12-24.html</p>
<p>It is possible I zoomed ahead too fast to make this a continuous tutorial, but
overall I just wanted to post an update</p>
<p>In pt. 1 I learned how to use the <code>aws-sam</code> CLI tool. This was a great insight
for me about automating deployments. I can now simply run <code>sam deploy</code> and it
will create new dynamodb tables, lambda functions, etc.</p>
<p>After writing pt 1. I converted the existing vue-js app that was in the aws
tutorial and converted it to react. Then I extended the app to allow</p>
<ul>
<li>Posting comments on photos</li>
<li>Uploading multiple files</li>
<li>Uploading videos etc.</li>
</ul>
<p>It will be hard to summarize all the changes since now the app has taken off a
little bit but it looks like this:</p>
<p>Repo structure</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">./frontend</span></span>
<span class="line"><span style="color: #91B4D5">./frontend/src/App.tsx</span></span>
<span class="line"><span style="color: #91B4D5">./lambdas/</span></span>
<span class="line"><span style="color: #91B4D5">./lambdas/postFile</span></span>
<span class="line"><span style="color: #91B4D5">./lambdas/getFiles</span></span>
<span class="line"><span style="color: #91B4D5">./lambdas/postComment</span></span>
<span class="line"><span style="color: #91B4D5">./lambdas/getComments</span></span></code></pre>
<p>Here is a detailed code for uploading the file. We upload one file at a time,
but the client code post to the lambda endpoint individually for each file</p>
<p>This generates a pre-signed URL to allow the client-side JS (not the lambda
itself) to directly upload to S3, and also posts a row in the S3 to the filename
that will. It is very similar code in to
<a href="https://cmdcolin.github.io/2020-12-24.html">https://cmdcolin.github.io/2020-12-24.html</a></p>
<p>./lambdas/postFile/app.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">use strict</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">AWS</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">require</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">aws-sdk</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">multipart</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">require</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">./multipart</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #ADD7FF">AWS</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">config</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">update</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">region</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">process</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">env</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">AWS_REGION</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">})</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">s3</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">AWS</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">S3</span><span style="color: #A6ACCD">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Change this value to adjust the signed URL's expiration</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">URL_EXPIRATION_SECONDS</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">300</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">// Main Lambda entry point</span></span>
<span class="line"><span style="color: #E4F0FB">exports</span><span style="color: #A6ACCD">.</span><span style="color: #ADD7FF">handler</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getUploadURL</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { AWS_REGION: </span><span style="color: #E4F0FB">region</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">process</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">env</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">dynamodb</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">AWS</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">DynamoDB</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">apiVersion</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">2012-08-10</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> region</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">uploadPic</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">timestamp</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">message</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">user</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">contentType</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">}) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">params</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">Item</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">timestamp</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">N</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">timestamp</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">filename</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">S</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">message</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">S</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">message</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">user</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">S</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">user</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">date</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">S</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">contentType</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #ADD7FF">S</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">contentType</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">},</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">TableName</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">files</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">dynamodb</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">putItem</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">params</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">promise</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getUploadURL</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #D0679D">try</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">multipart</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">parse</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">contentType</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">user</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">message</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">date</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">data</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">timestamp</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">+</span><span style="color: #E4F0FB">Date</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">now</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">Key</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">timestamp</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">-</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD"> </span><span style="color: #767C9DB0; font-style: italic">// Get signed URL from S3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">s3Params</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">Bucket</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">process</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">env</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">UploadBucket</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      Key</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">Expires</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">URL_EXPIRATION_SECONDS</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">ContentType</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">contentType</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// This ACL makes the uploaded object publicly readable. You must also</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// uncomment the extra permission for the Lambda function in the SAM</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">// template.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">ACL</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">public-read</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">uploadURL</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">s3</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">getSignedUrlPromise</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">putObject</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">s3Params</span><span style="color: #A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">uploadPic</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #E4F0FB">      timestamp</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">filename</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">Key</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      message</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      user</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      date</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      contentType</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">stringify</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #E4F0FB">      uploadURL</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      Key</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">})</span></span>
<span class="line"><span style="color: #A6ACCD">  } </span><span style="color: #D0679D">catch</span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">statusCode</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">500</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">stringify</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">message</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">}`</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">response</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>./lambdas/getFiles/app.js</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #767C9DB0; font-style: italic">// eslint-disable-next-line import/no-unresolved</span></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">AWS</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">require</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">aws-sdk</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { AWS_REGION: </span><span style="color: #E4F0FB">region</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">process</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">env</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">docClient</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">AWS</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">DynamoDB</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">DocumentClient</span><span style="color: #A6ACCD">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">getItems</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> () {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">params</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #ADD7FF">TableName</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">files</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">docClient</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">scan</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">params</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">promise</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">exports</span><span style="color: #A6ACCD">.</span><span style="color: #ADD7FF">handler</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #D0679D">try</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">result</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">getItems</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">statusCode</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">200</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">stringify</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">result</span><span style="color: #A6ACCD">),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">  } </span><span style="color: #D0679D">catch</span><span style="color: #A6ACCD"> (</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">statusCode</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #5DE4C7">400</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">      </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> JSON</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">stringify</span><span style="color: #A6ACCD">({</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">message</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">}`</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}),</span></span>
<span class="line"><span style="color: #E4F0FB">    </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>./frontend/src/App.tsx (excerpt)</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">async</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">myfetch</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">params</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">string</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">opts</span><span style="color: #91B4D5">?:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">any</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">fetch</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">params</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">opts</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  if (</span><span style="color: #91B4D5">!</span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">ok</span><span style="color: #A6ACCD">) {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #D0679D">throw</span><span style="color: #A6ACCD"> </span><span style="color: #5DE4C7">new</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">Error</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">`</span><span style="color: #5DE4C7">HTTP </span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">status</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7"> </span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">statusText</span><span style="color: #A6ACCD">}`</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">response</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">json</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">UploadDialog</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">open</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">onClose</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">}</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  open</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">boolean</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #ADD7FF">onClose</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">void</span></span>
<span class="line"><span style="color: #A6ACCD">}) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">images</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setImages</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">&#x3C;</span><span style="color: #A6ACCDC0">FileList</span><span style="color: #A6ACCD">>()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setError</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">&#x3C;</span><span style="color: #A6ACCDC0">Error</span><span style="color: #A6ACCD">>()</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">loading</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setLoading</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">(</span><span style="color: #D0679D">false</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">total</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setTotal</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">completed</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setCompleted</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">user</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setUser</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">''</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> [</span><span style="color: #E4F0FB">message</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">setMessage</span><span style="color: #A6ACCD">] </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useState</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">''</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">classes</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FBD0">useStyles</span><span style="color: #A6ACCD">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">handleClose</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> () </span><span style="color: #91B4D5">=></span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setError</span><span style="color: #A6ACCD">(</span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setLoading</span><span style="color: #A6ACCD">(</span><span style="color: #D0679D">false</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setImages</span><span style="color: #A6ACCD">(</span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setCompleted</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setTotal</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">setMessage</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">''</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FBD0">onClose</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #A6ACCD">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">&#x3C;</span><span style="color: #5DE4C7">Dialog</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">onClose</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{handleClose} </span><span style="color: #91B4D5; font-style: italic">open</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{open}></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">DialogTitle</span><span style="color: #E4F0FB">>upload a file (supports picture or video)&#x3C;/</span><span style="color: #5DE4C7">DialogTitle</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">DialogContent</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">label</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">htmlFor</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">user</span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">>name (optional) &#x3C;/</span><span style="color: #5DE4C7">label</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">input</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">type</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">text</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">value</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{user}</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">onChange</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{event </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">setUser</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">target</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">id</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">user</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">        /></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">br</span><span style="color: #E4F0FB"> /> &#x3C;</span><span style="color: #5DE4C7">label</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">htmlFor</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">user</span><span style="color: #A6ACCD">"</span><span style="color: #E4F0FB">>message (optional) &#x3C;/</span><span style="color: #5DE4C7">label</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">input</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">type</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">text</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">value</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{message}</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">onChange</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{event </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">setMessage</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">event</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">target</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">value</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">id</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">message</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">        /></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">br</span><span style="color: #E4F0FB"> /></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;</span><span style="color: #5DE4C7">input</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">multiple</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">type</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">file</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #91B4D5; font-style: italic">onChange</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{e </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5">let</span><span style="color: #E4F0FB"> files </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> e</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">target</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">files</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #A6ACCD">if</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">files </span><span style="color: #91B4D5">&#x26;&#x26;</span><span style="color: #E4F0FB"> files</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">length</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">              </span><span style="color: #E4F0FBD0">setImages</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">files</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">        /> {error </span><span style="color: #91B4D5">?</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">div</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">className</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{classes</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">error}>{</span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">error</span><span style="color: #A6ACCD">}`</span><span style="color: #E4F0FB">}&#x3C;/</span><span style="color: #5DE4C7">div</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">:</span><span style="color: #E4F0FB"> loading </span><span style="color: #91B4D5">?</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">          </span><span style="color: #A6ACCD">`</span><span style="color: #5DE4C7">Uploading...</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">completed</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">/</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">total</span><span style="color: #A6ACCD">}`</span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">:</span><span style="color: #E4F0FB"> completed </span><span style="color: #91B4D5">?</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">h2</span><span style="color: #E4F0FB">>Uploaded &#x3C;/</span><span style="color: #5DE4C7">h2</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">:</span><span style="color: #E4F0FB"> </span><span style="color: #D0679D">null</span><span style="color: #E4F0FB">} &#x3C;</span><span style="color: #5DE4C7">DialogActions</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">Button</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">style</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">textTransform</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">none</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">onClick</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #5DE4C7">async</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">()</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">              </span><span style="color: #D0679D">try</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                </span><span style="color: #A6ACCD">if</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">images</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #E4F0FBD0">setLoading</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">true</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #E4F0FBD0">setError</span><span style="color: #A6ACCD">(</span><span style="color: #D0679D">undefined</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #E4F0FBD0">setCompleted</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">0</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #E4F0FBD0">setTotal</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">images</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">length</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #5DE4C7C0">await</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">Promise</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">all</span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">                    Array</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">from</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">images</span><span style="color: #A6ACCD">).</span><span style="color: #E4F0FBD0">map</span><span style="color: #A6ACCD">(</span><span style="color: #5DE4C7">async</span><span style="color: #E4F0FB"> image </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #91B4D5">const</span><span style="color: #E4F0FB"> data </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #5DE4C7">new</span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">FormData</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #E4F0FB">                      data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">append</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">message</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> message</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                      data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">append</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">user</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> user</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                      data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">append</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">date</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #5DE4C7">new</span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">Date</span><span style="color: #A6ACCD">().</span><span style="color: #E4F0FBD0">toLocaleString</span><span style="color: #A6ACCD">())</span></span>
<span class="line"><span style="color: #E4F0FB">                      data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">append</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">filename</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> image</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">name</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                      data</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">append</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">contentType</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> image</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">type</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #91B4D5">const</span><span style="color: #E4F0FB"> res </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #5DE4C7C0">await</span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">myfetch</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">API_ENDPOINT </span><span style="color: #91B4D5">+</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">/postFile</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                        </span><span style="color: #ADD7FF">method</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">POST</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">                        </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">data</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #5DE4C7C0">await</span><span style="color: #E4F0FB"> </span><span style="color: #E4F0FBD0">myfetch</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">res</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FB">uploadURL</span><span style="color: #A6ACCD">,</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                        </span><span style="color: #ADD7FF">method</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">PUT</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">                        </span><span style="color: #ADD7FF">body</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #E4F0FB">image</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #A6ACCD">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E4F0FB">                      </span><span style="color: #E4F0FBD0">setCompleted</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">completed </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> completed </span><span style="color: #91B4D5">+</span><span style="color: #E4F0FB"> </span><span style="color: #5DE4C7">1</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                    </span><span style="color: #A6ACCD">}),</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #E4F0FBD0">setTimeout</span><span style="color: #A6ACCD">(()</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">=></span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                    </span><span style="color: #E4F0FBD0">handleClose</span><span style="color: #A6ACCD">()</span></span>
<span class="line"><span style="color: #E4F0FB">                  </span><span style="color: #A6ACCD">},</span><span style="color: #E4F0FB"> </span><span style="color: #5DE4C7">500</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">                </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #E4F0FB">              </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB"> </span><span style="color: #D0679D">catch</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">                </span><span style="color: #E4F0FBD0">setError</span><span style="color: #A6ACCD">(</span><span style="color: #E4F0FB">e</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #E4F0FB">              </span><span style="color: #A6ACCD">}</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">color</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">primary</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">          ></span></span>
<span class="line"><span style="color: #E4F0FB">            upload</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;/</span><span style="color: #5DE4C7">Button</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">Button</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">onClick</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{handleClose}</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">color</span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD">"</span><span style="color: #5DE4C7">primary</span><span style="color: #A6ACCD">"</span></span>
<span class="line"><span style="color: #E4F0FB">            </span><span style="color: #91B4D5; font-style: italic">style</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">textTransform</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">none</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">          ></span></span>
<span class="line"><span style="color: #E4F0FB">            cancel</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;/</span><span style="color: #5DE4C7">Button</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        &#x3C;/</span><span style="color: #5DE4C7">DialogActions</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;/</span><span style="color: #5DE4C7">DialogContent</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">    &#x3C;/</span><span style="color: #5DE4C7">Dialog</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #A6ACCD">  )</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>template.yaml for AWS</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">AWSTemplateFormatVersion</span><span style="color: #A6ACCD">: 2010-09-09</span></span>
<span class="line"><span style="color: #5DE4C7">Transform</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::Serverless-2016-10-31</span></span>
<span class="line"><span style="color: #5DE4C7">Description</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">S3 Uploader</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">Resources</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">filesDynamoDBTable</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::DynamoDB::Table</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">AttributeDefinitions</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #5DE4C7">AttributeName</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">timestamp</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">AttributeType</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">N</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">KeySchema</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #5DE4C7">AttributeName</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">timestamp</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">KeyType</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">HASH</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">ProvisionedThroughput</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">ReadCapacityUnits</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">5</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">WriteCapacityUnits</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">5</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">TableName</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">files</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic"># HTTP API</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">MyApi</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::Serverless::HttpApi</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># CORS configuration - this is open for development only and should be restricted in prod.</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># See https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-property-httpapi-httpapicorsconfiguration.html</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">CorsConfiguration</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">AllowMethods</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #ADD7FF">GET</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #ADD7FF">POST</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #ADD7FF">DELETE</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #ADD7FF">OPTIONS</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">AllowHeaders</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">*</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">AllowOrigins</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">*</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">UploadRequestFunction</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::Serverless::Function</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">CodeUri</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">lambdas/postFile/</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Handler</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">app.handler</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Runtime</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">nodejs12.x</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Timeout</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">3</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">MemorySize</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">128</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Environment</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">Variables</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">UploadBucket</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Ref</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">S3UploadBucket</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Policies</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #ADD7FF">AmazonDynamoDBFullAccess</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #5DE4C7">S3WritePolicy</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">BucketName</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Ref</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">S3UploadBucket</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #5DE4C7">Statement</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">            - </span><span style="color: #5DE4C7">Effect</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">Allow</span></span>
<span class="line"><span style="color: #A6ACCD">              </span><span style="color: #5DE4C7">Resource</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Sub</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">arn:aws:s3:::${S3UploadBucket}/</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">              </span><span style="color: #5DE4C7">Action</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">                - </span><span style="color: #ADD7FF">s3:putObjectAcl</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Events</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">UploadAssetAPI</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">HttpApi</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">Path</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">/postFile</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">Method</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">post</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">ApiId</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Ref</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">MyApi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">FileReadFunction</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::Serverless::Function</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">CodeUri</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">lambdas/getFiles/</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Handler</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">app.handler</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Runtime</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">nodejs12.x</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Timeout</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">3</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">MemorySize</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">128</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Policies</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        - </span><span style="color: #ADD7FF">AmazonDynamoDBFullAccess</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">Events</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">UploadAssetAPI</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">HttpApi</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">Path</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">/getFiles</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">Method</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">get</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">ApiId</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Ref</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">MyApi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic">## S3 bucket</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">S3UploadBucket</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">AWS::S3::Bucket</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Properties</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">CorsConfiguration</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">CorsRules</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          - </span><span style="color: #5DE4C7">AllowedHeaders</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">              - </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">*</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">AllowedMethods</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">              - </span><span style="color: #ADD7FF">GET</span></span>
<span class="line"><span style="color: #A6ACCD">              - </span><span style="color: #ADD7FF">PUT</span></span>
<span class="line"><span style="color: #A6ACCD">              - </span><span style="color: #ADD7FF">HEAD</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #5DE4C7">AllowedOrigins</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">              - </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">*</span><span style="color: #A6ACCD">'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #767C9DB0; font-style: italic">## Take a note of the outputs for deploying the workflow templates in this sample application</span></span>
<span class="line"><span style="color: #5DE4C7">Outputs</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">APIendpoint</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Description</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">HTTP API endpoint URL</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Value</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Sub</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">https://${MyApi}.execute-api.${AWS::Region}.amazonaws.com</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">S3UploadBucketName</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Description</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">S3 bucket for application uploads</span><span style="color: #A6ACCD">'</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">Value</span><span style="color: #A6ACCD">: </span><span style="color: #91B4D5">!Ref</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">S3UploadBucket</span><span style="color: #A6ACCD">'</span></span></code></pre>
<p>To display all the pictures I use a switch from video or img tag based on
contentType.startsWith('video'). I also use the "figcaption" HTML tag to have a
little caption on the pics/videos</p>
<p>./frontend/src/App.tsx</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #91B4D5">function</span><span style="color: #A6ACCD"> </span><span style="color: #ADD7FF">Media</span><span style="color: #A6ACCD">({</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">file</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">style</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">onClick</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #E4F0FB">children</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">}</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> {</span></span>
<span class="line"><span style="color: #A6ACCD">  file</span><span style="color: #91B4D5">:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">File</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #ADD7FF">onClick</span><span style="color: #91B4D5">?:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">Function</span></span>
<span class="line"><span style="color: #A6ACCD">  style</span><span style="color: #91B4D5">?:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">React</span><span style="color: #A6ACCD">.</span><span style="color: #A6ACCDC0">CSSProperties</span></span>
<span class="line"><span style="color: #A6ACCD">  children</span><span style="color: #91B4D5">?:</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCDC0">React</span><span style="color: #A6ACCD">.</span><span style="color: #A6ACCDC0">ReactNode</span></span>
<span class="line"><span style="color: #A6ACCD">}) {</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> { </span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">, </span><span style="color: #E4F0FB">contentType</span><span style="color: #A6ACCD"> } </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">file</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #91B4D5">const</span><span style="color: #A6ACCD"> </span><span style="color: #E4F0FB">src</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #A6ACCD"> </span><span style="color: #A6ACCD">`${</span><span style="color: #E4F0FB">BUCKET</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">/</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">filename</span><span style="color: #A6ACCD">}`</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7C0">return</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #E4F0FB">&#x3C;</span><span style="color: #5DE4C7">figure</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">style</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{</span><span style="color: #A6ACCD">{</span><span style="color: #E4F0FB"> </span><span style="color: #ADD7FF">display</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">inline-block</span><span style="color: #A6ACCD">'</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">}</span><span style="color: #E4F0FB">}></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">picture</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">        {contentType</span><span style="color: #A6ACCD">.</span><span style="color: #E4F0FBD0">startsWith</span><span style="color: #A6ACCD">(</span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">video</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">?</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">video</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">style</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{style} </span><span style="color: #91B4D5; font-style: italic">src</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{src} </span><span style="color: #91B4D5; font-style: italic">controls</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">onClick</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{onClick </span><span style="color: #A6ACCDC0">as</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCDC0">any</span><span style="color: #E4F0FB">} /></span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5">:</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">(</span></span>
<span class="line"><span style="color: #E4F0FB">          &#x3C;</span><span style="color: #5DE4C7">img</span><span style="color: #E4F0FB"> </span><span style="color: #91B4D5; font-style: italic">style</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{style} </span><span style="color: #91B4D5; font-style: italic">src</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{src} </span><span style="color: #91B4D5; font-style: italic">onClick</span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB">{onClick </span><span style="color: #A6ACCDC0">as</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCDC0">any</span><span style="color: #E4F0FB">} /></span></span>
<span class="line"><span style="color: #E4F0FB">        </span><span style="color: #A6ACCD">)</span><span style="color: #E4F0FB">}</span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;/</span><span style="color: #5DE4C7">picture</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">      &#x3C;</span><span style="color: #5DE4C7">figcaption</span><span style="color: #E4F0FB">>{children}&#x3C;/</span><span style="color: #5DE4C7">figcaption</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #E4F0FB">    &#x3C;/</span><span style="color: #5DE4C7">figure</span><span style="color: #E4F0FB">></span></span>
<span class="line"><span style="color: #A6ACCD">  )</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p>Now the really fun part: if you get an image of a picture frame like
<a href="https://www.amazon.com/Paintings-Frames-Antique-Shatterproof-Osafs2-Gld-A3/dp/B06XNQ8W9T">https://www.amazon.com/Paintings-Frames-Antique-Shatterproof-Osafs2-Gld-A3/dp/B06XNQ8W9T</a></p>
<p>You can make it a border for any image or video using border-image CSS</p>
<pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #E4F0FB">style</span><span style="color: #A6ACCD"> </span><span style="color: #91B4D5">=</span><span style="color: #E4F0FB"> </span><span style="color: #A6ACCD">{</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">border</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">'</span><span style="color: #5DE4C7">30px solid</span><span style="color: #A6ACCD">'</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #E4F0FB">  </span><span style="color: #ADD7FF">borderImage</span><span style="color: #A6ACCD">:</span><span style="color: #ADD7FF"> </span><span style="color: #A6ACCD">`</span><span style="color: #5DE4C7">url(borders/</span><span style="color: #A6ACCD">${</span><span style="color: #E4F0FB">border</span><span style="color: #A6ACCD">}</span><span style="color: #5DE4C7">) 30 round</span><span style="color: #A6ACCD">`</span><span style="color: #A6ACCD">,</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre>
<p><img src="/media/638602799897329664_0.png" alt=""></p>
<h2 id="summary"><a aria-hidden="true" tabindex="-1" href="#summary"><a href="#summary" style="margin-right: 10px">#</a></a>Summary</h2>
<p>The template.yaml automatically deploys the lambdas for postFile/getFile and the
files table in dynamoDB</p>
<p>The React app uses postFile for each file in an <code>&#x3C;input type="file"/></code>, the code
uses React hooks and functional components but is hopefully not too complex</p>
<p>I also added commenting on photos. The code is not shown here but you can look
in the source code for details</p>
<p><img src="/media/638602799897329664_1.png" alt=""></p>
<p>Overall this has been a good experience learning to develop this app and
learning to automate the cloud deployment is really good for ensuring
reliability and fast iteration.</p>
<p>Also quick note on serverless CLI vs aws-sam. I had tried a serverless CLI
tutorial from another user but it didn't click with me, while the aws-sam
tutorial from
<a href="https://searchvoidstar.tumblr.com/post/638408397901987840/making-a-serverless-website-for-photo-upload-pt-1">https://searchvoidstar.tumblr.com/post/638408397901987840/making-a-serverless-website-for-photo-upload-pt-1</a>
was a great kick start for me. I am sure the serverless CLI is great too and it
ensures a bit less vendor lock in, but then is also a little bit removed from
the native aws config schemas. Probably fine though</p>
<h2 id="source-code"><a aria-hidden="true" tabindex="-1" href="#source-code"><a href="#source-code" style="margin-right: 10px">#</a></a>Source code</h2>
<p><a href="https://github.com/cmdcolin/aws_photo_gallery/">https://github.com/cmdcolin/aws_photo_gallery/</a></p>8:["$","article",null,{"children":[["$","div",null,{"children":[["$","h1",null,{"children":"Making a serverless website for photo and video upload pt. 2"}],["$","h4",null,{"children":"2020-12-26"}]]}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$9"}}],["$","$La",null,{}]]}]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Making a serverless website for photo and video upload pt. 2"}],["$","meta","2",{"name":"description","content":"A blog"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"128x128"}]]
7:null
