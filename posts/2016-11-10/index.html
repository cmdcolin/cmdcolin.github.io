<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Astro description"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v6.0.0-beta.1"><title>Creating a JBrowse plugin</title><style>.container[data-astro-cid-4oxc2zqz]{max-width:800px;margin:0 auto;padding:0 1rem}article[data-astro-cid-lvjzyg5v]{max-width:100%}.post-content[data-astro-cid-lvjzyg5v]{margin:2rem 0;line-height:1.6}
</style>
<link rel="stylesheet" href="/_astro/Layout.Ca4IH_rv.css"></head> <body> <div class="mb-8"> <a href="/">Misc scribbles</a> </div>  <div class="container" data-astro-cid-4oxc2zqz>  <article data-astro-cid-lvjzyg5v> <div data-astro-cid-lvjzyg5v> <h1 data-astro-cid-lvjzyg5v>Creating a JBrowse plugin</h1> <h4 data-astro-cid-lvjzyg5v>2016-11-10</h4> </div> <div class="post-content" data-astro-cid-lvjzyg5v> <p>I have been very impressed with peoples creativity and willingness to dig into
all the details of JBrowse to customize it’s features. One great way to do this
in a modular way is to create a “JBrowse plugin”. This concept sounds hard but
you can set up a simple couple of files and refresh your browser and it will
“just work”!</p>
<h2 id="introduction-to-the-plugin-mindset">Introduction to the plugin mindset</h2>
<p>In a plugin, you can define new things like custom track types, custom adaptors
to new file types, new track selectors, or something really different. A key
insight about the custom types of tracks and things though is that you can put
the name of your new custom class in the jbrowse config file which will then
find the code in your plugin and run it. Plugins can do other things, but the
ability to just swap out track types or other components in the config file is a
great benefit.</p>
<h2 id="a-scenario">A scenario</h2>
<p>One example that was talked about on the mailing list might involve adding new
menu items for a given track. We might consider a plugin that defines a custom
track type to add that functionality.</p>
<p>Basically, we can use object- oriented principles to “inherit” from some
existing track type like CanvasFeatures and then extend its functionality by
overriding the functions.</p>
<p>If you are not familiar with object-oriented javascript, dojo makes it pretty
easy (but, especially get a background on this if you need to, see footnotes
below).</p>
<p>We can inherit a new track type by using the “define” function to include the
dependencies needed in a file, and they are listed in an array at the top of
your file.</p>
<p>Then the “declare” function creates a new class. The first argument to declare
is the is your parent class, like CanvasFeatures, and we type “return declare”
because we are returning our new track class from the module.</p>
<pre><code class="language-js"><a-f>define</a-f><a-p>([</a-p><a-s>'dojo/_base/declare'</a-s><a-p>,</a-p> <a-s>'JBrowse/View/Track/CanvasFeatures'</a-s><a-p>],</a-p> <a-k>function</a-k> <a-p>(</a-p>
  <a-v>declare</a-v><a-p>,</a-p>
  <a-cr>CanvasFeatures</a-cr><a-p>,</a-p>
<a-p>)</a-p> <a-p>{</a-p>
  <a-k>return</a-k> <a-f>declare</a-f><a-p>(</a-p><a-cr>CanvasFeatures</a-cr><a-p>,</a-p> <a-p>{</a-p>
    <a-f>_trackMenuOptions</a-f>: <a-k>function</a-k> <a-p>()</a-p> <a-p>{</a-p>
      <a-k>var</a-k> <a-v>opts</a-v> <a-o>=</a-o> <a-v>this</a-v><a-p>.</a-p><a-f>inherited</a-f><a-p>(</a-p><a-v>arguments</a-v><a-p>)</a-p> <a-c>//call the parent classes function</a-c>

      <a-v>opts</a-v><a-p>.</a-p><a-f>push</a-f><a-p>(</a-p>
        <a-c>// add an extra menu item to the array returned from parent class function</a-c>
        <a-p>{</a-p>
          <a-pr>label</a-pr>: <a-s>'Custom item'</a-s><a-p>,</a-p>
          <a-pr>type</a-pr>: <a-s>'dijit/CheckedMenuItem'</a-s><a-p>,</a-p>
          <a-f>onClick</a-f>: <a-k>function</a-k> <a-p>(</a-p><a-v>event</a-v><a-p>)</a-p> <a-p>{</a-p>
            <a-v>console</a-v><a-p>.</a-p><a-f>log</a-f><a-p>(</a-p><a-s>'Clicked'</a-s><a-p>)</a-p>
          <a-p>},</a-p>
          <a-pr>iconClass</a-pr>: <a-s>'dijitIconPackage'</a-s><a-p>,</a-p>
        <a-p>},</a-p>
      <a-p>)</a-p>
      <a-k>return</a-k> <a-v>opts</a-v>
    <a-p>},</a-p>
  <a-p>})</a-p>
<a-p>})</a-p>
</code></pre>
<p>Code listing 1. an example custom track type, MyTrack.js, that adds an extra
track menu item</p>
<h2 id="now-how-do-we-make-this-a-plugin">Now how do we make this a plugin?</h2>
<p>In the above section, we created a new track subclass with a custom menu option.
How do we use this track? We want to turn it into part of afine the boilerplate
code from the
<a href="http://gmod.org/wiki/JBrowse_Configuration_Guide#Writing_JBrowse_Plugins">Writing plugins</a>
guide.</p>
<pre><code class="language-js"><a-f>define</a-f><a-p>([</a-p><a-s>'dojo/_base/declare'</a-s><a-p>,</a-p> <a-s>'JBrowse/Plugin'</a-s><a-p>],</a-p> <a-k>function</a-k> <a-p>(</a-p>
  <a-v>declare</a-v><a-p>,</a-p>
  <a-cr>JBrowsePlugin</a-cr><a-p>,</a-p>
<a-p>)</a-p> <a-p>{</a-p>
  <a-k>return</a-k> <a-f>declare</a-f><a-p>(</a-p>
    <a-cr>JBrowsePlugin</a-cr><a-p>,</a-p> <a-c>// this line says our plugin's main.js derives from the "JBrowse/Plugin" base class</a-c>
    <a-p>{</a-p>
      <a-f>constructor</a-f>: <a-k>function</a-k> <a-p>(</a-p><a-v>args</a-v><a-p>)</a-p> <a-p>{</a-p>
        <a-c>//don't necessarily have to do any initializing here, but you</a-c>
        <a-c>//can get a handle to various jbrowse components if any initialization</a-c>
        <a-c>//is needed from the args.browser variable</a-c>
      <a-p>},</a-p>
    <a-p>},</a-p>
  <a-p>)</a-p>
<a-p>})</a-p>
</code></pre>
<p>Code listing 2. Our plugin’s main.js</p>
<p>After this, we create the plugin directory structure</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin/js</p>
<blockquote>
<p>jbrowse/plugins/MyPlugin/js/main.js</p>
<p>jbrowse/plugins/MyPlugin/js/MyTrack.js</p>
</blockquote>
</blockquote>
</blockquote>
<p>Then we can add our new plugin to a config file like <code>jbrowse_conf.json</code> as
<code>"plugins": ["MyPlugin"]</code> and then make a track in <code>trackList.json</code> have
<code>"type": "MyPlugin/MyTrack"</code> instead of for example <code>"type": "CanvasFeatures"</code>.
That will tell jbrowse to load the <code>MyTrack</code> class from your plugin instead of
the normal <code>CanvasFeatures</code> class.</p>
<p>That’s about it!</p>
<p>Note that the <code>bin/new-plugin.pl</code> script can automatically initialize some of
this directory structure too. Try running <code>bin/new-plugin.pl MyPlugin</code> and see
what happens.</p>
<h3 id="footnotes">Footnotes:</h3>
<p>It is important to understand the module format (AMD) which is what the “define”
function is about and the dojo way of defining classes using the “declare”
function. Together, this allows the dojo to create object-oriented programs that
are modular in javascript. See
<a href="http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html">http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html</a> and
<a href="http://dojotoolkit.org/documentation/tutorials/1.9/modules/">http://dojotoolkit.org/documentation/tutorials/1.9/modules/</a> (understanding this
helps you understand the “preamble” for declaring a jbrowse plugin)</p> </div> <div id="giscus"></div> <script>
  const script = document.createElement('script');
  script.src = 'https://giscus.app/client.js';
  script.setAttribute('data-repo', 'cmdcolin/cmdcolin.github.io');
  script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNjE0OTY3Nw==');
  script.setAttribute('data-category', 'General');
  script.setAttribute('data-category-id', 'DIC_kwDOAY8DLc4CO-L9');
  script.setAttribute('data-mapping', 'pathname');
  script.setAttribute('data-strict', '0');
  script.setAttribute('data-reactions-enabled', '1');
  script.setAttribute('data-emit-metadata', '0');
  script.setAttribute('data-input-position', 'bottom');
  script.setAttribute('data-theme', 'light');
  script.setAttribute('data-lang', 'en');
  script.setAttribute('crossorigin', 'anonymous');
  script.async = true;
  document.getElementById('giscus').appendChild(script);
</script> </article>  </div>   <footer class="footer-style" data-astro-cid-k2f5zb5c> <a class="footer-link" href="/" data-astro-cid-k2f5zb5c>Home</a> <a class="footer-link" href="/archive" data-astro-cid-k2f5zb5c>Blog archive</a> <a class="footer-link" href="https://github.com/cmdcolin/" data-astro-cid-k2f5zb5c>Github</a> <a class="footer-link" href="/projects" data-astro-cid-k2f5zb5c>Projects</a> <a class="footer-link" href="/about" data-astro-cid-k2f5zb5c>About</a> </footer> </body></html> 