<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/82eb5efba2a6c9217a68.css" as="style"/><link rel="stylesheet" href="/_next/static/css/82eb5efba2a6c9217a68.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-b97a0ed4f13ff8397343.js" defer=""></script><script src="/_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-72a03db9ecdc52193d45.js" defer=""></script><script src="/_next/static/chunks/pages/2021-09-05-typescript-33b2caebc374813864c8.js" defer=""></script><script src="/_next/static/4R9lIUNYn0JZ1JUSKlg6Q/_buildManifest.js" defer=""></script><script src="/_next/static/4R9lIUNYn0JZ1JUSKlg6Q/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><a href="/">Return home</a><img src="/avatar.png" style="height:2em;margin-left:1em"/></div><div class="blog"><h1>Decrease your idle CPU usage when developing typescript apps with this one weird environment variable</h1><p>TL;DR:</p><p>add this to your bashrc</p><pre><code>export TSC_WATCHFILE=UseFsEventsWithFallbackDynamicPolling
</code></pre><hr/><p>By default, the typescript watcher configuration e.g. tsc --watch or whatever is run internally to a create-react-app typescript app (I see it in the process manager as fork-ts-checker-webpack-plugin cpu usage) can have high CPU usage by default</p><p>This is because the default configuration polls for file changes (constantly
asks the computer if there are changes every second or so). There is an
alternative configuration for this to change it to a file watcher so it
receives file system notifications on file change. There is discussion here on
this.</p><p>The main summary is that a env variable set to
TSC_WATCHFILE=UseFsEventsWithFallbackDynamicPolling allows this</p><p><a href="https://github.com/microsoft/TypeScript/issues/31048">https://github.com/microsoft/TypeScript/issues/31048</a></p><p>The issue thread shows that it can go from roughly ~7% idle CPU usage to 0.2%.
This corresponds with what I see too after applying this! Detailed docs for
typescript discuss some of the reasoning behing not making this the default</p><p><a href="https://github.com/microsoft/TypeScript-Handbook/blob/master/pages/Configuring%20Watch.md#background">https://github.com/microsoft/TypeScript-Handbook/blob/master/pages/Configuring%20Watch.md#background</a></p><p>It claims that some OS specific behaviors of file watching could be harmful to
making it the default. For example, that (maybe?) on linux, it may use a large
number of file watchers which can exceed notify handles (this is a setting I
commonly have to increase in linux, guide here
<a href="https://dev.to/rubiin/ubuntu-increase-inotify-watcher-file-watch-limit-kf4">https://dev.to/rubiin/ubuntu-increase-inotify-watcher-file-watch-limit-kf4</a>)</p><p>PS: if you have a package.json of a <code>create-react-app --template typescript</code> or
something like this then you can edit the package.json to apply this
automatically</p><pre><code>-&quot;start&quot;: &quot;react-scripts start&quot;
+&quot;start&quot;: &quot;cross-env TSC_WATCHFILE=UseFsEventsWithFallbackDynamicPolling react-scripts start&quot;
</code></pre><p>Phew. I can already feel my laptop running cooler...or at least I can sleep
more soundly knowing that my readers adopt this and save some CPU cycles for
planet earth...and hopefully don&#x27;t run into any of the caveats</p><p>Disclaimer: it may be worth reading the reasons that typescript does not have
this enabled by default before pushing this into your dev environment and all
your teammates, but as far as I could tell, it seems ok!</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/2021-09-05-typescript","query":{},"buildId":"4R9lIUNYn0JZ1JUSKlg6Q","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>