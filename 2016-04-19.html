<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/39537df1dfa69610d89e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/39537df1dfa69610d89e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-b97a0ed4f13ff8397343.js" defer=""></script><script src="/_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-72a03db9ecdc52193d45.js" defer=""></script><script src="/_next/static/chunks/pages/2016-04-19-ce6af49ca662c565c2fb.js" defer=""></script><script src="/_next/static/OTXqL_pNLhZW5kFHttQ5t/_buildManifest.js" defer=""></script><script src="/_next/static/OTXqL_pNLhZW5kFHttQ5t/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><a href="/">Return home</a><img src="/avatar.png" style="height:2em;margin-left:1em"/></div><div class="blog"><h1>Creating a testing framework for JBrowse plugins</h1><p>Testing client side apps requires a couple of tedious steps: Organizing
the git clone, the dependencies, wrangling up a web server, the test
framework, etc.</p><p>When testing a plugin for jbrowse, the dependency tree is interesting
because the plugin &quot;depends&quot; on JBrowse to run, but we will use
travis-CI and bower inside the git repo for our plugin to accomplish
this.</p><p>In this scenario, we will</p><ol><li><p>Use bower to install jasmine and JBrowse (our platform that we write
the plugin for)</p></li><li><p>Use nginx to launch a webserver on travis-CI</p></li><li><p>Use the phantomjs run-jasmine.js script to check jasmine test
results</p></li></ol><p>Without further ado</p><p>Here is the .travis.yml</p><pre><code>sudo: false
addons:
  apt:
    packages:
    - nginx
cache:
  apt: true
  directories:
  - $HOME/.cache/bower
before_install:
  - npm install -g jshint bower
install:
  - bower install
before_script:
  - cat test/travis.conf | envsubst &gt; test/travis-envsubst.conf
  - nginx -c `pwd`/test/travis-envsubst.conf
script:
  - phantomjs test/run-jasmine.js http://localhost:9000/test/
  - jshint js
</code></pre><p>Refer to
<a href="http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2">http://searchvoidstar.tumblr.com/post/141858047213/running-nginx-on-containerised-travis-ci-pt-2</a>
for details on the nginx setup</p><p>Here is the bower.json</p><pre><code>{
  &quot;name&quot;: &quot;sashimiplot&quot;,
  &quot;homepage&quot;: &quot;https://github.com/cmdcolin/sashimiplot&quot;,
  &quot;description&quot;: &quot;Sashimi track type for jbrowse&quot;,
  &quot;main&quot;: &quot;js/main.js&quot;,
  &quot;keywords&quot;: [
    &quot;bioinformatics&quot;,
    &quot;jbrowse&quot;
  ],
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;ignore&quot;: [
    &quot;**/.*&quot;,
    &quot;node_modules&quot;,
    &quot;bower_components&quot;,
    &quot;src&quot;,
    &quot;test&quot;,
    &quot;tests&quot;
  ],
  &quot;devDependencies&quot;: {
    &quot;jasmine-core&quot;: &quot;jasmine#^2.4.1&quot;,
    &quot;jbrowse&quot;: &quot;git://github.com/GMOD/jbrowse.git#master&quot;
  }
}
</code></pre><p>The key thing here is that it installs jasmine and JBrowse. I set
.bowerrc to install both jasmine and JBrowse to the &quot;test&quot; directory</p><pre><code>{
    &quot;directory&quot;: &quot;test&quot;
}
</code></pre><p>With this setup, bower will make a &quot;flat dependency tree&quot; in the test
directory, so it will look like this</p><pre><code>$ ls -1 test
FileSaver
dbind
dgrid
dijit
dojo
dojox
*index.html*
jDataView
jasmine-core
jbrowse
json-schema
jszlib
lazyload
put-selector
*run-jasmine.js*
*spec*
*travis.conf*
util
xstyle
</code></pre><p>Here the asterisks indicate things that are part of our app, other&#x27;s are
automatically installed by bower (jbrowse, jasmine-core, the dojo
dependencies, and other things)</p><p>Then we can create the jasmine test/index.html to be something like this</p><pre><code>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;


  &lt;meta&gt;
  Jasmine Spec Runner

  &lt;link rel=&quot;stylesheet&quot; href=&quot;jasmine-core/lib/jasmine-core/jasmine.css&quot;&gt;&lt;script src=&quot;jasmine-core/lib/jasmine-core/jasmine.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;jasmine-core/lib/jasmine-core/boot.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;dojo/dojo.js&quot; data-dojo-config=&quot;async: 1&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;
    require( { baseUrl: &#x27;.&#x27;,
               packages: [
                   &#x27;dojo&#x27;,
                   &#x27;dijit&#x27;,
                   &#x27;dojox&#x27;,
                   &#x27;jszlib&#x27;,
                   { name: &#x27;lazyload&#x27;, location: &#x27;lazyload&#x27;, main: &#x27;lazyload&#x27; },
                   &#x27;dgrid&#x27;,
                   &#x27;xstyle&#x27;,
                   &#x27;put-selector&#x27;,
                   &#x27;FileSaver&#x27;,
                   { name: &#x27;jDataView&#x27;, location: &#x27;jDataView/src&#x27;, main: &#x27;jdataview&#x27; },
                   { name: &#x27;JBrowse&#x27;, location: &#x27;jbrowse/src/JBrowse&#x27; },
                   { name: &#x27;SashimiPlot&#x27;, location: &#x27;../js&#x27; }
               ]
    });
  &lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;spec/SashimiPlot.spec.js&quot;&gt;&lt;/script&gt;&lt;div id=&quot;sandbox&quot; style=&quot;overflow:hidden; height:1px;&quot;&gt;&lt;/div&gt;
</code></pre><p>The &quot;packages&quot; in the require statement puts all these packages in the
right &quot;namespace&quot; for the AMD includes, and the &quot;specs&quot; are defined like
<code>&lt;script type=&quot;text/javascript&quot; src=&quot;spec/Projection.spec.js&quot;&gt;&lt;/script&gt;</code></p><p>Finally, run-jasmine.js is used to check the results of the jasmine
tests (it is run via phantomjs in the travis-CI script). It is a special
version for the most recent version of jasmine (2.4)
<a href="https://gist.github.com/vmeln/b6cbb319d9a0efc816be">https://gist.github.com/vmeln/b6cbb319d9a0efc816be</a></p><p>For an example of the project using this, see
<a href="https://github.com/cmdcolin/sashimiplot">https://github.com/cmdcolin/sashimiplot</a></p><p>::: {#footer}
<!-- -->[ April 19th, 2016 11:19am ]<!-- -->{#timestamp} <!-- -->[testing]<!-- -->{.tag}
<!-- -->[unittesting]<!-- -->{.tag} <!-- -->[software]<!-- -->{.tag} <!-- -->[engineering]<!-- -->{.tag}
:::</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/2016-04-19","query":{},"buildId":"OTXqL_pNLhZW5kFHttQ5t","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>