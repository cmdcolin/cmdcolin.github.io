{"pageProps":{"post":{"title":"Creating a JBrowse plugin","date":"2016-11-10","slug":"2016-11-10","mdxSource":{"compiledSource":"var c=Object.defineProperty,d=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var i=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var u=(e,t,o)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))r.call(t,o)&&u(e,o,t[o]);if(i)for(var o of i(t))s.call(t,o)&&u(e,o,t[o]);return e},l=(e,t)=>d(e,h(t));var p=(e,t)=>{var o={};for(var n in e)r.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&i)for(var n of i(e))t.indexOf(n)<0&&s.call(e,n)&&(o[n]=e[n]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var n=o,{components:e}=n,t=p(n,[\"components\"]);return mdx(MDXLayout,l(a(a({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`I have been very impressed with peoples creativity and willingness to\ndig into all the details of JBrowse to customize it's features. One\ngreat way to do this in a modular way is to create a \"JBrowse plugin\".\nThis concept sounds hard but you can set up a simple couple of files and\nrefresh your browser and it will \"just work\"!`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Introduction to the plugin mindset\")),mdx(\"p\",null,`In a plugin, you can define new things like custom track types, custom\nadaptors to new file types, new track selectors, or something really\ndifferent. A key insight about the custom types of tracks and things\nthough is that you can put the name of your new custom class in the\njbrowse config file which will then find the code in your plugin and run\nit. Plugins can do other things, but the ability to just swap out track\ntypes or other components in the config file is a great benefit.`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"A scenario\")),mdx(\"p\",null,`One example that was talked about on the mailing list might involve\nadding new menu items for a given track. We might consider a plugin that\ndefines a custom track type to add that functionality.`),mdx(\"p\",null,`Basically, we can use object- oriented principles to \"inherit\" from some\nexisting track type like CanvasFeatures and then extend its\nfunctionality by overriding the functions.`),mdx(\"p\",null,`If you are not familiar with object-oriented javascript, dojo makes it\npretty easy (but, especially get a background on this if you need to,\nsee footnotes below).`),mdx(\"p\",null,`We can inherit a new track type by using the \"define\" function to\ninclude the dependencies needed in a file, and they are listed in an\narray at the top of your file.`),mdx(\"p\",null,`Then the \"declare\" function creates a new class. The first argument to\ndeclare is the is your parent class, like CanvasFeatures, and we type\n\"return declare\" because we are returning our new track class from the\nmodule.`),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),` define( [\"dojo/_base/declare\",\n \"JBrowse/View/Track/CanvasFeatures\"],\n \\xA0\\xA0\\xA0 function(declare,CanvasFeatures) {\n \\xA0\\xA0\\xA0 return declare(CanvasFeatures, {\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 _trackMenuOptions: function() {\n\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 var opts=this.inherited(arguments); //call the parent\n classes function\n\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 opts.push( // add an extra menu item to the array returned\n from parent class function\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 {\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 label: \"Custom item\",\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 type: 'dijit/CheckedMenuItem',\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 onClick: function(event) {\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 console.log('Clicked');\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 }, \\xA0\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 iconClass: \"dijitIconPackage\"\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 }\\xA0 \\xA0\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 ); \\xA0\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 return opts;\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 }\\xA0 \\xA0\n \\xA0\\xA0\\xA0 });\n \\xA0\\xA0\\xA0 }\\xA0 \\xA0\n );\n`)),mdx(\"p\",null,`Code listing 1. an example custom track type, MyTrack.js, that adds an\nextra track menu item`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Now how do we make this a plugin?\")),mdx(\"p\",null,`In the above section, we created a new track subclass with a custom menu\noption. How do we use this track? We want to turn it into part of afine\nthe boilerplate code from the `,mdx(\"a\",a({parentName:\"p\"},{href:\"http://gmod.org/wiki/JBrowse_Configuration_Guide#Writing_JBrowse_Plugins\"}),`Writing\nplugins`),`\nguide.`),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-js\"}),` define([\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 'dojo/_base/declare',\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 'JBrowse/Plugin'\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 ], \\xA0\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 function(\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 declare,\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 JBrowsePlugin\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 ) {\n \\xA0\n return declare( JBrowsePlugin, // our plugin's main.js derives from\n the \"JBrowse/Plugin\" base class\n {\n \\xA0\\xA0\\xA0 constructor: function( args ) {\n \\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0 /*don't necessarily have to do any initializing here, but you\n can get a handle to various jbrowse components if any initialization\n is needed from the args.browser variable*/\n \\xA0\\xA0\\xA0 }\\xA0 \\xA0\n });\n });\n`)),mdx(\"p\",null,\"Code listing 2. Our plugin's main.js\"),mdx(\"p\",null,\"After this, we create the plugin directory structure\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"jbrowse/plugins/MyPlugin\"),mdx(\"blockquote\",{parentName:\"blockquote\"},mdx(\"p\",{parentName:\"blockquote\"},\"jbrowse/plugins/MyPlugin/js\"),mdx(\"blockquote\",{parentName:\"blockquote\"},mdx(\"p\",{parentName:\"blockquote\"},\"jbrowse/plugins/MyPlugin/js/main.js\"),mdx(\"p\",{parentName:\"blockquote\"},\"jbrowse/plugins/MyPlugin/js/MyTrack.js\")))),mdx(\"p\",null,`Then we can add our new plugin to a config file like jbrowse_conf.json\nas \"plugins\": `,'[\"MyPlugin\"]',`\\xA0 and then make a track in trackList.json\nhave \"type\":\\xA0 \"MyPlugin/MyTrack\" instead of for\nexample\\xA0\"type\":\\xA0\"CanvasFeatures\". That will tell jbrowse to load the\nMyTrack class from your plugin instead of the normal CanvasFeatures\nclass.`),mdx(\"p\",null,\"That's about it!\"),mdx(\"p\",null,`Note that the bin/new-plugin.pl script can automatically initialize some\nof this directory structure too. Try running \"bin/new-plugin.pl\nMyPlugin\" and see what happens.`),mdx(\"p\",null,\"Footnotes:\"),mdx(\"p\",null,`It is important to understand the module format (AMD) which is what the\n\"define\" function is about and the dojo way of definining classes using\nthe \"declare\" function. Together, this allows the dojo to create\nobject-oriented programs that are modular in javascript. See\n`,mdx(\"a\",a({parentName:\"p\"},{href:\"http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html\"}),\"http://dojotoolkit.org/reference-guide/1.10/dojo/_base/declare.html\"),`\nand `,mdx(\"a\",a({parentName:\"p\"},{href:\"http://dojotoolkit.org/documentation/tutorials/1.9/modules/\"}),\"http://dojotoolkit.org/documentation/tutorials/1.9/modules/\"),`\n(understanding this helps you understand the \"preamble\" for declaring a\njbrowse plugin)`))}MDXContent.isMDXComponent=!0;\n","scope":{}}}},"__N_SSG":true}