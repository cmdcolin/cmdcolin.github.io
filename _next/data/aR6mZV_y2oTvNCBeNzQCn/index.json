{"pageProps":{"allPosts":[{"title":"Don't let it get to you","date":"2022-03-03","slug":"2022-03-02-dont-let-it-get-to-you","mdxSource":{"compiledSource":"var c=Object.defineProperty,l=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var a=Object.getOwnPropertySymbols;var i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var h=(t,e,o)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,r=(t,e)=>{for(var o in e||(e={}))i.call(e,o)&&h(t,o,e[o]);if(a)for(var o of a(e))s.call(e,o)&&h(t,o,e[o]);return t},p=(t,e)=>l(t,m(e));var u=(t,e)=>{var o={};for(var n in t)i.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&a)for(var n of a(t))e.indexOf(n)<0&&s.call(t,n)&&(o[n]=t[n]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var n=o,{components:t}=n,e=u(n,[\"components\"]);return mdx(MDXLayout,p(r(r({},layoutProps),e),{components:t,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"A big part of my recent career has not been technical but emotional learning\"),mdx(\"p\",null,`I have had to make big efforts to be more relaxed, to take things in stride,\nand to not fight about things. This doesn't necessarily mean I have to roll\nover on things, but I have to be very careful with my tone.`))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"Memoizing async functions so that you don't cache errors","date":"2022-02-26","slug":"2022-02-26-memoize-async","mdxSource":{"compiledSource":"var c=Object.defineProperty,m=Object.defineProperties;var d=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var h=(e,o,a)=>o in e?c(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,t=(e,o)=>{for(var a in o||(o={}))i.call(o,a)&&h(e,a,o[a]);if(r)for(var a of r(o))s.call(o,a)&&h(e,a,o[a]);return e},p=(e,o)=>m(e,d(o));var l=(e,o)=>{var a={};for(var n in e)i.call(e,n)&&o.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&r)for(var n of r(e))o.indexOf(n)<0&&s.call(e,n)&&(a[n]=e[n]);return a};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(a){var n=a,{components:e}=n,o=l(n,[\"components\"]);return mdx(MDXLayout,p(t(t({},layoutProps),o),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"There are two hard problems in computer science: \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://martinfowler.com/bliki/TwoHardThings.html\"}),`Cache invalidation and naming\nthings`),`. In this post we'll\nshow how memoize an async function, and how to invalidate the memoization when\nthe promise throws an error.`),mdx(\"p\",null,`This helps us with being able to re-try because since the error is not cached,\ncalling it again after an error retries automatically.`),mdx(\"p\",null,\"Example async function: fetch from the pokemon API\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`async function getPokemon() {\n  const id = Math.floor(Math.random() * 150)\n  const url = 'https://pokeapi.co/api/v2/pokemon/' + id\n  const ret = await fetch(url)\n  if (!ret.ok) {\n    throw new Error(\n      \\`Failed to fetch \\${url} HTTP \\${ret.status} \\${ret.statusText}\\`,\n    )\n  }\n  return ret.json()\n}\n`)),mdx(\"p\",null,\"Here is a technique that can be used to memoize this function\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`function getPokemonMemoized() {\n  if (!this.promise) {\n    this.promise = getPokemon().catch(e => {\n      this.promise = undefined\n      throw e\n    })\n  }\n  return this.promise\n}\n`)),mdx(\"p\",null,`The promise is held in this.promise, and the important part of this function is\nthat when I get an error, I clear this.promise and re-throw the error. The caller\nof the function, on error, will receive the error message, but caching will not\ntake place, allowing retries to take place later on.`),mdx(\"p\",null,\"See \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://cmdcolin.github.io/pokemon.html\"}),\"https://cmdcolin.github.io/pokemon.html\"),\" for demo\"),mdx(\"h2\",null,\"Footnote 0: Arguments to function\"),mdx(\"p\",null,`If your function takes arguments, then you can use a hashmap associating the\nargument with the promise. You may also consider using an LRU cache so that\nyour hashmap doesn't grow infinitely in size`),mdx(\"p\",null,`Generally you need a way to stringify or otherwise make them able to be stored\nin a Map or Object to do this.`),mdx(\"p\",null,\"See \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://github.com/nodeca/promise-memoize\"}),\"https://github.com/nodeca/promise-memoize\"),\" for example\"),mdx(\"h2\",null,\"Footnote 1: Error handling of \",mdx(\"inlineCode\",{parentName:\"h2\"},\"fetch\")),mdx(\"p\",null,`This demo also demonstrates some basic fetch error handling, and uses\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"statusText\"),\" \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/API/Response/statusText\"}),`which happens to not exist in\nHTTP/2`),`.\nIf you want a semblence of status message text in HTTP/2 you can try to use\nawait ret.json() (if the API returns json error messages) or await ret.text()\ninside the catch clause, but note that it could cause yet another error to be\nthrown`),mdx(\"h2\",null,\"Footnote 2: Global cache\"),mdx(\"p\",null,`You could also keep a cache in a global variable, or as a property on a class,\nor other methods. I have also found it useful to have a specific function for\nclearing the cache, so you can get a clean slate each time a test runs in unit\ntesting or similar`),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`let promise\nasync function getPokemonMemoized() {\n  if (!promise) {\n    promise = getPokemon().catch(e => {\n      promise = undefined\n      throw e\n    })\n  }\n  return promise\n}\nfunction clearCache() {\n  promise = undefined\n}\n`)),mdx(\"p\",null,\"You can also make a general purpose utility to memoize any promise function\"),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`function memoize(fn) {\n  let promise\n  return () => {\n    if (!promise) {\n      promise = fn().catch(e => {\n        promise = undefined\n        throw e\n      })\n    }\n  }\n}\n`)),mdx(\"h2\",null,\"Footnote 3 - Aborting\"),mdx(\"p\",null,`If you want to handle aborting, it is a bit trickier. Aborting in javascript is\nhandled by\n`,mdx(\"a\",t({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController/AbortController\"}),\"AbortController\"),`.\nThis is an object that gives you an\n`,mdx(\"a\",t({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal\"}),\"AbortSignal\"),`\nthat can be passed to fetch calls and the like to stop a big download from\nhappening.`),mdx(\"p\",null,`In our above example, if we passed an abort signal to the first call to fetch,\nand then aborted it, it would abort the fetch, `,mdx(\"a\",t({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort\"}),`which throws a DOMException\ncalled\n\"AbortError\"`),`.\nYou can detect that it is an AbortError like this, and may choose not to\ndisplay or re-throw the abort exception`),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`function isAbortException(e) {\n  return e instanceof Error && exception.name === 'AbortError'\n}\n`)),mdx(\"p\",null,`Now, what if 5 functions call getPokemonMemoized(), all passing different abort\nsignals. What if the first one aborts? Then all the rest will get aborted also.\nBut what if we only want to abort the cached call if literally all of them\naborted? Then we may have to synthesize an abortcontroller inside our function`),mdx(\"pre\",null,mdx(\"code\",t({parentName:\"pre\"},{className:\"language-javascript\"}),`let promise\nlet abortcontroller\nlet listeners = 0\nasync function getPokemonMemoized(signal) {\n  if (!promise) {\n    abortcontroller = new AbortController()\n\n    // synthesize a new signal instead of using the passed in signal\n    promise = getPokemon(abortcontroller.signal).catch(e => {\n      promise = undefined\n      throw e\n    })\n  }\n  if (signal) {\n    listeners++\n    // add listener to the passed in signal\n    signal.addEventListener('abort', () => {\n      listeners--\n      if (listeners === 0) {\n        abortcontroller.abort()\n      }\n    })\n  }\n  return promise\n}\n`)),mdx(\"p\",null,`A library my team created,\n`,mdx(\"a\",t({parentName:\"p\"},{href:\"https://github.com/GMOD/abortable-promise-cache\"}),\"abortable-promise-cache\"),`,\ntries to help with this scenario with a cleaner abstraction.`),mdx(\"h2\",null,\"Footnote 4\"),mdx(\"p\",null,`I have been playing through Pokemon Yellow and find it really amusing hence the\npokemon theme`),mdx(\"p\",null,`Fun stuff: The cutting room floor wiki with unused moves, sounds, and sprites\nin Pokemon Yellow `,mdx(\"a\",t({parentName:\"p\"},{href:\"https://tcrf.net/Pok%C3%A9mon_Yellow\"}),\"https://tcrf.net/Pok%C3%A9mon_Yellow\")),mdx(\"h2\",null,\"Footnote 5\"),mdx(\"p\",null,\"This blog post mentioned in a comment thread \",mdx(\"a\",t({parentName:\"p\"},{href:\"https://zansh.in/memoizer.html\"}),\"https://zansh.in/memoizer.html\"),` has\ngreat interactive examples and shows the \"invalidate on .catch()\" behavior!`))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"Ukraine","date":"2022-02-24","slug":"2022-02-24-ukraine","mdxSource":{"compiledSource":"var u=Object.defineProperty,h=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var t=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var p=(o,n,e)=>n in o?u(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,i=(o,n)=>{for(var e in n||(n={}))r.call(n,e)&&p(o,e,n[e]);if(t)for(var e of t(n))s.call(n,e)&&p(o,e,n[e]);return o},d=(o,n)=>h(o,c(n));var m=(o,n)=>{var e={};for(var a in o)r.call(o,a)&&n.indexOf(a)<0&&(e[a]=o[a]);if(o!=null&&t)for(var a of t(o))n.indexOf(a)<0&&s.call(o,a)&&(e[a]=o[a]);return e};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(e){var a=e,{components:o}=a,n=m(a,[\"components\"]);return mdx(MDXLayout,d(i(i({},layoutProps),n),{components:o,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"As Russia is actively invading Ukraine my heart goes out to them.\"),mdx(\"p\",null,`Even if I had no personal connection with Ukraine, I would find this abhorrent,\nbut I do have personal connections to Ukraine in various ways that makes me\nthink of them more fondly`),mdx(\"p\",null,`My first, and so far only, consulting job was with a company in Ukraine, around 2012. I helped them configure JBrowse, and prepared an official looking word\ndocument with recommendations and hours (a total of like...2 hours) and they\nwere very nice.`),mdx(\"p\",null,\"Stand strong Ukraine\"),mdx(\"img\",{src:\"https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Lesser_Coat_of_Arms_of_Ukraine.svg/172px-Lesser_Coat_of_Arms_of_Ukraine.svg.png\"}))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"Back when I was a noise musician...","date":"2022-02-15","slug":"2022-02-15-noise","mdxSource":{"compiledSource":"var h=Object.defineProperty,u=Object.defineProperties;var l=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var r=(o,t,e)=>t in o?h(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,p=(o,t)=>{for(var e in t||(t={}))s.call(t,e)&&r(o,e,t[e]);if(n)for(var e of n(t))i.call(t,e)&&r(o,e,t[e]);return o},c=(o,t)=>u(o,l(t));var m=(o,t)=>{var e={};for(var a in o)s.call(o,a)&&t.indexOf(a)<0&&(e[a]=o[a]);if(o!=null&&n)for(var a of n(o))t.indexOf(a)<0&&i.call(o,a)&&(e[a]=o[a]);return e};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(e){var a=e,{components:o}=a,t=m(a,[\"components\"]);return mdx(MDXLayout,c(p(p({},layoutProps),t),{components:o,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`Found this photo of myself from a photo book published by john cates called\nauditory depravation...great documentation of michigan area noise activity. I\nam actually the last photo in the book amongst so many amazing\nartists...totally honored. I forgot I was even in the book when I picked it up\nrandomly.`),mdx(\"p\",null,\"thank you john cates!!!\"),mdx(\"img\",{src:\"/photos/noise/cover-crop-fs8.png\"}),mdx(\"p\",null,\"cover\"),mdx(\"img\",{src:\"/photos/noise/out20-crop-fs8.png\"}),mdx(\"p\",null,\"index p1\"),mdx(\"img\",{src:\"/photos/noise/out21-crop-fs8.png\"}),mdx(\"p\",null,\"index p2\"),mdx(\"img\",{src:\"/photos/noise/out22-crop-fs8.png\"}),mdx(\"p\",null,\"index p3, i'm last as xephedradap\"),mdx(\"img\",{src:\"/photos/noise/out15-crop-fs8.png\"}),mdx(\"p\",null,\"me\"),mdx(\"img\",{src:\"/photos/noise/out16-crop-fs8.png\"}),mdx(\"p\",null,\"abstract b/w\"),mdx(\"p\",null,\"some photos from the book here \",mdx(\"a\",p({parentName:\"p\"},{href:\"https://www.johncatesphoto.com/noise\"}),\"https://www.johncatesphoto.com/noise\")),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",p({parentName:\"li\"},{href:\"https://soundcloud.com/xephedradap/amazingnoisetreasure\"}),\"lightyear fluctuations\"),\" (hnw)\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",p({parentName:\"li\"},{href:\"https://soundcloud.com/xephedradap/symptomatic-of-extreme-decay\"}),\"symptomatic of extreme decay\"),\" (circuit bent hnw)\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",p({parentName:\"li\"},{href:\"https://soundcloud.com/xephedradap/2016-10-10-13-35-49a\"}),\"2016-10-10-13-35-49a\"),\" (circuit bent drum machine)\")),mdx(\"p\",null,\"I will make more noise soon...stay tuned\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"Structural variants and the SAM format - the long (reads) and short (reads) of it","date":"2022-02-06","slug":"2022-02-06-sv-sam","mdxSource":{"compiledSource":"var h=Object.defineProperty,m=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var p=(n,t,i)=>t in n?h(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,e=(n,t)=>{for(var i in t||(t={}))r.call(t,i)&&p(n,i,t[i]);if(o)for(var i of o(t))s.call(t,i)&&p(n,i,t[i]);return n},l=(n,t)=>m(n,c(t));var d=(n,t)=>{var i={};for(var a in n)r.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&o)for(var a of o(n))t.indexOf(a)<0&&s.call(n,a)&&(i[a]=n[a]);return i};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(i){var a=i,{components:n}=a,t=d(a,[\"components\"]);return mdx(MDXLayout,l(e(e({},layoutProps),t),{components:n,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` specification is pretty amazing\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/SAMv1.pdf\"}),\"https://samtools.github.io/hts-specs/SAMv1.pdf\"),` but it is also fairly terse and\nabstract. True understanding might come from playing with real world data, but\nI will try to relay some things I have learned, especially as they relate to\nstructural variants.`),mdx(\"p\",null,`Disclaimer: I'm a developer of JBrowse 2. This document has some screenshots\nand links for it, feel free to try it at `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org\"}),\"https://jbrowse.org\")),mdx(\"p\",null,\"Also note: When I refer to a \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` record in this document, it could come from\na `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\", or \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),\" file as \",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),` are just alternative\nencodings of `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\")),mdx(\"h2\",null,\"Basics\"),mdx(\"h3\",null,\"What is a \",mdx(\"inlineCode\",{parentName:\"h3\"},\"SAM\"),\" file and how does it relate to \",mdx(\"inlineCode\",{parentName:\"h3\"},\"BAM\"),\" and \",mdx(\"inlineCode\",{parentName:\"h3\"},\"CRAM\"),\"?\"),mdx(\"p\",null,\"A \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" file \",mdx(\"strong\",{parentName:\"p\"},\"generally\"),` contains \"reads\" from a sequencer, with information\nabout how they are mapped to a reference genome `,\"[1][2]\",`. The raw unaligned reads\nare often stored in `,mdx(\"inlineCode\",{parentName:\"p\"},\"FASTQ\"),\" format files. The reads from \",mdx(\"inlineCode\",{parentName:\"p\"},\"FASTQ\"),` format are\nthen inputted into an aligner such as `,mdx(\"inlineCode\",{parentName:\"p\"},\"bwa\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"bowtie\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"minimap2\"),` (there are\nmany others) which map the reads to a reference genome, and output `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),`\nformat.`),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" is a text format that you can read with your text editor. \",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),` and\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),\" are compressed representations of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" format.\"),mdx(\"p\",null,\"You can convert \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\" with samtools\"),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"samtools view file.sam -o file.bam\")),mdx(\"p\",null,\"A slightly modified command converts \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),` (requires -T argument to\nspecify your reference sequence)`),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"samtools view -T reference.fa file.sam -o file.cram\")),mdx(\"p\",null,\"Also see Appendix C: piping FASTQ from \",mdx(\"inlineCode\",{parentName:\"p\"},\"minimap2\"),\" directly to CRAM\"),mdx(\"p\",null,\"[1]\",\" \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` can contain any type of sequence, not specifically reads. If you\ncreated a de novo assembly, you could align the contigs of the de novo assembly\nto a reference genome and store the results in `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\".\"),mdx(\"p\",null,\"[2]\",` Does not always have to have information about mapping to a reference\ngenome. You can also store unaligned data in `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),` (so-called\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"uBAM\"),\" for example) but most of the time, the reads in \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` format are aligned\nto a reference genome.`),mdx(\"h3\",null,\"What is in a \",mdx(\"inlineCode\",{parentName:\"h3\"},\"SAM\"),\" file\"),mdx(\"p\",null,\"A \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\" file contains a header (\",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),\" files also have the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),`\nheader) and a series of records. A record is a single line in a `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file, and\nit generally corresponds to a single read, but as we will see, a split\nalignment may produce multiple records that refer to the same source read.`),mdx(\"p\",null,`Note: if a read failed to align to the reference genome, it may still be in\nyour `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file, marked as unmapped using the flag column. Sometimes, \"dumpster\ndiving\" (looking at the unmapped records from a `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file) can be used to aid\nstructural variant searches (e.g. there may be novel sequence in there not from\nthe reference genome that could be assembled)`),mdx(\"h3\",null,\"What is a \",mdx(\"inlineCode\",{parentName:\"h3\"},\"CIGAR\"),\" string\"),mdx(\"p\",null,\"A \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` string is a \"compact idiosyncratic gapped alignment report\". Yes,\nthat's an acronym.`),mdx(\"p\",null,\"Examples of \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),\" strings\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"A \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),\" strings could look be \",mdx(\"inlineCode\",{parentName:\"p\"},\"50M\"),` which means 50 bases \"matched\". There\nare no insertions or deletions. There could be underlying mismatches in this\nsequence that only comparing to a reference sequence would tell you`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Another \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),\" string with insertions and deletions could be \",mdx(\"inlineCode\",{parentName:\"p\"},\"50M1D1I50M\"),`.\nThis string had a deletion and an insertion back to back. This could be just\na mismatch! There is ambiguity in sequence alignment representations.\nDownstream programs must accomodate this.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Another \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),\" string with soft-clipping \",mdx(\"inlineCode\",{parentName:\"p\"},\"500S50M\"),` this means that 500 bases\nof the read were not aligned at this position, but 50 bases were! Note that\nthe alignment might have been a split alignment (see seciton on split\nalignments below) so another record in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file might contain info on\nwhere the other 500 bases aligned, or they might just be fully unaligned.`))),mdx(\"p\",null,\"See SAMv1.pdf for all the CIGAR operators.\"),mdx(\"p\",null,\"And also: \\u266B don't fear the \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),\" \\u266B\"),mdx(\"p\",null,\"If you are working with \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` data, you will often write loops that directly\nparse CIGAR strings. See Appendix B for handy functions for parsing `,mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),`\nstrings.`),mdx(\"h3\",null,\"What is an \",mdx(\"inlineCode\",{parentName:\"h3\"},\"MD\"),\" string\"),mdx(\"p\",null,\"An \",mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),\" string is a tag in \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file that helps tell you where the mismatches\nare, and can be combined with a `,mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` to get the position of the mismatches\nwithout looking at a reference genome.`),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),\" string is commonly seen in \",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\" files (not generally \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),` because\nit already uses reference compression and requires a reference sequence to\ndecode). The `,mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),` tag contains information about deletions (including the bases\nof the reference genome, which would otherwise not be indicated) and mismatches\n(same, indicating the base of the reference genome at a SNPs position), but not\ninsertions.`),mdx(\"p\",null,\"The command \",mdx(\"inlineCode\",{parentName:\"p\"},\"samtools calmd yourfile.bam --reference reference.fa\"),\" can add \",mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),`\ntags to your `,mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\" file. Note that there are some oddities about \",mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),` tags\nleading to complaints (e.g. `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/samtools/hts-specs/issues/505\"}),\"https://github.com/samtools/hts-specs/issues/505\"),`)\nbut the `,mdx(\"inlineCode\",{parentName:\"p\"},\"MD\"),` tag can be helpful if you want to decode a file without referring\nto it's reference.`),mdx(\"h2\",null,\"Detecting SVs from long reads\"),mdx(\"p\",null,\"Long reads offer a wide array of methods for detecting SVs\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`Insertions/deletions: Long reads can completely span moderate sized\ninsertions and deletions, indicated by `,mdx(\"inlineCode\",{parentName:\"li\"},\"I\"),\" or \",mdx(\"inlineCode\",{parentName:\"li\"},\"D\"),\" in a \",mdx(\"inlineCode\",{parentName:\"li\"},\"CIGAR\"),` string. If it\ndoes not completely span it, it may be split alignment (for a deletion) or\nclipped (for an insertion)`),mdx(\"li\",{parentName:\"ul\"},`Translocations: A split alignment can span inter-chromosomal translocations,\nso part of the read maps to one chromosome and one part maps to the other`),mdx(\"li\",{parentName:\"ul\"},`Inversions: A split alignment can span an inversion, the long read is split\ninto multiple parts, one part of it aligns in the reverse orientation, while\nthe other part aligns in the forward orientation`)),mdx(\"p\",null,`Note that there are many different methods for detecting SVs from long reads,\ne.g. not all use mapped reads from SAM files, some use de novo assembly, but\nit is still useful to be familiar with mapped read methods.`),mdx(\"h3\",null,\"What are split alignments?\"),mdx(\"p\",null,`Split alignments, or chimeric alignments, are alignments where part of the read\naligns to perhaps chr1, and part of it maps to perhaps chr4. It is worth\nreading the definition of \"Chimeric alignment\" from\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/SAMv1.pdf\"}),\"SAMv1.pdf\"),` when you get the\nchance.`),mdx(\"p\",null,`Split alignments are especially common with long reads, and it can indicate\nthat there may be a structural variant where the two chromosomes are fused\ntogether (which may create gene fusions, or other types of phenomena).`),mdx(\"p\",null,`There is no limitation on how many splits might occur so the split can align to\n3, 4, or more different places. Each part of the split puts a new line in the\nSAM file, and note that all the records also have the same `,mdx(\"inlineCode\",{parentName:\"p\"},\"QNAME\"),` (first\ncolumn of `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),`). As\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/SAMv1.pdf\"}),\"SAMv1.pdf\"),` tells us, one\nrecord is marked as \"representative\", I call this the \"primary\" record, while\nthe other components of the split read are maked supplementary, given the 2048\nflag. Only the \"primary\" record generally has a `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),\" field.\"),mdx(\"p\",null,`Note: split alignments are different from \"multi-mappers\" where the entire read\nmaps maps equally well to, say, chr4 and chr1. Split reads maps part to chr1,\nand part to chr4. See again the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/SAMv1.pdf\"}),\"SAMv1.pdf\"),` for the definition\nof multi-mapping`),mdx(\"h3\",null,\"What is the \",mdx(\"inlineCode\",{parentName:\"h3\"},\"SA\"),\" tag?\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` tag is outputted on each part of the split alignment, e.g. the primary\ncontains an `,mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),\" tag that refers to all the locations, \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` strings, and\nmore for all the supplementary reads, and each of the supplementary reads also\ncontains an `,mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` tag that refers to the primary alignment and each other\nsupplementary alignment.`),mdx(\"p\",null,\"Fun fact: The \",mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` tag conceptually can result in a 'quadratic explosion' of\ndata, because each part of the split contains references to every other part.\nFor example, if a read is split into 4 pieces, then each record would would\nhave an SA tag with 3 segments, so 3`,\"*\",\"4 segments will be documented in the\",mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),`\ntag. In many cases, this is not a problem, but if you imagine a finished\nchromosome aligned to a draft assembly, it may get split so many times this\ncould be a factor.`),mdx(\"h3\",null,\"Visualizing split reads across a breakend or translocation\"),mdx(\"p\",null,`This is a specialized JBrowse 2 feature, but if there is an inter-chromosomal\ntranslocation, you can load this into JBrowse and visualize support for this\nevent using our \"breakpoint split view\". This`),mdx(\"p\",null,`We also have a workflow called the \"SV inspector\" that helps you setup the\n\"breakpoint split views\"\n(`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org/jb2/docs/user_guide/#sv-inspector\"}),\"https://jbrowse.org/jb2/docs/user_guide/#sv-inspector\"),`). The SV inspector works\nbest on Breakend spec events and `,\"<\",\"TRA\",\">\",` (translocation) events from VCF,\nor BEDPE formatted SV calls, and you can launch the \"breakpoint split view\"\nfrom the \"SV inspector\"`),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/breakpoint_split_view.png\",alt:null}))),mdx(\"h3\",null,\"Visualizing a 'read vs reference' view given a split alignment\"),mdx(\"p\",null,`If we are given the the primary alignment of an arbitrary split read, then we\ncan construct what that split looks like compared to the reference genome.`),mdx(\"p\",null,`If we are not given the primary alignment (e.g. we are starting from a\nsupplementary alignment) then we can search the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` list for the one that is\nprimary, because at least one will be.`),mdx(\"p\",null,\"Now that we have the primary alignment, it will have the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),` (of the entire\nread, the supplementary alignments typically have a blank `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),\"!) and the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),`\ntag containing the `,mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` of all the different parts of the split. We can then\nconstruct how the entire read, not just a particular record of the split\nalignment, compares to the genome. In JBrowse 2 we implemented this and it uses\na synteny-style rendering. This functionality also exists in GenomeRibbon\n(`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://genomeribbon.org\"}),\"https://genomeribbon.org\"),\")\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/linear_alignment.png\",alt:null}))),mdx(\"p\",null,`Figure showing JBrowse 2 piecing together a long read vs the reference genome\nfrom a single read`),mdx(\"p\",null,\"In order to do this reconstruction, JBrowse 2 takes the \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` strings of the\nprimary alignment and each of the pieces of the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` tag (it is a semi-colon\nseparated list of chunks), sort them by the amount of softclipping (the\nsoftclipping values will progressively trim off more of the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),` telling you\nit aligned further and further on in the long read), and then this tells me\nwhere each piece of the split alignment came from in the original `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),`, so we\ncan plot the alignments of the read vs the reference genome using synteny style\ndisplay.`),mdx(\"h3\",null,\"SAM vs VCF - Breakends vs split alignments\"),mdx(\"p\",null,\"An interesting outcome (to me) is that from a single record in a \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file, I\ncan reconstruct the \"derived\" genome around a region of interest from a single\nread.`),mdx(\"p\",null,\"If I was to try to do this with the \",mdx(\"inlineCode\",{parentName:\"p\"},\"VCF\"),` Breakend specification (section 5.4\nof `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/VCFv4.3.pdf\"}),\"VCF4.3.pdf\"),`), it may\nactually be more challenging than from a `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` read. This is because a Breakend\nin `,mdx(\"inlineCode\",{parentName:\"p\"},\"VCF\"),` format is only an edge in a graph (and the sequences are nodes).\nTherefore, in order to properly reconstruct a structural variant from a `,mdx(\"inlineCode\",{parentName:\"p\"},\"VCF\"),`\nwith Breakends, I would have to construct a graph and decode paths through it.`),mdx(\"p\",null,`I like the ability to reconstruct the derived genome from a single read, but it\ncan be noisy. That said, de novo assembled contigs can also be stored in `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),`\nformat and is significantly less noisy (being composed of the aggregate\ninformation of many reads).`),mdx(\"p\",null,\"The point though is that interpretation of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"VCF\"),` breakend specification is\nchallenging due to imposing a sequence graph on the genome, while the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SA\"),` tag\nremains just a simple set of linear alignments that can easily be pieced\ntogether, and you only need to refer to a single record in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file to do\nso.`),mdx(\"p\",null,`I am not aware of a lot of tools that work on the VCF Breakend graph, and\nexpect more will need to be created to truly work with this standard. An\ninversion for example may create 4 record in the VCF file (see section 5.4 in\nthe `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://samtools.github.io/hts-specs/VCFv4.3.pdf\"}),\"VCF4.3.pdf\"),` for\nexample), and needs careful interpretation.`),mdx(\"h3\",null,\"Haplotype tagged reads\"),mdx(\"p\",null,\"A new trend has been to create \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"BAM\"),\"/\",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),` files with tagged reads,\nwhich tells us which haplotype a read was inferred to have come from. This is\ncommonly done with the `,mdx(\"inlineCode\",{parentName:\"p\"},\"HP\"),\" tag, which might have \",mdx(\"inlineCode\",{parentName:\"p\"},\"HP=0\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"HP=1\"),` for a\ndiploid genome. Tools like `,mdx(\"inlineCode\",{parentName:\"p\"},\"whatshap\"),\" can add these tags to a \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` file, and\nIGV and JBrowse 2 can color and sort by these tags.`),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/color_by_tag.png\",alt:null}))),mdx(\"p\",null,`Screenshot of JBrowse 2 with the \"Color by tag\" and \"Sort by tag\" setting\nenabled (coloring and sorting by the HP tag) letting us see that only one\nhaplotype has a deletion. Tutorial for how to do this in JBrowse 2 here\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org/jb2/docs/user_guide/#sort-color-and-filter-by-tag\"}),\"https://jbrowse.org/jb2/docs/user_guide/#sort-color-and-filter-by-tag\")),mdx(\"h2\",null,\"How do you detect SVs with paired-end reads?\"),mdx(\"p\",null,`Paired-end reads are short reads, e.g. 150bp each. This makes them unable to\nrecover some large structural variants.`),mdx(\"p\",null,`However, paired-end reads have a number of attributes that can be used to\ndetect paired end reads`),mdx(\"h3\",null,\"Distance between pairs being abnormally large or short\"),mdx(\"p\",null,\"The distance between pairs is encoded by the \",mdx(\"inlineCode\",{parentName:\"p\"},\"TLEN\"),\" column in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` format.\nThe distance between pairs with good mapping is relatively constant and called\nthe \"insert length\". This comes from how the sequencing is done: paired-end\nsequencing performs sequencing on both ends of a fragment.`),mdx(\"p\",null,`But, if you are mapping reads vs the reference genome, and you observe that\nthey are abnormally far apart, say 50kb apart instead of 1kb apart, this may\nindicate there your sample contains a deletion relative to the reference.`),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/aberrant_size.png\",alt:null}))),mdx(\"p\",null,`Screenshot of JBrowse 1 with \"View as pairs\" enabled, and large insert size\ncolored as red (from `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org/docs/paired_reads.html\"}),\"https://jbrowse.org/docs/paired_reads.html\"),`). Note that\nsome of JBrowse 1's View as pairs features are not yet available in JBrowse 2`),mdx(\"h3\",null,'An abundance of reads being \"clipped\" at a particular position'),mdx(\"p\",null,`This can indicate that part of the reads map well, but then there was an abrupt\nstop to the mapping. This might mean that there is a sequence that was an\ninsertion at that position, or a deletion, or a translocation.`),mdx(\"p\",null,\"The clipping is indicated by the \",mdx(\"inlineCode\",{parentName:\"p\"},\"CIGAR\"),` string, either at the start or end of\nit by an `,mdx(\"inlineCode\",{parentName:\"p\"},\"S\"),\" or an \",mdx(\"inlineCode\",{parentName:\"p\"},\"H\"),\". The \",mdx(\"inlineCode\",{parentName:\"p\"},\"S\"),` indicates \"soft clipping\", and indicates that\nthe sequence of the clipped portion can be found in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),` field of the\nprimary alignment. The `,mdx(\"inlineCode\",{parentName:\"p\"},\"H\"),` is hard clipped, and the sequence that is hard\nclipped will not appear in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"SEQ\"),\".\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/clipping_pileup.png\",alt:null}))),mdx(\"p\",null,`Screenshot of JBrowse 2 showing blue clipping indicator with a \"pileup\" of\nsoft-clipping at a particular position shown in blue. The clipping is an\n\"interbase\" operation (it occurs between base pair coordinates) so it is\nplotted separately from the normal coverage histogram.`),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/show_soft_clipping.png\",alt:null}))),mdx(\"p\",null,`Screenshot of JBrowse 2 showing an insertion with Nanopore (top), PacBio\n(middle) and Illumina short reads. The long reads may completely span the\ninsertion, so the CIGAR string on those have an `,mdx(\"inlineCode\",{parentName:\"p\"},\"I\"),` operator and are indicated\nby the purple triangle above the reads. For the short reads, the reads near the\ninsertion will be clipped since they will not properly map to the reference\ngenome and cannot span the sinsertion. The \"Show soft clipping\" setting in\nJBrowse 2 and IGV can be used to show visually the bases that extend into the\ninsertion (shown on the bottom track).`),mdx(\"h3\",null,\"Unexpected pair orientation\"),mdx(\"p\",null,\"With standard paired end sequencing, the pairs normally point at each other\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`forward reverse\n --->    <---\n`)),mdx(\"p\",null,`If the stranded-ness of the pair is off, then it could indicate a structural\nvariant. See Appendix A for a handy function for calculating pair orientation.`),mdx(\"p\",null,`This guide from IGV is helpful for interpreting the pair directionality with\npatterns of SVs using \"Color by pair orientation\"`),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\"}),\"https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\")),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/inverted_duplication.png\",alt:null}))),mdx(\"p\",null,`Figure: This shows an inverted (tandem) duplication in 1000 genomes data. The\ntandem duplication can produce green arrows which have reads pointing in\nopposite directions e.g. `,mdx(\"inlineCode\",{parentName:\"p\"},\"<--\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"-->\"),`, while blue arrows which can indicate\nan inversion point in the same direction e.g. `,mdx(\"inlineCode\",{parentName:\"p\"},\"-->\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"-->\")),mdx(\"h3\",null,\"Caveat about TLEN\"),mdx(\"p\",null,\"Note that \",mdx(\"inlineCode\",{parentName:\"p\"},\"TLEN\"),` is a field in the SAM format that is somewhat ill defined,\nat least in the sense that different tools may use it differently\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/pysam-developers/pysam/issues/667#issuecomment-381521767\"}),\"https://github.com/pysam-developers/pysam/issues/667#issuecomment-381521767\")),mdx(\"p\",null,\"If needed, you can calculate \",mdx(\"inlineCode\",{parentName:\"p\"},\"TLEN\"),` yourself if you process the file yourself\n(e.g. process all reads, get the actual records for the pairs, and calculate\ndistance) but I have not had trouble with relying on the `,mdx(\"inlineCode\",{parentName:\"p\"},\"TLEN\"),` from the data\nfiles themselves.`),mdx(\"h2\",null,\"Calling copy number variants with your short or long reads\"),mdx(\"p\",null,\"Another type of SV that you can get from your \",mdx(\"inlineCode\",{parentName:\"p\"},\"SAM\"),` files are copy number\nvariants (CNVs). By looking at the depth-of-coverage for your data files, you\ncan look for abnormalities that may indicate copy number variants. By using a\ntool like `,mdx(\"inlineCode\",{parentName:\"p\"},\"mosdepth\"),`, you can quickly get a file showing the coverage across\nthe genome.`),mdx(\"p\",null,`Be aware that if you are comparing the coverage counts from different tools,\nthat they have different defaults that may affect comparison. Some discard\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"QC_FAIL\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"DUP\"),\", and \",mdx(\"inlineCode\",{parentName:\"p\"},\"SECONDARY\"),` flagged reads. This is probably appropriate,\nand corresponds to what most genome browsers will display (see\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://gist.github.com/cmdcolin/9f677eca28448d8a7c5d6e9917fc56af\"}),\"https://gist.github.com/cmdcolin/9f677eca28448d8a7c5d6e9917fc56af\"),` for a short\nsummary of depth calculated from different tools)`),mdx(\"p\",null,`Note that both long and short reads can be used for CNV detection. Long reads\nmay give more accurate measurements also, with their better ability to map\nsmoothly through difficult regions of the genome.`),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"/media/coverage_cnv.png\",alt:null}))),mdx(\"p\",null,`Screenshot showing coverage in BigWig format from nanopore reads on normal and\ntumor tissue from a melanoma cancer cell line (COLO829) plotted using JBrowse 2\n(`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org/code/jb2/v1.6.4/?config=test_data%2Fconfig_demo.json&session=share-MZj3d18lzH&password=3X7bS\"}),\"demo\"),`\nand\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jbrowse.org/jb2/docs/user_guide/#viewing-whole-genome-coverage-for-profiling-cnv\"}),\"tutorial\"),\")\"),mdx(\"h2\",null,\"The future, with graph genomes and de-novo assemblies\"),mdx(\"p\",null,`Currently, SV visualization is highly based on comparing data versus a\nreference genome (and the SAM format is a signature of this: it stores data in\nterms of reference genome coordinates). In the future, SV visualization may\nlook more similar to comparative genomics, where we compare an SV to a\npopulation specific reference from a graph genomes or something like this.`),mdx(\"p\",null,`It is known that de-novo assembly has more power to detect SVs than some read\noperations (`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://twitter.com/lh3lh3/status/1362921612690010118/photo/1\"}),\"https://twitter.com/lh3lh3/status/1362921612690010118/photo/1\"),`) so\nas de novo assembled genomes improve and become more widespread, we may see a\nshift in how SVs are called`),mdx(\"p\",null,`I would also like to see improved ability to do fast or 'on the fly' gene\nprediction on the de novo assembled genomes, and we can see what SNPs or\nmodified splicing might occur in CNV copies of genes.`),mdx(\"h2\",null,\"Conclusion\"),mdx(\"p\",null,`Algorithms that actually call structural variants face many challenges, but\nunderstanding how the reads are encoded in SAM format, and seeing what they\nlook like in the genome browser is a useful first step to gaining a better\nunderstanding.`),mdx(\"p\",null,\"In summary, some of the signatures of SVs may include:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Aberrant insert size (\",mdx(\"inlineCode\",{parentName:\"li\"},\"TLEN\"),`) detection (longer for deletion, shorter for\ninsertion)`),mdx(\"li\",{parentName:\"ul\"},\"Split-read detection (\",mdx(\"inlineCode\",{parentName:\"li\"},\"SA\"),\" tag)\"),mdx(\"li\",{parentName:\"ul\"},\"CIGAR string processing (\",mdx(\"inlineCode\",{parentName:\"li\"},\"D\"),\" operator for deletions, \",mdx(\"inlineCode\",{parentName:\"li\"},\"I\"),` operator for\ninsertions)`),mdx(\"li\",{parentName:\"ul\"},\"Over-abundance of clipping (\",mdx(\"inlineCode\",{parentName:\"li\"},\"S\"),\" or \",mdx(\"inlineCode\",{parentName:\"li\"},\"H\"),\" operators in \",mdx(\"inlineCode\",{parentName:\"li\"},\"CIGAR\"),\")\"),mdx(\"li\",{parentName:\"ul\"},\"Depth of coverage changes for CNVs\"),mdx(\"li\",{parentName:\"ul\"},`Aligning de novo assembly vs a reference genome\n(`,mdx(\"a\",e({parentName:\"li\"},{href:\"https://twitter.com/lh3lh3/status/1362921612690010118/photo/1\"}),\"https://twitter.com/lh3lh3/status/1362921612690010118/photo/1\"),`) which can\noutput `,mdx(\"inlineCode\",{parentName:\"li\"},\"SAM\"),`, but it can also output\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/lh3/miniasm/blob/master/PAF.md\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"PAF\")),` format (which can\nbe loaded in JBrowse 2 in the synteny views). Techniques of detecting SVs on\nPAF will be fundamentally pretty similar to the techniques listed above but\nmay look a bit different (see `,mdx(\"inlineCode\",{parentName:\"li\"},\"cs\"),\" tag in PAF for example)\")),mdx(\"p\",null,\"If you have any ideas I should include here, let me know!\"),mdx(\"h3\",null,\"Appendix A: Parsing CIGAR strings\"),mdx(\"p\",null,`This is code that can help determine the pair orientation from a single BAM\nrecord. Might be too much detail but follow along`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`// @param flags - flags from a single read\n// @param ref - the string of the reference sequence, just used to determine if it matches rnext\n// @param rnext - the string of the RNEXT, just used to determine if it matches ref\n// @param tlen - the TLEN field from SAM\n// @return e.g. F1R2 normal paired end orientation\nfunction getPairOrientation(\n  flags: number,\n  ref: string,\n  rnext: string,\n  tlen: number,\n) {\n  // this read is not unmapped &&\n  // this read's mate is also not unmapped &&\n  // this read's mate is on the same reference genome\n  if (!flags & 4 && !flags & 8 && ref === rnext) {\n    const s1 = flags & 16 ? 'R' : 'F'\n    const s2 = flags & 32 ? 'R' : 'F'\n    let o1 = ' '\n    let o2 = ' '\n\n    // if first in pair\n    if (flags & 64) {\n      o1 = '1'\n      o2 = '2'\n    }\n\n    // else if second in pair\n    else if (flags & 128) {\n      o1 = '2'\n      o2 = '1'\n    }\n\n    const tmp = []\n    if (tlen > 0) {\n      tmp[0] = s1\n      tmp[1] = o1\n      tmp[2] = s2\n      tmp[3] = o2\n    } else {\n      tmp[2] = s1\n      tmp[3] = o1\n      tmp[0] = s2\n      tmp[1] = o2\n    }\n    return tmp.join('')\n  }\n  return null\n}\n`)),mdx(\"p\",null,\"Then this can be broken down further by orientation type\"),mdx(\"p\",null,`Paired end reads are \"fr\"\nMate pair reads are \"rf\"`),mdx(\"p\",null,\"So you can interpret e.g. F1R2 in relation to being a paired end read (fr) or mate pair (rf) below and with this link \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\"}),\"https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  \"fr\": {\n    \"F1R2\": \"LR\",\n    \"F2R1\": \"LR\",\n\n    \"F1F2\": \"LL\",\n    \"F2F1\": \"LL\",\n\n    \"R1R2\": \"RR\",\n    \"R2R1\": \"RR\",\n\n    \"R1F2\": \"RL\",\n    \"R2F1\": \"RL\"\n  },\n\n  \"rf\": {\n    \"R1F2\": \"LR\",\n    \"R2F1\": \"LR\",\n\n    \"R1R2\": \"LL\",\n    \"R2R1\": \"LL\",\n\n    \"F1F2\": \"RR\",\n    \"F2F1\": \"RR\",\n\n    \"F1R2\": \"RL\",\n    \"F2R1\": \"RL\"\n  }\n}\n`)),mdx(\"h3\",null,\"Appendix B - CIGAR parsing\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`// @param cigar: CIGAR string in text form\nfunction parseCigar(cigar: string) {\n  return cigar.split(/([MIDNSHPX=])/)\n}\n`)),mdx(\"p\",null,\"Then parse the returned array two at a time\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`// this function does nothing, but is informative for how to parse interpret a\n// CIGAR string\n// @param cigar:CIGAR string from record\n// @param readSeq: the SEQ from record\n// @param refSeq: the reference sequence underlying the read\nfunction interpretCigar(cigar: string, readSeq: string, refSeq: string) {\n  const opts = parseCigar(cigar)\n  let qpos = 0 // query position, position on the read\n  let tpos = 0 // target position, position on the reference sequence\n  for (let i = 0; i < ops.length - 1; i += 2) {\n    const length = parseInt(opts[i], 10)\n    const operator = opts[i + 1]\n    // do things. refer to the CIGAR chart in SAMv1.pdf for which operators\n    // \"consume reference\" to see whether to increment\n    if (op === 'M' || op === '=') {\n      // matches consume query and reference\n      qpos += len\n      tpos += len\n    }\n    if (op === 'I') {\n      // insertions only consume query\n      // sequence of the insertion from the read is\n      const insSeq = readSeq.slice(qpos, qpos + len)\n      qpos += len\n    }\n    if (op === 'D') {\n      // deletions only consume reference\n      // sequence of the deletion from the reference is\n      const delSeq = refSeq.slice(tpos, tpos + len)\n      tpad += len\n    }\n    if (op === 'N') {\n      // skips only consume reference\n      // skips are similar to deletions but are related to spliced alignments\n      tpad += len\n    }\n    if (op === 'X') {\n      // mismatch using the extended CIGAR format\n      // could lookup the mismatch letter in a string containing the reference\n      const mismatch = refSeq.slice(tpos, tpos + len)\n      qpos += len\n      tpos += len\n    }\n    if (op === 'H') {\n      // does not consume query or reference\n      // hardclip is just an indicator\n    }\n    if (op === 'S') {\n      // softclip consumes query\n      // below gets the entire soft clipped portion\n      const softClipStr = readSeq.slice(qpos, qpos + len)\n      qpos += len\n    }\n  }\n}\n`)),mdx(\"p\",null,`Note for example, that to determine how long a record is on the reference\nsequence, you have to combine the records start position with the CIGAR string,\nbasically parsing the CIGAR string to add up tpos and return tpos`),mdx(\"h3\",null,\"Appendix C - align FASTQ directly to CRAM\"),mdx(\"p\",null,`This example from the htslib documentation\n(`,mdx(\"a\",e({parentName:\"p\"},{href:\"http://www.htslib.org/workflow/fastq.html\"}),\"http://www.htslib.org/workflow/fastq.html\"),`) shows how you can stream directly\nfrom `,mdx(\"inlineCode\",{parentName:\"p\"},\"FASTQ\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"CRAM\"),\" (and generate the index file .crai too)\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`minimap2 -t 8 -a -x sr reference.fa reads1.fq reads2.fq  | \\\\\nsamtools fixmate -u -m - - | \\\\\nsamtools sort -u -@2 - | \\\\\nsamtools markdup -@8 --reference reference.fa - --write-index final.cram\n`)),mdx(\"p\",null,\"If you want, you can make this a little shell script, easy_align.sh\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`#!/bin/bash\nminimap2 -t 8 -a -x sr \"$1\" \"$2\" \"$3\"  | \\\\\nsamtools fixmate -u -m - - | \\\\\nsamtools sort -u -@2 - | \\\\\nsamtools markdup -@8 --reference \"$1\" - --write-index \"$4\"\n`)),mdx(\"p\",null,\"Then call\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`bash easy_align.sh ref.fa reads1.fq reads2.fq out.cram\n`)),mdx(\"p\",null,\"This same concept works with other common aligners as well like bwa\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"How to make your own npm package with typescript","date":"2021-12-31","slug":"2021-12-31-npm-package","mdxSource":{"compiledSource":"var c=Object.defineProperty,u=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var s=(a,n,t)=>n in a?c(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=>{for(var t in n||(n={}))p.call(n,t)&&s(a,t,n[t]);if(o)for(var t of o(n))r.call(n,t)&&s(a,t,n[t]);return a},l=(a,n)=>u(a,m(n));var d=(a,n)=>{var t={};for(var i in a)p.call(a,i)&&n.indexOf(i)<0&&(t[i]=a[i]);if(a!=null&&o)for(var i of o(a))n.indexOf(i)<0&&r.call(a,i)&&(t[i]=a[i]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var i=t,{components:a}=i,n=d(i,[\"components\"]);return mdx(MDXLayout,l(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"There is a lot of mystery around making your own \",mdx(\"inlineCode\",{parentName:\"p\"},\"npm\"),` package. Every package\nlikely does it a bit differently, and it can be tricky to get a setup you like.\nShould you use a \"starter kit\" or a boilerplate example? Or just roll your own?\nShould you use a bundler? How do you use typescript?`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"*\",\"Record scratch \",\"*\",\"*\")),mdx(\"p\",null,\"Why don't we try starting from scratch and seeing where we can get?\"),mdx(\"p\",null,`TLDR: here is a github repo with a template package\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/npm-package-tutorial/\"}),\"https://github.com/cmdcolin/npm-package-tutorial/\")),mdx(\"h2\",null,\"Introduction\"),mdx(\"p\",null,\"An \",mdx(\"inlineCode\",{parentName:\"p\"},\"npm\"),` package can be very bare bones. In some sense, npmjs.com is just an\narbitrary file host, and you can upload pretty much anything you want to it.`),mdx(\"p\",null,\"The magic is in the package.json file, which tells npm:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"what files are part of your package\"),mdx(\"li\",{parentName:\"ul\"},`what to use as the \"entry point\" (e.g. the file that should be referenced\nwhen you say `,mdx(\"inlineCode\",{parentName:\"li\"},\"const lib = require('mypackage')\"),\")\"),mdx(\"li\",{parentName:\"ul\"},`what pre- and post- processing steps should be done when the package is being\npublished`),mdx(\"li\",{parentName:\"ul\"},\"and more!\")),mdx(\"p\",null,\"Let's try an experiment...\"),mdx(\"h2\",null,\"Initializing a package\"),mdx(\"p\",null,\"Open up a terminal, and run\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`mkdir mypackage\ncd mypackage\ngit init # make mypackage version controlled\nnpm init\n# or\nyarn init\n`)),mdx(\"p\",null,\"This init command outputs something like this, and we accept the defaults\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`This utility will walk you through creating a package.json file.\nIt only covers the most common items, and tries to guess sensible defaults.\n\nSee \\`npm help init\\` for definitive documentation on these fields\nand exactly what they do.\n\nUse \\`npm install <pkg>\\` afterwards to install a package and\nsave it as a dependency in the package.json file.\n\nPress ^C at any time to quit.\npackage name: (mypackage)\nversion: (1.0.0)\ndescription:\nentry point: (index.js)\ntest command:\ngit repository:\nkeywords:\nlicense: (ISC)\nAbout to write to /home/cdiesh/mypackage/package.json:\n\n{\n  \"name\": \"mypackage\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\\\"Error: no test specified\\\\\" && exit 1\"\n  },\n  \"author\": \"Colin\",\n  \"license\": \"ISC\"\n}\n\n`)),mdx(\"p\",null,\"Then, you can create a file named \",mdx(\"inlineCode\",{parentName:\"p\"},\"index.js\"),` (in your package.json it says\n`,mdx(\"inlineCode\",{parentName:\"p\"},'\"main\": \"index.js\"'),\" to refer to this file, the entrypoint)\"),mdx(\"p\",null,\"In your \",mdx(\"inlineCode\",{parentName:\"p\"},\"index.js\"),` file, generally, you would do things like export a function\nor functions. I will use commonjs exports here for maximum compatibility:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`module.exports = {\n  hello: () => {\n    console.log('hello world')\n  },\n}\n`)),mdx(\"h2\",null,\"Publishing a package\"),mdx(\"p\",null,\"This npm package, \",mdx(\"inlineCode\",{parentName:\"p\"},\"mypackage\"),\" can now be published to \",mdx(\"inlineCode\",{parentName:\"p\"},\"npm\"),` with a simple\ncommand.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm publish\n# or\nyarn publish\n`)),mdx(\"p\",null,`This will prompt you for your npmjs.com username, password, email, and if\nneeded, 2FA token (highly recommended)`),mdx(\"h2\",null,\"Using your package after it is published\"),mdx(\"p\",null,`Once it is published, you can use it in your create-react-app app or other npm\npackage.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm install mypackage\n# or\nyarn add mypackage\n`)),mdx(\"p\",null,\"Then you can use\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`import { hello } from 'mypackage'\n`)),mdx(\"p\",null,\"in any of your other codebases\"),mdx(\"h2\",null,\"Summary of the simplest NPM package\"),mdx(\"p\",null,\"This all seems pretty boring thus far but it tells us a couple things\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"packages can be very very bare bones\"),mdx(\"li\",{parentName:\"ol\"},\"no transpiler or bundler is needed for publishing an npm package\"),mdx(\"li\",{parentName:\"ol\"},`our package can consist of a single file and it is uploaded to npm, and the\n\"main\" field in package.json provides an entry point`),mdx(\"li\",{parentName:\"ol\"},`the filename index.js is not special, probably it is a hangover from the\nname index.html. you can use whatever name you want`)),mdx(\"h2\",null,\"Adding typescript\"),mdx(\"p\",null,\"Let's try adding typescript\"),mdx(\"p\",null,`To do this, we will use the typescript compiler to compile a directory of files\nin our \"src\" directory and output the compiled files to a directory named\n\"dist\"`),mdx(\"p\",null,\"To start, let's add typescript\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm install --save-dev typescript\n# or\nyarn add -D typescript\n`)),mdx(\"p\",null,\"Our package.json now will have \",mdx(\"inlineCode\",{parentName:\"p\"},\"typescript\"),\" in it's \",mdx(\"inlineCode\",{parentName:\"p\"},\"devDependencies\"),` (this\nmeans that when someone installs your package, it they don't get typescript as\na dependency, it is just a dependency for while you are developing the library\nlocally).`),mdx(\"p\",null,\"Then we need to create a tsconfig.json for typescript to use\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`yarn tsc --init\n# or\nnpx tsc --init\n`)),mdx(\"p\",null,\"This will generate a \",mdx(\"inlineCode\",{parentName:\"p\"},\"tsconfig.json\"),\" file (needed by \",mdx(\"inlineCode\",{parentName:\"p\"},\"typescript\"),`) with a bunch of\noptions, but I have stripped it down in my projects to look like this`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  \"include\": [\"src\"],\n  \"compilerOptions\": {\n    \"target\": \"es2018\",\n    \"moduleResolution\": \"node\",\n    \"declaration\": true, // generate .d.ts files\n    \"sourceMap\": true, // generate source map\n    \"outDir\": \"dist\", // output compiled js, d.ts, and source map to dist folder\n    \"strict\": true,\n    \"esModuleInterop\": true\n  }\n}\n`)),mdx(\"p\",null,\"Now, we want to change our \",mdx(\"inlineCode\",{parentName:\"p\"},\"js\"),\" to \",mdx(\"inlineCode\",{parentName:\"p\"},\"ts\"),\" files to use \",mdx(\"inlineCode\",{parentName:\"p\"},\"typescript\"),`, let's change them\nto use normal ESM import/exports`),mdx(\"p\",null,\"util.ts\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`export function getMessage() {\n  return 'hello'\n}\n`)),mdx(\"p\",null,\"index.ts\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`import { getMessage } from './util'\nexport function sayMessage() {\n  console.log(getMessage())\n}\n`)),mdx(\"p\",null,\"And then we will add a \",mdx(\"inlineCode\",{parentName:\"p\"},'\"build\"'),\" script to \",mdx(\"inlineCode\",{parentName:\"p\"},\"package.json\"),` to compile the\nlibrary, and refer to the `,mdx(\"inlineCode\",{parentName:\"p\"},'\"dist\"'),\" directory for the \",mdx(\"inlineCode\",{parentName:\"p\"},'\"files\"'),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},'\"main\"'),`\nfields in `,mdx(\"inlineCode\",{parentName:\"p\"},\"package.json\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  \"name\": \"mypackage\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"src/index.js\",\n  \"files\": [\"dist\"],\n  \"scripts\": {\n    \"build\": \"tsc\"\n  },\n  \"author\": \"Colin\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"typescript\": \"^4.5.4\"\n  }\n}\n`)),mdx(\"p\",null,\"We can now run\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm run build\n# or\nyarn build\n`)),mdx(\"p\",null,\"And this will run the \",mdx(\"inlineCode\",{parentName:\"p\"},'\"build\"'),` script we created, which in turn, just runs\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"tsc\"),\" with no arguments.\"),mdx(\"p\",null,\"You can also add a \",mdx(\"inlineCode\",{parentName:\"p\"},'\"prebuild\"'),` script that clears out the old contents. In fact,\nnpm scripts generalizes the naming system -- you can make scripts with whatever name you want, e.g.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  \"scripts\": {\n    \"preparty\": \"echo preparty\",\n    \"party\": \"echo party\",\n    \"postparty\": \"echo postparty\"\n  }\n}\n`)),mdx(\"p\",null,\"Then running\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`$ yarn party\npreparty\nparty\npostparty\n`)),mdx(\"p\",null,\"To make this useful, we will use \",mdx(\"inlineCode\",{parentName:\"p\"},\"rimraf\"),` (a node package) to make a\ncross-platform removal of the `,mdx(\"inlineCode\",{parentName:\"p\"},\"dist\"),\" directory\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm install --save-dev rimraf\n# or\nyarn add -D rimraf\n`)),mdx(\"p\",null,\"and then update your package.json\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  ...\n  \"scripts\": {\n    \"clean\": \"rimraf dist\",\n    \"prebuild\": \"npm run clean\",\n    \"build\": \"tsc\"\n  },\n  \"devDependencies\": {\n    \"rimraf\": \"^3.0.2\",\n    \"typescript\": \"^4.5.4\"\n  }\n}\n`)),mdx(\"p\",null,`We could make it say \"rm -rf dist\" instead of \"rimraf dist\" (e.g. run arbitrary\nshell commands), but rimraf allows it to be cross-platform`),mdx(\"h2\",null,\"Making sure you create a fresh build before you publish\"),mdx(\"p\",null,\"Without extra instructions, your \",mdx(\"inlineCode\",{parentName:\"p\"},\"yarn publish\"),` command would not create a\nfresh build and you could publish an older version that was lingering in the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"dist\"),\" folder.\"),mdx(\"p\",null,\"We can use a \",mdx(\"inlineCode\",{parentName:\"p\"},\"preversion\"),` script that will automatically get invoked when you\nrun `,mdx(\"inlineCode\",{parentName:\"p\"},\"yarn publish\"),\" to make sure you get a fresh build in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"dist\"),` folder\nbefore you publish`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  ...\n  \"scripts\": {\n    ...\n    \"preversion\": \"npm run build\",\n  },\n}\n`)),mdx(\"h2\",null,\"Making sure you push your tag to github after publish\"),mdx(\"p\",null,\"When you run \",mdx(\"inlineCode\",{parentName:\"p\"},\"yarn publish\"),`, npm will automatically create a commit with the\nversion name and a git tag, it `,mdx(\"em\",{parentName:\"p\"},\"will not\"),` automatically push tag to your\nrepository.`),mdx(\"p\",null,\"Add a \",mdx(\"inlineCode\",{parentName:\"p\"},\"postversion\"),\" script that pushes the tag to your repo after your publish\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-json\"}),`{\n  ...\n  \"scripts\": {\n    ...\n    \"postversion\": \"git push --follow-tags\",\n  },\n}\n`)),mdx(\"h2\",null,\"Incremental builds\"),mdx(\"p\",null,\"We can use this to do incremental/watch builds\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`npm run build --watch\n# or\nyarn build --watch\n`)),mdx(\"h2\",null,\"Adding testing with ts-jest\"),mdx(\"p\",null,\"You can use ts-jest to test your code. This involves installing jest, typescript, ts-jest, @types/jest, and then initializing a jest.config.json\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm i -D jest typescript\n# or\nyarn add --dev jest typescript\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npm i -D ts-jest @types/jest\n# or\nyarn add --dev ts-jest @types/jest\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-sh\"}),`npx ts-jest config:init\n# or\nyarn ts-jest config:init\n`)),mdx(\"p\",null,\"We can then create a test\"),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"test/util.spec.ts\")),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),`import { getMessage } from '../src/util'\ntest('expected message returned', () => {\n  expect(getMessage()).toBe('hello')\n})\n`)),mdx(\"p\",null,\"Then we can then create a script in the package.json that says \",mdx(\"inlineCode\",{parentName:\"p\"},'\"test\": \"jest\"'),\", and then we can say\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`npm run test\n# or\nyarn test\n`)),mdx(\"p\",null,\"You can also create an alternative system where you use \",mdx(\"inlineCode\",{parentName:\"p\"},\"babel-eslint\"),` and\nvarious babel strategies to test your code, but if you are using typescript,\nts-jest+typescript works great.`),mdx(\"h2\",null,\"Add a .gitignore\"),mdx(\"p\",null,\"Create a .gitignore with just a line that references this \",mdx(\"inlineCode\",{parentName:\"p\"},\"dist\"),\" folder and \",mdx(\"inlineCode\",{parentName:\"p\"},\"node_modules\"),\" folder\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`dist\nnode_modules\n`)),mdx(\"h2\",null,\"The future of ESM modules\"),mdx(\"p\",null,`There is a shift happening where modules are changing to be pure ESM rather\nthan keeping commonjs equivalents`),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\"}),\"https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c\")),mdx(\"p\",null,`There are many challenges here, and will not be discussed, but it may be a\nuseful further reading page`),mdx(\"h2\",null,\"Conclusion\"),mdx(\"p\",null,`This tutorial shows you how you can create a basic package that you can publish\nto `,mdx(\"inlineCode\",{parentName:\"p\"},\"npm\"),\". This little boilerplate includes these features:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Makes clean build when running \",mdx(\"inlineCode\",{parentName:\"li\"},\"yarn build\"),\" or \",mdx(\"inlineCode\",{parentName:\"li\"},\"yarn publish\")),mdx(\"li\",{parentName:\"ul\"},\"Pushes to github after publish\"),mdx(\"li\",{parentName:\"ul\"},\"Uses ts-jest for testing\"),mdx(\"li\",{parentName:\"ul\"},\"Uses esm modules\")),mdx(\"p\",null,`You also have full control, and understand the decisions we took to get to this\npoint. This package does not use any bundling (rollup or webpack or otherwise).\nIt just uses `,mdx(\"inlineCode\",{parentName:\"p\"},\"tsc\"),\" is used to compile the files to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"dist\"),` folder, and the\ndist folder is published to `,mdx(\"inlineCode\",{parentName:\"p\"},\"npm\"),`! If you need your package to be usable by\nconsumers that don't themselves use bundlers, consider looking into `,mdx(\"inlineCode\",{parentName:\"p\"},'<script type=\"module\">'),` for importing ESM modules in the browser, or you can bundle\nyour library using rollup or webpack and output e.g. a UMD bundle`),mdx(\"h2\",null,\"Final product\"),mdx(\"p\",null,\"See \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/npm-package-tutorial/\"}),\"https://github.com/cmdcolin/npm-package-tutorial/\")))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"My next.js static blog setup","date":"2021-12-26","slug":"2021-12-26-nextjs","mdxSource":{"compiledSource":"var d=Object.defineProperty,h=Object.defineProperties;var c=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var r=(t,a,i)=>a in t?d(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,e=(t,a)=>{for(var i in a||(a={}))s.call(a,i)&&r(t,i,a[i]);if(o)for(var i of o(a))l.call(a,i)&&r(t,i,a[i]);return t},p=(t,a)=>h(t,c(a));var m=(t,a)=>{var i={};for(var n in t)s.call(t,n)&&a.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&o)for(var n of o(t))a.indexOf(n)<0&&l.call(t,n)&&(i[n]=t[n]);return i};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(i){var n=i,{components:t}=n,a=m(n,[\"components\"]);return mdx(MDXLayout,p(e(e({},layoutProps),a),{components:t,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`My personal homepage originally used statocles, a perl-based static site\ngenerator (`,mdx(\"a\",e({parentName:\"p\"},{href:\"http://preaction.me/statocles/\"}),\"http://preaction.me/statocles/\"),`). I didn't really blog using it, just\na homepage for myself plus some links to my tumblr blog. But, if I linked\npeople to the tumblr blog directly, it would give people terrible popup ads and\ntrackers. So, I switched to github pages+next.js this year. I considered a\nnumber of alternative static site systems, but next.js seemed to hit some nice\ngoals`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Flexible\"),mdx(\"li\",{parentName:\"ul\"},\"React-based (as opposed to template-based like jekyll, eleventy, etc.)\"),mdx(\"li\",{parentName:\"ul\"},\"Markdown driven, and can use MDX\"),mdx(\"li\",{parentName:\"ul\"},\"RSS feed (bonus)\"),mdx(\"li\",{parentName:\"ul\"},\"Active community\")),mdx(\"p\",null,\"Other systems almost worked and were attempted but aborted\"),mdx(\"h3\",null,\"First and second iterations\"),mdx(\"p\",null,\"The first iteration of my next.js blog\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`I put every blog post in the \"pages\" folder. This worked ok but I had to\nmanually edit the index.mdx file to have long lists of stuff like this\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"![link to new blogpost](manually_inserted_link_here)\"))),mdx(\"p\",null,`The second iteration, I wanted to automatically generate a list of recent\nblogposts from files on disk`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`I used the next.js \"blog-template-typescript\" example folder from their\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript\"}),\"monorepo\"),\".\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"The new blog posts are generated from markdown files in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"_posts\"),` folder,\nand get rendered by the file `,mdx(\"inlineCode\",{parentName:\"p\"},\"pages/posts/[slug].tsx\"),` (yes, the filename\nincludes square brackets).`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"getAllPosts in\",mdx(\"br\",{parentName:\"p\"}),`\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/master/lib/api.ts\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"lib/api.ts\")),`\ngets a listing of the files in `,\"_\",\"posts folder, which I can call from the \",mdx(\"inlineCode\",{parentName:\"p\"},\"getStaticProps\"),\" method on next.js pages\"))),mdx(\"h3\",null,\"Stripping off unnecessary stuff from blog-starter-typescript\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-starter-typescript\"),` template has many tiny components, I removed some\nof them to make it easier for me to orient myself`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/vercel/next.js/tree/canary/examples/blog-starter-typescript/components\"}),\"theirs\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/tree/master/components\"}),\"mine\"))),mdx(\"h3\",null,\"Removing tailwind CSS\"),mdx(\"p\",null,\"The \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-starter-typescript\"),` template uses tailwind CSS and uses \"modern web design\" (aka:\ngigantic \"tiles\" instead of links, images that are way too large, etc)`),mdx(\"p\",null,`I started making a more basic design. I tried to roll with the tailwind CSS for\na bit, but ended up removing it entirely.`),mdx(\"p\",null,\"Tailwind CSS is sort of like a CSS-in-JS system, except every CSS attribute is encoded in a CSS classname. For example, here are some tailwind CSS snippets\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-html\"}),`<div className=\"container mx-auto px-5\"></div>\n<footer className=\"bg-accent-1 border-t border-accent-2\"></footer>\n<div className=\"max-w-1xl mx-auto\"></div>\n<div className=\"min-h-screen\"></div>\n<a className=\"hover:underline\"></a>\n<h1\n  className=\"text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left\"\n></h1>\n`)),mdx(\"p\",null,`They claim this is better than using external CSS (see comparison here\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tailwindcss.com/docs/utility-first\"}),\"https://tailwindcss.com/docs/utility-first\"),`) but it is yet another language to\nlearn, and kind of tricky.`),mdx(\"p\",null,`But, the reason I gave up with tailwind is actually because tailwind CSS resets\na lot of HTML styles so things like `,mdx(\"inlineCode\",{parentName:\"p\"},\"<h1>\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"<h2>\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"<ul>\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"<li>\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"<a>\"),` have\nno styling at all. This is done by `,mdx(\"inlineCode\",{parentName:\"p\"},\"tailwind preflight\"),`\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://tailwindcss.com/docs/preflight\"}),\"https://tailwindcss.com/docs/preflight\"),` (which you can disable, but it is\nenabled by default)`),mdx(\"p\",null,`Stackoverflow has some ways to help restore styling and keep preflight, but it\nstill struck me as odd. Examples`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackoverflow.com/a/68853223/2129219\"}),\"Example: you have to manually restore underlines on \",mdx(\"inlineCode\",{parentName:\"a\"},\"<a>\"),\" elements if using tailwind XSS\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackoverflow.com/questions/69264976/cant-display-markdown-on-nextjs\"}),`Another example: \"It looks like you're using TailwindCSS, the default\nstyles for elements are reset, that's why the h1 text will look like any other\ntext.\"`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://raw.githubusercontent.com/vercel/next.js/canary/examples/blog-starter-typescript/components/markdown-styles.module.css\"}),\"Another example \",mdx(\"inlineCode\",{parentName:\"a\"},\"blog-template-typescript\"),` uses this file to try to style\nthe markdown using some general\nstyles`)))),mdx(\"p\",null,`To me it was surprising the extend that tailwind goes to unstyle the default\nbrowser styles, removing \"idiomatic HTML\" styles, so I removed tailwind for\nnow. Perhaps I'll return to it another time`),mdx(\"h2\",null,\"Using MDX for blogposts in next.js\"),mdx(\"p\",null,\"In the template from next.js team, the \",mdx(\"inlineCode\",{parentName:\"p\"},\"blog-template-typescript\"),`, it uses a\nfairly simple `,mdx(\"inlineCode\",{parentName:\"p\"},\"lib/markdownToHtml.ts\"),` function right in the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"pages/posts/[slug].tsx\"),` file (the markdown is statically pre-rendered in the\ntrue static blog sense, using the getStaticProps function). This is,\nunfortunately, over-simplified for the MDX case, because MDX properly needs to\nhydrate the components using react on the client side also`),mdx(\"p\",null,\"To fix, the module \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/hashicorp/next-mdx-remote\"}),\"https://github.com/hashicorp/next-mdx-remote\"),` offers a way to\nload actual MDX files.`),mdx(\"h2\",null,\"Adding syntax highlighting the next.js code snippets\"),mdx(\"p\",null,`There are a couple results from google about how to add syntax highlighting to\nnext.js but I still found it difficult.`),mdx(\"p\",null,`My method ended up a bit different where I manually included the prism JS and\nCSS from a CDN essentially and it worked`),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15\"}),\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/styles/index.css#L14-L15\")),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17\"}),\"https://github.com/cmdcolin/cmdcolin.github.io/blob/aa080193f45cb3e3d11ca1ead2bbd5eb2ae09633/pages/_document.tsx#L12-L17\")),mdx(\"p\",null,`Other methods e.g. adding react-prism in next.config.js (like\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/mikeesto/next-mdx-prism-example\"}),\"https://github.com/mikeesto/next-mdx-prism-example\"),` does) I think clashed with\nMDXRemote perhaps, or maybe I was tussling with tailwind CSS too much to make a\nclear thought out of it, but syntax blocks on my blogposts should now be\nproperly highlighted`),mdx(\"h2\",null,\"RSS feed\"),mdx(\"p\",null,`I also followed this great guide to add a RSS file for next.js\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site\"}),\"https://ashleemboyer.com/how-i-added-an-rss-feed-to-my-nextjs-site\")),mdx(\"p\",null,`Link here, for your feed readers\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://cmdcolin.github.io/rss.xml\"}),\"https://cmdcolin.github.io/rss.xml\")),mdx(\"p\",null,`Not many people may use RSS much anymore, but I do use it (via feedly), and I\nlove music blogs that keep posting on blogspot year after year, and the\noccasional programming post is nice too`))}MDXContent.isMDXComponent=!0;\n","scope":{}}},{"title":"A spooky error when you have a string bigger than 512MB in Chrome","date":"2021-10-30","slug":"2021-10-30-spooky","mdxSource":{"compiledSource":"var h=Object.defineProperty,d=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var s=(e,t,o)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))r.call(t,o)&&s(e,o,t[o]);if(p)for(var o of p(t))i.call(t,o)&&s(e,o,t[o]);return e},l=(e,t)=>d(e,u(t));var c=(e,t)=>{var o={};for(var n in e)r.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&p)for(var n of p(e))t.indexOf(n)<0&&i.call(e,n)&&(o[n]=e[n]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var n=o,{components:e}=n,t=c(n,[\"components\"]);return mdx(MDXLayout,l(a(a({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Now gather round for a spooky story\"),mdx(\"p\",null,`Late one night... in the haunted office space castle (hindenbugs cackling in\nthe background amongst the dusty technical books) the midnight candles were\nburning bright and we entered data for a user file`),mdx(\"p\",null,`A simple 52MB gzipped datafile that we want to process in the browser. We unzip\nit, decode it, and ...an error`),mdx(\"p\",null,\"ERROR: data not found\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"/media/pumpkin-dark.jpg\",alt:null}))),mdx(\"p\",null,'But... our code is so simple (we of course abide by the religion of writing \"simple code\" you know)...what could be happening?'),mdx(\"p\",null,\"The code looks like this\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-js\"}),`const buf = unzip(file)\nconst str = new TextDecoder().decode(buf)\n`)),mdx(\"p\",null,\"We trace it back and run a console.log(str)\"),mdx(\"p\",null,\"It looks empty. We try running console.log(str.length) ... it prints out 0\"),mdx(\"p\",null,\"But if we console.log(buffer.length) we get 546,483,710 bytes...\"),mdx(\"p\",null,\"What could be happening?\"),mdx(\"p\",null,'We see in the TextDecoder documentation that it has a note called \"fatal\". We try'),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-js\"}),`const buf = unzip(file)\nconst str = new TextDecoder('utf8', { fatal: true }).decode(buf)\n`)),mdx(\"p\",null,\"This doesn't change the results though\"),mdx(\"p\",null,`Then it dawns on us while the lightning hits and the thunderclap booms and the\nwind blows through the rattly windows`),mdx(\"p\",null,\"We have hit...the maximum string length in Chrome\"),mdx(\"p\",null,\"BWAHAHAHAHA\"),mdx(\"p\",null,\"The maximum string length!!! Nooooooo\"),mdx(\"p\",null,\"It is 512MB on the dot... 536,870,888 bytes. We test this to be sure\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-js\"}),`const len = 536_870_888\nconst buf = new Uint8Array(len)\nfor (let i = 0; i < len; i++) {\n  buf[i] = 'a'.charCodeAt(0)\n}\nconst str = new TextDecoder().decode(buf)\nconsole.log(str.length)\n`)),mdx(\"p\",null,\"This is correct, outputs 536,870,888\"),mdx(\"p\",null,\"With anything, even one byte more, it fails and outputs 0\"),mdx(\"p\",null,\"happy halloween!!\"),mdx(\"p\",null,\"pumpkin photo source: \",mdx(\"a\",a({parentName:\"p\"},{href:\"http://mountainbikerak.blogspot.com/2010/11/google-chrome-pumpkin.html\"}),\"http://mountainbikerak.blogspot.com/2010/11/google-chrome-pumpkin.html\")),mdx(\"p\",null,\"chrome 95 tested\"),mdx(\"p\",null,\"nodejs 15 - at 512MB+1 bytes it prints an error message \",mdx(\"inlineCode\",{parentName:\"p\"},\"Error: Cannot create a string longer than 0x1fffffe8 characters\"),` for significantly greater than 512MB\ne.g. 600MB it actually prints a different error `,mdx(\"inlineCode\",{parentName:\"p\"},\"TypeError [ERR_ENCODING_INVALID_ENCODED_DATA]: The encoded data was not valid for encoding utf-8\"),\")\"),mdx(\"p\",null,'firefox 93 - goes up to ~1GB but then gives Exception { name: \"NS_ERROR_OUT_OF_MEMORY\", message: \"\", result: 2147942414'),mdx(\"p\",null,\"midori 6 (safari-alike/webkit) - goes up to ~2GB fine! will have to test more\"))}MDXContent.isMDXComponent=!0;\n","scope":{}}}]},"__N_SSG":true}