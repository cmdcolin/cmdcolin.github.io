<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/39537df1dfa69610d89e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/39537df1dfa69610d89e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-b97a0ed4f13ff8397343.js" defer=""></script><script src="/_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-72a03db9ecdc52193d45.js" defer=""></script><script src="/_next/static/chunks/pages/2020-12-26-pt2-3dac66400e95b1381280.js" defer=""></script><script src="/_next/static/OTXqL_pNLhZW5kFHttQ5t/_buildManifest.js" defer=""></script><script src="/_next/static/OTXqL_pNLhZW5kFHttQ5t/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><a href="/">Return home</a><img src="/avatar.png" style="height:2em;margin-left:1em"/></div><div class="blog"><h1>Making a HTTPS accessible S3 powered static site with CloudFront+route 53</h1><p>This is not a very authoritative post because I stumbled though this but
I think I got it working now on my website :)</p><h2>Setup your S3 bucket</h2><p>First setup your S3 bucket, your bucket must be named yourdomain.com
e.g. named after your domain</p><p>Then if you have a create-react-app setup I add a script in package.json
that runs</p><pre><code> &quot;predeploy&quot;: &quot;npm run build&quot;,
 &quot;deploy&quot;: &quot;aws sync --delete build s3://yourdomain.com&quot;
</code></pre><p>Then we can run &quot;yarn deploy&quot; and it will automatically upload our
create-react-app website to our S3 static site bucket.</p><p>Then make sure your bucket has public permissions enabled
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2">https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2</a>Then
make sure your bucket has &quot;static site hosting&quot; enabled too</p><h2>Setup route 53, and make your NS entries in domains.google.com</h2><p>I bought a domain with domains.google.com</p><p>Google then emailed me to validate my ownership</p><p>Then I went to aws.amazon.com route 53 and I created a hosted zone</p><p>This generated 4 name server entries and I added those to the
domains.google.com site</p><p><img src="/media/638618421776515072_0.png"/></p><p>Screenshot shows copying the NS values from route 53 to the name servers
area of domains.google.com</p><h2>Setup your Amazon certificate for making SSL work on CloudFront</h2><p>To properly setup However, this does not work so you need to go to
Amazon Certificates-&gt;Provision certificates</p><p>We request the certificate for</p><p><a href="http://www.yourdomain.com">www.yourdomain.com</a>
yourdomain.com</p><p>Then it generates some codes for a CNAME value for each of those two
entries, and has a button to autoimport those CNAME values to route53</p><p>Then it will say &quot;Pending validation&quot;...I waited like an hour and then
it changed to &quot;Success&quot;.</p><p><img src="/media/638618421776515072_1.png"/></p><p>Screenshot shows the now successful Amazon Certificate. After you get
this, you can proceed to finishing your cloudfront</p><h2>Create a CloudFront distribution and add &quot;Alternative CNAME&quot; entries for your domain</h2><p>Then we can update our CloudFront distribution and add these to
the &quot;Alternative CNAME&quot; input box</p><p>yourdomain.com
<a href="http://www.yourdomain.com">www.yourdomain.com</a></p><p>Note also that I first generated my certificate in us-east-2 but the
&quot;Import certificate form&quot; in cloudfront said I had to create it in
us-east-1</p><p><img src="/media/638618421776515072_2.png"/></p><h2>Add a default object index.html to the CloudFront setting</h2><p>Make your CloudFront &quot;default object&quot; is index.html</p><p>You have to manually type this in :)</p><h2>Add the CloudFront distribution to your Route 53</h2><p>Add a Route 53 &quot;A&quot; record that points to the CloudFront domain name e.g.
d897d897d87d98dd.cloudfront.net</p><h2>Summary of steps needed</h2><p>The general hindsight 20/20 procedure is</p><ol><li>Upload your static content to an S3 bucket called yoursite.com (must
be your domain name)</li><li>Make your S3 bucket have the &quot;static website&quot; setting on in the
properties menu and add a permissions policy that supports getObject
e.g. <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2">https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-2</a></li><li>Create a CloudFront distribution for your website</li><li>Make the CloudFront default object index.html</li><li>Create your domain with domains.google.com or similar</li><li>Point the google domain&#x27;s name server to Route 53 NS list from AWS</li><li>Add Route 53 A records that point to the CloudFront domain name e.g.
d897d897d87d98dd.cloudfront.net</li><li>Create Amazon issued certificate for yourdomain.com, which can
auto-import a validation CNAME to your Route 53</li><li>Make your CloudFront domain support your Alternative CNAME&#x27;s e.g.
yourdomain.com which requires importing (e.g. selecting from a list
that they auto-populate) your Amazon-issued-certificate</li></ol><h2>Troubleshooting and notes</h2><p>Problem: Your website gives 403 CloudFlare error
Solution: You have to get the Alternateive CNAME configuration setup
(pre-step involves the certificate request and validation)</p><p>Problem: Your website gives an object not found error
Solution: Set the CloudFront &quot;default object&quot; to index.html</p><h2>Random comment</h2><p>This is one of those processes (creating the cloudfront/route 53) that
probably could have done with the aws-sam CLI and it would have possibly
been easier, it is quite fiddly doing all these steps in the web
interface</p><p>::: {#footer}
<!-- -->[ December 26th, 2020 8:53pm ]<!-- -->{#timestamp}
:::</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/2020-12-26-pt2","query":{},"buildId":"OTXqL_pNLhZW5kFHttQ5t","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>