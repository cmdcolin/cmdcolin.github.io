<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/39537df1dfa69610d89e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/39537df1dfa69610d89e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-b97a0ed4f13ff8397343.js" defer=""></script><script src="/_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-72a03db9ecdc52193d45.js" defer=""></script><script src="/_next/static/chunks/pages/2017-03-12-b5b732a28589f36a10d4.js" defer=""></script><script src="/_next/static/Qd0XArxtmaPq271VU008B/_buildManifest.js" defer=""></script><script src="/_next/static/Qd0XArxtmaPq271VU008B/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div><a href="/">Return home</a><img src="/avatar.png" style="height:2em;margin-left:1em"/></div><div class="blog"><h1>How I learned to hate ORM (especially for data import scripts)</h1><p>When I was tasked with making a new application for our websites, I was
given several CSV files with some expectation that these files could
basically be just loaded into a database and jumped into production really
quickly. If you are using R and Shiny to make a data visualization dashboard,
especially if it is read only, this can actually be a reality for you: load
those CSVs and just pretend you&#x27;re a full featured database. I had to actually
create some read write functionality though. This was sort of experimental for
me and I&#x27;m not that well versed in databases, but I wanted to share my
experience</p><p>When I started, I chose grails/groovy/hibernate/GORM as a platform to
use. This quickly turned into pain when I tried to make a data importer
using grails also.</p><p>Each CSV row from the source file would have to be turned into many
different rows in the database because it represented multiple
relationships, example:</p><p><img src="/media/158300473458_0.png"/></p><p>Initially I made my data importer in grails, and was hardcoding column
names knowing full well this was really inflexible. At the same time I
was also trying to &quot;iterate&quot; on my database schema, and I&#x27;d want to
re-import my data to test it out, but it was really really slow. I tried
many different approaches to try to speed this up such as cleanUpGorm,
StatelessSessions, and other tricks, but it would take 10-20 minutes for
imports on a 100KB input file.  </p><p>What I basically realised is that for bulk data import</p><p><strong>1) Using the ORM is really painful for bulk import.</strong></p><p><strong>2) If you can pre-process your data so that it is already in the
format the database expects, then you can use the CSV COPY command which
is very fast</strong></p><p><strong>3) If you can then abandon the ORM mentality and even ignore it as
a convenience factor, then you can embrace my database system itself</strong></p><p>Overall, after all this work, it just seemed like ORM treats the
database as a danger and something to be heavily abstracted over, but I
actually found joy in learning how to treat my database as a first class
citizen. Soon I started gaining appreciation of</p><ul><li>using plain SQL queries</li><li>learning about full text search in postgres with ts_query</li><li>learning about triggers to make a &quot;last updated&quot; field get updated
automatically</li></ul><p>I am pretty happy this way, and although I miss some things like
criteria queries which are very powerful, I am happy that I can interact
with my database as a friend</p><p>At the very least, due to the fact that I now pre-process the data
before database loading, I can now import large amounts of data super
fast with the CSV COPY command</p><p>::: {#footer}
<!-- -->[ March 12th, 2017 3:13am ]<!-- -->{#timestamp} <!-- -->[grails]<!-- -->{.tag}
<!-- -->[postgresql]<!-- -->{.tag} <!-- -->[sql]<!-- -->{.tag}
:::</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/2017-03-12","query":{},"buildId":"Qd0XArxtmaPq271VU008B","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>