<!DOCTYPE html>
<html>
  <body>
    <button id="poke">Get pokemon</button>
    <button id="clear">Clear cache</button>
    <div id="output"></div>
    <div id="error"></div>
    <script>
      async function getPokemon() {
        const id = Math.floor(Math.random() * 150)
        const url = 'https://pokeapi.co/api/v2/pokemon/' + id
        const ret = await fetch(url)
        if (!ret.ok) {
          throw new Error(
            `Failed to fetch ${url} HTTP ${ret.status} ${ret.statusText}`,
          )
        }
        return ret.json()
      }

      let res = undefined
      async function getCachedPokemon() {
        if (!res) {
          res = getPokemon().catch(e => {
            res = undefined
          })
        }
        return res
      }

      function clearCache() {
        res = undefined
      }

      async function loadPokemon() {
        try {
          const result = await getCachedPokemon()
          document.getElementById('output').innerHTML = result.name
        } catch (e) {
          console.error(e)
          document.getElementById('error').innerHTML = `${e}`
        }
      }

      document.getElementById('poke').addEventListener('click', () => {
        document.getElementById('output').innerHTML = 'Loading...'
        loadPokemon()
      })

      document.getElementById('clear').addEventListener('click', () => {
        clearCache()
      })
    </script>
  </body>
</html>
