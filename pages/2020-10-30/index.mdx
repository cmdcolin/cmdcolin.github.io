## A spooky error when you have a string bigger than 512MB

Sometimes we try to process fairly large user data in JS. people often tell us, this is dumb. JS can't handle big data. Well, in this case, they might be right

Now gather round for a spooky story

Late one night in the haunted office space (cue hindenbugs cackling in the background) the candles were burning bright and we entered data for a user file

A simple 52MB gzipped datafile that we wanted to process in the browser

We unzip it, decode it, and ERROR: data not found

![](images/pumpkin.jpg)


We can see in the file we clearly have valid data


In nodeJS we get a different error

With 6_000_000 bytes

```
~ ❯❯❯ node test.js                                                                            ✘ 130
node:internal/encoding:424
        throw new ERR_ENCODING_INVALID_ENCODED_DATA(this.encoding, ret);
        ^

TypeError [ERR_ENCODING_INVALID_ENCODED_DATA]: The encoded data was not valid for encoding utf-8
    at new NodeError (node:internal/errors:329:5)
    at TextDecoder.decode (node:internal/encoding:424:15)
    at Object.<anonymous> (/home/cdiesh/test.js:6:31)
    at Module._compile (node:internal/modules/cjs/loader:1092:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1121:10)
    at Module.load (node:internal/modules/cjs/loader:972:32)
    at Function.Module._load (node:internal/modules/cjs/loader:813:14)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:76:12)
    at node:internal/main/run_main_module:17:47 {
  errno: 1,
  code: 'ERR_ENCODING_INVALID_ENCODED_DATA'
}

```

With 512MB+1 bytes
```
~ ❯❯❯ node test.js                                                                            ✘ 130
node:buffer:603
    slice: (buf, start, end) => buf.ucs2Slice(start, end),
                                    ^

Error: Cannot create a string longer than 0x1fffffe8 characters
    at Object.slice (node:buffer:603:37)
    at Uint8Array.toString (node:buffer:812:14)
    at TextDecoder.decode (node:internal/encoding:426:18)
    at Object.<anonymous> (/home/cdiesh/test.js:6:31)
    at Module._compile (node:internal/modules/cjs/loader:1092:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1121:10)
    at Module.load (node:internal/modules/cjs/loader:972:32)
    at Function.Module._load (node:internal/modules/cjs/loader:813:14)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:76:12)
    at node:internal/main/run_main_module:17:47 {
  code: 'ERR_STRING_TOO_LONG'

```

works

```
const len = 536_870_888;
const buf = new Uint8Array(len);
for (let i = 0; i < len; i++) {
  buf[i] = "a".charCodeAt(0);
}
const str = new TextDecoder().decode(buf);
console.log(str.length);
```


source: http://mountainbikerak.blogspot.com/2010/11/google-chrome-pumpkin.html
